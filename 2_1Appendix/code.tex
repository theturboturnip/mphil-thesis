\chapter{Code Snippets}
This appendix contains code snippets referenced in the document.
Some small snippets include comparison to generated assembly, which is extracted using \url{godbolt.org}.
The full codebases are available online at \redact{\gitrepo{theturboturnip/riscv-v-lite}{https://github.com/theturboturnip/riscv-v-lite} and \gitrepo{theturboturnip/cheri-compressed-cap}{https://github.com/theturboturnip/cheri-compressed-cap}}, and attached to the submission.

% \section{C examples}
% \section{C example --- Saving/restoring vector registers}
% This code generated by Clang 15, that demonstrates saving/restoring vector registers when a function is called.

\clearpage
\pagebreak
\section{C example --- Basic RVV program}\label{example:rvv}
This a reproduction of \url{https://github.com/riscv-non-isa/rvv-intrinsic-doc/blob/master/examples/rvv_memcpy.c}, with annotations to mirror the steps from \cref{chap:software:subsec:vectorintrinsics}.
\inputframedminted[breaklines=true]{c}{./code/rvv_memcpy.c}

\clearpage
\pagebreak
\section{C example --- Saving/restoring vector registers}
\todomark{add preamble}
\begin{figure}[h]
    \caption{Clang 15: Saving/restoring vector registers\\Reproduced from \url{https://godbolt.org/z/4xfMoxsT7}}\label{example:saverestore}

    \centering
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=1,lastline=11]{c}{./code/saving_vector.txt}
        \caption{C code}
    \end{subfigure}

    \vspace{1em}
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=13,lastline=28]{asm}{./code/saving_vector.txt}
        \caption{Generated assembly}
    \end{subfigure}
\end{figure}
\clearpage

\pagebreak
\section{C example --- Arm SVE}\label{example:armsvec}
This section shows how to use Arm SVE in C, in various ways.
The output is compiled with the latest GCC (Clang also supports Arm SVE, but generates longer output).
Output for GCC and Clang is available at \url{https://godbolt.org/z/8edWMscfP}.

\begin{figure}[h]
    \caption{Arm SVE --- Autovectorization}

    \centering
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=4,lastline=8]{c}{./code/arm_sve.txt}
        \caption{C code}
    \end{subfigure}

    \vspace{1em}
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=52,lastline=67]{asm}{./code/arm_sve.txt}
        \caption{Generated assembly}
    \end{subfigure}
\end{figure}

\clearpage
\pagebreak

\begin{figure}[h]
    \caption{Arm SVE --- Intrinsics}

    \centering
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=12,lastline=24]{c}{./code/arm_sve.txt}
        \caption{C code}
    \end{subfigure}

    \vspace{1em}
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=68,lastline=83]{asm}{./code/arm_sve.txt}
        \caption{Generated assembly}
    \end{subfigure}
\end{figure}

\clearpage
\pagebreak

\begin{figure}[h]
    \caption{Arm SVE --- Inline Assembly}

    \centering
    \begin{subfigure}[t]{\linewidth}
        \inputframedminted[breaklines=true,firstline=26,lastline=48]{c}{./code/arm_sve.txt}
        \caption{C code}
    \end{subfigure}

    \vspace{1em}
    \begin{subfigure}[t]{0.8\linewidth}
        \inputframedminted[breaklines=true,firstline=84,lastline=97]{asm}{./code/arm_sve.txt}
        \caption{Generated assembly}
    \end{subfigure}
\end{figure}

\clearpage
\pagebreak

% \begin{figure}[h]
%     \caption{Example Arm SVE C code\\Autovectorization, intrinsics, inline assembly}
%     \centering
%     \inputframedminted[breaklines=true,firstline=1,lastline=48]{c}{./code/arm_sve.txt}
% \end{figure}

% \clearpage
% \pagebreak
% \begin{figure}[h]
%     \caption{Example GCC outputs\\\url{https://godbolt.org/z/8edWMscfP}}
%     \begin{subfigure}[t]{0.8\linewidth}
%         \inputframedminted[breaklines=true,firstline=52,lastline=67]{asm}{./code/arm_sve.txt}
%         \caption{Automatic vectorization}
%     \end{subfigure}
%     \vspace{1em}
%     \begin{subfigure}[t]{0.8\linewidth}
%         \inputframedminted[breaklines=true,firstline=68,lastline=83]{asm}{./code/arm_sve.txt}
%         \caption{Intrinsics}
%     \end{subfigure}
%     \vspace{1em}
%     \begin{subfigure}[t]{0.8\linewidth}
%         \inputframedminted[breaklines=true,firstline=84,lastline=97]{asm}{./code/arm_sve.txt}
%         \caption{Inline assembly}
%     \end{subfigure}
% \end{figure}


\section{\code{riscv-v-lite} --- Vector memory accesses}\label{appx:code:vector_mem_access}
\inputframedminted[breaklines=true]{rust}{./code/vector_accesses_snippet.rs}