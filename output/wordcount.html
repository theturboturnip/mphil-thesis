<html>
<head>
<meta http-equiv='content-type' content='text/html; charset=utf8'>
<style>
<!--
body {width:auto;padding:5;margin:5;}
.error {font-weight:bold;color:#f00;font-style:italic; border: solid 1px red;}
.word,.hword,.oword,.altwd {border-left: 1px solid #CDF; border-bottom: 1px solid #CDF;}
.word {color: #009}
.hword {color: #009; font-weight: 700;}
.oword {color: #009; font-style: italic;}
.altwd {color: #c0c; font-style: oblique;}
.cmd {color: #c00;}
.exclcmd {color: #f99;}
.option {color: #cc0;}
.optparm {color: #c90;}
.envir, .document {color: #900; font-weight:bold;}
.math {color: #6c0;}
.mathgroup {color: #090;}
.exclmath {color: #9f6;}
.mathcmd {color: #6c0;}
.ignore {color: #999;}
.exclenv {color:#c66;}
.special {color:#c66; font-weight: bold;}
.specarg {color:#c66; font-weight: bold; font-style: italic;}
.tc {color: #999; font-weight:bold;}
.comment {color: #999; font-style: italic;}
.state {color: #990; font-size: 70%;}
.cumsum {color: #999; font-size: 80%;}
.fileinc {color: #696; font-weight:bold;}
.warning {color: #c00; font-weight: 700;}
.note {color: #c90; font-weight: bold;}

div.filegroup, div.parse, div.stylehelp, div.count, div.sumcount, div.error {
   border: solid 1px #999; margin: 4pt 0pt; padding: 4pt;
}
div.stylehelp {font-size: 80%; background: #fffff0; margin-bottom: 16pt;}
div.filegroup {background: #dfd; margin-bottom: 16pt;}
div.count {background: #ffe;}
div.sumcount {background: #cec;}
div.error {background: #fcc;}
.parse {font-size: 80%; background: #f8fff8; border-bottom:none;}

ul.count {list-style-type: none; margin: 4pt 0pt; padding: 0pt;}
.count li.header {font-weight: bold; font-style: italic;}
.subcount li.header {font-weight: normal; font-style: italic;}
.subcount li {margin-left: 16pt; font-size: 80%;}
.fielddesc {font-style: italic;}
.nb {color: #900;}

table.stat {border:2px solid #339; margin:0 0 8pt 0; background:#666; border-collapse:collapse;}
table.stat tr {border:1px solid #CCC;}
table.stat th, table.stat td {padding:1pt 4pt;}
table.stat col {padding:4pt;}
table.stat thead {background: #CCF;}
table.stat tbody {border:1px solid #333;}
table.stat tbody.sumstat {background:#FFC;}
table.stat tbody.langstat {background:#FEE;}
table.stat tbody.wordstat {background:#EEF;}
table.stat tbody.macrostat {background:#EFE;}
table.stat .sum {font-weight:bold; font-style:italic;}
-->
</style>
</head>

<body>

<h1>LaTeX word count</h1>

<div class='filegroup'>
<h2>File: chapters.tex</h2>
<div class='parse'><p>
<span class='tc'>%TC:macro \todomark [ignore]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:macro \todoref [ignore]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:macro \todocite [option:text,ignore]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:macro \redact [text]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:macro \gitfile [option:text,text,text,ignore]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:macro \gitrepo [option:text,text,ignore]</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:fileinclude \figinput file</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:usepackage hyperref</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:usepackage cleveref</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:usepackage subfiles</span><span class='cumsum'> [0]</span><br>
<span class='tc'>%TC:usepackage amsmath</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='comment'>% The above comments tell texcount that some macros should not have their arguments counted as text.</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% \todomark, \todoref, and \todocite are all macros used during development - there will be no TODO messages</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% in the final release.</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% In particular, \todomark is sometimes used with long sentences e.g. \todomark{Should I use a different sentence here?} which I don't want to count.</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% The \cref and \crefrange macros are used throughout the thesis, and are counted slightly incorrectly:</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% While the actual output of \cref{hyp:cap_in_vec_load_store} = "Hyp. H-8" (2 or 3 words), TeXcount counts it as "hyp cap in vec load store" (6 words).</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% This means the actual wordcount is an over-approximation.</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='comment'>% TC:subst tells TeXcount to interpret \subfile as \input for the purposes of word counting.</span><span class='cumsum'> [0]</span><br>
<span class='comment'>% TeXcount has native support for the subfiles package, but because this file doesn't have a preamble we can't tell TeXcount that we're using it.</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='comment'>% Any text that is \redact-ed in the anonymous version is still counted.</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_10Introduction/content</span><span class='ignore'>}</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='comment'>% --- Start of included file ./1_10Introduction/content.tex</span><span class='cumsum'> [0]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [0]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [0]</span><br>
<span class='cumsum'> [0]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>Introduction</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>wc</span><span class='ignore'>:</span><span class='ignore'>start</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>intro</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='comment'>% PLAN: 1k words</span><span class='cumsum'> [1]</span><br>
<span class='comment'>% 2-3 pages</span><span class='cumsum'> [1]</span><br>
<span class='cumsum'> [1]</span><br>
<span class='comment'>% \todomark{para on what capabilities are}</span><span class='cumsum'> [1]</span><br>
<span class='word'>Since</span> <span class='word'>2010</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>Cambridge</span> <span class='word'>Computer</span> <span class='word'>Lab</span> <span class='ignore'>(</span><span class='word'>in</span> <span class='word'>association</span> <span class='word'>with</span> <span class='word'>SRI</span><span class='ignore'>)</span> <span class='word'>has</span> <span class='word'>been</span> <span class='word'>developing</span> <span class='word'>the</span> <span class='word'>CHERI</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Capability</span> <span class='oword'>Hardware</span> <span class='oword'>Enhanced</span> <span class='oword'>RISC</span> <span class='oword'>Instructions</span><span class='ignore'>}</span> <span class='word'>architecture</span> <span class='word'>extension</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>improves</span> <span class='word'>the</span> <span class='word'>security</span> <span class='word'>of</span> <span class='word'>any</span> <span class='word'>given</span> <span class='word'>architecture</span> <span class='word'>by</span> <span class='word'>checking</span> <span class='word'>all</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>in</span> <span class='word'>hardware</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='word'>The</span> <span class='word'>core</span> <span class='word'>impact</span> <span class='word'>of</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>on</span> <span class='word'>a</span> <span class='word'>hardware</span> <span class='word'>level</span><span class='ignore'>,</span> <span class='word'>is</span> <span class='word'>that</span> <span class='word'>memory</span> <span class='word'>can</span> <span class='word'>no</span> <span class='word'>longer</span> <span class='word'>be</span> <span class='word'>accessed</span> <span class='word'>directly</span> <span class='word'>through</span> <span class='word'>raw</span> <span class='word'>addresses</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>must</span> <span class='word'>pass</span> <span class='word'>through</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>capability</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-941</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [65]</span><br>
<span class='word'>Capabilities</span> <span class='word'>are</span> <span class='word'>unforgeable</span> <span class='word'>tokens</span> <span class='word'>that</span> <span class='word'>grant</span> <span class='word'>fine-grained</span> <span class='word'>access</span> <span class='word'>to</span> <span class='word'>ranges</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [77]</span><br>
<span class='word'>Instead</span> <span class='word'>of</span> <span class='word'>generating</span> <span class='word'>them</span> <span class='word'>from</span> <span class='word'>scratch</span><span class='ignore'>,</span> <span class='word'>capabilities</span> <span class='word'>must</span> <span class='word'>be</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>derived</span><span class='ignore'>}</span> <span class='word'>from</span> <span class='word'>another</span> <span class='word'>capability</span> <span class='word'>with</span> <span class='word'>greater</span> <span class='word'>permissions</span><span class='ignore'>.</span><span class='cumsum'> [93]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>giving</span> <span class='word'>read-write</span> <span class='word'>access</span> <span class='word'>to</span> <span class='word'>an</span> <span class='word'>array</span> <span class='word'>of</span> <span class='word'>structures</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>a</span> <span class='word'>sub-capability</span> <span class='word'>granting</span> <span class='word'>read-only</span> <span class='word'>access</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>element</span><span class='ignore'>.</span><span class='cumsum'> [119]</span><br>
<span class='word'>This</span> <span class='word'>vastly</span> <span class='word'>reduces</span> <span class='word'>the</span> <span class='word'>scope</span> <span class='word'>of</span> <span class='word'>security</span> <span class='word'>violations</span> <span class='word'>through</span> <span class='word'>spatial</span> <span class='word'>errors</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>buffer</span> <span class='word'>overflows</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>szekeresSoKEternalWar2013</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>creates</span> <span class='word'>interesting</span> <span class='word'>opportunities</span> <span class='word'>for</span> <span class='word'>software</span> <span class='word'>compartmentalization</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>watsonCHERIHybridCapabilitySystem2015</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [140]</span><br>
<span class='cumsum'> [140]</span><br>
<span class='word'>Industry</span> <span class='word'>leaders</span> <span class='word'>have</span> <span class='word'>recognized</span> <span class='word'>the</span> <span class='word'>value</span> <span class='word'>CHERI</span> <span class='word'>provides</span><span class='ignore'>.</span><span class='cumsum'> [148]</span><br>
<span class='word'>Arm</span> <span class='word'>Inc</span> <span class='word'>have</span> <span class='word'>manufactured</span> <span class='word'>the</span> <span class='word'>Morello</span> <span class='word'>System-on-Chip</span><span class='ignore'>,</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>their</span> <span class='word'>Neoverse</span> <span class='word'>N1</span> <span class='word'>CPU</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>incorporates</span> <span class='word'>CHERI</span> <span class='word'>capabilities</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>Armv8.2</span> <span class='word'>ISA</span><span class='ignore'>.</span><span class='cumsum'> [169]</span><br>
<span class='word'>While</span> <span class='word'>this</span> <span class='word'>represents</span> <span class='word'>a</span> <span class='word'>great</span> <span class='word'>step</span> <span class='word'>forward</span><span class='ignore'>,</span> <span class='word'>there</span> <span class='word'>are</span> <span class='word'>still</span> <span class='word'>elements</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>SoC</span> <span class='word'>that</span> <span class='word'>haven't</span> <span class='word'>fully</span> <span class='word'>embraced</span> <span class='word'>CHERI</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>GPU</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>architecture</span> <span class='word'>extensions</span> <span class='word'>that</span> <span class='word'>haven't</span> <span class='word'>been</span> <span class='word'>investigated</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>context</span> <span class='word'>of</span> <span class='word'>CHERI</span><span class='ignore'>.</span><span class='cumsum'> [203]</span><br>
<span class='word'>One</span> <span class='word'>such</span> <span class='word'>example</span> <span class='word'>is</span> <span class='word'>Arm's</span> <span class='word'>Scalable</span> <span class='word'>Vector</span> <span class='word'>Extension</span> <span class='ignore'>(</span><span class='word'>introduced</span> <span class='word'>in</span> <span class='word'>Armv8.2</span> <span class='word'>but</span> <span class='word'>not</span> <span class='word'>included</span> <span class='word'>in</span> <span class='word'>Neoverse</span> <span class='word'>N1</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>is</span> <span class='word'>designed</span> <span class='word'>to</span> <span class='word'>remain</span> <span class='word'>in</span> <span class='word'>use</span> <span class='word'>well</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>future</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>stephensARMScalableVector2017</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [231]</span><br>
<span class='word'>Supporting</span> <span class='word'>this</span> <span class='word'>and</span> <span class='word'>other</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>ISAs</span> <span class='word'>in</span> <span class='word'>CHERI</span> <span class='word'>is</span> <span class='word'>essential</span> <span class='word'>to</span> <span class='word'>CHERI's</span> <span class='word'>long-term</span> <span class='word'>relevance</span><span class='ignore'>.</span><span class='cumsum'> [246]</span><br>
<span class='cumsum'> [246]</span><br>
<span class='comment'>% \todomark{para on what vectors are}</span><span class='cumsum'> [246]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>context</span> <span class='word'>of</span> <span class='word'>modern</span> <span class='word'>computer</span> <span class='word'>architecture</span><span class='ignore'>,</span> <span class='word'>vector</span> <span class='word'>processing</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>practice</span> <span class='word'>of</span> <span class='word'>dividing</span> <span class='word'>a</span> <span class='word'>large</span> <span class='word'>hardware</span> <span class='word'>register</span> <span class='word'>into</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>vector</span><span class='ignore'>}</span> <span class='word'>of</span> <span class='word'>multiple</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>elements</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>executing</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>operation</span> <span class='word'>on</span> <span class='word'>each</span> <span class='word'>element</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>instruction</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>is</span> <span class='oword'>a</span> <span class='oword'>SIMD</span> <span class='ignore'>(</span><span class='oword'>Single</span> <span class='oword'>Instruction</span> <span class='oword'>Multiple</span> <span class='oword'>Data</span><span class='ignore'>)</span> <span class='oword'>paradigm</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [291]</span><br>
<span class='word'>This</span> <span class='word'>data-level</span> <span class='word'>parallelism</span> <span class='word'>can</span> <span class='word'>drastically</span> <span class='word'>increase</span> <span class='word'>throughput</span><span class='ignore'>,</span> <span class='word'>particularly</span> <span class='word'>for</span> <span class='word'>arithmetic-heavy</span> <span class='word'>programs</span><span class='ignore'>.</span><span class='cumsum'> [302]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>before</span> <span class='word'>computing</span> <span class='word'>arithmetic</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>vectors</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>populated</span> <span class='word'>with</span> <span class='word'>data</span><span class='ignore'>.</span><span class='cumsum'> [313]</span><br>
<span class='comment'>% This is typically done using specialized vector memory accesses, which access a whole vector's worth of memory in a single instruction.</span><span class='cumsum'> [313]</span><br>
<span class='cumsum'> [313]</span><br>
<span class='comment'>% This was the initial motivation for investigating the interactions between CHERI and vector processing.</span><span class='cumsum'> [313]</span><br>
<span class='cumsum'> [313]</span><br>
<span class='comment'>% \todomark{above paras should explain why the interactions between the two are interesting}</span><span class='cumsum'> [313]</span><br>
<span class='cumsum'> [313]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Motivation</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='comment'>% \todomark{vectorized memory accesses required for vectorized arithmetic}</span><span class='cumsum'> [1]</span><br>
<span class='word'>Modern</span> <span class='word'>vector</span> <span class='word'>implementations</span> <span class='word'>all</span> <span class='word'>provide</span> <span class='word'>vector</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='word'>access</span> <span class='word'>a</span> <span class='word'>whole</span> <span class='word'>vector's</span> <span class='word'>worth</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [18]</span><br>
<span class='word'>These</span> <span class='word'>range</span> <span class='word'>from</span> <span class='word'>simple</span> <span class='word'>contiguous</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='word'>where</span> <span class='word'>all</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>next</span> <span class='word'>to</span> <span class='word'>each</span> <span class='word'>other</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>to</span> <span class='word'>complex</span> <span class='word'>indexed</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='word'>where</span> <span class='word'>each</span> <span class='word'>element</span> <span class='word'>loads</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>different</span> <span class='word'>location</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>another</span> <span class='word'>vector</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [48]</span><br>
<span class='word'>They</span> <span class='word'>can</span> <span class='word'>also</span> <span class='word'>have</span> <span class='word'>per-element</span> <span class='word'>semantics</span><span class='ignore'>,</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>elements</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>loaded</span> <span class='word'>in</span> <span class='word'>order</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>if</span> <span class='word'>one</span> <span class='word'>element</span> <span class='word'>fails</span> <span class='word'>the</span> <span class='word'>preceding</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>still</span> <span class='word'>valid</span><span class='ignore'>'</span><span class='ignore'>'</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>7.7</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [74]</span><br>
<span class='comment'>% \todomark{Necessary for CHERI support in order for CHERI performance to be competitive}</span><span class='cumsum'> [74]</span><br>
<span class='word'>If</span> <span class='word'>CHERI</span> <span class='word'>CPUs</span> <span class='word'>want</span> <span class='word'>to</span> <span class='word'>benefit</span> <span class='word'>from</span> <span class='word'>vector</span> <span class='word'>processing's</span> <span class='word'>increased</span> <span class='word'>performance</span> <span class='word'>and</span> <span class='word'>throughput</span><span class='ignore'>,</span> <span class='word'>they</span> <span class='word'>must</span> <span class='word'>support</span> <span class='word'>those</span> <span class='word'>instructions</span> <span class='word'>at</span> <span class='word'>some</span> <span class='word'>level</span><span class='ignore'>.</span><span class='cumsum'> [95]</span><br>
<span class='word'>But</span> <span class='word'>adding</span> <span class='word'>CHERI's</span> <span class='word'>bounds-checking</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>mix</span> <span class='word'>may</span> <span class='word'>affect</span> <span class='word'>these</span> <span class='word'>semantics</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>could</span> <span class='word'>impact</span> <span class='word'>performance</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>checking</span> <span class='word'>each</span> <span class='word'>element's</span> <span class='word'>access</span> <span class='word'>in</span> <span class='word'>turn</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>slow</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [120]</span><br>
<span class='cumsum'> [120]</span><br>
<span class='comment'>% \todomark{if this were the only priority, vectorized memory access doesn't need to be that fast relative to arithmetic?}</span><span class='cumsum'> [120]</span><br>
<span class='word'>Vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>performance</span> <span class='word'>is</span> <span class='word'>more</span> <span class='word'>critical</span> <span class='word'>than</span> <span class='word'>one</span> <span class='word'>may</span> <span class='word'>initially</span> <span class='word'>assume</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>vectors</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>for</span> <span class='word'>more</span> <span class='word'>than</span> <span class='word'>just</span> <span class='word'>computation</span><span class='ignore'>.</span><span class='cumsum'> [141]</span><br>
<span class='comment'>% \todomark{memcpy is a very common operation, vectorized on many platforms (cite)}</span><span class='cumsum'> [141]</span><br>
<span class='word'>A</span> <span class='word'>prime</span> <span class='word'>example</span> <span class='word'>is</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span><span class='ignore'>:</span> <span class='word'>for</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>x86</span><span class='cmd'>\_</span><span class='word'>64</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>glibc</span><span class='ignore'>}</span> <span class='word'>includes</span> <span class='word'>multiple</span> <span class='word'>versions</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>function</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>It</span> <span class='oword'>appears</span> <span class='oword'>memcpy</span> <span class='oword'>is</span> <span class='oword'>implemented</span> <span class='oword'>as</span> <span class='oword'>a</span> <span class='oword'>copy</span> <span class='oword'>of</span> <span class='oword'>memmove</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>taking</span> <span class='word'>advantage</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>platforms</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>selects</span> <span class='word'>one</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>at</span> <span class='word'>runtime</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitfile</span><span class='ignore'>{</span><span class='oword'>sysdeps</span><span class='ignore'>/</span><span class='oword'>x86</span><span class='ignore'>_</span><span class='oword'>64</span><span class='ignore'>/</span><span class='oword'>multiarch</span><span class='ignore'>/</span><span class='oword'>ifunc-memmove.h</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='oword'>bminor</span><span class='ignore'>/</span><span class='oword'>glibc</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>bminor</span><span class='ignore'>/</span><span class='ignore'>glibc</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>7b1cfba79ee54221ffa7d7879433b7ee1728cd76</span><span class='ignore'>/</span><span class='ignore'>sysdeps</span><span class='ignore'>/</span><span class='ignore'>x86</span><span class='ignore'>_</span><span class='ignore'>64</span><span class='ignore'>/</span><span class='ignore'>multiarch</span><span class='ignore'>/</span><span class='ignore'>ifunc-memmove.h</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [185]</span><br>
<span class='comment'>% \todomark{thus memory accesses themselves should be optimized}</span><span class='cumsum'> [185]</span><br>
<span class='word'>These</span> <span class='word'>implementations</span> <span class='word'>are</span> <span class='word'>written</span> <span class='word'>in</span> <span class='word'>assembly</span> <span class='word'>and</span> <span class='word'>heavily</span> <span class='word'>optimized</span><span class='ignore'>.</span><span class='cumsum'> [194]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>hitting</span> <span class='word'>the</span> <span class='word'>cache</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>few</span> <span class='word'>extra</span> <span class='word'>cycles</span> <span class='word'>of</span> <span class='word'>bounds-checking</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>could</span> <span class='word'>actually</span> <span class='word'>make</span> <span class='word'>a</span> <span class='word'>noticeable</span> <span class='word'>difference</span><span class='ignore'>.</span><span class='cumsum'> [217]</span><br>
<span class='cumsum'> [217]</span><br>
<span class='comment'>% \todomark{also raises the question of storing capabilities within vectors, which could be useful for revocation strategies as proposed in XYZ}</span><span class='cumsum'> [217]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>also</span> <span class='word'>raises</span> <span class='word'>the</span> <span class='word'>important</span> <span class='word'>question</span> <span class='word'>of</span> <span class='word'>how</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>model</span> <span class='word'>interacts</span> <span class='word'>with</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [231]</span><br>
<span class='word'>In</span> <span class='word'>non-CHERI</span> <span class='word'>processors</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>will</span> <span class='word'>copy</span> <span class='word'>pointers</span> <span class='word'>around</span> <span class='word'>in</span> <span class='word'>memory</span> <span class='word'>without</span> <span class='word'>fuss</span><span class='ignore'>.</span><span class='cumsum'> [243]</span><br>
<span class='word'>For</span> <span class='word'>a</span> <span class='word'>CHERI-enabled</span> <span class='word'>vector</span> <span class='word'>processor</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>this</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>would</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>capabilities</span> <span class='word'>from</span> <span class='word'>vectors</span> <span class='word'>without</span> <span class='word'>violating</span> <span class='word'>any</span> <span class='word'>security</span> <span class='word'>guarantees</span><span class='ignore'>.</span><span class='cumsum'> [268]</span><br>
<span class='word'>This</span> <span class='word'>may</span> <span class='word'>require</span> <span class='word'>more</span> <span class='word'>guarantees</span> <span class='word'>than</span> <span class='word'>otherwise</span> <span class='word'>necessary</span> <span class='ignore'>-</span> <span class='word'>for</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>each</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>likely</span> <span class='word'>needs</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>as</span> <span class='word'>large</span> <span class='word'>or</span> <span class='word'>larger</span> <span class='word'>than</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>capability</span><span class='ignore'>.</span><span class='cumsum'> [293]</span><br>
<span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{rvv introduces vectors for RVV}</span><span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{rvv is scalable vector}</span><span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{why rvv and not just arm}</span><span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{CHERI has a RISC-V ISA + various implementations, wants to support vectors}</span><span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{scalable vector support useful for future Arm support}</span><span class='cumsum'> [293]</span><br>
<span class='comment'>% \todomark{Current Morello doesn't support Arm SVE/NEON (cite?) despite the base Neoverse N1 supporting it (cite??)}</span><span class='cumsum'> [293]</span><br>
<span class='word'>To</span> <span class='word'>explore</span> <span class='word'>this</span> <span class='word'>topic</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>chose</span> <span class='word'>to</span> <span class='word'>focus</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>RISC-V</span> <span class='word'>Vector</span> <span class='word'>extension</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>shortened</span> <span class='word'>to</span> <span class='word'>RVV</span> <span class='word'>throughout</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [310]</span><br>
<span class='word'>As</span> <span class='word'>of</span> <span class='word'>November</span> <span class='word'>2021</span> <span class='word'>this</span> <span class='word'>has</span> <span class='word'>been</span> <span class='word'>ratified</span> <span class='word'>by</span> <span class='word'>RISC-V</span> <span class='word'>International</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>wiki.riscv.org</span><span class='ignore'>/</span><span class='ignore'>display</span><span class='ignore'>/</span><span class='ignore'>HOME</span><span class='ignore'>/</span><span class='ignore'>Recently</span><span class='ignore'>+</span><span class='ignore'>Ratified</span><span class='ignore'>+</span><span class='ignore'>Extensions</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>RISC-V's</span> <span class='word'>standard</span> <span class='word'>vector</span> <span class='word'>instruction</span> <span class='word'>set</span> <span class='word'>moving</span> <span class='word'>forward</span><span class='ignore'>.</span><span class='cumsum'> [332]</span><br>
<span class='word'>This</span> <span class='word'>has</span> <span class='word'>two</span> <span class='word'>key</span> <span class='word'>benefits</span><span class='ignore'>.</span><span class='cumsum'> [337]</span><br>
<span class='word'>Studying</span> <span class='word'>RVV</span> <span class='word'>will</span> <span class='word'>allow</span> <span class='word'>reference</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>CHERI-RVV</span><span class='ignore'>}</span> <span class='word'>implementations</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>built</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>CHERI</span> <span class='word'>project's</span> <span class='word'>open-source</span> <span class='word'>RISC-V</span> <span class='word'>cores</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>www.cl.cam.ac.uk</span><span class='ignore'>/</span><span class='ignore'>research</span><span class='ignore'>/</span><span class='ignore'>security</span><span class='ignore'>/</span><span class='ignore'>ctsrd</span><span class='ignore'>/</span><span class='ignore'>cheri</span><span class='ignore'>/</span><span class='ignore'>cheri-risc-v.html</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>don't</span> <span class='word'>currently</span> <span class='word'>support</span> <span class='word'>vector</span> <span class='word'>processing</span><span class='ignore'>.</span><span class='cumsum'> [361]</span><br>
<span class='word'>Secondly</span><span class='ignore'>,</span> <span class='word'>RVV</span> <span class='word'>is</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>scalable</span><span class='ignore'>}</span> <span class='word'>vector</span> <span class='word'>model</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>of</span> <span class='word'>each</span> <span class='word'>vector</span> <span class='word'>is</span> <span class='word'>implementation-dependent</span><span class='ignore'>.</span><span class='cumsum'> [376]</span><br>
<span class='word'>This</span> <span class='word'>has</span> <span class='word'>more</span> <span class='word'>potential</span> <span class='word'>roadblocks</span> <span class='word'>than</span> <span class='word'>a</span> <span class='word'>fixed-length</span> <span class='word'>vector</span> <span class='word'>model</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>investigating</span> <span class='word'>them</span> <span class='word'>here</span> <span class='word'>will</span> <span class='word'>make</span> <span class='word'>life</span> <span class='word'>easier</span> <span class='word'>if</span> <span class='word'>Arm</span> <span class='word'>wish</span> <span class='word'>to</span> <span class='word'>integrate</span> <span class='word'>their</span> <span class='word'>Scalable</span> <span class='word'>Vector</span> <span class='word'>Extension</span> <span class='word'>with</span> <span class='word'>CHERI</span> <span class='word'>later</span> <span class='word'>down</span> <span class='word'>the</span> <span class='word'>road</span><span class='ignore'>.</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='comment'>% \section{Aims}</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% The aim of this project is to investigate the impact of, and the roadblocks for, integrating a scalable vector architecture with CHERI's memory protection system.</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% In particular, we focus on integrating RVV with the CHERI-RISC-V ISA, with the aim of enabling a future CHERI-RVV implementation and informing the approach for a future CHERI Arm SVE implementation.</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='comment'>% % Investigate the reprecussions of adding scalable vector support to CHERI systems.</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% % \todomark{Identify where potential roadblocks could be, and where they couldn't be.}</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% % What are potential performance/compatibility roadblocks?</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% This project does not try to implement CHERI-RVV in a hardware description language.</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% Instead, it uses an emulator written in Rust to experiment with potential integration methods.</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% A higher-level approach allows us to evaluate what's plausible for hardware without getting stuck in the weeds of implementing it in full.</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='comment'>% % \todomark{Investigate from both hardware and software perspectives}</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% Software and the user story for writing CHERI-RVV programs is also considered. </span><span class='cumsum'> [409]</span><br>
<span class='comment'>% Where possible, vector code is generated from C source code using the CHERI-Clang compiler, rather than hand-writing assembly.</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% This reveals many problems CHERI-Clang has with vector intrinsics, which we later propose solutions to.</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='comment'>% % \todomark{Investigate from both (adding CHERI to vector) and (adding vectors to CHERI) perspectives}</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% As scalar CHERI processors and vector non-CHERI processors both already exist, we consider integration from both sides: how does vector processing change when adding CHERI, and how does CHERI change when adding vectors?</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% Examples of these perspectives include the following:</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% \begin{itemize}</span><span class='cumsum'> [409]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item When adding CHERI to vectors, do vectors need to be able to hold capabilities? If so, what changes are necessary?</span><span class='cumsum'> [409]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item When adding vectors to scalar CHERI, what are the benefits/drawbacks of using a separate hardware vector unit vs. an integrated scalar+vector pipeline?</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% \end{itemize}</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='comment'>% % How does CHERI impact vector implementations (i.e. storing capabilities inside vectors for generic memcpy)</span><span class='cumsum'> [409]</span><br>
<span class='comment'>% % How do vectors impact CHERI implementations (particularly scalable vectors?)</span><span class='cumsum'> [409]</span><br>
<span class='cumsum'> [409]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Hypotheses</span> <span class='hword'>and</span> <span class='hword'>Aims</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>The</span> <span class='word'>goal</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>project</span> <span class='word'>is</span> <span class='word'>to</span> <span class='word'>investigate</span> <span class='word'>the</span> <span class='word'>impact</span> <span class='word'>of</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>roadblocks</span> <span class='word'>for</span><span class='ignore'>,</span> <span class='word'>integrating</span> <span class='word'>a</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>architecture</span> <span class='word'>with</span> <span class='word'>CHERI's</span> <span class='word'>memory</span> <span class='word'>protection</span> <span class='word'>system</span><span class='ignore'>.</span><span class='cumsum'> [28]</span><br>
<span class='word'>In</span> <span class='word'>particular</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>focus</span> <span class='word'>on</span> <span class='word'>integrating</span> <span class='word'>RVV</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>ISA</span><span class='ignore'>,</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>aim</span> <span class='word'>of</span> <span class='word'>enabling</span> <span class='word'>a</span> <span class='word'>future</span> <span class='word'>CHERI-RVV</span> <span class='word'>implementation</span> <span class='word'>and</span> <span class='word'>informing</span> <span class='word'>the</span> <span class='word'>approach</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>future</span> <span class='word'>CHERI</span> <span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>implementation</span><span class='ignore'>.</span><span class='cumsum'> [59]</span><br>
<span class='cumsum'> [59]</span><br>
<span class='word'>The</span> <span class='word'>investigation</span> <span class='word'>was</span> <span class='word'>carried</span> <span class='word'>out</span> <span class='word'>by</span> <span class='word'>designing</span> <span class='word'>and</span> <span class='word'>testing</span> <span class='word'>a</span> <span class='word'>CHERI-RVV</span> <span class='word'>emulator</span> <span class='word'>written</span> <span class='word'>in</span> <span class='word'>Rust</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>that</span> <span class='word'>is</span> <span class='word'>only</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>implementation</span><span class='ignore'>.</span><span class='cumsum'> [81]</span><br>
<span class='word'>To</span> <span class='word'>show</span> <span class='word'>that</span> <span class='word'>RVV</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>integrated</span> <span class='word'>with</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>wide</span> <span class='word'>range</span> <span class='word'>of</span> <span class='word'>processors</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>use</span> <span class='word'>information</span> <span class='word'>gathered</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>to</span> <span class='word'>check</span> <span class='word'>nine</span> <span class='word'>hypotheses</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>hypotheses</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [107]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>as</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>ref</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>bounds</span><span class='ignore'>_</span><span class='ignore'>checks</span><span class='ignore'>_</span><span class='ignore'>amortized</span><span class='ignore'>}</span> <span class='word'>consider</span> <span class='word'>basic</span> <span class='word'>feasibility</span> <span class='word'>and</span> <span class='word'>potential</span> <span class='word'>hardware</span> <span class='word'>performance</span> <span class='word'>issues</span><span class='ignore'>.</span><span class='cumsum'> [115]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>legacy</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>pure</span><span class='ignore'>_</span><span class='ignore'>compat</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>stack</span><span class='ignore'>_</span><span class='ignore'>vectors</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>multiproc</span><span class='ignore'>}</span> <span class='word'>ensure</span> <span class='word'>that</span> <span class='word'>vector</span> <span class='word'>software</span> <span class='word'>is</span> <span class='word'>compatible</span> <span class='word'>with</span> <span class='word'>potential</span> <span class='word'>CHERI-RVV</span> <span class='word'>software</span> <span class='word'>stacks</span><span class='ignore'>.</span><span class='cumsum'> [126]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>storage</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>manip</span><span class='ignore'>}</span> <span class='word'>considers</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>conditions</span> <span class='word'>under</span> <span class='word'>which</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>can</span> <span class='word'>hold</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>vectorized</span> <span class='word'>instructions</span> <span class='word'>can</span> <span class='word'>manipulate</span> <span class='word'>them</span><span class='ignore'>.</span><span class='cumsum'> [143]</span><br>
<span class='cumsum'> [143]</span><br>
<span class='word'>This</span> <span class='word'>document</span> <span class='word'>also</span> <span class='word'>examines</span> <span class='word'>current</span> <span class='word'>practical</span> <span class='word'>realities</span><span class='ignore'>,</span> <span class='word'>such</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>limitations</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>current</span> <span class='word'>CHERI-RVV</span> <span class='word'>software</span> <span class='word'>stack</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>explains</span> <span class='word'>how</span> <span class='word'>to</span> <span class='word'>compile</span><span class='ignore'>/</span><span class='word'>execute</span> <span class='word'>CHERI-RVV</span> <span class='word'>code</span> <span class='word'>on</span> <span class='word'>baremetal</span> <span class='word'>platforms</span><span class='ignore'>.</span><span class='cumsum'> [171]</span><br>
<span class='word'>The</span> <span class='word'>RVV</span> <span class='word'>and</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>specifications</span> <span class='word'>are</span> <span class='word'>succinctly</span> <span class='word'>explained</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>background</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [180]</span><br>
<span class='cumsum'> [180]</span><br>
<span class='comment'>% Along with testing these hypotheses, this document serves as a practical explanation of the following:</span><span class='cumsum'> [180]</span><br>
<span class='comment'>% \begin{itemize}</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item The changes to RISC-V required by CHERI-RISC-V</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item The RISC-V-V vector model, and all memory-related instructions</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item How to compile CHERI-RVV code for a baremetal platform (with no operating system)</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item How to execute CHERI-RVV code compiled for a baremetal platform</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \item The limitations of the current CHERI-RVV software stack</span><span class='cumsum'> [180]</span><br>
<span class='comment'>% \end{itemize}</span><span class='cumsum'> [180]</span><br>
<span class='comment'>% \todomark{fill out this para more, have an actual end sentence}</span><span class='cumsum'> [180]</span><br>
<span class='cumsum'> [180]</span><br>
<span class='cmd'>\vfill</span><span class='cmd'>\null</span><span class='cumsum'> [180]</span><br>
<span class='cumsum'> [180]</span><br>
<span class='comment'>% Count hypothesis words - normally they shouldn't be counted, because they're inside a table,</span><span class='cumsum'> [180]</span><br>
<span class='comment'>% but we can't easily count when they're reproduced in later sections.</span><span class='cumsum'> [180]</span><br>
<span class='comment'>% Count them once here, and not after, which is equivalent to not counting them here but counting after.</span><span class='cumsum'> [180]</span><br>
<span class='tc'>%TC:macro \definehyp [ignore,text]</span><span class='cumsum'> [180]</span><br>
<span class='tc'>%TC:group table 0 1</span><span class='cumsum'> [180]</span><br>
<span class='tc'>%TC:group tabular 1 1</span><span class='cumsum'> [180]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\definehyp</span><span class='ignore'>}</span><span class='option'>[2]</span><span class='ignore'>{</span><span class='ignore'>{</span><span class='ignore'>\sethyptext</span><span class='ignore'>{</span><span class='ignore'>#</span><span class='ignore'>1</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>#</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>\newhyp</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='ignore'>\label</span><span class='ignore'>{</span><span class='ignore'>#</span><span class='ignore'>1</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>#</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='cumsum'> [180]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[h]</span><span class='cumsum'> [180]</span><br>
&nbsp;&nbsp;<span class='cmd'>\centering</span><span class='cumsum'> [180]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lp</span><span class='ignore'>{</span><span class='ignore'>0.9</span><span class='exclcmd'>\linewidth</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [180]</span><br>
&nbsp;&nbsp;<span class='cmd'>\toprule</span><span class='cumsum'> [180]</span><br>
&nbsp;&nbsp;<span class='cmd'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>l</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Hardware</span> <span class='word'>Hypotheses</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [182]</span><br>
&nbsp;&nbsp;<span class='cmd'>\midrule</span><span class='cumsum'> [182]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>as</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>ref</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [182]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>It</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>CHERI</span> <span class='word'>capabilities</span> <span class='word'>as</span> <span class='word'>memory</span> <span class='word'>references</span> <span class='word'>in</span> <span class='word'>all</span> <span class='word'>vector</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [196]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>bounds</span><span class='ignore'>_</span><span class='ignore'>checks</span><span class='ignore'>_</span><span class='ignore'>amortized</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [196]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>The</span> <span class='word'>capability</span> <span class='word'>bounds</span> <span class='word'>checks</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>elements</span> <span class='word'>within</span> <span class='word'>a</span> <span class='word'>known</span> <span class='word'>range</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>a</span> <span class='word'>cache</span> <span class='word'>line</span><span class='ignore'>)</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>check</span><span class='ignore'>,</span> <span class='word'>amortizing</span> <span class='word'>the</span> <span class='word'>cost</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [221]</span><br>
&nbsp;&nbsp;<span class='cmd'>\midrule</span><span class='cumsum'> [221]</span><br>
&nbsp;&nbsp;<span class='cmd'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>l</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Software</span> <span class='word'>Hypotheses</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [223]</span><br>
&nbsp;&nbsp;<span class='cmd'>\midrule</span><span class='cumsum'> [223]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>legacy</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [223]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>Vector</span> <span class='word'>code</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>compiled</span> <span class='word'>in</span> <span class='word'>legacy</span> <span class='word'>forms</span> <span class='ignore'>(</span><span class='word'>with</span> <span class='word'>integer</span> <span class='word'>addressing</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>function</span> <span class='word'>correctly</span> <span class='word'>on</span> <span class='word'>CHERI</span> <span class='word'>with</span> <span class='word'>no</span> <span class='word'>source</span> <span class='word'>code</span> <span class='word'>changes</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [244]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>pure</span><span class='ignore'>_</span><span class='ignore'>compat</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [244]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>Legacy</span> <span class='word'>vector</span> <span class='word'>code</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>compiled</span> <span class='word'>into</span> <span class='word'>a</span> <span class='word'>pure-capability</span> <span class='word'>form</span> <span class='word'>with</span> <span class='word'>no</span> <span class='word'>changes</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [257]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>stack</span><span class='ignore'>_</span><span class='ignore'>vectors</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [257]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>Vector</span> <span class='word'>code</span> <span class='word'>that</span> <span class='word'>saves</span><span class='ignore'>/</span><span class='word'>restores</span> <span class='word'>variable-length</span> <span class='word'>vectors</span> <span class='word'>to</span><span class='ignore'>/</span><span class='word'>from</span> <span class='word'>the</span> <span class='word'>stack</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>compiled</span> <span class='word'>on</span> <span class='word'>CHERI-RVV</span> <span class='word'>with</span> <span class='word'>no</span> <span class='word'>source</span> <span class='word'>code</span> <span class='word'>changes</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [278]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>multiproc</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [278]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>CHERI-vector</span> <span class='word'>code</span> <span class='word'>can</span> <span class='word'>run</span> <span class='word'>correctly</span> <span class='word'>in</span> <span class='word'>multiprocessing</span> <span class='word'>systems</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>execution</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>paused</span> <span class='word'>and</span> <span class='word'>resumed</span> <span class='word'>on</span> <span class='word'>interrupts</span> <span class='word'>or</span> <span class='word'>context</span> <span class='word'>switches</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [298]</span><br>
&nbsp;&nbsp;<span class='cmd'>\midrule</span><span class='cumsum'> [298]</span><br>
&nbsp;&nbsp;<span class='cmd'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>l</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Capabilities-in-Vectors</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [299]</span><br>
&nbsp;&nbsp;<span class='cmd'>\midrule</span><span class='cumsum'> [299]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>storage</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [299]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>It</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>to</span> <span class='word'>hold</span> <span class='word'>capabilities</span> <span class='word'>to</span> <span class='word'>enable</span> <span class='word'>copying</span> <span class='word'>without</span> <span class='word'>violating</span> <span class='word'>CHERI</span> <span class='word'>security</span> <span class='word'>principles</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [316]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [316]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>It</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>to</span> <span class='word'>load</span> <span class='word'>and</span> <span class='word'>store</span> <span class='word'>capabilities</span> <span class='word'>from</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>without</span> <span class='word'>violating</span> <span class='word'>CHERI</span> <span class='word'>security</span> <span class='word'>principles</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [336]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\definehyp</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>manip</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [336]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='word'>It</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='word'>manipulate</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>without</span> <span class='word'>violating</span> <span class='word'>CHERI</span> <span class='word'>security</span> <span class='word'>principles</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='cmd'>\\</span><span class='cumsum'> [353]</span><br>
&nbsp;&nbsp;<span class='cmd'>\bottomrule</span><span class='cumsum'> [353]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{tabular}</span><span class='cumsum'> [353]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Project</span> <span class='oword'>Hypotheses</span><span class='ignore'>}</span><span class='comment'>%</span><span class='cumsum'> [355]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>hypotheses</span><span class='ignore'>}</span><span class='cumsum'> [355]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [355]</span><br>
<span class='comment'>% This table was an exception, usually don't count tables</span><span class='cumsum'> [355]</span><br>
<span class='tc'>%TC:group table 0 0</span><span class='cumsum'> [355]</span><br>
<span class='tc'>%TC:group tabular 1 0</span><span class='cumsum'> [355]</span><br>
<span class='cumsum'> [355]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [355]</span><br>
<span class='comment'>% --- End of included file ./1_10Introduction/content.tex</span><span class='cumsum'> [355]</span><br>
<span class='cumsum'> [355]</span><br>
<span class='cumsum'> [355]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/content</span><span class='ignore'>}</span><span class='cumsum'> [355]</span><br>
<span class='cumsum'> [355]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/content.tex</span><span class='cumsum'> [355]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [355]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [355]</span><br>
<span class='cumsum'> [355]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>Background</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>background</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cumsum'> [1]</span><br>
<span class='word'>This</span> <span class='word'>chapter</span> <span class='word'>describes</span> <span class='word'>RISC-V</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>riscv</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>RVV</span> <span class='ignore'>(</span><span class='cmd'>\crefrange</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>rvvstart</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>rvvend</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>CHERI</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>cheri</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>detail</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>understand</span> <span class='word'>the</span> <span class='word'>rest</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>dissertation</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='word'>It</span> <span class='word'>summarizes</span> <span class='word'>the</span> <span class='word'>relevant</span> <span class='word'>sections</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>RISC-V</span> <span class='word'>unprivileged</span> <span class='word'>spec</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RISCV-vol1-20191213</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>RISC-V</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>V</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>extension</span> <span class='word'>specification</span> <span class='word'>v1.0</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Sections</span> <span class='word'>1</span><span class='ignore'>-</span><span class='ignore'>-</span><span class='word'>9</span><span class='ignore'>,</span> <span class='word'>17</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>TR-951</span> <span class='word'>CHERI</span> <span class='word'>ISAv8</span> <span class='word'>technical</span> <span class='word'>report</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Chapters</span> <span class='word'>5</span><span class='ignore'>,</span> <span class='word'>8</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>TR-949</span> <span class='word'>technical</span> <span class='word'>report</span> <span class='word'>about</span> <span class='word'>C</span><span class='ignore'>/</span><span class='word'>C</span><span class='ignore'>+</span><span class='ignore'>+</span> <span class='word'>safety</span> <span class='word'>on</span> <span class='word'>CHERI</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>4.4</span><span class='ignore'>,</span> <span class='word'>Appendix</span> <span class='word'>C</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-949</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [63]</span><br>
<span class='word'>Both</span> <span class='word'>vectors</span> <span class='word'>and</span> <span class='word'>CHERI</span> <span class='word'>are</span> <span class='word'>described</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>this</span> <span class='word'>dissertation</span> <span class='word'>caters</span> <span class='word'>to</span> <span class='word'>those</span> <span class='word'>who</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>familiar</span> <span class='word'>with</span> <span class='word'>one</span> <span class='word'>but</span> <span class='word'>not</span> <span class='word'>the</span> <span class='word'>other</span><span class='ignore'>.</span><span class='cumsum'> [85]</span><br>
<span class='cumsum'> [85]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub10_riscv}</span><span class='cumsum'> [85]</span><br>
<span class='cumsum'> [85]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub10_riscv.tex</span><span class='cumsum'> [85]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>RISC-V</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>riscv</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='comment'>% RISC-V has extensions</span><span class='cumsum'> [1]</span><br>
<span class='word'>RISC-V</span> <span class='word'>is</span> <span class='word'>an</span> <span class='word'>open</span> <span class='word'>family</span> <span class='word'>of</span> <span class='word'>ISAs</span> <span class='word'>which</span> <span class='word'>defines</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>base</span> <span class='word'>integer</span> <span class='word'>ISAs</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>all</span> <span class='word'>64-bit</span> <span class='word'>RISC-V</span> <span class='word'>cores</span> <span class='word'>implement</span> <span class='word'>the</span> <span class='word'>RV64I</span> <span class='word'>base</span> <span class='word'>ISA</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>extensions</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>M</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>extension</span> <span class='word'>for</span> <span class='word'>integer</span> <span class='word'>multiplication</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [32]</span><br>
<span class='word'>A</span> <span class='word'>base</span> <span class='word'>instruction</span> <span class='word'>set</span> <span class='word'>combined</span> <span class='word'>with</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>extensions</span> <span class='word'>is</span> <span class='word'>known</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>RISC-V</span> <span class='word'>ISA</span><span class='ignore'>.</span><span class='cumsum'> [48]</span><br>
<span class='word'>Because</span> <span class='word'>RISC-V</span> <span class='word'>is</span> <span class='word'>open</span><span class='ignore'>,</span> <span class='word'>anyone</span> <span class='word'>can</span> <span class='word'>design</span><span class='ignore'>,</span> <span class='word'>manufacture</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>sell</span> <span class='word'>chips</span> <span class='word'>implementing</span> <span class='word'>any</span> <span class='word'>RISC-V</span> <span class='word'>ISA</span><span class='ignore'>.</span><span class='cumsum'> [63]</span><br>
<span class='cumsum'> [63]</span><br>
<span class='word'>Each</span> <span class='word'>RISC-V</span> <span class='word'>implementation</span> <span class='word'>has</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>constant</span> <span class='word'>parameters</span><span class='ignore'>.</span><span class='cumsum'> [72]</span><br>
<span class='word'>The</span> <span class='word'>most</span> <span class='word'>common</span> <span class='word'>example</span> <span class='word'>is</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>XLEN</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>of</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>register</span> <span class='word'>in</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>is</span> <span class='word'>tied</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>integer</span> <span class='word'>ISA</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>64-bit</span> <span class='word'>ISA</span> <span class='word'>implies</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>XLEN</span><span class='ignore'>=</span><span class='word'>64</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [100]</span><br>
<span class='word'>Other</span> <span class='word'>constant</span> <span class='word'>parameters</span> <span class='word'>include</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>in</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>defined</span> <span class='word'>by</span> <span class='word'>CHERI</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>XLEN</span><span class='ignore'>}</span><span class='ignore'>;</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ELEN</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>by</span> <span class='word'>RVV</span> <span class='word'>and</span> <span class='word'>entirely</span> <span class='word'>implementation-defined</span><span class='ignore'>.</span><span class='cumsum'> [130]</span><br>
<span class='cumsum'> [130]</span><br>
<span class='word'>The</span> <span class='word'>extensions</span> <span class='word'>of</span> <span class='word'>most</span> <span class='word'>relevance</span> <span class='word'>to</span> <span class='word'>this</span> <span class='word'>project</span> <span class='word'>are</span> <span class='word'>the</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>V</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>vector</span> <span class='word'>extension</span> <span class='ignore'>(</span><span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>specified</span> <span class='word'>in</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>CHERI</span> <span class='word'>extension</span> <span class='ignore'>(</span><span class='word'>specified</span> <span class='word'>in</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [152]</span><br>
<span class='word'>RVV</span> <span class='word'>has</span> <span class='word'>recently</span> <span class='word'>been</span> <span class='word'>officially</span> <span class='word'>ratified</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>de</span> <span class='word'>facto</span> <span class='word'>vector</span> <span class='word'>extension</span> <span class='word'>for</span> <span class='word'>RISC-V</span><span class='ignore'>.</span><span class='cumsum'> [167]</span><br>
<span class='word'>The</span> <span class='word'>following</span> <span class='word'>sections</span> <span class='word'>summarize</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>extension</span><span class='ignore'>,</span> <span class='word'>how</span> <span class='word'>it</span> <span class='word'>accesses</span> <span class='word'>memory</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>previous</span> <span class='word'>implementations</span> <span class='word'>in</span> <span class='word'>academia</span><span class='ignore'>.</span><span class='cumsum'> [183]</span><br>
<span class='comment'>% \todomark{finish this para}</span><span class='cumsum'> [183]</span><br>
<span class='cumsum'> [183]</span><br>
<span class='comment'>% RVV is the officially ratified vector extension for RISC-V, and going forward all RISC-V chips with vector processing capabilities should implement it instead of designing their own custom vector extensions.</span><span class='cumsum'> [183]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub10_riscv.tex</span><span class='cumsum'> [183]</span><br>
<span class='cumsum'> [183]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [183]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub20_briefintro}</span><span class='cumsum'> [183]</span><br>
<span class='cumsum'> [183]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub20_briefintro.tex</span><span class='cumsum'> [183]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>A</span> <span class='hword'>brief</span> <span class='hword'>history</span> <span class='hword'>of</span> <span class='hword'>vector</span> <span class='hword'>processing</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>rvvstart</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>Many</span> <span class='word'>vector</span> <span class='word'>implementations</span> <span class='ignore'>(</span><span class='word'>Intel</span> <span class='word'>SSE</span><span class='ignore'>/</span><span class='word'>AVX</span><span class='ignore'>,</span> <span class='word'>Arm's</span> <span class='word'>Advanced</span> <span class='word'>SIMD</span> <span class='word'>and</span> <span class='word'>Neon</span><span class='ignore'>)</span> <span class='word'>use</span> <span class='word'>fixed-length</span> <span class='word'>vectors</span> <span class='ignore'>-</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>128-bit</span> <span class='word'>vectors</span> <span class='word'>which</span> <span class='word'>a</span> <span class='word'>program</span> <span class='word'>interprets</span> <span class='word'>as</span> <span class='word'>four</span> <span class='word'>32-bit</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [31]</span><br>
<span class='word'>As</span> <span class='word'>the</span> <span class='word'>industry's</span> <span class='word'>desire</span> <span class='word'>for</span> <span class='word'>parallelism</span> <span class='word'>grew</span><span class='ignore'>,</span> <span class='word'>new</span> <span class='word'>implementations</span> <span class='word'>had</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>designed</span> <span class='word'>with</span> <span class='word'>longer</span> <span class='word'>vectors</span> <span class='word'>of</span> <span class='word'>more</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [50]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>Intel</span> <span class='word'>SSE</span><span class='ignore'>/</span><span class='word'>SSE2</span> <span class='ignore'>(</span><span class='word'>both</span> <span class='word'>128-bit</span><span class='ignore'>)</span> <span class='word'>was</span> <span class='word'>succeeded</span> <span class='word'>by</span> <span class='word'>AVX</span> <span class='ignore'>(</span><span class='word'>128</span> <span class='word'>and</span> <span class='word'>256-bit</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>AVX2</span> <span class='ignore'>(</span><span class='word'>entirely</span> <span class='word'>256-bit</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>AVX-512</span> <span class='ignore'>(</span><span class='word'>512-bit</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [71]</span><br>
<span class='word'>Programs</span> <span class='word'>built</span> <span class='word'>for</span> <span class='word'>one</span> <span class='word'>extension</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>hence</span> <span class='word'>designed</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>specific</span> <span class='word'>vector</span> <span class='word'>size</span><span class='ignore'>,</span> <span class='word'>could</span> <span class='word'>not</span> <span class='word'>automatically</span> <span class='word'>take</span> <span class='word'>advantage</span> <span class='word'>of</span> <span class='word'>longer</span> <span class='word'>vectors</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='cumsum'> [92]</span><br>
<span class='word'>Scalable</span> <span class='word'>vectors</span> <span class='word'>address</span> <span class='word'>this</span> <span class='word'>by</span> <span class='word'>not</span> <span class='word'>specifying</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>length</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>instead</span> <span class='word'>calculating</span> <span class='word'>it</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>fly</span><span class='ignore'>.</span><span class='cumsum'> [109]</span><br>
<span class='word'>Instead</span> <span class='word'>of</span> <span class='word'>hardcoding</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>this</span> <span class='word'>loop</span> <span class='word'>iteration</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>vector</span> <span class='word'>of</span> <span class='word'>four</span> <span class='word'>32-bit</span> <span class='word'>elements</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>has</span> <span class='word'>to</span> <span class='word'>ask</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>how</span> <span class='word'>many</span> <span class='word'>32-bit</span> <span class='word'>elements</span> <span class='word'>will</span> <span class='word'>this</span> <span class='word'>iteration</span> <span class='word'>use</span><span class='ignore'>?</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [136]</span><br>
<span class='word'>This</span> <span class='word'>gives</span> <span class='word'>hardware</span> <span class='word'>designers</span> <span class='word'>more</span> <span class='word'>freedom</span><span class='ignore'>,</span> <span class='word'>letting</span> <span class='word'>them</span> <span class='word'>select</span> <span class='word'>a</span> <span class='word'>suitable</span> <span class='word'>hardware</span> <span class='word'>vector</span> <span class='word'>length</span> <span class='word'>for</span> <span class='word'>their</span> <span class='word'>power</span><span class='ignore'>/</span><span class='word'>timing</span> <span class='word'>targets</span><span class='ignore'>,</span> <span class='word'>while</span> <span class='word'>guaranteeing</span> <span class='word'>consistent</span> <span class='word'>execution</span> <span class='word'>of</span> <span class='word'>programs</span> <span class='word'>on</span> <span class='word'>arbitrarily-sized</span> <span class='word'>vectors</span><span class='ignore'>.</span><span class='cumsum'> [164]</span><br>
<span class='word'>RVV</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>model</span><span class='ignore'>.</span><span class='cumsum'> [170]</span><br>
<span class='cumsum'> [170]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub20_briefintro.tex</span><span class='cumsum'> [170]</span><br>
<span class='cumsum'> [170]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub30_rvv_model}</span><span class='cumsum'> [170]</span><br>
<span class='cumsum'> [170]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub30_rvv_model.tex</span><span class='cumsum'> [170]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>The</span> <span class='hword'>RVV</span> <span class='hword'>vector</span> <span class='hword'>model</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>model</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Summarizes</span> <span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Sections</span> <span class='word'>1-6</span><span class='ignore'>,</span> <span class='word'>17</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
<span class='cumsum'> [8]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_simple_widths</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
<span class='cumsum'> [8]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_simple_widths.tex</span><span class='cumsum'> [8]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>Simple</span><span class='ignore'>_</span><span class='word'>Widths.pdf</span><span class='ignore'>}</span><span class='cumsum'> [12]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>RVV</span> <span class='oword'>vector</span> <span class='oword'>register</span><span class='cmd'>\\</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>VLEN</span> <span class='ignore'>=</span> <span class='oword'>128</span><span class='ignore'>,</span> <span class='oword'>ELEN</span> <span class='ignore'>=</span> <span class='oword'>32</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [22]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>simple</span><span class='ignore'>_</span><span class='ignore'>widths</span><span class='ignore'>}</span><span class='cumsum'> [22]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [22]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_simple_widths.tex</span><span class='cumsum'> [22]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [26]</span><br>
<span class='cumsum'> [26]</span><br>
<span class='word'>RVV</span> <span class='word'>defines</span> <span class='word'>thirty-two</span> <span class='word'>vector</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>each</span> <span class='word'>of</span> <span class='word'>an</span> <span class='word'>implementation-defined</span> <span class='word'>constant</span> <span class='word'>width</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='word'>These</span> <span class='word'>registers</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>interpreted</span> <span class='word'>as</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>vectors</span><span class='ignore'>}</span> <span class='word'>of</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>elements</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [47]</span><br>
<span class='word'>The</span> <span class='word'>program</span> <span class='word'>can</span> <span class='word'>configure</span> <span class='word'>the</span> <span class='word'>size</span> <span class='word'>of</span> <span class='word'>elements</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>implementation</span> <span class='word'>defines</span> <span class='word'>a</span> <span class='word'>maximum</span> <span class='word'>width</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ELEN</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [63]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>simple</span><span class='ignore'>_</span><span class='ignore'>widths</span><span class='ignore'>}</span> <span class='word'>shows</span> <span class='word'>a</span> <span class='word'>simple</span> <span class='word'>example</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='cumsum'> [67]</span><br>
<span class='word'>RVV</span> <span class='word'>also</span> <span class='word'>adds</span> <span class='word'>some</span> <span class='word'>state</span> <span class='word'>that</span> <span class='word'>defines</span> <span class='word'>how</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>are</span> <span class='word'>used</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>added</span><span class='ignore'>_</span><span class='ignore'>state</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [81]</span><br>
<span class='word'>These</span> <span class='word'>are</span> <span class='word'>stored</span> <span class='word'>in</span> <span class='word'>RISC-V</span> <span class='word'>Control</span> <span class='word'>and</span> <span class='word'>Status</span> <span class='word'>Registers</span> <span class='ignore'>(</span><span class='word'>CSRs</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>can</span> <span class='word'>read</span><span class='ignore'>.</span><span class='cumsum'> [96]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vtype</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>defines</span> <span class='word'>how</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>are</span> <span class='word'>split</span> <span class='word'>into</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [106]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vlvstart</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>divides</span> <span class='word'>the</span> <span class='word'>elements</span> <span class='word'>into</span> <span class='word'>three</span> <span class='word'>disjoint</span> <span class='word'>subsets</span><span class='ignore'>:</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>prestart</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>body</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>tail</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [122]</span><br>
<span class='word'>Masked</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>rvvmasking</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>further</span> <span class='word'>divide</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>body</span><span class='ignore'>}</span> <span class='word'>into</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>active</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>inactive</span><span class='ignore'>}</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [133]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>also</span> <span class='word'>describes</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>exception</span> <span class='word'>model</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vexceptions</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [141]</span><br>
<span class='cumsum'> [141]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_added_state</span><span class='ignore'>}</span><span class='cumsum'> [141]</span><br>
<span class='cumsum'> [141]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_added_state.tex</span><span class='cumsum'> [141]</span><br>
<span class='comment'>% \begin{figure}</span><span class='cumsum'> [141]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \centering</span><span class='cumsum'> [141]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \includegraphics[width=0.7\textwidth]{Figures/RVV_Additions.pdf}</span><span class='cumsum'> [141]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \caption{Summary of additional state used by RVV}</span><span class='cumsum'> [141]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \label{fig:RVV_added_state}</span><span class='cumsum'> [141]</span><br>
<span class='comment'>% \end{figure}</span><span class='cumsum'> [141]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>Additions.pdf</span><span class='ignore'>}</span><span class='cumsum'> [144]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Summary</span> <span class='oword'>of</span> <span class='oword'>additional</span> <span class='oword'>state</span> <span class='oword'>used</span> <span class='oword'>by</span> <span class='oword'>RVV</span><span class='ignore'>}</span><span class='cumsum'> [151]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>added</span><span class='ignore'>_</span><span class='ignore'>state</span><span class='ignore'>}</span><span class='cumsum'> [151]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [151]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_added_state.tex</span><span class='cumsum'> [151]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [155]</span><br>
<span class='cumsum'> [155]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [155]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>vtype</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vtype</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_LMUL_widening</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cumsum'> [1]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_LMUL_widening.tex</span><span class='cumsum'> [1]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>LMUL</span><span class='ignore'>_</span><span class='word'>Widening.pdf</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>using</span> <span class='oword'>LMUL</span> <span class='oword'>to</span> <span class='oword'>access</span> <span class='oword'>results</span> <span class='oword'>of</span> <span class='oword'>widening</span> <span class='oword'>operations</span><span class='ignore'>}</span><span class='cumsum'> [15]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>LMUL</span><span class='ignore'>_</span><span class='ignore'>widening</span><span class='ignore'>}</span><span class='cumsum'> [15]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [15]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_LMUL_widening.tex</span><span class='cumsum'> [15]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>b</span><span class='ignore'>]</span><span class='cumsum'> [19]</span><br>
<span class='word'>The</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>CSR</span> <span class='word'>contains</span> <span class='word'>two</span> <span class='word'>key</span> <span class='word'>fields</span> <span class='word'>that</span> <span class='word'>describe</span> <span class='word'>how</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>interpret</span> <span class='word'>the</span> <span class='word'>contents</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>registers</span><span class='ignore'>.</span><span class='cumsum'> [37]</span><br>
<span class='word'>The</span> <span class='word'>first</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>Selected</span> <span class='word'>Element</span> <span class='word'>Width</span> <span class='ignore'>(</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SEW</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>is</span> <span class='word'>self-explanatory</span><span class='ignore'>.</span><span class='cumsum'> [48]</span><br>
<span class='word'>It</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>8</span><span class='ignore'>,</span> <span class='word'>16</span><span class='ignore'>,</span> <span class='word'>32</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>64</span><span class='ignore'>.</span><span class='cumsum'> [56]</span><br>
<span class='word'>128-bit</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>referenced</span> <span class='word'>a</span> <span class='word'>few</span> <span class='word'>times</span> <span class='word'>throughout</span> <span class='word'>but</span> <span class='word'>haven't</span> <span class='word'>been</span> <span class='word'>formally</span> <span class='word'>specified</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>p10</span><span class='ignore'>,</span> <span class='word'>p32</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [72]</span><br>
<span class='comment'>% Most instructions\footnote{Except where the width is encoded in the instruction, like bytemask loads.} will split vector registers into elements of this width.</span><span class='cumsum'> [72]</span><br>
<span class='cumsum'> [72]</span><br>
<span class='word'>The</span> <span class='word'>second</span> <span class='word'>field</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>Vector</span> <span class='word'>Register</span> <span class='word'>Group</span> <span class='word'>Multiplier</span> <span class='ignore'>(</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [82]</span><br>
<span class='word'>Vector</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>just</span> <span class='word'>operate</span> <span class='word'>over</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>register</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>over</span> <span class='word'>a</span> <span class='word'>register</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>group</span><span class='ignore'>}</span> <span class='word'>as</span> <span class='word'>defined</span> <span class='word'>by</span> <span class='word'>this</span> <span class='word'>field</span><span class='ignore'>.</span><span class='cumsum'> [101]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>=</span><span class='word'>8</span><span class='ignore'>}</span> <span class='word'>then</span> <span class='word'>each</span> <span class='word'>instruction</span> <span class='word'>would</span> <span class='word'>operate</span> <span class='word'>over</span> <span class='word'>8</span> <span class='word'>register's</span> <span class='word'>worth</span> <span class='word'>of</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [117]</span><br>
<span class='word'>These</span> <span class='word'>groups</span> <span class='word'>must</span> <span class='word'>use</span> <span class='word'>aligned</span> <span class='word'>register</span> <span class='word'>indices</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>=</span><span class='word'>4</span><span class='ignore'>}</span> <span class='word'>all</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>operands</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>multiples</span> <span class='word'>of</span> <span class='word'>4</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>v0</span><span class='ignore'>,</span> <span class='word'>v4</span><span class='ignore'>,</span> <span class='word'>v8</span><span class='ignore'>}</span> <span class='word'>etc</span><span class='ignore'>.</span><span class='cumsum'> [142]</span><br>
<span class='word'>In</span> <span class='word'>some</span> <span class='word'>implementations</span> <span class='word'>this</span> <span class='word'>may</span> <span class='word'>increase</span> <span class='word'>throughput</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>by</span> <span class='word'>itself</span> <span class='word'>is</span> <span class='word'>beneficial</span> <span class='word'>for</span> <span class='word'>applications</span><span class='ignore'>.</span><span class='cumsum'> [156]</span><br>
<span class='cumsum'> [156]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>true</span> <span class='word'>utility</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>}</span> <span class='word'>lies</span> <span class='word'>in</span> <span class='word'>widening</span><span class='ignore'>/</span><span class='word'>narrowing</span> <span class='word'>operations</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>LMUL</span><span class='ignore'>_</span><span class='ignore'>widening</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [168]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>an</span> <span class='word'>8-by-8-bit</span> <span class='word'>multiplication</span> <span class='word'>can</span> <span class='word'>produce</span> <span class='word'>16-bit</span> <span class='word'>results</span><span class='ignore'>.</span><span class='cumsum'> [177]</span><br>
<span class='word'>Because</span> <span class='word'>the</span> <span class='word'>element</span> <span class='word'>size</span> <span class='word'>doubles</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>hold</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>elements</span> <span class='word'>also</span> <span class='word'>doubles</span><span class='ignore'>.</span><span class='cumsum'> [197]</span><br>
<span class='word'>Doubling</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>}</span> <span class='word'>after</span> <span class='word'>such</span> <span class='word'>an</span> <span class='word'>operation</span> <span class='word'>allows</span> <span class='word'>subsequent</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>all</span> <span class='word'>the</span> <span class='word'>results</span> <span class='word'>at</span> <span class='word'>once</span><span class='ignore'>.</span><span class='cumsum'> [213]</span><br>
<span class='word'>At</span> <span class='word'>the</span> <span class='word'>start</span> <span class='word'>of</span> <span class='word'>such</span> <span class='word'>an</span> <span class='word'>operation</span><span class='ignore'>,</span> <span class='word'>fractional</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>1</span><span class='ignore'>/</span><span class='word'>2</span><span class='ignore'>,</span> <span class='word'>1</span><span class='ignore'>/</span><span class='word'>4</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>1</span><span class='ignore'>/</span><span class='word'>8</span><span class='ignore'>)</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>avoid</span> <span class='word'>subsequent</span> <span class='word'>results</span> <span class='word'>using</span> <span class='word'>too</span> <span class='word'>many</span> <span class='word'>registers</span><span class='ignore'>.</span><span class='cumsum'> [240]</span><br>
<span class='cumsum'> [240]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>also</span> <span class='word'>encodes</span> <span class='word'>two</span> <span class='word'>flags</span><span class='ignore'>:</span> <span class='word'>mask-agnostic</span> <span class='word'>and</span> <span class='word'>tail-agnostic</span><span class='ignore'>.</span><span class='cumsum'> [248]</span><br>
<span class='word'>If</span> <span class='word'>these</span> <span class='word'>are</span> <span class='word'>set</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>implementation</span> <span class='word'>is</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>allowed</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>overwrite</span> <span class='word'>any</span> <span class='word'>masked-out</span> <span class='word'>or</span> <span class='word'>tail</span> <span class='word'>elements</span> <span class='word'>with</span> <span class='word'>all</span> <span class='word'>1s</span><span class='ignore'>.</span><span class='cumsum'> [266]</span><br>
<span class='cumsum'> [266]</span><br>
<span class='word'>Most</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>will</span> <span class='word'>interpret</span> <span class='word'>their</span> <span class='word'>operands</span> <span class='word'>using</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>always</span> <span class='word'>the</span> <span class='word'>case</span><span class='ignore'>.</span><span class='cumsum'> [282]</span><br>
<span class='word'>Some</span> <span class='word'>instructions</span> <span class='ignore'>(</span><span class='word'>such</span> <span class='word'>as</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='ignore'>)</span> <span class='word'>use</span> <span class='word'>different</span> <span class='word'>Effective</span> <span class='word'>Element</span> <span class='word'>Widths</span> <span class='ignore'>(</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EEW</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>Effective</span> <span class='word'>LMULs</span> <span class='ignore'>(</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EMUL</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>for</span> <span class='word'>their</span> <span class='word'>operands</span><span class='ignore'>.</span><span class='cumsum'> [301]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>case</span> <span class='word'>of</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EEW</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>encoded</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>bits</span> <span class='word'>and</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EMUL</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>calculated</span> <span class='word'>to</span> <span class='word'>keep</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>elements</span> <span class='word'>consistent</span><span class='ignore'>.</span><span class='cumsum'> [327]</span><br>
<span class='word'>Another</span> <span class='word'>example</span> <span class='word'>is</span> <span class='word'>widening</span><span class='ignore'>/</span><span class='word'>narrowing</span> <span class='word'>operations</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>by</span> <span class='word'>definition</span> <span class='word'>have</span> <span class='word'>to</span> <span class='word'>interpret</span> <span class='word'>the</span> <span class='word'>destination</span> <span class='word'>registers</span> <span class='word'>differently</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>sources</span><span class='ignore'>.</span><span class='cumsum'> [346]</span><br>
<span class='cumsum'> [346]</span><br>
<span class='word'>Programs</span> <span class='word'>update</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>through</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>family</span> <span class='word'>of</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [355]</span><br>
<span class='word'>These</span> <span class='word'>are</span> <span class='word'>designed</span> <span class='word'>for</span> <span class='word'>a</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>stripmining</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>paradigm</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>each</span> <span class='word'>iteration</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>loop</span> <span class='word'>processes</span> <span class='word'>some</span> <span class='word'>elements</span> <span class='word'>until</span> <span class='word'>all</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>processed</span><span class='ignore'>.</span><span class='cumsum'> [376]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>instructions</span> <span class='word'>take</span> <span class='word'>a</span> <span class='word'>requested</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>remaining</span> <span class='word'>elements</span> <span class='word'>to</span> <span class='word'>process</span> <span class='ignore'>(</span><span class='word'>the</span> <span class='word'>Application</span> <span class='word'>Vector</span> <span class='word'>Length</span> <span class='word'>or</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>AVL</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>return</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>elements</span> <span class='word'>that</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>processed</span> <span class='word'>in</span> <span class='word'>this</span> <span class='word'>iteration</span><span class='ignore'>.</span><span class='cumsum'> [409]</span><br>
<span class='word'>This</span> <span class='word'>value</span> <span class='word'>is</span> <span class='word'>saved</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>register</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>to</span> <span class='word'>use</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>also</span> <span class='word'>saved</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>internal</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>CSR</span><span class='ignore'>.</span><span class='cumsum'> [429]</span><br>
<span class='cumsum'> [429]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [429]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>vl</span><span class='ignore'>}</span> <span class='hword'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>vstart</span><span class='ignore'>}</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='hword'>Prestart</span><span class='ignore'>,</span> <span class='hword'>body</span><span class='ignore'>,</span> <span class='hword'>tail</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vlvstart</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>The</span> <span class='word'>first</span> <span class='word'>CSR</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>Vector</span> <span class='word'>Length</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>holds</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>elements</span> <span class='word'>that</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>updated</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>instruction</span><span class='ignore'>.</span><span class='cumsum'> [28]</span><br>
<span class='word'>The</span> <span class='word'>program</span> <span class='word'>updates</span> <span class='word'>this</span> <span class='word'>value</span> <span class='word'>through</span> <span class='word'>fault-only-first</span> <span class='word'>loads</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>fof</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>more</span> <span class='word'>commonly</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [41]</span><br>
<span class='cumsum'> [41]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>simple</span> <span class='word'>case</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>equal</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>total</span> <span class='word'>available</span> <span class='word'>elements</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vl</span><span class='ignore'>_</span><span class='ignore'>full</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='word'>It</span> <span class='word'>can</span> <span class='word'>also</span> <span class='word'>be</span> <span class='word'>fewer</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vl</span><span class='ignore'>_</span><span class='ignore'>short</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>in</span> <span class='word'>which</span> <span class='word'>case</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>will</span> <span class='word'>not</span> <span class='word'>write</span> <span class='word'>to</span> <span class='word'>elements</span> <span class='word'>in</span> <span class='word'>the</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>tail</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>elements</span> <span class='word'>past</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [77]</span><br>
<span class='word'>This</span> <span class='word'>eliminates</span> <span class='word'>the</span> <span class='word'>need</span> <span class='word'>for</span> <span class='word'>a</span> <span class='ignore'>`</span><span class='word'>cleanup</span> <span class='word'>loop</span><span class='ignore'>'</span> <span class='word'>common</span> <span class='word'>in</span> <span class='word'>fixed-length</span> <span class='word'>vector</span> <span class='word'>programs</span><span class='ignore'>.</span><span class='cumsum'> [90]</span><br>
<span class='cumsum'> [90]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_vl</span><span class='ignore'>}</span><span class='cumsum'> [90]</span><br>
<span class='cumsum'> [90]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_vl.tex</span><span class='cumsum'> [90]</span><br>
<span class='cmd'>\figcheckinputs</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [90]</span><br>
<span class='envir'>\begin</span><span class='envir'>{turnipfig}</span><span class='cumsum'> [90]</span><br>
&nbsp;&nbsp;<span class='cmd'>\centering</span><span class='cumsum'> [90]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{subfigure}</span><span class='option'>[b]</span><span class='ignore'>{</span><span class='cmd'>\figinputWidth</span><span class='ignore'>}</span><span class='cumsum'> [90]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\centering</span><span class='cumsum'> [90]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>VL</span><span class='ignore'>_</span><span class='ignore'>full.pdf</span><span class='ignore'>}</span><span class='cumsum'> [90]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Fully</span> <span class='oword'>utilized</span> <span class='oword'>vector</span><span class='ignore'>}</span><span class='cumsum'> [93]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vl</span><span class='ignore'>_</span><span class='ignore'>full</span><span class='ignore'>}</span><span class='cumsum'> [93]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{subfigure}</span><span class='cumsum'> [93]</span><br>
&nbsp; &nbsp; <span class='cmd'>\hfill</span><span class='cumsum'> [93]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{subfigure}</span><span class='option'>[b]</span><span class='ignore'>{</span><span class='cmd'>\figinputWidth</span><span class='ignore'>}</span><span class='cumsum'> [93]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\centering</span><span class='cumsum'> [93]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>VL</span><span class='ignore'>_</span><span class='ignore'>short.pdf</span><span class='ignore'>}</span><span class='cumsum'> [93]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Partially</span> <span class='oword'>utilized</span> <span class='oword'>vector</span><span class='ignore'>}</span><span class='cumsum'> [96]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vl</span><span class='ignore'>_</span><span class='ignore'>short</span><span class='ignore'>}</span><span class='cumsum'> [96]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{subfigure}</span><span class='cumsum'> [96]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Examples</span> <span class='oword'>of</span> <span class='oword'>vector</span> <span class='oword'>utilization</span> <span class='oword'>with</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>vl</span><span class='ignore'>}</span> <span class='oword'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>vstart</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [104]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vl</span><span class='ignore'>}</span><span class='cumsum'> [104]</span><br>
<span class='envir'>\end</span><span class='envir'>{turnipfig}</span><span class='cumsum'> [104]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_vl.tex</span><span class='cumsum'> [104]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>t</span><span class='ignore'>]</span><span class='cumsum'> [108]</span><br>
<span class='cumsum'> [108]</span><br>
<span class='word'>In</span> <span class='word'>a</span> <span class='word'>similar</span> <span class='word'>vein</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>specifies</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>the</span> <span class='word'>index</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>first</span> <span class='word'>element</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>executed</span> <span class='word'>by</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>instruction</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [127]</span><br>
<span class='word'>Elements</span> <span class='word'>before</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>are</span> <span class='word'>known</span> <span class='word'>as</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>pre-start</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>touched</span> <span class='word'>by</span> <span class='word'>executed</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [142]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>usually</span> <span class='word'>only</span> <span class='word'>set</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>hardware</span> <span class='word'>whenever</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>interrupted</span> <span class='word'>mid-instruction</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vstart</span><span class='ignore'>_</span><span class='ignore'>trap</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vexceptions</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>so</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>re-executed</span> <span class='word'>later</span> <span class='word'>without</span> <span class='word'>corrupting</span> <span class='word'>completed</span> <span class='word'>values</span><span class='ignore'>.</span><span class='cumsum'> [169]</span><br>
<span class='word'>Whenever</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>instruction</span> <span class='word'>completes</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>reset</span> <span class='word'>to</span> <span class='word'>zero</span><span class='ignore'>.</span><span class='cumsum'> [179]</span><br>
<span class='cumsum'> [179]</span><br>
<span class='word'>The</span> <span class='word'>program</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>can</span><span class='ignore'>}</span> <span class='word'>set</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>manually</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>it</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>always</span> <span class='word'>work</span><span class='ignore'>.</span><span class='cumsum'> [191]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>couldn't</span> <span class='word'>arrive</span> <span class='word'>at</span> <span class='word'>the</span> <span class='word'>value</span> <span class='word'>itself</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>allowed</span> <span class='word'>to</span> <span class='word'>reject</span> <span class='word'>it</span><span class='ignore'>.</span><span class='cumsum'> [207]</span><br>
<span class='word'>The</span> <span class='word'>specification</span> <span class='word'>gives</span> <span class='word'>an</span> <span class='word'>example</span> <span class='word'>where</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>implementation</span> <span class='word'>never</span> <span class='word'>takes</span> <span class='word'>interrupts</span> <span class='word'>during</span> <span class='word'>an</span> <span class='word'>arithmetic</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>it</span> <span class='word'>would</span> <span class='word'>never</span> <span class='word'>set</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>during</span> <span class='word'>an</span> <span class='word'>arithmetic</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>it</span> <span class='word'>could</span> <span class='word'>raise</span> <span class='word'>an</span> <span class='word'>exception</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>was</span> <span class='word'>nonzero</span> <span class='word'>for</span> <span class='word'>an</span> <span class='word'>arithmetic</span> <span class='word'>instruction</span><span class='ignore'>.</span><span class='cumsum'> [247]</span><br>
<span class='cumsum'> [247]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [247]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Masking</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='hword'>Active</span><span class='ignore'>/</span><span class='hword'>inactive</span> <span class='hword'>elements</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>rvvmasking</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='word'>Most</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>allow</span> <span class='word'>for</span> <span class='word'>per-element</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>masking</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mask</span><span class='ignore'>_</span><span class='ignore'>example</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [12]</span><br>
<span class='word'>When</span> <span class='word'>masking</span> <span class='word'>is</span> <span class='word'>enabled</span><span class='ignore'>,</span> <span class='word'>register</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>v0</span><span class='ignore'>}</span> <span class='word'>acts</span> <span class='word'>as</span> <span class='word'>the</span> <span class='ignore'>`</span><span class='word'>mask</span> <span class='word'>register</span><span class='ignore'>'</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>each</span> <span class='word'>bit</span> <span class='word'>corresponds</span> <span class='word'>to</span> <span class='word'>an</span> <span class='word'>element</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>vector</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>A</span> <span class='oword'>single</span> <span class='oword'>vector</span> <span class='oword'>register</span> <span class='oword'>will</span> <span class='oword'>always</span> <span class='oword'>have</span> <span class='oword'>enough</span> <span class='oword'>bits</span> <span class='oword'>for</span> <span class='oword'>all</span> <span class='oword'>elements</span><span class='ignore'>.</span> <span class='oword'>The</span> <span class='oword'>maximum</span> <span class='oword'>element</span> <span class='oword'>count</span> <span class='oword'>is</span> <span class='oword'>found</span> <span class='oword'>when</span> <span class='oword'>SEW</span> <span class='oword'>is</span> <span class='oword'>minimized</span> <span class='ignore'>(</span><span class='oword'>8</span> <span class='oword'>bits</span><span class='ignore'>)</span> <span class='oword'>and</span> <span class='oword'>LMUL</span> <span class='oword'>is</span> <span class='oword'>maximized</span> <span class='ignore'>(</span><span class='oword'>8</span> <span class='oword'>registers</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='oword'>and</span> <span class='oword'>is</span> <span class='oword'>equal</span> <span class='oword'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>VLEN</span> <span class='ignore'>*</span> <span class='oword'>LMUL</span> <span class='ignore'>/</span> <span class='oword'>SEW</span> <span class='ignore'>=</span> <span class='oword'>VLEN</span> <span class='ignore'>*</span> <span class='oword'>8</span> <span class='ignore'>/</span> <span class='oword'>8</span> <span class='ignore'>=</span> <span class='oword'>VLEN</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [74]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>mask</span> <span class='word'>bit</span> <span class='word'>is</span> <span class='word'>0</span><span class='ignore'>,</span> <span class='word'>that</span> <span class='word'>element</span> <span class='word'>is</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>active</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>as</span> <span class='word'>normal</span><span class='ignore'>.</span><span class='cumsum'> [90]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>mask</span> <span class='word'>bit</span> <span class='word'>is</span> <span class='word'>1</span><span class='ignore'>,</span> <span class='word'>that</span> <span class='word'>element</span> <span class='word'>will</span> <span class='word'>be</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>inactive</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>not</span> <span class='word'>written</span> <span class='word'>to</span> <span class='ignore'>(</span><span class='word'>or</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>mask-agnostic</span> <span class='word'>setting</span><span class='ignore'>,</span> <span class='word'>overwritten</span> <span class='word'>with</span> <span class='word'>1s</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [114]</span><br>
<span class='word'>When</span> <span class='word'>masking</span> <span class='word'>is</span> <span class='word'>disabled</span><span class='ignore'>,</span> <span class='word'>all</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>active</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [122]</span><br>
<span class='cumsum'> [122]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_vstart_trap</span><span class='ignore'>}</span><span class='cumsum'> [122]</span><br>
<span class='cumsum'> [122]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_vstart_trap.tex</span><span class='cumsum'> [122]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>vstart</span><span class='ignore'>_</span><span class='word'>trap.pdf</span><span class='ignore'>}</span><span class='cumsum'> [126]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>the</span> <span class='oword'>hardware</span> <span class='oword'>setting</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>vstart</span><span class='ignore'>}</span> <span class='oword'>after</span> <span class='oword'>a</span> <span class='oword'>trap</span><span class='ignore'>}</span><span class='cumsum'> [135]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>vstart</span><span class='ignore'>_</span><span class='ignore'>trap</span><span class='ignore'>}</span><span class='cumsum'> [135]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [135]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_vstart_trap.tex</span><span class='cumsum'> [135]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [139]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_mask_example</span><span class='ignore'>}</span><span class='cumsum'> [139]</span><br>
<span class='cumsum'> [139]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_mask_example.tex</span><span class='cumsum'> [139]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>Mask</span><span class='ignore'>_</span><span class='word'>example.pdf</span><span class='ignore'>}</span><span class='cumsum'> [143]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>masking</span> <span class='oword'>a</span> <span class='oword'>vector</span> <span class='oword'>operation</span><span class='ignore'>}</span><span class='cumsum'> [149]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mask</span><span class='ignore'>_</span><span class='ignore'>example</span><span class='ignore'>}</span><span class='cumsum'> [149]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [149]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_mask_example.tex</span><span class='cumsum'> [149]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.7</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [153]</span><br>
<span class='cmd'>\clearpage</span><span class='cumsum'> [153]</span><br>
<span class='cumsum'> [153]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [153]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [153]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [153]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [153]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Exception</span> <span class='hword'>handling</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>vexceptions</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Summarizes</span> <span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>17</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='cumsum'> [5]</span><br>
<span class='word'>During</span> <span class='word'>the</span> <span class='word'>execution</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>two</span> <span class='word'>events</span> <span class='word'>can</span> <span class='word'>prevent</span> <span class='word'>an</span> <span class='word'>instruction</span> <span class='word'>from</span> <span class='word'>fully</span> <span class='word'>completing</span><span class='ignore'>:</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>itself</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>an</span> <span class='word'>asynchronous</span> <span class='word'>interrupt</span> <span class='word'>from</span> <span class='word'>another</span> <span class='word'>part</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>system</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='word'>Implementations</span> <span class='word'>may</span> <span class='word'>choose</span> <span class='word'>to</span> <span class='word'>wait</span> <span class='word'>until</span> <span class='word'>an</span> <span class='word'>instruction</span> <span class='word'>fully</span> <span class='word'>completes</span> <span class='word'>before</span> <span class='word'>handling</span> <span class='word'>asynchronous</span> <span class='word'>interrupts</span><span class='ignore'>,</span> <span class='word'>making</span> <span class='word'>it</span> <span class='word'>unnecessary</span> <span class='word'>to</span> <span class='word'>pause</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>halfway</span> <span class='word'>through</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>synchronous</span> <span class='word'>exceptions</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>avoided</span> <span class='word'>in</span> <span class='word'>this</span> <span class='word'>way</span> <span class='ignore'>(</span><span class='word'>particularly</span> <span class='word'>where</span> <span class='word'>page</span> <span class='word'>fault</span> <span class='word'>exceptions</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>handled</span> <span class='word'>transparently</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [79]</span><br>
<span class='cumsum'> [79]</span><br>
<span class='word'>The</span> <span class='word'>RVV</span> <span class='word'>specification</span> <span class='word'>defines</span> <span class='word'>two</span> <span class='word'>modes</span> <span class='word'>for</span> <span class='ignore'>`</span><span class='word'>trapping</span><span class='ignore'>'</span> <span class='word'>these</span> <span class='word'>events</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>implementations</span> <span class='word'>may</span> <span class='word'>choose</span> <span class='word'>between</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>context</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>offending</span> <span class='word'>instruction</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>notes</span> <span class='word'>two</span> <span class='word'>further</span> <span class='word'>modes</span> <span class='word'>which</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>in</span> <span class='word'>further</span> <span class='word'>extensions</span><span class='ignore'>.</span><span class='cumsum'> [114]</span><br>
<span class='word'>All</span> <span class='word'>modes</span> <span class='word'>start</span> <span class='word'>by</span> <span class='word'>saving</span> <span class='word'>the</span> <span class='word'>PC</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>trapping</span> <span class='word'>instruction</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>CSR</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='ignore'>*</span><span class='word'>epc</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [129]</span><br>
<span class='cumsum'> [129]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [129]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Imprecise</span> <span class='hword'>vector</span> <span class='hword'>traps</span><span class='ignore'>}</span><span class='cumsum'> [132]</span><br>
<span class='word'>Imprecise</span> <span class='word'>traps</span> <span class='word'>are</span> <span class='word'>intended</span> <span class='word'>for</span> <span class='word'>events</span> <span class='word'>that</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>recoverable</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>reporting</span> <span class='word'>an</span> <span class='word'>error</span> <span class='word'>and</span> <span class='word'>terminating</span> <span class='word'>execution</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>appropriate</span> <span class='word'>response</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [153]</span><br>
<span class='word'>They</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>impose</span> <span class='word'>any</span> <span class='word'>extra</span> <span class='word'>requirements</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>implementation</span><span class='ignore'>.</span><span class='cumsum'> [163]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>that</span> <span class='word'>executes</span> <span class='word'>instructions</span> <span class='word'>out-of-order</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>guarantee</span> <span class='word'>that</span> <span class='word'>instructions</span> <span class='word'>older</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='ignore'>*</span><span class='word'>epc</span><span class='ignore'>}</span> <span class='word'>have</span> <span class='word'>completed</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>is</span> <span class='word'>allowed</span> <span class='word'>to</span> <span class='word'>have</span> <span class='word'>completed</span> <span class='word'>instructions</span> <span class='word'>newer</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='ignore'>*</span><span class='word'>epc</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [193]</span><br>
<span class='cumsum'> [193]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>was</span> <span class='word'>triggered</span> <span class='word'>by</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>CSR</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>updated</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>element</span> <span class='word'>that</span> <span class='word'>caused</span> <span class='word'>it</span><span class='ignore'>.</span><span class='cumsum'> [214]</span><br>
<span class='word'>The</span> <span class='word'>specification</span> <span class='word'>calls</span> <span class='word'>out</span> <span class='word'>synchronous</span> <span class='word'>exceptions</span> <span class='word'>in</span> <span class='word'>particular</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>mention</span> <span class='word'>asynchronous</span> <span class='word'>interrupts</span><span class='ignore'>.</span><span class='cumsum'> [228]</span><br>
<span class='word'>It's</span> <span class='word'>likely</span> <span class='word'>that</span> <span class='word'>imprecise</span> <span class='word'>traps</span> <span class='word'>for</span> <span class='word'>asynchronous</span> <span class='word'>interrupts</span> <span class='word'>should</span> <span class='word'>also</span> <span class='word'>set</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>issue</span> <span class='word'>has</span> <span class='word'>been</span> <span class='word'>raised</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>authors</span> <span class='word'>for</span> <span class='word'>further</span> <span class='word'>clarification</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\redact</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>riscv</span><span class='ignore'>/</span><span class='ignore'>riscv-v-spec</span><span class='ignore'>/</span><span class='ignore'>issues</span><span class='ignore'>/</span><span class='ignore'>799</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [253]</span><br>
<span class='word'>The</span> <span class='word'>specification</span> <span class='word'>also</span> <span class='word'>states</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>There</span> <span class='word'>is</span> <span class='word'>no</span> <span class='word'>support</span> <span class='word'>for</span> <span class='word'>imprecise</span> <span class='word'>traps</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>current</span> <span class='word'>standard</span> <span class='word'>extensions</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>meaning</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>other</span> <span class='word'>standard</span> <span class='word'>RISC-V</span> <span class='word'>exceptions</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>use</span> <span class='word'>and</span> <span class='word'>have</span> <span class='word'>not</span> <span class='word'>considered</span> <span class='word'>imprecise</span> <span class='word'>traps</span><span class='ignore'>.</span><span class='cumsum'> [285]</span><br>
<span class='cumsum'> [285]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [285]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Precise</span> <span class='hword'>vector</span> <span class='hword'>traps</span><span class='ignore'>}</span><span class='cumsum'> [288]</span><br>
<span class='word'>Precise</span> <span class='word'>vector</span> <span class='word'>traps</span> <span class='word'>are</span> <span class='word'>intended</span> <span class='word'>for</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>resumed</span> <span class='word'>after</span> <span class='word'>handling</span> <span class='word'>the</span> <span class='word'>interrupting</span> <span class='word'>event</span><span class='ignore'>.</span><span class='cumsum'> [304]</span><br>
<span class='word'>This</span> <span class='word'>means</span> <span class='word'>the</span> <span class='word'>architectural</span> <span class='word'>state</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>register</span> <span class='word'>values</span><span class='ignore'>)</span> <span class='word'>when</span> <span class='word'>starting</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>saved</span> <span class='word'>and</span> <span class='word'>reloaded</span> <span class='word'>before</span> <span class='word'>continuing</span> <span class='word'>execution</span><span class='ignore'>.</span><span class='cumsum'> [324]</span><br>
<span class='word'>Therefore</span> <span class='word'>it</span> <span class='word'>must</span> <span class='word'>look</span> <span class='word'>like</span> <span class='word'>instructions</span> <span class='word'>were</span> <span class='word'>completed</span> <span class='word'>in-order</span><span class='ignore'>,</span> <span class='word'>even</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>implementation</span> <span class='word'>is</span> <span class='word'>out-of-order</span><span class='ignore'>:</span><span class='cumsum'> [339]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [339]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Instructions</span> <span class='word'>older</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='ignore'>*</span><span class='word'>epc</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>have</span> <span class='word'>completed</span> <span class='ignore'>(</span><span class='word'>committed</span> <span class='word'>all</span> <span class='word'>results</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>architectural</span> <span class='word'>state</span><span class='ignore'>)</span><span class='cumsum'> [353]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Instructions</span> <span class='word'>newer</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='ignore'>*</span><span class='word'>epc</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='cmd'>\textbf</span><span class='ignore'>{</span><span class='word'>not</span><span class='ignore'>}</span> <span class='word'>have</span> <span class='word'>altered</span> <span class='word'>architectural</span> <span class='word'>state</span><span class='ignore'>.</span><span class='cumsum'> [363]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [363]</span><br>
<span class='cumsum'> [363]</span><br>
<span class='word'>On</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>trap</span><span class='ignore'>,</span> <span class='word'>regardless</span> <span class='word'>of</span> <span class='word'>what</span> <span class='word'>caused</span> <span class='word'>it</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>CSR</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>set</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>element</span> <span class='word'>index</span> <span class='word'>on</span> <span class='word'>which</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>was</span> <span class='word'>taken</span><span class='ignore'>.</span><span class='cumsum'> [388]</span><br>
<span class='word'>The</span> <span class='word'>save-and-reload</span> <span class='word'>expectation</span> <span class='word'>then</span> <span class='word'>add</span> <span class='word'>two</span> <span class='word'>constraints</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>trapping</span> <span class='word'>instruction's</span> <span class='word'>execution</span><span class='ignore'>:</span><span class='cumsum'> [400]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [400]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Operations</span> <span class='word'>affecting</span> <span class='word'>elements</span> <span class='word'>preceding</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>have</span> <span class='word'>committed</span> <span class='word'>their</span> <span class='word'>results</span><span class='cumsum'> [410]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Operations</span> <span class='word'>affecting</span> <span class='word'>elements</span> <span class='word'>at</span> <span class='word'>or</span> <span class='word'>following</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>either</span><span class='cumsum'> [419]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [419]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>not</span> <span class='word'>have</span> <span class='word'>committed</span> <span class='word'>results</span> <span class='word'>or</span> <span class='word'>otherwise</span> <span class='word'>affected</span> <span class='word'>architectural</span> <span class='word'>state</span><span class='cumsum'> [428]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>be</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>idempotent</span><span class='ignore'>}</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>produce</span> <span class='word'>exactly</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>result</span> <span class='word'>when</span> <span class='word'>repeated</span><span class='ignore'>.</span><span class='cumsum'> [438]</span><br>
&nbsp; &nbsp; <span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [438]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [438]</span><br>
<span class='cumsum'> [438]</span><br>
<span class='word'>The</span> <span class='word'>idempotency</span> <span class='word'>option</span> <span class='word'>gives</span> <span class='word'>implementations</span> <span class='word'>a</span> <span class='word'>lot</span> <span class='word'>of</span> <span class='word'>leeway</span><span class='ignore'>.</span><span class='cumsum'> [447]</span><br>
<span class='word'>Some</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>such</span> <span class='word'>as</span>&nbsp; <span class='word'>indexed</span> <span class='word'>segment</span> <span class='word'>loads</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>indexedmem</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>are</span> <span class='word'>specifically</span> <span class='word'>prohibited</span> <span class='word'>from</span> <span class='word'>overwriting</span> <span class='word'>their</span> <span class='word'>inputs</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>them</span> <span class='word'>idempotent</span><span class='ignore'>.</span><span class='cumsum'> [465]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>instruction</span> <span class='word'>is</span> <span class='word'>idempotent</span><span class='ignore'>,</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>is</span> <span class='word'>even</span> <span class='word'>allowed</span> <span class='word'>to</span> <span class='word'>repeat</span> <span class='word'>operations</span> <span class='word'>on</span> <span class='word'>elements</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>preceding</span><span class='ignore'>}</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [482]</span><br>
<span class='word'>However</span> <span class='word'>for</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>the</span> <span class='word'>idempotency</span> <span class='word'>depends</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>memory</span> <span class='word'>being</span> <span class='word'>accessed</span><span class='ignore'>.</span><span class='cumsum'> [494]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>reading</span> <span class='word'>or</span> <span class='word'>writing</span> <span class='word'>a</span> <span class='word'>memory-mapped</span> <span class='word'>I</span><span class='ignore'>/</span><span class='word'>O</span> <span class='word'>region</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>be</span> <span class='word'>idempotent</span><span class='ignore'>.</span><span class='cumsum'> [508]</span><br>
<span class='cumsum'> [508]</span><br>
<span class='word'>Another</span> <span class='word'>memory-specific</span> <span class='word'>issue</span> <span class='word'>is</span> <span class='word'>that</span> <span class='word'>of</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>demand-paging</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>the</span> <span class='word'>OS</span> <span class='word'>needs</span> <span class='word'>to</span> <span class='word'>step</span> <span class='word'>in</span> <span class='word'>and</span> <span class='word'>move</span> <span class='word'>virtual</span> <span class='word'>memory</span> <span class='word'>pages</span> <span class='word'>into</span> <span class='word'>physical</span> <span class='word'>memory</span> <span class='word'>for</span> <span class='word'>an</span> <span class='word'>instruction</span> <span class='word'>to</span> <span class='word'>use</span><span class='ignore'>.</span><span class='cumsum'> [535]</span><br>
<span class='word'>This</span> <span class='word'>use-case</span> <span class='word'>is</span> <span class='word'>specifically</span> <span class='word'>called</span> <span class='word'>out</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>specification</span> <span class='word'>for</span> <span class='word'>precise</span> <span class='word'>traps</span><span class='ignore'>.</span><span class='cumsum'> [547]</span><br>
<span class='word'>Usually</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>is</span> <span class='word'>triggered</span> <span class='word'>by</span> <span class='word'>some</span> <span class='word'>element</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>raising</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span><span class='ignore'>,</span> <span class='word'>invoking</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>trap</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>writing</span> <span class='word'>the</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>Machine</span> <span class='word'>Trap</span> <span class='word'>Value</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>scalar</span> <span class='word'>register</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>offending</span> <span class='word'>address</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>3.1.21</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RISCV-vol2-20211203</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [581]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>set</span> <span class='word'>to</span> <span class='word'>an</span> <span class='word'>element</span> <span class='word'>at</span> <span class='ignore'>(</span><span class='word'>or</span> <span class='word'>before</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>If</span> <span class='oword'>the</span> <span class='oword'>memory</span> <span class='oword'>region</span> <span class='oword'>is</span> <span class='oword'>idempotent</span><span class='ignore'>,</span> <span class='oword'>then</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>vstart</span><span class='ignore'>}</span> <span class='oword'>could</span> <span class='oword'>any</span> <span class='oword'>value</span> <span class='oword'>where</span> <span class='oword'>all</span> <span class='oword'>preceding</span> <span class='oword'>elements</span> <span class='oword'>had</span> <span class='oword'>completed</span><span class='ignore'>.</span> <span class='oword'>It</span> <span class='oword'>could</span> <span class='oword'>even</span> <span class='oword'>be</span> <span class='oword'>zero</span><span class='ignore'>,</span> <span class='oword'>in</span> <span class='oword'>which</span> <span class='oword'>case</span> <span class='oword'>all</span> <span class='oword'>accesses</span> <span class='oword'>would</span> <span class='oword'>be</span> <span class='oword'>retried</span> <span class='oword'>on</span> <span class='oword'>resume</span><span class='ignore'>,</span> <span class='oword'>as</span> <span class='oword'>long</span> <span class='oword'>as</span> <span class='oword'>it</span> <span class='oword'>could</span> <span class='oword'>guarantee</span> <span class='oword'>forward</span> <span class='oword'>progress</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>the</span> <span class='word'>one</span> <span class='word'>that</span> <span class='word'>demanded</span> <span class='word'>the</span> <span class='word'>page</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>that</span> <span class='word'>element</span> <span class='word'>must</span> <span class='word'>perform</span> <span class='word'>the</span> <span class='word'>access</span> <span class='word'>after</span> <span class='word'>reloading</span><span class='ignore'>.</span><span class='cumsum'> [646]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>sets</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>offending</span> <span class='word'>element</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>operations</span> <span class='word'>preceding</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>have</span> <span class='word'>completed</span><span class='ignore'>,</span> <span class='word'>any</span> <span class='word'>elements</span> <span class='word'>that</span> <span class='word'>could</span> <span class='word'>potentially</span> <span class='word'>trigger</span> <span class='word'>demand-paging</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>must</span><span class='ignore'>}</span> <span class='word'>wait</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>preceding</span> <span class='word'>elements</span> <span class='word'>to</span> <span class='word'>complete</span><span class='ignore'>.</span><span class='cumsum'> [677]</span><br>
<span class='cumsum'> [677]</span><br>
<span class='cumsum'> [677]</span><br>
<span class='comment'>% \code{vstart} must be set to an element that demanded the page</span><span class='cumsum'> [677]</span><br>
<span class='comment'>% Because \code{vstart} must be set to the element that demanded the page, and operations preceding \code{vstart} must have completed, any elements that could potentially trigger demand-paging \emph{must} wait for the preceding elements to complete.</span><span class='cumsum'> [677]</span><br>
<span class='comment'>% This always applies, no matter what the instruction's specific ordering guarantees are.</span><span class='cumsum'> [677]</span><br>
<span class='cumsum'> [677]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [677]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Other</span> <span class='hword'>modes</span><span class='ignore'>}</span><span class='cumsum'> [679]</span><br>
<span class='word'>The</span> <span class='word'>RVV</span> <span class='word'>spec</span> <span class='word'>notes</span> <span class='word'>two</span> <span class='word'>other</span> <span class='word'>possible</span> <span class='word'>future</span> <span class='word'>trap</span> <span class='word'>modes</span><span class='ignore'>.</span><span class='cumsum'> [689]</span><br>
<span class='word'>First</span> <span class='word'>is</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>Selectable</span> <span class='word'>precise</span><span class='ignore'>/</span><span class='word'>imprecise</span> <span class='word'>traps</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>allows</span> <span class='word'>the</span> <span class='word'>user</span> <span class='word'>to</span> <span class='word'>select</span> <span class='word'>precise</span> <span class='word'>or</span> <span class='word'>imprecise</span> <span class='word'>traps</span> <span class='word'>for</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>debugging</span> <span class='word'>or</span> <span class='word'>performance</span><span class='ignore'>.</span><span class='cumsum'> [712]</span><br>
<span class='cumsum'> [712]</span><br>
<span class='word'>The</span> <span class='word'>second</span> <span class='word'>mode</span> <span class='word'>is</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>Swappable</span> <span class='word'>traps</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>a</span> <span class='word'>trap</span> <span class='word'>handler</span> <span class='word'>could</span> <span class='word'>use</span> <span class='word'>special</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>save</span> <span class='word'>and</span> <span class='word'>restore</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>unit</span> <span class='word'>microarchitectural</span> <span class='word'>state</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [735]</span><br>
<span class='word'>The</span> <span class='word'>intent</span> <span class='word'>seems</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>context</span> <span class='word'>switching</span> <span class='word'>with</span> <span class='word'>imprecise</span> <span class='word'>traps</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>could</span> <span class='word'>also</span> <span class='word'>require</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>opaque</span><span class='ignore'>}</span> <span class='word'>state</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>internal</span> <span class='word'>state</span> <span class='word'>not</span> <span class='word'>visible</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>program</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>saved</span> <span class='word'>and</span> <span class='word'>restored</span><span class='ignore'>.</span><span class='cumsum'> [767]</span><br>
<span class='word'>Right</span> <span class='word'>now</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>seems</span> <span class='word'>that</span> <span class='word'>context</span> <span class='word'>switching</span> <span class='word'>always</span> <span class='word'>requires</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>trap</span><span class='ignore'>.</span><span class='cumsum'> [779]</span><br>
<span class='cumsum'> [779]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [779]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Summary</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>rvvsummary</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_examples_combined</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cumsum'> [1]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_examples_combined.tex</span><span class='cumsum'> [1]</span><br>
<span class='envir'>\begin</span><span class='envir'>{basicfig}</span><span class='ignore'>{</span><span class='word'>Figures</span><span class='ignore'>/</span><span class='word'>RVV</span><span class='ignore'>_</span><span class='word'>examples</span><span class='ignore'>_</span><span class='word'>combined.pdf</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Combined</span> <span class='oword'>examples</span> <span class='oword'>for</span> <span class='oword'>RVV</span> <span class='oword'>vector</span><span class='ignore'>}</span><span class='cumsum'> [10]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>examples</span><span class='ignore'>_</span><span class='ignore'>combined</span><span class='ignore'>}</span><span class='cumsum'> [10]</span><br>
<span class='envir'>\end</span><span class='envir'>{basicfig}</span><span class='cumsum'> [10]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_examples_combined.tex</span><span class='cumsum'> [10]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.8</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [14]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>examples</span><span class='ignore'>_</span><span class='ignore'>combined</span><span class='ignore'>}</span> <span class='word'>shows</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>above</span> <span class='word'>features</span> <span class='word'>used</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>configuration</span><span class='ignore'>:</span><span class='cumsum'> [25]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [25]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>The</span> <span class='word'>instruction</span> <span class='word'>was</span> <span class='word'>previously</span> <span class='word'>interrupted</span> <span class='word'>with</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>trap</span> <span class='word'>and</span> <span class='word'>restarted</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>=</span><span class='word'>2</span><span class='ignore'>}</span><span class='cumsum'> [39]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Elements</span> <span class='word'>are</span> <span class='word'>16-bit</span><span class='cumsum'> [42]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span><span class='ignore'>=</span><span class='word'>4</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>try</span> <span class='word'>and</span> <span class='word'>increase</span> <span class='word'>throughput</span><span class='cumsum'> [49]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Only</span> <span class='word'>29</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>32</span> <span class='word'>available</span> <span class='word'>elements</span> <span class='word'>were</span> <span class='word'>requested</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>=</span><span class='word'>29</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>3</span> <span class='word'>tail</span> <span class='word'>elements</span><span class='ignore'>)</span><span class='cumsum'> [64]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Some</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>masked</span> <span class='word'>out</span><span class='ignore'>/</span><span class='word'>inactive</span> <span class='ignore'>(</span><span class='word'>in</span> <span class='word'>this</span> <span class='word'>case</span> <span class='word'>seemingly</span> <span class='word'>at</span> <span class='word'>random</span><span class='ignore'>)</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Overall</span><span class='ignore'>,</span> <span class='word'>21</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>active</span><span class='cumsum'> [81]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [81]</span><br>
<span class='cumsum'> [81]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub30_rvv_model.tex</span><span class='cumsum'> [81]</span><br>
<span class='cumsum'> [81]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub39_rvv_impls}</span><span class='cumsum'> [81]</span><br>
<span class='cumsum'> [81]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub39_rvv_impls.tex</span><span class='cumsum'> [81]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Previous</span> <span class='hword'>RVV</span> <span class='hword'>implementations</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>rvvend</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>Academia</span> <span class='word'>and</span> <span class='word'>industry</span> <span class='word'>have</span> <span class='word'>implemented</span> <span class='word'>RVV</span> <span class='word'>even</span> <span class='word'>before</span> <span class='word'>v1.0</span> <span class='word'>was</span> <span class='word'>released</span><span class='ignore'>.</span><span class='cumsum'> [14]</span><br>
<span class='comment'>% Even before v1.0 of the RVV specification was released, multiple implementations were released in academia and industry.</span><span class='cumsum'> [14]</span><br>
<span class='word'>The</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>model</span> <span class='word'>allows</span> <span class='word'>great</span> <span class='word'>diversity</span><span class='ignore'>:</span> <span class='cmd'>\citeauthor</span><span class='ignore'>{</span><span class='ignore'>johnsMinimalRISCVVector2020</span><span class='ignore'>}</span> <span class='word'>integrated</span> <span class='word'>a</span> <span class='word'>minimal</span> <span class='word'>vector</span> <span class='word'>processor</span> <span class='word'>into</span> <span class='word'>a</span> <span class='word'>microcontroller's</span> <span class='word'>scalar</span> <span class='word'>pipeline</span> <span class='ignore'>(</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>=</span><span class='word'>32</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>johnsMinimalRISCVVector2020</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\citeauthor</span><span class='ignore'>{</span><span class='ignore'>dimascioOnBoardDecisionMaking2021</span><span class='ignore'>}</span> <span class='word'>used</span> <span class='word'>RVV</span> <span class='word'>for</span> <span class='word'>deep</span> <span class='word'>learning</span> <span class='word'>in</span> <span class='word'>space</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>dimascioOnBoardDecisionMaking2021</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>AndesCode</span><span class='ignore'>,</span> <span class='word'>SiFive</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>Alibaba</span> <span class='word'>have</span> <span class='word'>released</span> <span class='word'>cores</span> <span class='word'>with</span> <span class='cmd'>\code</span><span class='word'>{VLEN}s</span> <span class='word'>up</span> <span class='word'>to</span> <span class='word'>512</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>AndesCoreNX27VProcessor</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>SiFiveIntelligenceX280</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>chenXuantie910CommercialMultiCore2020</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [53]</span><br>
<span class='word'>Other</span> <span class='word'>academic</span> <span class='word'>examples</span> <span class='word'>include</span> <span class='word'>Ara</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>cavalcanteAra1GHzScalable2020</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>Arrow</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>assirArrowRISCVVector2021</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>RISC</span><span class='ignore'>-</span><span class='mathgroup'>$</span><span class='mathcmd'>\text</span><span class='ignore'>{</span><span class='math'>V</span><span class='ignore'>}</span><span class='math'>^</span><span class='math'>2</span><span class='mathgroup'>$</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>patsidisRISCV2ScalableRISCV2020</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>Vicuna</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>platzerVicunaTimingPredictableRISCV2021</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>all</span> <span class='word'>decouple</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>processing</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>scalar</span> <span class='word'>pipeline</span><span class='ignore'>.</span><span class='cumsum'> [73]</span><br>
<span class='comment'>%\footnote{These implementations are not examined further as they do not go into detail on their load/store implementations.}</span><span class='cumsum'> [73]</span><br>
<span class='comment'>% \todomark{Planned to do a survey of existing implementations here - might be too many words?}</span><span class='cumsum'> [73]</span><br>
<span class='cumsum'> [73]</span><br>
<span class='word'>Very</span> <span class='word'>recently</span><span class='ignore'>,</span> <span class='word'>more</span> <span class='word'>implementations</span> <span class='word'>were</span> <span class='word'>revealed</span> <span class='word'>at</span> <span class='word'>RISC-V</span> <span class='word'>Week</span> <span class='word'>in</span> <span class='word'>Paris</span> <span class='ignore'>(</span><span class='word'>May</span> <span class='word'>2022</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [86]</span><br>
<span class='comment'>% This is only going to continue: multiple implementations were just recently presented at RISC-V Week in Paris (May 2022).</span><span class='cumsum'> [86]</span><br>
<span class='word'>Vitruvius</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>minerviniVitruviusAreaEfficientRISCV2022</span><span class='ignore'>}</span> <span class='word'>uses</span> <span class='word'>extremely</span> <span class='word'>long</span> <span class='word'>vectors</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span> <span class='ignore'>=</span> <span class='word'>16384</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>is</span> <span class='word'>implemented</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>decoupled</span> <span class='word'>processor</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>first</span> <span class='word'>RISC-V</span> <span class='word'>processor</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>the</span> <span class='word'>Open</span> <span class='word'>Vector</span> <span class='word'>Interface</span> <span class='ignore'>(</span><span class='word'>OVI</span><span class='ignore'>)</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitrepo</span><span class='ignore'>{</span><span class='oword'>semidynamics</span><span class='ignore'>/</span><span class='oword'>OpenVectorInterface</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>semidynamics</span><span class='ignore'>/</span><span class='ignore'>OpenVectorInterface</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>communicate</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>scalar</span> <span class='word'>core</span><span class='ignore'>.</span><span class='cumsum'> [120]</span><br>
<span class='word'>VecProM</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>mahaleRISCVVPUVery2021</span><span class='ignore'>}</span> <span class='word'>splits</span> <span class='word'>its</span> <span class='word'>approach</span> <span class='word'>into</span> <span class='word'>two</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>vectors</span> <span class='word'>beyond</span> <span class='word'>a</span> <span class='word'>certain</span> <span class='word'>length</span> <span class='word'>are</span> <span class='word'>strip-mined</span> <span class='word'>and</span> <span class='word'>processed</span> <span class='word'>in</span> <span class='word'>hardware</span> <span class='word'>using</span> <span class='word'>a</span> <span class='word'>scratch</span> <span class='word'>memory</span><span class='ignore'>,</span> <span class='word'>using</span> <span class='word'>OVI</span> <span class='word'>to</span> <span class='word'>connect</span> <span class='word'>multiple</span> <span class='word'>heterogeneous</span> <span class='word'>vector</span> <span class='word'>processors</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>scalar</span> <span class='word'>core</span><span class='ignore'>.</span><span class='cumsum'> [154]</span><br>
<span class='word'>Both</span> <span class='word'>were</span> <span class='word'>produced</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>Barcelona</span> <span class='word'>Supercomputing</span> <span class='word'>Center</span> <span class='word'>under</span> <span class='word'>the</span> <span class='word'>European</span> <span class='word'>Processor</span> <span class='word'>Initiative</span><span class='ignore'>.</span><span class='cumsum'> [167]</span><br>
<span class='word'>It</span> <span class='word'>seems</span> <span class='word'>that</span> <span class='word'>adoption</span> <span class='word'>of</span> <span class='word'>RVV</span> <span class='word'>will</span> <span class='word'>continue</span><span class='ignore'>,</span> <span class='word'>making</span> <span class='word'>it</span> <span class='word'>a</span> <span class='word'>good</span> <span class='word'>choice</span> <span class='word'>for</span> <span class='word'>adapting</span> <span class='word'>to</span> <span class='word'>CHERI</span><span class='ignore'>.</span><span class='cumsum'> [184]</span><br>
<span class='cumsum'> [184]</span><br>
<span class='comment'>% \todomark{This is only going to continue: an implementation was presented at RISC-V week(cite)}</span><span class='cumsum'> [184]</span><br>
<span class='comment'>% Vitruvius: 256 * 64-bit elements</span><span class='cumsum'> [184]</span><br>
<span class='comment'>% Decoupled processor</span><span class='cumsum'> [184]</span><br>
<span class='comment'>% Uses OVI to communicate with scalar cores</span><span class='cumsum'> [184]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub39_rvv_impls.tex</span><span class='cumsum'> [184]</span><br>
<span class='cumsum'> [184]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [184]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub35_rvv_memory}</span><span class='cumsum'> [184]</span><br>
<span class='cumsum'> [184]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub35_rvv_memory.tex</span><span class='cumsum'> [184]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [184]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [184]</span><br>
<span class='comment'>%---------------------------------</span><span class='cumsum'> [184]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>RVV</span> <span class='hword'>memory</span> <span class='hword'>instructions</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvvmemory</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Summarizes</span> <span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Sections</span> <span class='word'>7-9</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='cumsum'> [6]</span><br>
<span class='word'>RVV</span> <span class='word'>defines</span> <span class='word'>three</span> <span class='word'>broad</span> <span class='word'>categories</span> <span class='word'>of</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>further</span> <span class='word'>split</span> <span class='word'>into</span> <span class='word'>five</span> <span class='word'>archetypes</span> <span class='word'>with</span> <span class='word'>different</span> <span class='word'>semantics</span><span class='ignore'>.</span><span class='cumsum'> [26]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>summarizes</span> <span class='word'>each</span> <span class='word'>archetype</span><span class='ignore'>,</span> <span class='word'>their</span> <span class='word'>semantics</span><span class='ignore'>,</span> <span class='word'>their</span> <span class='word'>assembly</span> <span class='word'>mnemonics</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>demonstrates</span> <span class='word'>how</span> <span class='word'>they</span> <span class='word'>map</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>to</span> <span class='word'>vector</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [46]</span><br>
<span class='cumsum'> [46]</span><br>
<span class='comment'>% \begin{table}[]</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \centering</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \begin{tabular}{cc|c|}</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \toprule</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Archetype &amp; Direction &amp;&nbsp; Category \\</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  \midrule</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Unit/Strided &amp; Load/Store &amp; Unit/Strided \\</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Fault-only-First &amp; Load &amp; Unit \\</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Whole-Register &amp; Load/Store &amp; Unit \\</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Bytemask &amp; Load/Store &amp; Unit \\</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  Indexed &amp; Load/Store &amp; Indexed</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp; &nbsp; &nbsp;  \bottomrule</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \end{tabular}</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \caption{Table of categories/archetypes??}</span><span class='cumsum'> [46]</span><br>
<span class='comment'>%&nbsp; &nbsp;  \label{tab:my_label}</span><span class='cumsum'> [46]</span><br>
<span class='comment'>% \end{table}</span><span class='cumsum'> [46]</span><br>
<span class='cumsum'> [46]</span><br>
<span class='comment'>% RVV defines five broad categories of memory access instructions.</span><span class='cumsum'> [46]</span><br>
<span class='word'>For</span> <span class='word'>the</span> <span class='word'>most</span> <span class='word'>part</span><span class='ignore'>,</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>handle</span> <span class='word'>their</span> <span class='word'>operands</span> <span class='word'>as</span> <span class='word'>described</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>model</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [59]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EEW</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EMUL</span><span class='ignore'>}</span> <span class='word'>are</span> <span class='word'>usually</span> <span class='word'>derived</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>encoding</span><span class='ignore'>,</span> <span class='word'>rather</span> <span class='word'>than</span> <span class='word'>reading</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>CSR</span><span class='ignore'>.</span><span class='cumsum'> [75]</span><br>
<span class='word'>In</span> <span class='word'>a</span> <span class='word'>few</span> <span class='word'>cases</span> <span class='word'>the</span> <span class='word'>Effective</span> <span class='word'>Vector</span> <span class='word'>Length</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>different</span> <span class='word'>from</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>CSR</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>for</span> <span class='word'>simplicity</span> <span class='word'>all</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>described</span> <span class='word'>in</span> <span class='word'>terms</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [101]</span><br>
<span class='cumsum'> [101]</span><br>
<span class='cmd'>\subsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Segmented</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>Three</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>five</span> <span class='word'>archetypes</span> <span class='ignore'>(</span><span class='word'>unit</span><span class='ignore'>/</span><span class='word'>strided</span><span class='ignore'>,</span> <span class='word'>fault-only-first</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>indexed</span><span class='ignore'>)</span> <span class='word'>support</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>segmented</span><span class='ignore'>}</span> <span class='word'>access</span><span class='ignore'>.</span><span class='cumsum'> [15]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>used</span> <span class='word'>for</span> <span class='word'>unpacking</span> <span class='word'>contiguous</span> <span class='word'>structures</span> <span class='word'>of</span> <span class='mathgroup'>$</span><span class='math'>1</span> <span class='mathcmd'>\le</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>nf</span><span class='ignore'>}</span> <span class='mathcmd'>\le</span> <span class='math'>8</span><span class='mathgroup'>$</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>fields</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>placing</span> <span class='word'>each</span> <span class='word'>field</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>separate</span> <span class='word'>vector</span><span class='ignore'>.</span><span class='cumsum'> [33]</span><br>
<span class='word'>In</span> <span class='word'>these</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>values</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>mask</span> <span class='word'>register</span> <span class='word'>are</span> <span class='word'>interpreted</span> <span class='word'>in</span> <span class='word'>terms</span> <span class='word'>of</span> <span class='word'>segments</span><span class='ignore'>.</span><span class='cumsum'> [51]</span><br>
<span class='comment'>% Additionally, if an element within a segment causes a synchronous exception/trap, it</span><span class='cumsum'> [51]</span><br>
<span class='cumsum'> [51]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>}</span> <span class='word'>demonstrates</span> <span class='word'>a</span> <span class='word'>common</span> <span class='word'>example</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>extraction</span> <span class='word'>of</span> <span class='word'>separate</span> <span class='word'>R</span><span class='ignore'>,</span> <span class='word'>G</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>B</span> <span class='word'>components</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>color</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='word'>Without</span> <span class='word'>segmentation</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='mathgroup'>$</span><span class='math'>n</span> <span class='math'>=</span> <span class='math'>1</span><span class='mathgroup'>$</span><span class='ignore'>,</span> <span class='word'>each</span> <span class='word'>consecutive</span> <span class='word'>memory</span> <span class='word'>address</span> <span class='word'>maps</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>consecutive</span> <span class='word'>element</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>group</span><span class='ignore'>.</span><span class='cumsum'> [86]</span><br>
<span class='word'>With</span> <span class='word'>segmentation</span><span class='ignore'>,</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>grouped</span> <span class='word'>into</span> <span class='word'>segments</span> <span class='word'>of</span> <span class='mathgroup'>$</span><span class='math'>n</span> <span class='math'>&gt;</span> <span class='math'>1</span><span class='mathgroup'>$</span> <span class='word'>fields</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>each</span> <span class='word'>field</span> <span class='word'>is</span> <span class='word'>mapped</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>different</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>group</span><span class='ignore'>.</span><span class='cumsum'> [107]</span><br>
<span class='word'>This</span> <span class='word'>principle</span> <span class='word'>extends</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LMUL</span> <span class='ignore'>&gt;</span> <span class='word'>1</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>lmul</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [113]</span><br>
<span class='cumsum'> [113]</span><br>
<span class='comment'>% \todomark{vl, vstart, masks are all in terms of segments in segmented accesses.}</span><span class='cumsum'> [113]</span><br>
<span class='comment'>% \todomark{if a trap occurs, it is implementation defined if a subset of the faulting segment's accesses are performed before the trap is taken}</span><span class='cumsum'> [113]</span><br>
<span class='comment'>% \todomark{nf has range 1..8}</span><span class='cumsum'> [113]</span><br>
<span class='cumsum'> [113]</span><br>
<span class='cmd'>\figinput</span><span class='ignore'>{</span><span class='fileinc'>1_20Background/figures/fig_RVV_mem_unit</span><span class='ignore'>}</span><span class='cumsum'> [113]</span><br>
<span class='cumsum'> [113]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/figures/fig_RVV_mem_unit.tex</span><span class='cumsum'> [113]</span><br>
<span class='envir'>\begin</span><span class='envir'>{turnipfig}</span><span class='cumsum'> [113]</span><br>
&nbsp;&nbsp;<span class='cmd'>\centering</span><span class='cumsum'> [113]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='cmd'>\figinputWidth</span><span class='ignore'>}</span><span class='cumsum'> [113]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\centering</span><span class='cumsum'> [113]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\adjustbox</span><span class='ignore'>{</span><span class='word'>valign</span><span class='ignore'>=</span><span class='word'>t</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='cmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>_</span><span class='ignore'>noseg.pdf</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [115]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Simple</span> <span class='oword'>vector</span> <span class='oword'>element</span> <span class='oword'>to</span> <span class='oword'>address</span> <span class='oword'>mapping</span><span class='ignore'>}</span><span class='cumsum'> [121]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>_</span><span class='ignore'>noseg</span><span class='ignore'>}</span><span class='cumsum'> [121]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{subfigure}</span><span class='cumsum'> [121]</span><br>
&nbsp; &nbsp; <span class='cmd'>\hfill</span><span class='cumsum'> [121]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='cmd'>\figinputWidth</span><span class='ignore'>}</span><span class='cumsum'> [121]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\centering</span><span class='cumsum'> [121]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\adjustbox</span><span class='ignore'>{</span><span class='word'>valign</span><span class='ignore'>=</span><span class='word'>t</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='cmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>_</span><span class='ignore'>3seg.pdf</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [123]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Element-address</span> <span class='oword'>mapping</span> <span class='oword'>for</span> <span class='oword'>segmented</span> <span class='oword'>access</span><span class='ignore'>}</span><span class='cumsum'> [128]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='cumsum'> [128]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{subfigure}</span><span class='cumsum'> [128]</span><br>
&nbsp; &nbsp; <span class='cumsum'> [128]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='cmd'>\figinputWidth</span><span class='ignore'>}</span><span class='cumsum'> [128]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\centering</span><span class='cumsum'> [128]</span><br>
&nbsp; &nbsp;  <span class='cmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>lmul</span><span class='ignore'>_</span><span class='ignore'>3seg.pdf</span><span class='ignore'>}</span><span class='cumsum'> [128]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>segment</span> <span class='oword'>mapping</span> <span class='oword'>for</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>LMUL</span> <span class='ignore'>&gt;</span> <span class='oword'>1</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [135]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>lmul</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='cumsum'> [135]</span><br>
&nbsp;&nbsp;<span class='envir'>\end</span><span class='envir'>{subfigure}</span><span class='cumsum'> [135]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Comparison</span> <span class='oword'>between</span> <span class='oword'>segmented</span> <span class='oword'>and</span> <span class='oword'>unsegmented</span> <span class='oword'>accesses</span><span class='cmd'>\\</span><span class='oword'>For</span> <span class='oword'>readability</span><span class='ignore'>,</span> <span class='oword'>the</span> <span class='oword'>vector</span> <span class='oword'>registers</span> <span class='oword'>are</span> <span class='oword'>2x</span> <span class='oword'>as</span> <span class='oword'>wide</span><span class='ignore'>}</span><span class='cumsum'> [150]</span><br>
&nbsp;&nbsp;<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>unit</span><span class='ignore'>}</span><span class='cumsum'> [150]</span><br>
<span class='envir'>\end</span><span class='envir'>{turnipfig}</span><span class='cumsum'> [150]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/figures/fig_RVV_mem_unit.tex</span><span class='cumsum'> [150]</span><br>
<span class='ignore'>[</span><span class='word'>width</span><span class='ignore'>=</span><span class='word'>0.48</span><span class='cmd'>\textwidth</span><span class='ignore'>,</span><span class='word'>pos</span><span class='ignore'>=</span><span class='word'>h</span><span class='ignore'>]</span><span class='cumsum'> [154]</span><br>
<span class='comment'>% \figinput[width=0.55\textwidth,pos=h]{1_20Background/figures/fig_RVV_mem_lmul_3seg}</span><span class='cumsum'> [154]</span><br>
<span class='cumsum'> [154]</span><br>
<span class='cumsum'> [154]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [154]</span><br>
<span class='comment'>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class='cumsum'> [154]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Unit</span> <span class='hword'>and</span> <span class='hword'>Strided</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>unitstrideaccess</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='cumsum'> [4]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[h]</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='ignore'>{</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>llcccc</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>&amp;</span> <span class='ignore'>Mnmemonic</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='ignore'>&amp;</span> <span class='ignore'>Stride</span> <span class='ignore'>&amp;</span> <span class='ignore'>Masked</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Unit</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vlseg</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>e</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\textit</span><span class='ignore'>{</span><span class='exclcmd'>\small</span> <span class='ignore'>implicit</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Strided</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vlsseg</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>e</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>rs2</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span> <span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Instruction</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\vspace</span><span class='ignore'>{</span><span class='ignore'>1em</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='option'>[b]</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='ignore'>Masked</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span> <span class='ignore'>=</span><span class='ignore'>=</span> <span class='ignore'>0</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vl</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>VLEN</span> <span class='ignore'>*</span> <span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='ignore'>/</span> <span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>NFIELDS</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Parameters</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>strided</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='exclcmd'>\hfill</span><span class='cumsum'> [6]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>strided</span><span class='ignore'>_</span><span class='ignore'>3seg.pdf</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>segmented</span> <span class='oword'>strided</span> <span class='oword'>access</span><span class='cmd'>\\</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>EEW</span><span class='ignore'>=</span><span class='oword'>8-bits</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>nf</span><span class='ignore'>=</span><span class='oword'>3</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>stride</span><span class='ignore'>=</span><span class='oword'>4</span><span class='ignore'>}</span><span class='ignore'>,</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>EVL</span><span class='ignore'>=</span><span class='oword'>4</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [20]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>strided</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='cumsum'> [20]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [20]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Segmented</span> <span class='oword'>Unit</span><span class='ignore'>/</span><span class='oword'>Strided</span> <span class='oword'>Access</span> <span class='oword'>Information</span><span class='ignore'>}</span><span class='cumsum'> [25]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [25]</span><br>
<span class='cumsum'> [25]</span><br>
<span class='cmd'>\noindent</span><span class='cumsum'> [25]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>moves</span> <span class='word'>active</span> <span class='word'>elements</span> <span class='word'>of</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nf</span><span class='ignore'>}</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>groups</span> <span class='word'>to</span><span class='ignore'>/</span><span class='word'>from</span> <span class='word'>contiguous</span> <span class='word'>segments</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>,</span><span class='cumsum'> [41]</span><br>
<span class='word'>where</span> <span class='word'>the</span> <span class='word'>start</span> <span class='word'>of</span> <span class='word'>each</span> <span class='word'>segment</span> <span class='word'>is</span> <span class='word'>separated</span> <span class='word'>by</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>stride</span><span class='ignore'>}</span> <span class='word'>bytes</span><span class='ignore'>.</span><span class='cumsum'> [52]</span><br>
<span class='cumsum'> [52]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [52]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Unit-stride</span> <span class='word'>instructions</span> <span class='word'>tightly</span> <span class='word'>pack</span> <span class='word'>segments</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>stride</span> <span class='ignore'>=</span> <span class='cmd'>\param</span><span class='ignore'>{</span><span class='word'>nf</span><span class='ignore'>}</span> <span class='ignore'>*</span> <span class='cmd'>\param</span><span class='ignore'>{</span><span class='word'>eew</span><span class='ignore'>}</span> <span class='ignore'>/</span> <span class='word'>8</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [62]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Strided</span> <span class='word'>instructions</span> <span class='word'>read</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>stride</span><span class='ignore'>}</span> <span class='word'>from</span> <span class='word'>register</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>rs2</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [69]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [69]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>stride</span><span class='ignore'>}</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>positive</span><span class='ignore'>,</span> <span class='word'>negative</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>zero</span><span class='ignore'>.</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='comment'>% These two are described by the diagram</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='comment'>% \item Each segment is \code{\param{nf} * \param{eew}} bits long, i.e. \paramt{nf} elements long.</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='comment'>% \item Each element in the $i$-th segment maps to the $i$-th element of a vector register group.</span><span class='cumsum'> [76]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>do</span> <span class='word'>anything</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span> <span class='ignore'>&gt;</span><span class='ignore'>=</span> <span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [84]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [84]</span><br>
<span class='cumsum'> [84]</span><br>
<span class='word'>Strided</span> <span class='word'>accesses</span> <span class='word'>where</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>rs2</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>register</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>x0</span><span class='ignore'>}</span> <span class='word'>may</span> <span class='word'>perform</span> <span class='word'>fewer</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [98]</span><br>
<span class='word'>Otherwise</span><span class='ignore'>,</span> <span class='word'>even</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>stride</span> <span class='ignore'>=</span> <span class='word'>0</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>implementations</span> <span class='word'>must</span> <span class='word'>appear</span> <span class='word'>to</span> <span class='word'>perform</span> <span class='word'>all</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [110]</span><br>
<span class='cumsum'> [110]</span><br>
<span class='comment'>% ORDERING</span><span class='cumsum'> [110]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Ordering</span><span class='ignore'>}</span><span class='cumsum'> [111]</span><br>
<span class='word'>There</span> <span class='word'>are</span> <span class='word'>no</span> <span class='word'>ordering</span> <span class='word'>guarantees</span><span class='ignore'>,</span> <span class='word'>other</span> <span class='word'>than</span> <span class='word'>those</span> <span class='word'>required</span> <span class='word'>by</span> <span class='word'>precise</span> <span class='word'>vector</span> <span class='word'>traps</span> <span class='ignore'>(</span><span class='word'>if</span> <span class='word'>used</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [126]</span><br>
<span class='cumsum'> [126]</span><br>
<span class='comment'>% EXCEPTION HANDLING</span><span class='cumsum'> [126]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Exception</span> <span class='hword'>Handling</span><span class='ignore'>}</span><span class='cumsum'> [128]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>element</span> <span class='word'>within</span> <span class='word'>segment</span> <span class='mathgroup'>$</span><span class='math'>i</span><span class='mathgroup'>$</span> <span class='word'>triggers</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>set</span> <span class='word'>to</span> <span class='mathgroup'>$</span><span class='math'>i</span><span class='mathgroup'>$</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>or</span> <span class='word'>imprecise</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>triggered</span><span class='ignore'>.</span><span class='cumsum'> [151]</span><br>
<span class='word'>Load</span> <span class='word'>instructions</span> <span class='word'>may</span> <span class='word'>overwrite</span> <span class='word'>active</span> <span class='word'>segments</span> <span class='word'>past</span> <span class='word'>the</span> <span class='word'>segment</span> <span class='word'>index</span> <span class='word'>at</span> <span class='word'>which</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>reported</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>not</span> <span class='word'>past</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>7.7</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='cumsum'> [173]</span><br>
<span class='word'>Upon</span> <span class='word'>entering</span> <span class='word'>a</span> <span class='word'>trap</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>implementation-defined</span> <span class='word'>how</span> <span class='word'>much</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>faulting</span> <span class='word'>segment's</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>performed</span><span class='ignore'>.</span><span class='cumsum'> [189]</span><br>
<span class='cumsum'> [189]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Unit</span> <span class='hword'>fault-only-first</span> <span class='hword'>loads</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>fof</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='cumsum'> [3]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[h]</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='ignore'>{</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lccc</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Mnemonic</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='ignore'>&amp;</span> <span class='ignore'>Masked</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vlseg</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>e</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>ff.v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Instruction</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [4]</span><br>
<span class='cumsum'> [4]</span><br>
<span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='ignore'>{</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Masked</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span> <span class='ignore'>=</span><span class='ignore'>=</span> <span class='ignore'>0</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vl</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span>&nbsp; <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>VLEN</span> <span class='ignore'>*</span> <span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='ignore'>/</span> <span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>NFIELDS</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Parameters</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [5]</span><br>
<span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Unit</span> <span class='oword'>Fault-only-First</span> <span class='oword'>Information</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>fof</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [8]</span><br>
<span class='cumsum'> [8]</span><br>
<span class='cumsum'> [8]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>is</span> <span class='word'>equivalent</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>unit</span> <span class='word'>load</span> <span class='word'>in</span> <span class='word'>all</span> <span class='word'>respects</span> <span class='word'>but</span> <span class='word'>exception</span> <span class='word'>handling</span><span class='ignore'>.</span><span class='cumsum'> [22]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>access</span> <span class='word'>in</span> <span class='word'>segment</span> <span class='word'>0</span> <span class='word'>raises</span> <span class='word'>an</span> <span class='word'>exception</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Segment</span> <span class='oword'>0</span> <span class='oword'>may</span> <span class='oword'>be</span> <span class='oword'>masked</span> <span class='oword'>out</span><span class='ignore'>,</span> <span class='oword'>in</span> <span class='oword'>which</span> <span class='oword'>case</span> <span class='oword'>this</span> <span class='oword'>is</span> <span class='oword'>impossible</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>modified</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>taken</span> <span class='word'>as</span> <span class='word'>usual</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>access</span> <span class='word'>in</span> <span class='word'>any</span> <span class='word'>active</span> <span class='word'>segment</span> <span class='mathgroup'>$</span><span class='math'>&gt;</span> <span class='math'>0</span><span class='mathgroup'>$</span> <span class='word'>raises</span> <span class='word'>an</span> <span class='word'>exception</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>taken</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>reduced</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>index</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>offending</span> <span class='word'>segment</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>finishes</span><span class='ignore'>.</span><span class='cumsum'> [84]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>asynchronous</span> <span class='word'>interrupt</span> <span class='word'>is</span> <span class='word'>encountered</span> <span class='word'>at</span> <span class='word'>any</span> <span class='word'>point</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>taken</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>set</span> <span class='word'>as</span> <span class='word'>usual</span><span class='ignore'>.</span><span class='cumsum'> [103]</span><br>
<span class='cumsum'> [103]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>is</span> <span class='word'>intended</span> <span class='word'>for</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>loops</span> <span class='word'>with</span> <span class='word'>data-dependent</span> <span class='word'>exit</span> <span class='word'>conditions</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>is</span> <span class='word'>commonly</span> <span class='word'>used</span> <span class='word'>for</span> <span class='word'>string</span> <span class='word'>operations</span><span class='ignore'>.</span><span class='cumsum'> [120]</span><br>
<span class='word'>The</span> <span class='word'>specification</span> <span class='word'>uses</span> <span class='word'>it</span> <span class='word'>in</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>strcmp</span><span class='ignore'>}</span> <span class='word'>example</span><span class='ignore'>~</span><span class='ignore'>(</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span><span class='ignore'>~</span><span class='word'>A.9</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [130]</span><br>
<span class='cumsum'> [130]</span><br>
<span class='word'>Similar</span> <span class='word'>to</span> <span class='word'>plain</span> <span class='word'>loads</span><span class='ignore'>,</span> <span class='word'>if</span> <span class='word'>an</span> <span class='word'>exception</span> <span class='word'>is</span> <span class='word'>encountered</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>is</span> <span class='word'>allowed</span> <span class='word'>to</span> <span class='word'>update</span> <span class='word'>segments</span> <span class='word'>past</span> <span class='word'>the</span> <span class='word'>offender</span> <span class='ignore'>(</span><span class='word'>but</span> <span class='word'>not</span> <span class='word'>past</span> <span class='word'>the</span> <span class='word'>original</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [155]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>synchronous</span> <span class='word'>exception</span> <span class='word'>or</span> <span class='word'>asynchronous</span> <span class='word'>interrupt</span> <span class='word'>occurs</span><span class='ignore'>,</span> <span class='word'>regardless</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>segment</span> <span class='word'>index</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>implementation-defined</span> <span class='word'>how</span> <span class='word'>much</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>faulting</span> <span class='word'>segment's</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>performed</span><span class='ignore'>.</span><span class='cumsum'> [180]</span><br>
<span class='cumsum'> [180]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [180]</span><br>
<span class='comment'>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class='cumsum'> [180]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Indexed</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>indexedmem</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[h]</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='ignore'>{</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lcccc</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Mnmemonic</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='ignore'>&amp;</span> <span class='ignore'>Indices</span> <span class='ignore'>&amp;</span> <span class='ignore'>Masked</span> <span class='exclcmd'>\\</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span> <span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vl</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>u</span><span class='ignore'>|</span><span class='ignore'>o</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>xseg</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>e</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vs2</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [2]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [2]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Instruction</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\vspace</span><span class='ignore'>{</span><span class='ignore'>1em</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; <span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='option'>[b]</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Masked</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vm</span> <span class='ignore'>=</span><span class='ignore'>=</span> <span class='ignore'>0</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Element</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vtype.SEW</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Element</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vtype.LMUL</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Ordered</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>u</span><span class='ignore'>|</span><span class='ignore'>o</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Index</span> <span class='ignore'>Vector</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vs2</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Index</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Index</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>VLEN</span> <span class='ignore'>*</span> <span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='ignore'>/</span> <span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>NFIELDS</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nf</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vl</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Parameters</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>index</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='exclcmd'>\hfill</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.45</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\includegraphics</span><span class='option'>[width=\textwidth]</span><span class='ignore'>{</span><span class='ignore'>Figures</span><span class='ignore'>/</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>index</span><span class='ignore'>_</span><span class='ignore'>3seg.pdf</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Example</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>segmented</span> <span class='oword'>indexed</span> <span class='oword'>access</span><span class='cmd'>\\</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>EEW</span><span class='ignore'>=</span><span class='oword'>8-bits</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>nf</span><span class='ignore'>=</span><span class='oword'>3</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [14]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>index</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='cumsum'> [14]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [14]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Segmented</span> <span class='oword'>Indexed</span> <span class='oword'>Access</span> <span class='oword'>Information</span><span class='ignore'>}</span><span class='cumsum'> [18]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [18]</span><br>
<span class='cumsum'> [18]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>moves</span> <span class='word'>elements</span> <span class='word'>of</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nf</span><span class='ignore'>}</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>groups</span> <span class='word'>to</span><span class='ignore'>/</span><span class='word'>from</span> <span class='word'>contiguous</span> <span class='word'>segments</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>,</span><span class='cumsum'> [33]</span><br>
<span class='word'>where</span> <span class='word'>each</span> <span class='word'>segment</span> <span class='word'>is</span> <span class='word'>offset</span> <span class='word'>by</span> <span class='word'>an</span> <span class='word'>index</span> <span class='ignore'>(</span><span class='word'>in</span> <span class='word'>bytes</span><span class='ignore'>)</span> <span class='word'>taken</span> <span class='word'>from</span> <span class='word'>another</span> <span class='word'>vector</span><span class='ignore'>.</span><span class='cumsum'> [47]</span><br>
<span class='cumsum'> [47]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [47]</span><br>
<span class='cmd'>\item</span> <span class='word'>The</span> <span class='word'>start</span> <span class='word'>of</span> <span class='word'>each</span> <span class='word'>segment</span> <span class='word'>is</span> <span class='word'>defined</span> <span class='word'>by</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>address</span> <span class='ignore'>+</span> <span class='word'>index</span><span class='cmd'>\_</span><span class='word'>vector</span><span class='ignore'>[</span><span class='word'>i</span><span class='ignore'>]</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [59]</span><br>
<span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>do</span> <span class='word'>anything</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span> <span class='ignore'>&gt;</span><span class='ignore'>=</span> <span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='cmd'>\item</span> <span class='word'>Indexed</span> <span class='word'>segment</span> <span class='word'>loads</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>overwrite</span> <span class='word'>the</span> <span class='word'>index</span> <span class='word'>vector</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>allows</span> <span class='oword'>restarting</span> <span class='oword'>after</span> <span class='oword'>raising</span> <span class='oword'>an</span> <span class='oword'>exception</span> <span class='oword'>partway</span> <span class='oword'>through</span> <span class='oword'>a</span> <span class='oword'>structure</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [87]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [87]</span><br>
<span class='cumsum'> [87]</span><br>
<span class='comment'>% ORDERING</span><span class='cumsum'> [87]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Ordering</span><span class='ignore'>}</span><span class='cumsum'> [88]</span><br>
<span class='word'>Accesses</span> <span class='word'>within</span> <span class='word'>each</span> <span class='word'>segment</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>ordered</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>each</span> <span class='word'>other</span><span class='ignore'>.</span><span class='cumsum'> [99]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>ordered</span> <span class='word'>variant</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>instruction</span> <span class='word'>is</span> <span class='word'>used</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>the</span> <span class='word'>segments</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>accessed</span> <span class='word'>in</span> <span class='word'>order</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>17</span><span class='ignore'>,</span> <span class='word'>53</span><span class='ignore'>,</span> <span class='word'>8</span><span class='ignore'>,</span> <span class='word'>44</span> <span class='word'>for</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>index</span><span class='ignore'>_</span><span class='ignore'>3seg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [122]</span><br>
<span class='word'>Otherwise</span><span class='ignore'>,</span> <span class='word'>segment</span> <span class='word'>ordering</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>guaranteed</span><span class='ignore'>.</span><span class='cumsum'> [128]</span><br>
<span class='cumsum'> [128]</span><br>
<span class='cumsum'> [128]</span><br>
<span class='comment'>% EXCEPTION HANDLING</span><span class='cumsum'> [128]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Exception</span> <span class='hword'>Handling</span><span class='ignore'>}</span><span class='cumsum'> [130]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>element</span> <span class='word'>within</span> <span class='word'>segment</span> <span class='mathgroup'>$</span><span class='math'>i</span><span class='mathgroup'>$</span> <span class='word'>triggers</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span><span class='ignore'>,</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>set</span> <span class='word'>to</span> <span class='mathgroup'>$</span><span class='math'>i</span><span class='mathgroup'>$</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>or</span> <span class='word'>imprecise</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>triggered</span><span class='ignore'>.</span><span class='cumsum'> [153]</span><br>
<span class='word'>Load</span> <span class='word'>instructions</span> <span class='word'>may</span> <span class='word'>overwrite</span> <span class='word'>active</span> <span class='word'>segments</span> <span class='word'>past</span> <span class='word'>the</span> <span class='word'>segment</span> <span class='word'>index</span> <span class='word'>at</span> <span class='word'>which</span> <span class='word'>the</span> <span class='word'>trap</span> <span class='word'>is</span> <span class='word'>reported</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>not</span> <span class='word'>past</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>7.7</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [175]</span><br>
<span class='word'>Upon</span> <span class='word'>entering</span> <span class='word'>a</span> <span class='word'>trap</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>implementation-defined</span> <span class='word'>how</span> <span class='word'>much</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>faulting</span> <span class='word'>segment's</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>performed</span><span class='ignore'>.</span><span class='cumsum'> [191]</span><br>
<span class='cumsum'> [191]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [191]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Unit</span> <span class='hword'>whole-register</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='cumsum'> [3]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[h]</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
<span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lcc</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Mnemonic</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vl</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nreg</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>re</span><span class='exclcmd'>\param</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Instruction</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='exclcmd'>\hfill</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [4]</span><br>
<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='exclcmd'>\toprule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Masked</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='ignore'>False</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Registers</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>nreg</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>&lt;</span><span class='ignore'>eew</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>NFIELDS</span> <span class='ignore'>*</span> <span class='ignore'>VLEN</span> <span class='ignore'>/</span> <span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>1</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [4]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [4]</span><br>
<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Parameters</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Unit</span> <span class='oword'>Whole</span> <span class='oword'>Register</span> <span class='oword'>Information</span><span class='ignore'>}</span><span class='cumsum'> [9]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>wholereg</span><span class='ignore'>}</span><span class='cumsum'> [9]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [9]</span><br>
<span class='cumsum'> [9]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>moves</span> <span class='word'>the</span> <span class='word'>contents</span> <span class='word'>of</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nreg</span><span class='ignore'>}</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>to</span><span class='ignore'>/</span><span class='word'>from</span> <span class='word'>a</span> <span class='word'>contiguous</span> <span class='word'>range</span> <span class='word'>in</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [25]</span><br>
<span class='word'>Equivalent</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>unit-stride</span> <span class='word'>access</span> <span class='word'>where</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span><span class='ignore'>}</span> <span class='word'>equals</span> <span class='word'>the</span> <span class='word'>total</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>elements</span> <span class='word'>in</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nreg</span><span class='ignore'>}</span> <span class='word'>registers</span><span class='ignore'>.</span><span class='cumsum'> [41]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [41]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>nreg</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>a</span> <span class='word'>power</span> <span class='word'>of</span> <span class='word'>two</span><span class='ignore'>.</span><span class='cumsum'> [48]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>support</span> <span class='word'>segmented</span> <span class='word'>access</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>do</span> <span class='word'>anything</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span> <span class='ignore'>&gt;</span><span class='ignore'>=</span> <span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [62]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [62]</span><br>
<span class='cumsum'> [62]</span><br>
<span class='word'>Ordering</span> <span class='word'>and</span> <span class='word'>exception</span> <span class='word'>handling</span> <span class='word'>are</span> <span class='word'>identical</span> <span class='word'>to</span> <span class='word'>unit-stride</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>unitstrideaccess</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [71]</span><br>
<span class='cumsum'> [71]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Unit</span> <span class='hword'>bytemask</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[h]</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lcc</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Mnemonic</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vlm.v</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>,</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\large</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>(</span><span class='ignore'>rs1</span><span class='ignore'>)</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [3]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [3]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Instruction</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='exclcmd'>\hfill</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [4]</span><br>
<span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Masked</span><span class='ignore'>?</span> <span class='ignore'>&amp;</span> <span class='ignore'>False</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EEW</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>8-bits</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EVL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>ceil</span><span class='ignore'>(</span><span class='ignore'>vl</span><span class='ignore'>/</span><span class='ignore'>8</span><span class='ignore'>)</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>EMUL</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>1</span> <span class='exclcmd'>\\</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [4]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [4]</span><br>
<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Parameters</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='cumsum'> [5]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Unit</span> <span class='oword'>Bytemask</span> <span class='oword'>Information</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>RVV</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>bytemask</span><span class='ignore'>}</span><span class='cumsum'> [8]</span><br>
&nbsp; &nbsp; <span class='comment'>% \end{subtable}\hfill</span><span class='cumsum'> [8]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [8]</span><br>
<span class='cumsum'> [8]</span><br>
<span class='word'>This</span> <span class='word'>archetype</span> <span class='word'>moves</span> <span class='word'>the</span> <span class='word'>contents</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>mask</span> <span class='word'>register</span> <span class='word'>to</span><span class='ignore'>/</span><span class='word'>from</span> <span class='word'>a</span> <span class='word'>contiguous</span> <span class='word'>range</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>It</span> <span class='word'>transfers</span> <span class='word'>at</span> <span class='word'>least</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>bit</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>element</span> <span class='word'>that</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>in</span> <span class='word'>subsequent</span> <span class='word'>vector</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [43]</span><br>
<span class='word'>This</span> <span class='word'>will</span> <span class='word'>always</span> <span class='word'>fit</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>rvvmasking</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>hence</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EMUL</span> <span class='ignore'>=</span> <span class='word'>1</span><span class='ignore'>}</span> <span class='word'>in</span> <span class='word'>all</span> <span class='word'>cases</span><span class='ignore'>.</span><span class='cumsum'> [59]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [59]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>operate</span> <span class='word'>as</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>tail-agnostic</span> <span class='word'>setting</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>true</span><span class='ignore'>.</span><span class='cumsum'> [71]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>support</span> <span class='word'>segmented</span> <span class='word'>access</span><span class='ignore'>.</span><span class='cumsum'> [77]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>don't</span> <span class='word'>do</span> <span class='word'>anything</span> <span class='word'>if</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span> <span class='ignore'>&gt;</span><span class='ignore'>=</span> <span class='word'>EVL</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [85]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [85]</span><br>
<span class='word'>Ordering</span> <span class='word'>and</span> <span class='word'>exception</span> <span class='word'>handling</span> <span class='word'>are</span> <span class='word'>identical</span> <span class='word'>to</span> <span class='word'>unit-stride</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>:</span><span class='ignore'>unitstrideaccess</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [94]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub35_rvv_memory.tex</span><span class='cumsum'> [94]</span><br>
<span class='cumsum'> [94]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [94]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_20Background/sub50_cheri}</span><span class='cumsum'> [94]</span><br>
<span class='cumsum'> [94]</span><br>
<span class='comment'>% --- Start of included file ./1_20Background/sub50_cheri.tex</span><span class='cumsum'> [94]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>CHERI</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>cheri</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='comment'>% Concept of a capability</span><span class='cumsum'> [1]</span><br>
<span class='word'>In</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>addresses</span><span class='ignore'>/</span><span class='word'>pointers</span> <span class='word'>are</span> <span class='word'>replaced</span> <span class='word'>with</span> <span class='word'>capabilities</span><span class='ignore'>:</span> <span class='word'>unforgeable</span> <span class='word'>tokens</span> <span class='word'>that</span> <span class='word'>provide</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>specific</span> <span class='word'>kinds</span> <span class='word'>of</span> <span class='word'>access</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>an</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>address</span><span class='ignore'>}</span> <span class='word'>within</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>range</span> <span class='word'>of</span> <span class='word'>memory</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [25]</span><br>
<span class='word'>The</span> <span class='word'>above</span> <span class='word'>statement</span> <span class='word'>is</span> <span class='word'>enough</span> <span class='word'>to</span> <span class='word'>understand</span> <span class='word'>what</span> <span class='word'>capabilities</span> <span class='word'>contain</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>is</span> <span class='oword'>a</span> <span class='oword'>slight</span> <span class='oword'>simplification</span><span class='ignore'>.</span> <span class='oword'>For</span> <span class='oword'>the</span> <span class='oword'>purposes</span> <span class='oword'>of</span> <span class='oword'>vector</span> <span class='oword'>memory</span> <span class='oword'>accesses</span> <span class='oword'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='oword'>otype</span><span class='ignore'>}</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>capability</span> <span class='oword'>can</span> <span class='oword'>be</span> <span class='oword'>ignored</span><span class='ignore'>,</span> <span class='oword'>as</span> <span class='oword'>any</span> <span class='oword'>type</span> <span class='oword'>other</span> <span class='oword'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>UNSEALED</span><span class='ignore'>}</span> <span class='oword'>cannot</span> <span class='oword'>be</span> <span class='oword'>dereferenced</span> <span class='oword'>anyway</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>:</span><span class='cumsum'> [65]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [65]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Permission</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>to</span> <span class='word'>restrict</span> <span class='word'>access</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>The</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>cursor</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>address</span> <span class='word'>it</span> <span class='word'>currently</span> <span class='word'>points</span> <span class='word'>to</span><span class='cumsum'> [79]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>The</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>bounds</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>range</span> <span class='word'>of</span> <span class='word'>addresses</span> <span class='word'>this</span> <span class='word'>capability</span> <span class='word'>could</span> <span class='word'>point</span> <span class='word'>to</span><span class='cumsum'> [91]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [91]</span><br>
<span class='word'>A</span> <span class='word'>great</span> <span class='word'>deal</span> <span class='word'>of</span> <span class='word'>work</span> <span class='word'>has</span> <span class='word'>gone</span> <span class='word'>into</span> <span class='word'>compressing</span> <span class='word'>capabilities</span> <span class='word'>down</span> <span class='word'>into</span> <span class='word'>a</span> <span class='word'>reasonable</span> <span class='word'>size</span> <span class='ignore'>(</span><span class='word'>see</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>woodruffCHERIConcentratePractical2019</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>cheri</span><span class='ignore'>:</span><span class='ignore'>compressedcap</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>using</span> <span class='word'>the</span> <span class='word'>magic</span> <span class='word'>of</span> <span class='word'>floating-point</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>data</span> <span class='word'>has</span> <span class='word'>been</span> <span class='word'>reduced</span> <span class='word'>to</span> <span class='word'>just</span> <span class='word'>2x</span> <span class='word'>the</span> <span class='word'>architectural</span> <span class='word'>register</span> <span class='word'>size</span><span class='ignore'>.</span><span class='cumsum'> [127]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>on</span> <span class='word'>64-bit</span> <span class='word'>RISC-V</span> <span class='word'>a</span> <span class='word'>standard</span> <span class='word'>capability</span> <span class='word'>is</span> <span class='word'>128-bits</span> <span class='word'>long</span><span class='ignore'>.</span><span class='cumsum'> [138]</span><br>
<span class='word'>The</span> <span class='word'>rest</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>dissertation</span> <span class='word'>assumes</span> <span class='word'>capabilities</span> <span class='word'>are</span> <span class='word'>128-bits</span> <span class='word'>long</span> <span class='word'>for</span> <span class='word'>simplicity</span><span class='ignore'>.</span><span class='cumsum'> [150]</span><br>
<span class='cumsum'> [150]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[b]</span><span class='cumsum'> [150]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [150]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\includegraphics</span><span class='option'>[width=0.8\textwidth]</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>figures</span><span class='ignore'>/</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>compressed</span><span class='ignore'>_</span><span class='ignore'>cap.png</span><span class='ignore'>}</span><span class='cumsum'> [150]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>128-bit</span> <span class='oword'>compressed</span> <span class='oword'>capability</span> <span class='oword'>representation</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='oword'>from</span> <span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-941</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>cheri</span><span class='ignore'>:</span><span class='ignore'>compressedcap</span><span class='ignore'>}</span><span class='cumsum'> [155]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [155]</span><br>
<span class='cumsum'> [155]</span><br>
<span class='word'>A</span> <span class='word'>CHERI</span> <span class='word'>implementation</span> <span class='word'>has</span> <span class='word'>to</span> <span class='word'>enforce</span> <span class='word'>three</span> <span class='word'>security</span> <span class='word'>properties</span> <span class='word'>about</span> <span class='word'>its</span> <span class='word'>capabilities</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>1.2.1</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>:</span><span class='cumsum'> [169]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [169]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Provenance</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>Capabilities</span> <span class='word'>must</span> <span class='word'>always</span> <span class='word'>be</span> <span class='word'>derived</span> <span class='word'>from</span> <span class='word'>valid</span> <span class='word'>manipulations</span> <span class='word'>of</span> <span class='word'>other</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [181]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Integrity</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>Corrupted</span> <span class='word'>capabilities</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>dereferenced</span><span class='ignore'>.</span><span class='cumsum'> [187]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Monotonicity</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>Capabilities</span> <span class='word'>cannot</span> <span class='word'>increase</span> <span class='word'>their</span> <span class='word'>rights</span><span class='ignore'>.</span><span class='cumsum'> [193]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [193]</span><br>
<span class='cumsum'> [193]</span><br>
<span class='word'>Integrity</span> <span class='word'>is</span> <span class='word'>enforced</span> <span class='word'>by</span> <span class='word'>tagging</span> <span class='word'>registers</span> <span class='word'>and</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [201]</span><br>
<span class='word'>Every</span> <span class='word'>128-bit</span> <span class='word'>register</span> <span class='word'>and</span> <span class='word'>aligned</span> <span class='word'>128-bit</span> <span class='word'>region</span> <span class='word'>of</span> <span class='word'>memory</span> <span class='word'>has</span> <span class='word'>an</span> <span class='word'>associated</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>denotes</span> <span class='word'>if</span> <span class='word'>its</span> <span class='word'>data</span> <span class='word'>encodes</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>capability</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>has</span> <span class='oword'>the</span> <span class='oword'>side-effect</span> <span class='oword'>that</span> <span class='oword'>capabilities</span> <span class='oword'>must</span> <span class='oword'>be</span> <span class='oword'>128-bit</span> <span class='oword'>aligned</span> <span class='oword'>in</span> <span class='oword'>memory</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [236]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>non-capability</span> <span class='word'>data</span> <span class='word'>is</span> <span class='word'>written</span> <span class='word'>to</span> <span class='word'>any</span> <span class='word'>part</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>region</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>is</span> <span class='word'>zeroed</span> <span class='word'>out</span><span class='ignore'>.</span><span class='cumsum'> [254]</span><br>
<span class='word'>Instructions</span> <span class='word'>that</span> <span class='word'>perform</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>can</span> <span class='word'>only</span> <span class='word'>do</span> <span class='word'>so</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>provided</span> <span class='word'>capability</span> <span class='word'>has</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>.</span><span class='cumsum'> [272]</span><br>
<span class='word'>As</span> <span class='word'>above</span><span class='ignore'>,</span> <span class='word'>significant</span> <span class='word'>work</span> <span class='word'>has</span> <span class='word'>gone</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>implementation</span> <span class='word'>to</span> <span class='word'>reduce</span> <span class='word'>the</span> <span class='word'>DRAM</span> <span class='word'>overhead</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>method</span> <span class='ignore'>(</span><span class='word'>see</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>joannouEfficientTaggedMemory2017</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [290]</span><br>
<span class='cumsum'> [290]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [290]</span><br>
<span class='word'>Provenance</span> <span class='word'>and</span> <span class='word'>Monotonicity</span> <span class='word'>are</span> <span class='word'>enforced</span> <span class='word'>by</span> <span class='word'>all</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>manipulate</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [301]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>detects</span> <span class='word'>a</span> <span class='word'>violation</span> <span class='word'>of</span> <span class='word'>either</span> <span class='word'>property</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>will</span> <span class='word'>zero</span> <span class='word'>out</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>and</span> <span class='word'>rely</span> <span class='word'>on</span> <span class='word'>Integrity</span> <span class='word'>enforcement</span> <span class='word'>to</span> <span class='word'>ensure</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>dereferenced</span><span class='ignore'>.</span><span class='cumsum'> [328]</span><br>
<span class='word'>Some</span> <span class='word'>CHERI-enabled</span> <span class='word'>architectures</span><span class='ignore'>,</span> <span class='word'>such</span> <span class='word'>as</span> <span class='word'>CHERI-RISC-V</span><span class='ignore'>,</span> <span class='word'>also</span> <span class='word'>raise</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span> <span class='word'>when</span> <span class='word'>this</span> <span class='word'>occurs</span><span class='ignore'>.</span><span class='cumsum'> [342]</span><br>
<span class='cumsum'> [342]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>CHERI-RISC-V</span> <span class='hword'>ISA</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>The</span> <span class='word'>Cambridge</span> <span class='word'>Computer</span> <span class='word'>Lab's</span> <span class='word'>TR-951</span> <span class='word'>report</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span> <span class='word'>describes</span> <span class='word'>the</span> <span class='word'>latest</span> <span class='word'>version</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>CHERI</span> <span class='word'>architecture</span> <span class='ignore'>(</span><span class='word'>CHERI</span> <span class='word'>ISAv8</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>proposes</span> <span class='word'>applications</span> <span class='word'>to</span> <span class='word'>MIPS</span><span class='ignore'>,</span> <span class='word'>x86-64</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>RISC-V</span><span class='ignore'>.</span><span class='cumsum'> [26]</span><br>
<span class='word'>CHERI-RISC-V</span> <span class='word'>is</span> <span class='word'>a</span> <span class='word'>mostly</span> <span class='word'>straightforward</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>additions</span> <span class='word'>to</span> <span class='word'>basic</span> <span class='word'>RISC-V</span> <span class='word'>ISAs</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='word'>It</span> <span class='word'>adds</span> <span class='word'>thirty-two</span> <span class='word'>general-purpose</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>thirty-two</span> <span class='word'>Special</span> <span class='word'>Capability</span> <span class='word'>Registers</span> <span class='ignore'>(</span><span class='word'>SCRs</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>many</span> <span class='word'>new</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [53]</span><br>
<span class='cumsum'> [53]</span><br>
<span class='word'>The</span> <span class='word'>new</span> <span class='word'>general-purpose</span> <span class='word'>capability</span> <span class='word'>registers</span> <span class='word'>are</span> <span class='word'>each</span> <span class='word'>of</span> <span class='word'>size</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span> <span class='ignore'>=</span> <span class='word'>2</span> <span class='ignore'>*</span> <span class='word'>XLEN</span><span class='ignore'>}</span> <span class='word'>plus</span> <span class='word'>a</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>.</span><span class='cumsum'> [69]</span><br>
<span class='word'>These</span> <span class='word'>registers</span> <span class='word'>store</span> <span class='word'>compressed</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [74]</span><br>
<span class='word'>While</span> <span class='word'>there</span> <span class='word'>is</span> <span class='word'>always</span> <span class='word'>a</span> <span class='word'>logical</span> <span class='word'>distinction</span> <span class='word'>between</span> <span class='word'>the</span> <span class='word'>pre-existing</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>integer</span><span class='ignore'>}</span> <span class='word'>registers</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>x0-x31</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>capability</span><span class='ignore'>}</span> <span class='word'>registers</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cx0-cx31</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>architecture</span> <span class='word'>may</span> <span class='word'>store</span> <span class='word'>them</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>Split</span> <span class='word'>or</span> <span class='word'>Merged</span> <span class='word'>register</span> <span class='word'>file</span><span class='ignore'>.</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cherimergedreg</span><span class='ignore'>}</span><span class='cumsum'> [104]</span><br>
<span class='word'>A</span> <span class='word'>Split</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>stores</span> <span class='word'>the</span> <span class='word'>integer</span> <span class='word'>registers</span> <span class='word'>separately</span> <span class='word'>from</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>programs</span> <span class='word'>can</span> <span class='word'>manipulate</span> <span class='word'>them</span> <span class='word'>independently</span><span class='ignore'>.</span><span class='cumsum'> [122]</span><br>
<span class='word'>A</span> <span class='word'>Merged</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>stores</span> <span class='word'>thirty-two</span> <span class='word'>registers</span> <span class='word'>of</span> <span class='word'>length</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>using</span> <span class='word'>the</span> <span class='word'>full</span> <span class='word'>width</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>aliases</span> <span class='word'>the</span> <span class='word'>integer</span> <span class='word'>registers</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>bottom</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>XLEN</span><span class='ignore'>}</span> <span class='word'>bits</span><span class='ignore'>.</span><span class='cumsum'> [150]</span><br>
<span class='word'>Under</span> <span class='word'>a</span> <span class='word'>merged</span> <span class='word'>register</span> <span class='word'>file</span><span class='ignore'>,</span> <span class='word'>writing</span> <span class='word'>to</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>register</span> <span class='word'>makes</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>counterpart</span> <span class='word'>invalid</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>programs</span> <span class='word'>have</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>more</span> <span class='word'>careful</span> <span class='word'>with</span> <span class='word'>register</span> <span class='word'>usage</span><span class='ignore'>.</span><span class='cumsum'> [175]</span><br>
<span class='comment'>% \todomark{diagram for split/merged register file?}</span><span class='cumsum'> [175]</span><br>
<span class='cumsum'> [175]</span><br>
<span class='word'>Many</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>SCRs</span> <span class='word'>are</span> <span class='word'>intended</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>the</span> <span class='word'>privileged</span> <span class='word'>ISA</span> <span class='word'>extensions</span> <span class='word'>for</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>hypervisors</span> <span class='word'>or</span> <span class='word'>operating</span> <span class='word'>systems</span><span class='ignore'>.</span><span class='cumsum'> [194]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>doesn't</span> <span class='word'>use</span> <span class='word'>these</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>their</span> <span class='word'>SCRs</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>listed</span> <span class='word'>here</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>there</span> <span class='word'>are</span> <span class='word'>two</span> <span class='word'>highly</span> <span class='word'>relevant</span> <span class='word'>SCRs</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>modes</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>Program</span> <span class='word'>Counter</span> <span class='word'>Capability</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>Default</span> <span class='word'>Data</span> <span class='word'>Capability</span><span class='ignore'>.</span><span class='cumsum'> [225]</span><br>
<span class='cumsum'> [225]</span><br>
<span class='word'>The</span> <span class='word'>PCC</span> <span class='word'>replaces</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>counter</span> <span class='word'>and</span> <span class='word'>adds</span> <span class='word'>more</span> <span class='word'>metadata</span><span class='ignore'>,</span> <span class='word'>ensuring</span> <span class='word'>instruction</span> <span class='word'>fetches</span> <span class='word'>have</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>security</span> <span class='word'>properties</span> <span class='word'>as</span> <span class='word'>normal</span> <span class='word'>loads</span> <span class='word'>and</span> <span class='word'>stores</span><span class='ignore'>.</span><span class='cumsum'> [248]</span><br>
<span class='word'>The</span> <span class='word'>DDC</span> <span class='word'>is</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>sandbox</span> <span class='word'>integer</span> <span class='word'>addressing</span> <span class='word'>modes</span><span class='ignore'>.</span><span class='cumsum'> [257]</span><br>
<span class='word'>CHERI-RISC-V</span> <span class='word'>includes</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>which</span> <span class='word'>use</span> <span class='word'>integer</span> <span class='word'>addressing</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>allows</span> <span class='word'>legacy</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>integer</span> <span class='word'>addressed</span><span class='ignore'>)</span> <span class='word'>code</span> <span class='word'>to</span> <span class='word'>function</span> <span class='word'>on</span> <span class='word'>CHERI</span> <span class='word'>systems</span> <span class='word'>without</span> <span class='word'>recompiling</span> <span class='word'>for</span> <span class='word'>CHERI-RISC-V</span><span class='ignore'>.</span><span class='cumsum'> [281]</span><br>
<span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>all</span> <span class='word'>use</span> <span class='word'>integer</span> <span class='word'>addresses</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>DDC</span> <span class='word'>controls</span> <span class='word'>the</span> <span class='word'>permissions</span> <span class='word'>those</span> <span class='word'>instructions</span> <span class='word'>have</span><span class='ignore'>.</span><span class='cumsum'> [300]</span><br>
<span class='cumsum'> [300]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Instruction</span> <span class='hword'>changes</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>instructions</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>TR-951</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Chapter</span> <span class='word'>8</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span> <span class='word'>specifies</span> <span class='word'>a</span> <span class='word'>suite</span> <span class='word'>of</span> <span class='word'>new</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>well</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>modifications</span> <span class='word'>to</span> <span class='word'>pre-existing</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [21]</span><br>
<span class='word'>Many</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>unrelated</span> <span class='word'>to</span> <span class='word'>pre-existing</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>implement</span> <span class='word'>capability-specific</span> <span class='word'>operations</span> <span class='word'>like</span> <span class='word'>accessing</span> <span class='word'>fields</span> <span class='word'>of</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>.</span><span class='cumsum'> [41]</span><br>
<span class='word'>The</span> <span class='word'>most</span> <span class='word'>relevant</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>for</span> <span class='word'>our</span> <span class='word'>case</span> <span class='word'>are</span> <span class='word'>the</span> <span class='word'>various</span> <span class='word'>loads</span><span class='ignore'>/</span><span class='word'>stores</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='cumsum'> [54]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [54]</span><br>
<span class='word'>CHERI-RISC-V</span> <span class='word'>adds</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>for</span> <span class='word'>loading</span> <span class='word'>integer</span> <span class='word'>and</span> <span class='word'>capability</span> <span class='word'>data</span><span class='ignore'>,</span> <span class='word'>either</span> <span class='word'>via</span> <span class='word'>capabilities</span> <span class='word'>or</span> <span class='word'>using</span> <span class='word'>integer</span> <span class='word'>addressing</span> <span class='word'>through</span> <span class='word'>the</span> <span class='word'>DDC</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>new</span><span class='ignore'>_</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>instrs</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [74]</span><br>
<span class='word'>These</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>intended</span> <span class='word'>for</span> <span class='word'>hybrid-capability</span> <span class='word'>code</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>purecap</span><span class='ignore'>_</span><span class='ignore'>hybrid</span><span class='ignore'>}</span><span class='ignore'>,</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>p151</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>are</span> <span class='word'>more</span> <span class='word'>limited</span> <span class='word'>and</span> <span class='word'>don't</span> <span class='word'>support</span> <span class='word'>immediate</span> <span class='word'>offsets</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='word'>The</span> <span class='word'>behaviour</span> <span class='word'>of</span> <span class='word'>basic</span> <span class='word'>RISC-V</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>opcodes</span> <span class='word'>changes</span> <span class='word'>to</span> <span class='word'>either</span> <span class='word'>use</span> <span class='word'>capabilities</span> <span class='word'>as</span> <span class='word'>memory</span> <span class='word'>references</span> <span class='word'>or</span> <span class='word'>use</span> <span class='word'>integer</span> <span class='word'>addressing</span> <span class='word'>via</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>,</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>encoding</span> <span class='word'>mode</span><span class='ignore'>.</span><span class='cumsum'> [120]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>instruction</span> <span class='word'>tries</span> <span class='word'>to</span> <span class='word'>dereference</span> <span class='word'>an</span> <span class='word'>invalid</span> <span class='word'>capability</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>raises</span> <span class='word'>a</span> <span class='word'>synchronous</span> <span class='word'>exception</span><span class='ignore'>.</span><span class='cumsum'> [134]</span><br>
<span class='cumsum'> [134]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[t]</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [134]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lccl</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Name</span> <span class='ignore'>&amp;</span> <span class='ignore'>Direction</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>type</span> <span class='ignore'>&amp;</span> <span class='ignore'>Address</span> <span class='ignore'>calculation</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>L</span><span class='ignore'>[</span><span class='ignore'>BHWD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='ignore'>U</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='ignore'>CAP</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span> <span class='ignore'>register</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>L</span><span class='ignore'>[</span><span class='ignore'>BHWD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='ignore'>U</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='ignore'>DDC</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>LC.CAP</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span> <span class='ignore'>register</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>LC.DDC</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>DDC</span> <span class='exclcmd'>\\</span> <span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>S</span><span class='ignore'>[</span><span class='ignore'>BHWD</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='ignore'>CAP</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span> <span class='ignore'>register</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>S</span><span class='ignore'>[</span><span class='ignore'>BHWD</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='ignore'>DDC</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>SC.CAP</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span> <span class='ignore'>register</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>SC.DDC</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>DDC</span> <span class='exclcmd'>\\</span> <span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [134]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='ignore'>New</span> <span class='ignore'>CHERI</span> <span class='ignore'>load</span><span class='ignore'>/</span><span class='ignore'>store</span> <span class='ignore'>instructions</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>new</span><span class='ignore'>_</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>instrs</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [134]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[t]</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [134]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lccc</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Name</span> <span class='ignore'>&amp;</span> <span class='ignore'>Direction</span> <span class='ignore'>&amp;</span> <span class='ignore'>Data</span> <span class='ignore'>type</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>1</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>Address</span> <span class='ignore'>calculation</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>&amp;</span><span class='ignore'>&amp;</span><span class='ignore'>&amp;</span> <span class='ignore'>(</span><span class='ignore'>Capability</span><span class='ignore'>/</span><span class='ignore'>Integer</span> <span class='ignore'>mode</span><span class='ignore'>)</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='ignore'>[</span><span class='ignore'>C</span><span class='ignore'>]</span><span class='ignore'>}</span><span class='ignore'>LC</span><span class='exclcmd'>\parnote</span><span class='ignore'>{</span><span class='ignore'>Replaces</span> <span class='ignore'>RV128</span> <span class='ignore'>LQ</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>{</span><span class='ignore'>[</span><span class='ignore'>C</span><span class='ignore'>]</span><span class='ignore'>}</span><span class='ignore'>SC</span><span class='exclcmd'>\parnote</span><span class='ignore'>{</span><span class='ignore'>Replaces</span> <span class='ignore'>RV128</span> <span class='ignore'>SQ</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Capability</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>L</span><span class='ignore'>[</span><span class='ignore'>BWHD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='ignore'>U</span><span class='ignore'>]</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>S</span><span class='ignore'>[</span><span class='ignore'>BWHD</span><span class='ignore'>]</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>FL</span><span class='ignore'>[</span><span class='ignore'>WDQ</span><span class='ignore'>]</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Float</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>FS</span><span class='ignore'>[</span><span class='ignore'>WDQ</span><span class='ignore'>]</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Float</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>LR</span> <span class='ignore'>&amp;</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>SC</span> <span class='ignore'>&amp;</span> <span class='ignore'>Store</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>AMO</span><span class='exclcmd'>\parnote</span><span class='ignore'>{</span><span class='ignore'>All</span> <span class='ignore'>atomic</span> <span class='ignore'>memory</span> <span class='ignore'>operations</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='ignore'>&amp;</span> <span class='ignore'>Integer</span> <span class='ignore'>&amp;</span> <span class='ignore'>via</span> <span class='ignore'>capability</span><span class='ignore'>/</span><span class='ignore'>DDC</span> <span class='exclcmd'>\\</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [134]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\parnotes</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='ignore'>Preexisting</span> <span class='ignore'>RISC-V</span> <span class='ignore'>load</span><span class='ignore'>/</span><span class='ignore'>store</span> <span class='ignore'>instructions</span> <span class='ignore'>modified</span> <span class='ignore'>by</span> <span class='ignore'>CHERI-RISC-V</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>legacy</span><span class='ignore'>_</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>instrs</span><span class='ignore'>}</span><span class='cumsum'> [134]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [134]</span><br>
<span class='cumsum'> [134]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Capability</span> <span class='hword'>and</span> <span class='hword'>Integer</span> <span class='hword'>encoding</span> <span class='hword'>mode</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cheriencodingmode</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='word'>CHERI-RISC-V</span> <span class='word'>specifies</span> <span class='word'>two</span> <span class='word'>encoding</span> <span class='word'>modes</span><span class='ignore'>,</span> <span class='word'>selected</span> <span class='word'>using</span> <span class='word'>a</span> <span class='word'>flag</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>PCC</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>flags</span><span class='ignore'>}</span> <span class='word'>field</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Capability</span> <span class='word'>mode</span><span class='ignore'>}</span> <span class='word'>modifies</span> <span class='word'>the</span> <span class='word'>behaviour</span> <span class='word'>of</span> <span class='word'>pre-existing</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='word'>take</span> <span class='word'>address</span> <span class='word'>operands</span> <span class='word'>as</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [33]</span><br>
<span class='word'>This</span> <span class='word'>makes</span> <span class='word'>the</span> <span class='word'>basic</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>instruction</span> <span class='word'>behaviour</span> <span class='word'>exactly</span> <span class='word'>equivalent</span> <span class='word'>to</span> <span class='word'>newly</span> <span class='word'>introduced</span> <span class='word'>counterparts</span><span class='ignore'>:</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>L</span><span class='ignore'>[</span><span class='word'>BWHD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='word'>U</span><span class='ignore'>]</span> <span class='ignore'>=</span><span class='ignore'>=</span> <span class='word'>L</span><span class='ignore'>[</span><span class='word'>BWHD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='word'>U</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='word'>CAP</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [55]</span><br>
<span class='word'>The</span> <span class='word'>DDC</span> <span class='word'>may</span> <span class='word'>still</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>in</span> <span class='word'>this</span> <span class='word'>mode</span> <span class='word'>via</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>S</span><span class='ignore'>[</span><span class='word'>BWHD</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='word'>DDC</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [72]</span><br>
<span class='cumsum'> [72]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [72]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Integer</span> <span class='word'>mode</span><span class='ignore'>}</span> <span class='word'>seeks</span> <span class='word'>to</span> <span class='word'>emulate</span> <span class='word'>a</span> <span class='word'>standard</span> <span class='word'>CHERI-less</span> <span class='word'>RISC-V</span> <span class='word'>architecture</span> <span class='word'>as</span> <span class='word'>much</span> <span class='word'>as</span> <span class='word'>possible</span><span class='ignore'>.</span><span class='cumsum'> [86]</span><br>
<span class='word'>All</span> <span class='word'>pre-existing</span> <span class='word'>RISC-V</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>take</span> <span class='word'>address</span> <span class='word'>operands</span> <span class='word'>as</span> <span class='word'>integers</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>dereferenced</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Of</span> <span class='oword'>course</span><span class='ignore'>,</span> <span class='oword'>the</span> <span class='oword'>DDC</span> <span class='oword'>must</span> <span class='oword'>be</span> <span class='oword'>valid</span> <span class='oword'>when</span> <span class='oword'>it</span> <span class='oword'>is</span> <span class='oword'>used</span> <span class='oword'>in</span> <span class='oword'>this</span> <span class='oword'>mode</span><span class='ignore'>,</span> <span class='oword'>and</span> <span class='oword'>all</span> <span class='oword'>bounds</span> <span class='oword'>checks</span> <span class='oword'>etc</span><span class='ignore'>.</span> <span class='oword'>must</span> <span class='oword'>still</span> <span class='oword'>pass</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [126]</span><br>
<span class='word'>This</span> <span class='word'>makes</span> <span class='word'>the</span> <span class='word'>basic</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>instruction</span> <span class='word'>behaviour</span> <span class='word'>exactly</span> <span class='word'>equivalent</span> <span class='word'>to</span> <span class='word'>newly</span> <span class='word'>introduced</span> <span class='word'>counterparts</span><span class='ignore'>:</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>L</span><span class='ignore'>[</span><span class='word'>BWHD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='word'>U</span><span class='ignore'>]</span> <span class='ignore'>=</span><span class='ignore'>=</span> <span class='word'>L</span><span class='ignore'>[</span><span class='word'>BWHD</span><span class='ignore'>]</span><span class='ignore'>[</span><span class='word'>U</span><span class='ignore'>]</span><span class='ignore'>.</span><span class='word'>DDC</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [148]</span><br>
<span class='word'>The</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>may</span> <span class='word'>still</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>dereference</span> <span class='word'>and</span> <span class='word'>inspect</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>all</span> <span class='word'>other</span> <span class='word'>instructions</span> <span class='word'>access</span> <span class='word'>registers</span> <span class='word'>in</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>context</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>ignoring</span> <span class='word'>the</span> <span class='word'>upper</span> <span class='word'>bits</span> <span class='word'>and</span> <span class='word'>tag</span> <span class='word'>from</span> <span class='word'>merged</span> <span class='word'>register</span> <span class='word'>files</span><span class='ignore'>.</span><span class='cumsum'> [182]</span><br>
<span class='cumsum'> [182]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Pure-capability</span> <span class='hword'>and</span> <span class='hword'>Hybrid</span> <span class='hword'>compilation</span> <span class='hword'>modes</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>purecap</span><span class='ignore'>_</span><span class='ignore'>hybrid</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='word'>CHERI-Clang</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>www.cl.cam.ac.uk</span><span class='ignore'>/</span><span class='ignore'>research</span><span class='ignore'>/</span><span class='ignore'>security</span><span class='ignore'>/</span><span class='ignore'>ctsrd</span><span class='ignore'>/</span><span class='ignore'>cheri</span><span class='ignore'>/</span><span class='ignore'>cheri-llvm.html</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>main</span> <span class='word'>CHERI-enabled</span> <span class='word'>compiler</span><span class='ignore'>,</span> <span class='word'>supports</span> <span class='word'>two</span> <span class='word'>ways</span> <span class='word'>to</span> <span class='word'>compile</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>which</span> <span class='word'>map</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>different</span> <span class='word'>encoding</span> <span class='word'>modes</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='cumsum'> [24]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Pure-capability</span><span class='ignore'>}</span> <span class='word'>mode</span> <span class='word'>treats</span> <span class='word'>all</span> <span class='word'>pointers</span> <span class='word'>as</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>emits</span> <span class='word'>pre-existing</span> <span class='word'>RISC-V</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>expect</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>run</span> <span class='word'>in</span> <span class='word'>capability</span> <span class='word'>mode</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>wasn't</span> <span class='oword'>derived</span> <span class='oword'>from</span> <span class='oword'>documentation</span><span class='ignore'>,</span> <span class='oword'>but</span> <span class='oword'>instead</span> <span class='oword'>from</span> <span class='oword'>manual</span> <span class='oword'>inspection</span> <span class='oword'>of</span> <span class='oword'>emitted</span> <span class='oword'>code</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [57]</span><br>
<span class='cumsum'> [57]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Hybrid</span><span class='ignore'>}</span> <span class='word'>mode</span> <span class='word'>treats</span> <span class='word'>pointers</span> <span class='word'>as</span> <span class='word'>integer</span> <span class='word'>addresses</span><span class='ignore'>,</span> <span class='word'>dereferenced</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>,</span> <span class='word'>unless</span> <span class='word'>they</span> <span class='word'>are</span> <span class='word'>annotated</span> <span class='word'>with</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='cmd'>\_</span><span class='cmd'>\_</span><span class='word'>capability</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [75]</span><br>
<span class='word'>This</span> <span class='word'>mode</span> <span class='word'>emits</span> <span class='word'>pre-existing</span> <span class='word'>RISC-V</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>take</span> <span class='word'>integer</span> <span class='word'>operands</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>uses</span> <span class='word'>capabilities</span> <span class='word'>through</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='word'>All</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>hybrid</span> <span class='word'>mode</span> <span class='word'>are</span> <span class='word'>created</span> <span class='word'>manually</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>by</span> <span class='word'>copying</span> <span class='word'>and</span> <span class='word'>shrinking</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>.</span><span class='cumsum'> [109]</span><br>
<span class='cumsum'> [109]</span><br>
<span class='word'>Hybrid</span> <span class='word'>mode</span> <span class='word'>allows</span> <span class='word'>programs</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>gradually</span> <span class='word'>ported</span> <span class='word'>to</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>making</span> <span class='word'>it</span> <span class='word'>very</span> <span class='word'>easy</span> <span class='word'>to</span> <span class='word'>adopt</span> <span class='word'>on</span> <span class='word'>legacy</span><span class='ignore'>/</span><span class='word'>large</span> <span class='word'>codebases</span><span class='ignore'>.</span><span class='cumsum'> [129]</span><br>
<span class='word'>Any</span> <span class='word'>extensions</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>model</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>CHERI-RVV</span><span class='ignore'>)</span> <span class='word'>should</span> <span class='word'>try</span> <span class='word'>and</span> <span class='word'>retain</span> <span class='word'>this</span> <span class='word'>property</span><span class='ignore'>.</span><span class='cumsum'> [142]</span><br>
<span class='cumsum'> [142]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Capability</span> <span class='hword'>relocations</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cherirelocs</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>Summarizes</span><span class='ignore'>~</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>4.4</span><span class='ignore'>,</span> <span class='word'>Appendix</span> <span class='word'>C</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-949</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [7]</span><br>
<span class='cumsum'> [7]</span><br>
<span class='word'>Binary</span> <span class='word'>applications</span> <span class='word'>compiled</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>mode</span> <span class='word'>require</span> <span class='word'>some</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>global</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>capabilities</span> <span class='word'>to</span> <span class='word'>exist</span> <span class='word'>at</span> <span class='word'>startup</span><span class='ignore'>,</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>which</span> <span class='word'>points</span> <span class='word'>to</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>main</span><span class='ignore'>(</span><span class='ignore'>)</span><span class='ignore'>}</span> <span class='word'>function</span><span class='ignore'>.</span><span class='cumsum'> [30]</span><br>
<span class='word'>It</span> <span class='word'>would</span> <span class='word'>be</span> <span class='word'>a</span> <span class='word'>security</span> <span class='word'>risk</span> <span class='word'>to</span> <span class='word'>synthesize</span> <span class='word'>these</span> <span class='word'>capabilities</span> <span class='word'>from</span> <span class='word'>thin</span> <span class='word'>air</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>to</span> <span class='word'>allow</span> <span class='word'>the</span> <span class='word'>binary</span> <span class='word'>file</span> <span class='word'>itself</span> <span class='word'>to</span> <span class='word'>contain</span> <span class='word'>tag</span> <span class='word'>bits</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='cumsum'> [54]</span><br>
<span class='word'>Instead</span><span class='ignore'>,</span> <span class='word'>CHERI</span> <span class='word'>ELF</span> <span class='word'>binaries</span> <span class='word'>contain</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>requested</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>relocations</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='ignore'>(</span><span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='cmd'>\_</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>relocs</span><span class='ignore'>}</span> <span class='word'>section</span><span class='ignore'>)</span> <span class='word'>which</span> <span class='word'>instruct</span> <span class='word'>the</span> <span class='word'>runtime</span> <span class='word'>environment</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>capabilities</span> <span class='word'>with</span> <span class='word'>specific</span> <span class='word'>permissions</span> <span class='word'>and</span> <span class='word'>bounds</span> <span class='word'>in</span> <span class='word'>specific</span> <span class='word'>places</span><span class='ignore'>.</span><span class='cumsum'> [84]</span><br>
<span class='word'>This</span> <span class='word'>process</span> <span class='word'>uses</span> <span class='word'>the</span> <span class='word'>normal</span> <span class='word'>CHERI</span> <span class='word'>capability</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>any</span> <span class='word'>invalid</span> <span class='word'>requests</span> <span class='word'>will</span> <span class='word'>cause</span> <span class='word'>a</span> <span class='word'>program</span> <span class='word'>crash</span><span class='ignore'>,</span> <span class='word'>maintaining</span> <span class='word'>security</span><span class='ignore'>.</span><span class='cumsum'> [103]</span><br>
<span class='word'>Further</span> <span class='word'>complexity</span> <span class='word'>is</span> <span class='word'>introduced</span> <span class='word'>with</span> <span class='word'>dynamic</span> <span class='word'>linking</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>future</span> <span class='word'>these</span> <span class='word'>relocations</span> <span class='word'>may</span> <span class='word'>change</span> <span class='word'>format</span><span class='ignore'>,</span> <span class='word'>both</span> <span class='word'>described</span> <span class='word'>in</span> <span class='word'>TR-949</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-949</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>above</span> <span class='word'>description</span> <span class='word'>is</span> <span class='word'>sufficient</span> <span class='word'>to</span> <span class='word'>understand</span> <span class='word'>the</span> <span class='word'>rest</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>paper</span><span class='ignore'>.</span><span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='comment'>% \subsection{Instruction reference}</span><span class='cumsum'> [136]</span><br>
<span class='comment'>% \todomark{TR-951 contains a complete reference of all added instructions in section blah, and notes legacy instructions modified by capability mode in section blah. Reproduce short list? Do so in appendix?}</span><span class='cumsum'> [136]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/sub50_cheri.tex</span><span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [136]</span><br>
<span class='comment'>% --- End of included file ./1_20Background/content.tex</span><span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_25EmulationInvestigation/content</span><span class='ignore'>}</span><span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/content.tex</span><span class='cumsum'> [136]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [136]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [136]</span><br>
<span class='cumsum'> [136]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>Hardware</span> <span class='hword'>emulation</span> <span class='hword'>investigation</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>In</span> <span class='word'>order</span> <span class='word'>to</span> <span class='word'>experiment</span> <span class='word'>with</span> <span class='word'>integrating</span> <span class='word'>CHERI</span> <span class='word'>and</span> <span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>implemented</span> <span class='word'>a</span> <span class='word'>RISC-V</span> <span class='word'>emulator</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>Rust</span> <span class='word'>programming</span> <span class='word'>language</span> <span class='word'>named</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>riscv-v-lite</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>can</span> <span class='word'>partially</span> <span class='word'>emulate</span> <span class='word'>four</span> <span class='word'>unprivileged</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>i.e</span><span class='ignore'>.</span> <span class='oword'>entirely</span> <span class='oword'>bare-metal</span> <span class='oword'>without</span> <span class='oword'>privilege</span> <span class='oword'>levels</span> <span class='oword'>for</span> <span class='oword'>OSs</span> <span class='oword'>or</span> <span class='oword'>hypervisors</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>RISC-V</span> <span class='word'>ISAs</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>_</span><span class='ignore'>arches</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>was</span> <span class='word'>also</span> <span class='word'>used</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>for</span> <span class='word'>capabilities-in-vectors</span> <span class='word'>research</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [53]</span><br>
<span class='word'>This</span> <span class='word'>chapter</span> <span class='word'>explores</span> <span class='word'>the</span> <span class='word'>development</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>emulator</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>implementation</span> <span class='word'>of</span> <span class='word'>CHERI</span> <span class='word'>support</span> <span class='ignore'>(</span><span class='word'>including</span> <span class='word'>supplementary</span> <span class='word'>libraries</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>addition</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>support</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>conclusions</span> <span class='word'>drawn</span> <span class='word'>about</span> <span class='word'>CHERI-RVV</span><span class='ignore'>.</span><span class='cumsum'> [80]</span><br>
<span class='cumsum'> [80]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[h]</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [80]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>cll</span><span class='ignore'>}</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>Architecture</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Extensions</span> <span class='exclcmd'>\\</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='ignore'>32-bit</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>rv32imv</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Multiply</span><span class='ignore'>,</span> <span class='ignore'>CSR</span><span class='ignore'>,</span> <span class='ignore'>Vector</span><span class='exclcmd'>\parnote</span><span class='ignore'>{</span><span class='ignore'>Floating-point</span> <span class='ignore'>parts</span> <span class='ignore'>of</span> <span class='ignore'>the</span> <span class='ignore'>vector</span> <span class='ignore'>extension</span> <span class='ignore'>are</span> <span class='ignore'>not</span> <span class='ignore'>supported</span><span class='ignore'>.</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>rvvnofloat</span><span class='ignore'>}</span><span class='ignore'>}</span>&nbsp; <span class='exclcmd'>\\</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='ignore'>64-bit</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>rv64imv</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Multiply</span><span class='ignore'>,</span> <span class='ignore'>CSR</span><span class='ignore'>,</span> <span class='ignore'>Vector</span><span class='exclcmd'>\parnoteref</span><span class='ignore'>{</span><span class='ignore'>rvvnofloat</span><span class='ignore'>}</span>&nbsp; <span class='exclcmd'>\\</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='ignore'>64-bit</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>rv64imvxcheri</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Multiply</span><span class='ignore'>,</span> <span class='ignore'>CSR</span><span class='ignore'>,</span> <span class='ignore'>Vector</span><span class='exclcmd'>\parnoteref</span><span class='ignore'>{</span><span class='ignore'>rvvnofloat</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='ignore'>CHERI</span>&nbsp; <span class='exclcmd'>\\</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='ignore'>64-bit</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>rv64imvxcheri-int</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>Multiply</span><span class='ignore'>,</span> <span class='ignore'>CSR</span><span class='ignore'>,</span> <span class='ignore'>Vector</span><span class='exclcmd'>\parnoteref</span><span class='ignore'>{</span><span class='ignore'>rvvnofloat</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='ignore'>CHERI</span> <span class='ignore'>(</span><span class='ignore'>Integer</span><span class='ignore'>)</span>&nbsp; <span class='exclcmd'>\\</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [80]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\parnotes</span><span class='cumsum'> [80]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>riscv-v-lite</span><span class='ignore'>}</span> <span class='ignore'>supported</span> <span class='ignore'>architectures</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>_</span><span class='ignore'>arches</span><span class='ignore'>}</span><span class='cumsum'> [80]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [80]</span><br>
<span class='cumsum'> [80]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Developing</span> <span class='hword'>the</span> <span class='hword'>emulator</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='cumsum'> [3]</span><br>
<span class='word'>Each</span> <span class='word'>architecture</span> <span class='word'>is</span> <span class='word'>simulated</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>way</span><span class='ignore'>.</span><span class='cumsum'> [11]</span><br>
<span class='word'>A</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Processor</span><span class='ignore'>}</span> <span class='word'>struct</span> <span class='word'>holds</span> <span class='word'>the</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>and</span> <span class='word'>memory</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>separate</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ProcessorModules</span><span class='ignore'>}</span> <span class='word'>struct</span> <span class='word'>holds</span> <span class='word'>the</span> <span class='word'>ISA</span> <span class='word'>modules</span> <span class='word'>the</span> <span class='word'>architecture</span> <span class='word'>can</span> <span class='word'>use</span><span class='ignore'>.</span><span class='cumsum'> [33]</span><br>
<span class='comment'>% A separate \code{ProcessorModules} struct holds all ISA modules the processor can execute (e.g. the base RV64 Integer ISA, the Multiply extension, and the Vector extension).</span><span class='cumsum'> [33]</span><br>
<span class='word'>Each</span> <span class='word'>ISA</span> <span class='word'>module</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>connector</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>struct</span> <span class='word'>to</span> <span class='word'>manipulate</span> <span class='word'>data</span> <span class='word'>in</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Processor</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [46]</span><br>
<span class='comment'>% The gap between the \code{Processor} and the ISA modules is bridged by a module-specific ``connector'' struct, which holds references to data in the \code{Processor} that is required by the ISA module.</span><span class='cumsum'> [46]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>RV64</span> <span class='word'>Integer</span> <span class='word'>ISA's</span> <span class='word'>connector</span> <span class='word'>contains</span> <span class='word'>the</span> <span class='word'>current</span> <span class='word'>PC</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>virtual</span> <span class='word'>reference</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>register</span> <span class='word'>file</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>virtual</span> <span class='word'>reference</span> <span class='word'>to</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [70]</span><br>
<span class='word'>This</span> <span class='word'>allows</span> <span class='word'>different</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Processor</span><span class='ignore'>}</span> <span class='word'>structs</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>a</span> <span class='word'>normal</span> <span class='word'>RV64</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>CHERI-enabled</span> <span class='word'>RV64</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>reuse</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>ISA</span> <span class='word'>modules</span> <span class='word'>despite</span> <span class='word'>using</span> <span class='word'>different</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>implementations</span><span class='ignore'>.</span><span class='cumsum'> [95]</span><br>
<span class='cumsum'> [95]</span><br>
<span class='word'>Each</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Processor</span><span class='ignore'>}</span> <span class='word'>implements</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>stage</span> <span class='word'>pipeline</span><span class='ignore'>.</span><span class='cumsum'> [102]</span><br>
<span class='word'>Instructions</span> <span class='word'>are</span> <span class='word'>fetched</span><span class='ignore'>,</span> <span class='word'>decoded</span> <span class='word'>with</span> <span class='word'>a</span> <span class='word'>common</span> <span class='word'>decoder</span> <span class='word'>function</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>The</span> <span class='oword'>decoder</span><span class='ignore'>,</span> <span class='oword'>and</span> <span class='oword'>therefore</span> <span class='oword'>all</span> <span class='oword'>emulated</span> <span class='oword'>processors</span><span class='ignore'>,</span> <span class='oword'>doesn't</span> <span class='oword'>support</span> <span class='oword'>RISC-V</span> <span class='oword'>Compressed</span> <span class='oword'>instructions</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>executed</span><span class='ignore'>.</span><span class='cumsum'> [125]</span><br>
<span class='word'>The</span> <span class='word'>processor</span> <span class='word'>asks</span> <span class='word'>each</span> <span class='word'>ISA</span> <span class='word'>module</span> <span class='word'>in</span> <span class='word'>turn</span> <span class='word'>if</span> <span class='word'>it</span> <span class='word'>wants</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>the</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>uses</span> <span class='word'>the</span> <span class='word'>first</span> <span class='word'>module</span> <span class='word'>to</span> <span class='word'>say</span> <span class='word'>yes</span><span class='ignore'>.</span><span class='cumsum'> [148]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>ISA</span> <span class='word'>module</span> <span class='word'>returns</span> <span class='word'>a</span> <span class='word'>new</span> <span class='word'>PC</span> <span class='word'>value</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>immediately</span> <span class='word'>applied</span><span class='ignore'>,</span> <span class='word'>otherwise</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>automatically</span> <span class='word'>incremented</span><span class='ignore'>.</span><span class='cumsum'> [166]</span><br>
<span class='word'>This</span> <span class='word'>structure</span> <span class='word'>easily</span> <span class='word'>represents</span> <span class='word'>basic</span> <span class='word'>RISC-V</span> <span class='word'>architectures</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>can</span> <span class='word'>scale</span> <span class='word'>up</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>many</span> <span class='word'>different</span> <span class='word'>new</span> <span class='word'>modules</span><span class='ignore'>.</span><span class='cumsum'> [183]</span><br>
<span class='cumsum'> [183]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_25EmulationInvestigation/sub10_emu_cheri}</span><span class='cumsum'> [183]</span><br>
<span class='cumsum'> [183]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/sub10_emu_cheri.tex</span><span class='cumsum'> [183]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Emulating</span> <span class='hword'>CHERI</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='word'>Manipulating</span> <span class='word'>CHERI</span> <span class='word'>capabilities</span> <span class='word'>securely</span> <span class='word'>and</span> <span class='word'>correctly</span> <span class='word'>is</span> <span class='word'>a</span> <span class='word'>must</span> <span class='word'>for</span> <span class='word'>any</span> <span class='word'>CHERI-enabled</span> <span class='word'>emulator</span><span class='ignore'>.</span><span class='cumsum'> [15]</span><br>
<span class='word'>Capability</span> <span class='word'>encoding</span> <span class='word'>logic</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>trivial</span> <span class='word'>by</span> <span class='word'>any</span> <span class='word'>means</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri-compressed-cap</span><span class='ignore'>}</span> <span class='word'>C</span> <span class='word'>library</span> <span class='word'>was</span> <span class='word'>re-used</span> <span class='word'>rather</span> <span class='word'>than</span> <span class='word'>implementing</span> <span class='word'>it</span> <span class='word'>from</span> <span class='word'>scratch</span><span class='ignore'>.</span><span class='cumsum'> [37]</span><br>
<span class='word'>Rust</span> <span class='word'>has</span> <span class='word'>generally</span> <span class='word'>decent</span> <span class='word'>interoperability</span> <span class='word'>with</span> <span class='word'>C</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>some</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>particulars</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>library</span> <span class='word'>caused</span> <span class='word'>issues</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='cumsum'> [54]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>rust-cheri-compressed-cap</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [55]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri-compressed-cap</span><span class='ignore'>}</span> <span class='word'>provides</span> <span class='word'>two</span> <span class='word'>versions</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>library</span> <span class='word'>by</span> <span class='word'>default</span><span class='ignore'>,</span> <span class='word'>for</span> <span class='word'>64-bit</span> <span class='word'>and</span> <span class='word'>128-bit</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>generated</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>common</span> <span class='word'>source</span> <span class='word'>through</span> <span class='word'>extensive</span> <span class='word'>use</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>preprocessor</span><span class='ignore'>.</span><span class='cumsum'> [82]</span><br>
<span class='word'>Each</span> <span class='word'>variant</span> <span class='word'>defines</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>preprocessor</span> <span class='word'>macros</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>widths</span> <span class='word'>of</span> <span class='word'>various</span> <span class='word'>fields</span><span class='ignore'>)</span> <span class='word'>before</span> <span class='word'>including</span> <span class='word'>two</span> <span class='word'>common</span> <span class='word'>header</span> <span class='word'>files</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri</span><span class='cmd'>\_</span><span class='word'>compressed</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>macros.h</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri</span><span class='cmd'>\_</span><span class='word'>compressed</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>common.h</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [111]</span><br>
<span class='word'>The</span> <span class='word'>latter</span> <span class='word'>then</span> <span class='word'>defines</span> <span class='word'>every</span> <span class='word'>relevant</span> <span class='word'>structure</span> <span class='word'>or</span> <span class='word'>function</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>those</span> <span class='word'>preprocessor</span> <span class='word'>macros</span><span class='ignore'>.</span><span class='cumsum'> [125]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>function</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>compute</span><span class='ignore'>_</span><span class='word'>base</span><span class='ignore'>_</span><span class='word'>top</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>generated</span> <span class='word'>twice</span><span class='ignore'>,</span> <span class='word'>once</span> <span class='word'>as</span>&nbsp; <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cc64</span><span class='cmd'>\_</span><span class='word'>decompress</span><span class='cmd'>\_</span><span class='word'>mem</span><span class='ignore'>}</span> <span class='word'>returning</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cc64</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>t</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>another</span> <span class='word'>time</span> <span class='word'>as</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cc128</span><span class='cmd'>\_</span><span class='word'>decompress</span><span class='cmd'>\_</span><span class='word'>mem</span><span class='ignore'>}</span> <span class='word'>returning</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cc128</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>t</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [155]</span><br>
<span class='word'>Elegantly</span> <span class='word'>capturing</span> <span class='word'>both</span> <span class='word'>sets</span> <span class='word'>was</span> <span class='word'>the</span> <span class='word'>main</span> <span class='word'>challenge</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>Rust</span> <span class='word'>wrapper</span><span class='ignore'>.</span><span class='cumsum'> [167]</span><br>
<span class='cumsum'> [167]</span><br>
<span class='word'>One</span> <span class='word'>of</span> <span class='word'>Rust's</span> <span class='word'>core</span> <span class='word'>language</span> <span class='word'>elements</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>Trait</span> <span class='ignore'>-</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>functions</span> <span class='word'>and</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>associated</span> <span class='word'>types</span><span class='ignore'>}</span> <span class='word'>that</span> <span class='word'>can</span> <span class='word'>be</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>implemented</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>any</span> <span class='word'>type</span><span class='ignore'>.</span><span class='cumsum'> [190]</span><br>
<span class='word'>This</span> <span class='word'>gives</span> <span class='word'>a</span> <span class='word'>simple</span> <span class='word'>way</span> <span class='word'>to</span> <span class='word'>define</span> <span class='word'>a</span> <span class='word'>consistent</span> <span class='word'>interface</span><span class='ignore'>:</span> <span class='word'>define</span> <span class='word'>a</span> <span class='word'>trait</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CompressedCapability</span><span class='ignore'>}</span> <span class='word'>with</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>functions</span> <span class='word'>from</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri</span><span class='cmd'>\_</span><span class='word'>compressed</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>common.h</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>implement</span> <span class='word'>it</span> <span class='word'>for</span> <span class='word'>two</span> <span class='word'>empty</span> <span class='word'>structures</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Cc64</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Cc128</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [224]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>future</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>would</span> <span class='word'>allow</span> <span class='word'>the</span> <span class='word'>Morello</span> <span class='word'>versions</span> <span class='word'>of</span> <span class='word'>capabilities</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>added</span> <span class='word'>easily</span><span class='ignore'>.</span><span class='cumsum'> [239]</span><br>
<span class='word'>A</span> <span class='word'>struct</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CcxCap</span><span class='ignore'>&lt;</span><span class='word'>T</span><span class='ignore'>&gt;</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>defined</span> <span class='word'>which</span> <span class='word'>uses</span> <span class='word'>specific</span> <span class='word'>types</span> <span class='word'>for</span> <span class='word'>addresses</span> <span class='word'>and</span> <span class='word'>lengths</span> <span class='word'>pulled</span> <span class='word'>from</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CompressedCapability</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [258]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>64-bit</span> <span class='word'>capability</span> <span class='word'>structure</span> <span class='word'>holds</span> <span class='word'>a</span> <span class='word'>32-bit</span> <span class='word'>address</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>128-bit</span> <span class='word'>capability</span> <span class='word'>a</span> <span class='word'>64-bit</span> <span class='word'>address</span><span class='ignore'>.</span><span class='cumsum'> [275]</span><br>
<span class='cumsum'> [275]</span><br>
<span class='word'>128-bit</span> <span class='word'>capabilities</span> <span class='word'>can</span> <span class='word'>cover</span> <span class='word'>a</span> <span class='word'>64-bit</span> <span class='word'>address</span> <span class='word'>range</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>thus</span> <span class='word'>can</span> <span class='word'>have</span> <span class='word'>a</span> <span class='word'>length</span> <span class='word'>of</span> <span class='mathgroup'>$</span><span class='math'>2</span><span class='math'>^</span><span class='ignore'>{</span><span class='math'>64</span><span class='ignore'>}</span><span class='mathgroup'>$</span><span class='ignore'>.</span><span class='cumsum'> [291]</span><br>
<span class='word'>Storing</span> <span class='word'>this</span> <span class='word'>length</span> <span class='word'>requires</span> <span class='word'>65-bits</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>all</span> <span class='word'>math</span> <span class='word'>in</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri</span><span class='cmd'>\_</span><span class='word'>compressed</span><span class='cmd'>\_</span><span class='word'>cap</span><span class='cmd'>\_</span><span class='word'>common.h</span><span class='ignore'>}</span> <span class='word'>uses</span> <span class='word'>128-bit</span> <span class='word'>length</span> <span class='word'>values</span><span class='ignore'>.</span><span class='cumsum'> [308]</span><br>
<span class='word'>C</span> <span class='word'>doesn't</span> <span class='word'>have</span> <span class='word'>any</span> <span class='word'>standardized</span> <span class='word'>128-bit</span> <span class='word'>types</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>GCC</span> <span class='word'>and</span> <span class='word'>LLVM</span> <span class='word'>provide</span> <span class='word'>so-called</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>extension</span> <span class='word'>types</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>instead</span><span class='ignore'>.</span><span class='cumsum'> [327]</span><br>
<span class='word'>Although</span> <span class='word'>the</span> <span class='word'>x86-64</span> <span class='word'>ABI</span> <span class='word'>does</span> <span class='word'>specify</span> <span class='word'>how</span> <span class='word'>128-bit</span> <span class='word'>values</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>stored</span> <span class='word'>and</span> <span class='word'>passed</span> <span class='word'>as</span> <span class='word'>arguments</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-x86-psABI-v1.0</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>these</span> <span class='word'>rules</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>seem</span> <span class='word'>consistently</span> <span class='word'>applied</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>See</span> <span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>godbolt.org</span><span class='ignore'>/</span><span class='ignore'>z</span><span class='ignore'>/</span><span class='ignore'>qj43jssr6</span><span class='ignore'>}</span> <span class='oword'>for</span> <span class='oword'>an</span> <span class='oword'>example</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [355]</span><br>
<span class='word'>This</span> <span class='word'>causes</span> <span class='word'>great</span> <span class='word'>pain</span> <span class='word'>to</span> <span class='word'>anyone</span> <span class='word'>who</span> <span class='word'>needs</span> <span class='word'>to</span> <span class='word'>pass</span> <span class='word'>them</span> <span class='word'>across</span> <span class='word'>a</span> <span class='word'>language</span> <span class='word'>boundary</span><span class='ignore'>.</span><span class='cumsum'> [370]</span><br>
<span class='cumsum'> [370]</span><br>
<span class='word'>Rust</span> <span class='word'>explicitly</span> <span class='word'>warns</span> <span class='word'>against</span> <span class='word'>passing</span> <span class='word'>128-bit</span> <span class='word'>values</span> <span class='word'>across</span> <span class='word'>FFI</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>Clang</span> <span class='word'>User's</span> <span class='word'>Manual</span> <span class='word'>even</span> <span class='word'>states</span> <span class='word'>that</span> <span class='word'>passing</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>i128</span><span class='ignore'>}</span> <span class='word'>by</span> <span class='word'>value</span> <span class='word'>is</span> <span class='word'>incompatible</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>Microsoft</span> <span class='word'>x64</span> <span class='word'>calling</span> <span class='word'>convention</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitfile</span><span class='optparm'>[</span><span class='oword'>release</span><span class='ignore'>/</span><span class='oword'>13.x</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='oword'>clang</span><span class='ignore'>/</span><span class='oword'>docs</span><span class='ignore'>/</span><span class='oword'>UsersManual.rst</span><span class='ignore'>:</span><span class='oword'>3384</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='oword'>llvm</span><span class='ignore'>/</span><span class='oword'>llvm-project</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>llvm</span><span class='ignore'>/</span><span class='ignore'>llvm-project</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>release</span><span class='ignore'>/</span><span class='ignore'>13.x</span><span class='ignore'>/</span><span class='ignore'>clang</span><span class='ignore'>/</span><span class='ignore'>docs</span><span class='ignore'>/</span><span class='ignore'>UsersManual.rst</span><span class='exclcmd'>\#</span><span class='ignore'>x86</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [407]</span><br>
<span class='word'>This</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>resolved</span> <span class='word'>through</span> <span class='word'>careful</span> <span class='word'>examination</span><span class='ignore'>:</span> <span class='word'>for</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>on</span> <span class='word'>LLVM</span> <span class='word'>128-bit</span> <span class='word'>values</span> <span class='word'>are</span> <span class='word'>passed</span> <span class='word'>to</span> <span class='word'>functions</span> <span class='word'>in</span> <span class='word'>two</span> <span class='word'>64-bit</span> <span class='word'>registers</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitfile</span><span class='optparm'>[</span><span class='oword'>release</span><span class='ignore'>/</span><span class='oword'>13.x</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='oword'>clang</span><span class='ignore'>/</span><span class='oword'>lib</span><span class='ignore'>/</span><span class='oword'>CodeGen</span><span class='ignore'>/</span><span class='oword'>TargetInfo.cpp</span><span class='ignore'>:</span><span class='oword'>2811</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='oword'>llvm</span><span class='ignore'>/</span><span class='oword'>llvm-project</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>llvm</span><span class='ignore'>/</span><span class='ignore'>llvm-project</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>75e33f71c2dae584b13a7d1186ae0a038ba98838</span><span class='ignore'>/</span><span class='ignore'>clang</span><span class='ignore'>/</span><span class='ignore'>lib</span><span class='ignore'>/</span><span class='ignore'>CodeGen</span><span class='ignore'>/</span><span class='ignore'>TargetInfo.cpp</span><span class='exclcmd'>\#</span><span class='ignore'>L2811</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>replicated</span> <span class='word'>in</span> <span class='word'>Rust</span> <span class='word'>by</span> <span class='word'>passing</span> <span class='word'>two</span> <span class='word'>64-bit</span> <span class='word'>values</span><span class='ignore'>.</span><span class='cumsum'> [448]</span><br>
<span class='word'>For</span> <span class='word'>convenience</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>instead</span> <span class='word'>rely</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>Rust</span> <span class='word'>and</span> <span class='word'>Clang</span> <span class='word'>compilers</span> <span class='word'>using</span> <span class='word'>compatible</span> <span class='word'>LLVM</span> <span class='word'>versions</span> <span class='word'>and</span> <span class='word'>having</span> <span class='word'>identical</span> <span class='word'>128-bit</span> <span class='word'>semantics</span><span class='ignore'>.</span><span class='cumsum'> [468]</span><br>
<span class='cumsum'> [468]</span><br>
<span class='word'>The</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>documentation</span> <span class='word'>contains</span> <span class='word'>formal</span> <span class='word'>specifications</span> <span class='word'>of</span> <span class='word'>all</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>CHERI</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>expressed</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>Sail</span> <span class='word'>architecture</span> <span class='word'>definition</span>&nbsp; <span class='word'>language</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitrepo</span><span class='ignore'>{</span><span class='oword'>rems-project</span><span class='ignore'>/</span><span class='oword'>sail</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>rems-project</span><span class='ignore'>/</span><span class='ignore'>sail</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [489]</span><br>
<span class='word'>These</span> <span class='word'>definitions</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>formal</span> <span class='word'>model</span> <span class='ignore'>(</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitrepo</span><span class='ignore'>{</span><span class='oword'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='oword'>sail-cheri-riscv</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='ignore'>sail-cheri-riscv</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>require</span> <span class='word'>a</span> <span class='word'>few</span> <span class='word'>helper</span> <span class='word'>functions</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Chapter</span> <span class='word'>8.2</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [509]</span><br>
<span class='word'>To</span> <span class='word'>make</span> <span class='word'>it</span> <span class='word'>easier</span> <span class='word'>to</span> <span class='word'>port</span> <span class='word'>the</span> <span class='word'>formal</span> <span class='word'>definitions</span> <span class='word'>directly</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>rust-cheri-compressed-cap</span><span class='ignore'>}</span> <span class='word'>library</span> <span class='word'>also</span> <span class='word'>provides</span> <span class='word'>those</span> <span class='word'>helper</span> <span class='word'>functions</span> <span class='word'>through</span> <span class='word'>a</span> <span class='word'>wrapper</span> <span class='word'>trait</span><span class='ignore'>.</span><span class='cumsum'> [534]</span><br>
<span class='cumsum'> [534]</span><br>
<span class='word'>The</span> <span class='word'>above</span> <span class='word'>work</span> <span class='word'>is</span> <span class='word'>available</span> <span class='word'>online</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\redact</span><span class='ignore'>{</span><span class='cmd'>\gitrepo</span><span class='ignore'>{</span><span class='oword'>theturboturnip</span><span class='ignore'>/</span><span class='oword'>cheri-compressed-cap</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>theturboturnip</span><span class='ignore'>/</span><span class='ignore'>cheri-compressed-cap</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>includes</span> <span class='word'>documentation</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>C</span> <span class='word'>functions</span> <span class='ignore'>(</span><span class='word'>which</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>documented</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>main</span> <span class='word'>repository</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [557]</span><br>
<span class='word'>That</span> <span class='word'>documentation</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>available</span> <span class='word'>online</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\redact</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>theturboturnip.github.io</span><span class='ignore'>/</span><span class='ignore'>files</span><span class='ignore'>/</span><span class='ignore'>doc</span><span class='ignore'>/</span><span class='ignore'>rust</span><span class='ignore'>_</span><span class='ignore'>cheri</span><span class='ignore'>_</span><span class='ignore'>compressed</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>/</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>partially</span> <span class='word'>reproduced</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>appx</span><span class='ignore'>:</span><span class='ignore'>docs</span><span class='ignore'>:</span><span class='ignore'>rustcherilib</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [568]</span><br>
<span class='cumsum'> [568]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Integrating</span> <span class='hword'>into</span> <span class='hword'>the</span> <span class='hword'>emulator</span><span class='ignore'>}</span><span class='cumsum'> [572]</span><br>
<span class='comment'>% i.e. using MemoryOf trait to make all memory addressable only by capabilities</span><span class='cumsum'> [572]</span><br>
<span class='word'>Integrating</span> <span class='word'>capabilities</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>was</span> <span class='word'>relatively</span> <span class='word'>simple</span> <span class='word'>thanks</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>modular</span> <span class='word'>emulator</span> <span class='word'>structure</span><span class='ignore'>.</span><span class='cumsum'> [586]</span><br>
<span class='word'>A</span> <span class='word'>capability-addressed</span> <span class='word'>memory</span> <span class='word'>type</span> <span class='word'>was</span> <span class='word'>created</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>wraps</span> <span class='word'>a</span> <span class='word'>simple</span> <span class='word'>integer-addressed</span> <span class='word'>memory</span> <span class='word'>in</span> <span class='word'>logic</span> <span class='word'>which</span> <span class='word'>performs</span> <span class='word'>the</span> <span class='word'>relevant</span> <span class='word'>capability</span> <span class='word'>checks</span><span class='ignore'>.</span><span class='cumsum'> [606]</span><br>
<span class='word'>For</span> <span class='word'>integer</span> <span class='word'>encoding</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>further</span> <span class='word'>integer-addressed</span> <span class='word'>memory</span> <span class='word'>type</span> <span class='word'>was</span> <span class='word'>created</span> <span class='word'>which</span> <span class='word'>wraps</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>addressed</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>all</span> <span class='word'>integer</span> <span class='word'>addresses</span> <span class='word'>are</span> <span class='word'>bundled</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>DDC</span> <span class='word'>before</span> <span class='word'>passing</span> <span class='word'>through</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>capability-addressed</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [639]</span><br>
<span class='word'>Similarly</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>merged</span> <span class='word'>capability</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>type</span> <span class='word'>was</span> <span class='word'>created</span> <span class='word'>that</span> <span class='word'>exposed</span> <span class='word'>integer-mode</span> <span class='word'>and</span> <span class='word'>capability-mode</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [654]</span><br>
<span class='word'>This</span> <span class='word'>layered</span> <span class='word'>approach</span> <span class='word'>meant</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>basic</span> <span class='word'>RV64I</span> <span class='word'>operations</span> <span class='word'>did</span> <span class='word'>not</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>modified</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>CHERI</span> <span class='word'>at</span> <span class='word'>all</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>simply</span> <span class='word'>passing</span> <span class='word'>the</span> <span class='word'>integer-mode</span> <span class='word'>memory</span> <span class='word'>and</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>would</span> <span class='word'>perform</span> <span class='word'>all</span> <span class='word'>relevant</span> <span class='word'>checks</span><span class='ignore'>.</span><span class='cumsum'> [687]</span><br>
<span class='cumsum'> [687]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>diagram</span><span class='ignore'>}</span><span class='cumsum'> [687]</span><br>
<span class='cumsum'> [687]</span><br>
<span class='comment'>% i.e. isn't the module system nice for overriding specific behaviour like Capability-mode RV64I :)</span><span class='cumsum'> [687]</span><br>
<span class='word'>Integrating</span> <span class='word'>capability</span> <span class='word'>instructions</span> <span class='word'>was</span> <span class='word'>also</span> <span class='word'>simple</span><span class='ignore'>.</span><span class='cumsum'> [693]</span><br>
<span class='word'>Two</span> <span class='word'>new</span> <span class='word'>ISA</span> <span class='word'>modules</span> <span class='word'>were</span> <span class='word'>created</span><span class='ignore'>:</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>XCheri64</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>new</span> <span class='word'>CHERI</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Rv64imCapabilityMode</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>override</span> <span class='word'>the</span> <span class='word'>behaviour</span> <span class='word'>of</span> <span class='word'>legacy</span> <span class='word'>instructions</span> <span class='word'>in</span> <span class='word'>capability-encoding-mode</span><span class='ignore'>.</span><span class='cumsum'> [716]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>appendix</span> <span class='ignore'>-</span> <span class='ignore'>the</span> <span class='ignore'>program</span> <span class='ignore'>flow</span> <span class='ignore'>for</span> <span class='ignore'>using</span> <span class='ignore'>modules</span><span class='ignore'>}</span><span class='cumsum'> [716]</span><br>
<span class='word'>The</span> <span class='word'>actual</span> <span class='word'>Processor</span> <span class='word'>structure</span> <span class='word'>was</span> <span class='word'>left</span> <span class='word'>mostly</span> <span class='word'>unchanged</span><span class='ignore'>.</span><span class='cumsum'> [724]</span><br>
<span class='word'>Integer</span> <span class='word'>addresses</span> <span class='word'>were</span> <span class='word'>changed</span> <span class='word'>to</span> <span class='word'>capabilities</span> <span class='word'>throughout</span><span class='ignore'>,</span><span class='cumsum'> [731]</span><br>
<span class='word'>memory</span> <span class='word'>and</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>types</span> <span class='word'>were</span> <span class='word'>changed</span> <span class='word'>as</span> <span class='word'>described</span> <span class='word'>above</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>PCC</span><span class='ignore'>/</span><span class='word'>DDC</span> <span class='word'>were</span> <span class='word'>added</span><span class='ignore'>.</span><span class='cumsum'> [747]</span><br>
<span class='cumsum'> [747]</span><br>
<span class='word'>The</span> <span class='word'>capability</span> <span class='word'>model</span> <span class='word'>presented</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>C</span><span class='ignore'>/</span><span class='word'>Rust</span> <span class='word'>library</span> <span class='word'>has</span> <span class='word'>one</span> <span class='word'>flaw</span><span class='ignore'>.</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>safetaggedcap</span><span class='ignore'>}</span><span class='cumsum'> [759]</span><br>
<span class='word'>Each</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CcxCap</span><span class='ignore'>}</span> <span class='word'>instance</span> <span class='word'>stores</span> <span class='word'>capability</span> <span class='word'>metadata</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>uncompressed</span> <span class='word'>bounds</span><span class='ignore'>)</span> <span class='word'>as</span> <span class='word'>well</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>compressed</span> <span class='word'>encoding</span><span class='ignore'>.</span><span class='cumsum'> [775]</span><br>
<span class='word'>This</span> <span class='word'>makes</span> <span class='word'>it</span> <span class='word'>potentially</span> <span class='word'>error-prone</span> <span class='word'>to</span> <span class='word'>represent</span> <span class='word'>untagged</span> <span class='word'>integer</span> <span class='word'>data</span> <span class='word'>with</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CcxCap</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>compressed</span> <span class='word'>and</span> <span class='word'>uncompressed</span> <span class='word'>data</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>be</span> <span class='word'>kept</span> <span class='word'>in</span> <span class='word'>sync</span> <span class='word'>and</span> <span class='word'>cause</span> <span class='word'>inconsistencies</span> <span class='word'>later</span> <span class='word'>down</span> <span class='word'>the</span> <span class='word'>line</span><span class='ignore'>.</span><span class='cumsum'> [806]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CcxCap</span><span class='ignore'>}</span> <span class='word'>also</span> <span class='word'>provides</span> <span class='word'>a</span> <span class='word'>simple</span> <span class='word'>interface</span> <span class='word'>to</span> <span class='word'>set</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>,</span> <span class='word'>without</span> <span class='word'>checking</span> <span class='word'>whether</span> <span class='word'>that</span> <span class='word'>is</span> <span class='word'>valid</span><span class='ignore'>.</span><span class='cumsum'> [823]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>introduced</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SafeTaggedCap</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>resolve</span> <span class='word'>this</span><span class='ignore'>:</span> <span class='word'>a</span> <span class='word'>sum</span> <span class='word'>type</span> <span class='word'>which</span> <span class='word'>represents</span> <span class='word'>either</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CcxCap</span><span class='ignore'>}</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>set</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>raw</span> <span class='word'>data</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>unset</span><span class='ignore'>.</span><span class='cumsum'> [852]</span><br>
<span class='word'>This</span> <span class='word'>adds</span> <span class='word'>type</span> <span class='word'>safety</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>Rust</span> <span class='word'>compiler</span> <span class='word'>forces</span> <span class='word'>every</span> <span class='word'>usage</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SafeTaggedCap</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>consider</span> <span class='word'>both</span> <span class='word'>options</span><span class='ignore'>,</span> <span class='word'>preventing</span> <span class='word'>raw</span> <span class='word'>data</span> <span class='word'>from</span> <span class='word'>being</span> <span class='word'>interpreted</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>by</span> <span class='word'>accident</span> <span class='word'>and</span> <span class='word'>enforcing</span> <span class='word'>Provenance</span><span class='ignore'>.</span><span class='cumsum'> [883]</span><br>
<span class='cumsum'> [883]</span><br>
<span class='comment'>% i.e. doing capability relocation</span><span class='cumsum'> [883]</span><br>
<span class='word'>The</span> <span class='word'>final</span> <span class='word'>hurdle</span> <span class='word'>was</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>relocations</span> <span class='word'>outlined</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cherirelocs</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [892]</span><br>
<span class='word'>Because</span> <span class='word'>we're</span> <span class='word'>emulating</span> <span class='word'>a</span> <span class='word'>bare-metal</span> <span class='word'>platform</span><span class='ignore'>,</span> <span class='word'>there</span> <span class='word'>is</span> <span class='word'>no</span> <span class='word'>operating</span> <span class='word'>system</span> <span class='word'>to</span> <span class='word'>do</span> <span class='word'>this</span> <span class='word'>step</span> <span class='word'>for</span> <span class='word'>us</span><span class='ignore'>.</span><span class='cumsum'> [909]</span><br>
<span class='word'>A</span> <span class='word'>bare-metal</span> <span class='word'>C</span> <span class='word'>function</span> <span class='word'>has</span> <span class='word'>been</span> <span class='word'>written</span> <span class='word'>to</span> <span class='word'>perform</span> <span class='word'>the</span> <span class='word'>relocations</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitfile</span><span class='ignore'>{</span><span class='oword'>src</span><span class='ignore'>/</span><span class='oword'>crt</span><span class='ignore'>_</span><span class='oword'>init</span><span class='ignore'>_</span><span class='oword'>globals.c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='oword'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='oword'>device-model</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='ignore'>device-model</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>88e5e8e744d57b88b0dbb8e3456ee0e69afc143b</span><span class='ignore'>/</span><span class='ignore'>src</span><span class='ignore'>/</span><span class='ignore'>crt</span><span class='ignore'>_</span><span class='ignore'>init</span><span class='ignore'>_</span><span class='ignore'>globals.c</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>compiled</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>emulated</span> <span class='word'>program</span><span class='ignore'>.</span><span class='cumsum'> [934]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>I</span> <span class='word'>wasn't</span> <span class='word'>sure</span> <span class='word'>how</span> <span class='word'>to</span> <span class='word'>find</span> <span class='word'>the</span> <span class='word'>addresses</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>generated</span> <span class='word'>relocations</span> <span class='word'>in</span> <span class='word'>C</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>I</span> <span class='word'>performed</span> <span class='word'>the</span> <span class='word'>relocations</span> <span class='word'>in</span> <span class='word'>Rust</span> <span class='word'>by</span> <span class='word'>examining</span> <span class='word'>the</span> <span class='word'>compiled</span> <span class='word'>ELF</span> <span class='word'>file</span> <span class='word'>before</span> <span class='word'>starting</span> <span class='word'>emulation</span><span class='ignore'>.</span><span class='cumsum'> [965]</span><br>
<span class='word'>In</span> <span class='word'>future</span> <span class='word'>research</span> <span class='word'>it</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>doable</span> <span class='word'>to</span> <span class='word'>perform</span> <span class='word'>the</span> <span class='word'>relocations</span> <span class='word'>entirely</span> <span class='word'>in</span> <span class='word'>bare-metal</span> <span class='word'>C</span><span class='ignore'>.</span><span class='cumsum'> [980]</span><br>
<span class='cumsum'> [980]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/sub10_emu_cheri.tex</span><span class='cumsum'> [980]</span><br>
<span class='cumsum'> [980]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_25EmulationInvestigation/sub20_emu_vec}</span><span class='cumsum'> [980]</span><br>
<span class='cumsum'> [980]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/sub20_emu_vec.tex</span><span class='cumsum'> [980]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Emulating</span> <span class='hword'>vectors</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='comment'>% i.e. using addr, provenance split to write agnostic code?</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='word'>Vector</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>executed</span> <span class='word'>by</span> <span class='word'>a</span> <span class='word'>Vector</span> <span class='word'>ISA</span> <span class='word'>module</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>stores</span> <span class='word'>all</span> <span class='word'>registers</span> <span class='word'>and</span> <span class='word'>other</span> <span class='word'>state</span><span class='ignore'>.</span><span class='cumsum'> [18]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>hardcoded</span> <span class='word'>as</span> <span class='word'>128-bits</span><span class='ignore'>,</span> <span class='word'>chosen</span> <span class='word'>because</span> <span class='word'>it's</span> <span class='word'>the</span> <span class='word'>largest</span> <span class='word'>integer</span> <span class='word'>primitive</span> <span class='word'>provided</span> <span class='word'>by</span> <span class='word'>Rust</span> <span class='word'>that's</span> <span class='word'>large</span> <span class='word'>enough</span> <span class='word'>to</span> <span class='word'>hold</span> <span class='word'>a</span> <span class='word'>capability</span><span class='ignore'>.</span><span class='cumsum'> [40]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ELEN</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>128-bits</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>isn't</span> <span class='word'>supported</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>specification</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>is</span> <span class='word'>required</span> <span class='word'>for</span> <span class='word'>capabilities-in-vectors</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [55]</span><br>
<span class='word'>Scaling</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ELEN</span><span class='ignore'>}</span> <span class='word'>any</span> <span class='word'>higher</span> <span class='word'>would</span> <span class='word'>require</span> <span class='word'>the</span> <span class='word'>creation</span> <span class='word'>and</span> <span class='word'>integration</span> <span class='word'>of</span> <span class='word'>new</span> <span class='word'>types</span> <span class='word'>that</span> <span class='word'>were</span> <span class='word'>more</span> <span class='word'>than</span> <span class='word'>128-bits</span> <span class='word'>long</span><span class='ignore'>.</span><span class='cumsum'> [76]</span><br>
<span class='cumsum'> [76]</span><br>
<span class='word'>To</span> <span class='word'>support</span> <span class='word'>both</span> <span class='word'>CHERI</span> <span class='word'>and</span> <span class='word'>non-CHERI</span> <span class='word'>execution</span> <span class='word'>pointers</span> <span class='word'>are</span> <span class='word'>separated</span> <span class='word'>into</span> <span class='word'>an</span> <span class='word'>address</span> <span class='word'>and</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>provenance</span><span class='ignore'>}</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>The</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='oword'>original</span> <span class='oword'>allocation</span> <span class='oword'>the</span> <span class='oword'>pointer</span> <span class='oword'>is</span> <span class='oword'>derived</span> <span class='oword'>from</span><span class='ignore'>'</span><span class='ignore'>'</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>memarianExploringSemanticsPointer2019</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='oword'>or</span> <span class='oword'>in</span> <span class='oword'>CHERI</span> <span class='oword'>terms</span> <span class='oword'>the</span> <span class='oword'>bounds</span> <span class='oword'>within</span> <span class='oword'>which</span> <span class='oword'>the</span> <span class='oword'>pointer</span> <span class='oword'>is</span> <span class='oword'>valid</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [112]</span><br>
<span class='word'>The</span> <span class='word'>vector</span> <span class='word'>unit</span> <span class='word'>retrieves</span> <span class='word'>an</span> <span class='word'>address</span> <span class='ignore'>+</span> <span class='word'>provenance</span> <span class='word'>pair</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>register</span><span class='ignore'>,</span> <span class='word'>generates</span> <span class='word'>a</span> <span class='word'>stream</span> <span class='word'>of</span> <span class='word'>addresses</span> <span class='word'>to</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>rejoins</span> <span class='word'>each</span> <span class='word'>address</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>provenance</span> <span class='word'>to</span> <span class='word'>access</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [141]</span><br>
<span class='word'>When</span> <span class='word'>using</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>provenance</span> <span class='word'>is</span> <span class='word'>defined</span> <span class='word'>in</span> <span class='word'>terms</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>register</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>the</span> <span class='word'>provenance</span> <span class='word'>is</span> <span class='word'>provided</span> <span class='word'>by</span> <span class='word'>capability</span> <span class='word'>register</span> <span class='word'>X</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>defined</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>DDC</span> <span class='word'>in</span> <span class='word'>integer</span> <span class='word'>mode</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>See</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>int</span><span class='ignore'>_</span><span class='ignore'>mode</span><span class='ignore'>}</span> <span class='oword'>for</span> <span class='oword'>the</span> <span class='oword'>reasoning</span> <span class='oword'>behind</span> <span class='oword'>this</span> <span class='oword'>decision</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [177]</span><br>
<span class='word'>On</span> <span class='word'>non-CHERI</span> <span class='word'>platforms</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>unit</span> <span class='word'>doesn't</span> <span class='word'>check</span> <span class='word'>provenance</span><span class='ignore'>.</span><span class='cumsum'> [186]</span><br>
<span class='cumsum'> [186]</span><br>
<span class='word'>Arithmetic</span> <span class='word'>and</span> <span class='word'>configuration</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>generally</span> <span class='word'>simple</span> <span class='word'>to</span> <span class='word'>implement</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>aren't</span> <span class='word'>covered</span> <span class='word'>here</span><span class='ignore'>.</span><span class='cumsum'> [199]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>splits</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>into</span> <span class='word'>three</span> <span class='word'>phases</span><span class='ignore'>:</span> <span class='word'>decoding</span><span class='ignore'>,</span> <span class='word'>checking</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>execution</span><span class='ignore'>.</span><span class='cumsum'> [212]</span><br>
<span class='word'>A</span> <span class='word'>separate</span> <span class='word'>decoding</span> <span class='word'>stage</span> <span class='word'>may</span> <span class='word'>technically</span> <span class='word'>not</span> <span class='word'>be</span> <span class='word'>necessary</span> <span class='word'>in</span> <span class='word'>hardware</span> <span class='ignore'>(</span><span class='word'>especially</span> <span class='word'>the</span> <span class='word'>parts</span> <span class='word'>checking</span> <span class='word'>for</span> <span class='word'>errors</span> <span class='word'>and</span> <span class='word'>reserved</span> <span class='word'>instruction</span> <span class='word'>encodings</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>a</span> <span class='word'>hardware</span> <span class='word'>platform</span> <span class='word'>could</span> <span class='word'>simply</span> <span class='word'>assume</span> <span class='word'>won't</span> <span class='word'>happen</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>it</span> <span class='word'>allows</span> <span class='word'>each</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instruction</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>classified</span> <span class='word'>into</span> <span class='word'>one</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>five</span> <span class='word'>archetypes</span> <span class='word'>outlined</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>rvvmemory</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [260]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>then</span> <span class='word'>easy</span> <span class='word'>to</span> <span class='word'>define</span> <span class='word'>the</span> <span class='word'>checking</span> <span class='word'>and</span> <span class='word'>execution</span> <span class='word'>phases</span> <span class='word'>separately</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>archetype</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>hardware</span> <span class='word'>would</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>do</span><span class='ignore'>.</span><span class='cumsum'> [282]</span><br>
<span class='cumsum'> [282]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Decoding</span> <span class='hword'>phase</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>decoding</span><span class='ignore'>}</span><span class='cumsum'> [284]</span><br>
<span class='word'>Decoding</span> <span class='word'>is</span> <span class='word'>split</span> <span class='word'>into</span> <span class='word'>two</span> <span class='word'>steps</span><span class='ignore'>:</span> <span class='word'>finding</span> <span class='word'>the</span> <span class='word'>encoded</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nf</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>eew</span><span class='ignore'>}</span> <span class='word'>values</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>interpreting</span> <span class='word'>them</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>encoded</span> <span class='word'>archetype</span><span class='ignore'>.</span><span class='cumsum'> [305]</span><br>
<span class='comment'>% Vector memory accesses are encoded under the F extension's Load and Store major opcodes, which already encodes an element width.</span><span class='cumsum'> [305]</span><br>
<span class='comment'>% Vector memory access instructions are encoded similarly to the F extension's floating-point load/store instructions, which include an ``element width''.</span><span class='cumsum'> [305]</span><br>
<span class='word'>Vector</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>reuse</span> <span class='word'>instruction</span> <span class='word'>encodings</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>F</span> <span class='word'>extension's</span> <span class='word'>floating-point</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>include</span> <span class='word'>an</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>element</span> <span class='word'>width</span><span class='ignore'>'</span><span class='ignore'>'</span><span class='ignore'>.</span><span class='cumsum'> [324]</span><br>
<span class='word'>The</span> <span class='word'>vector</span> <span class='word'>extension</span> <span class='word'>adds</span> <span class='word'>four</span> <span class='word'>extra</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>element</span> <span class='word'>width</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>values</span> <span class='word'>which</span> <span class='word'>imply</span> <span class='word'>the</span> <span class='word'>access</span> <span class='word'>is</span> <span class='word'>vectorized</span><span class='ignore'>.</span><span class='cumsum'> [339]</span><br>
<span class='comment'>% This element width is used to differentiate between vector accesses and scalar floating-point accesses, where a vector access can have one of four widths (8, 16, 32, 64).</span><span class='cumsum'> [339]</span><br>
<span class='word'>If</span> <span class='word'>any</span> <span class='word'>of</span> <span class='word'>these</span> <span class='word'>values</span> <span class='word'>are</span> <span class='word'>found</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>is</span> <span class='word'>interpreted</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>access</span> <span class='word'>and</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>nf</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>extracted</span><span class='ignore'>.</span><span class='cumsum'> [358]</span><br>
<span class='comment'>% \paramt{nf} is encoded consistently in all vector memory access instructions</span><span class='cumsum'> [358]</span><br>
<span class='cumsum'> [358]</span><br>
<span class='word'>Once</span> <span class='word'>the</span> <span class='word'>generic</span> <span class='word'>parameters</span> <span class='word'>are</span> <span class='word'>extracted</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>addressing</span> <span class='word'>method</span> <span class='word'>is</span> <span class='word'>determined</span> <span class='word'>from</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>mop</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>Unit</span><span class='ignore'>,</span> <span class='word'>Strided</span><span class='ignore'>,</span> <span class='word'>Indexed-Ordered</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>Indexed-Unordered</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [376]</span><br>
<span class='word'>If</span> <span class='word'>a</span> <span class='word'>unit</span> <span class='word'>access</span> <span class='word'>is</span> <span class='word'>selected</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>second</span> <span class='word'>argument</span> <span class='word'>field</span> <span class='cmd'>\paramt</span><span class='ignore'>{</span><span class='word'>umop</span><span class='ignore'>}</span> <span class='word'>selects</span> <span class='word'>a</span> <span class='word'>unit-stride</span> <span class='word'>archetype</span> <span class='ignore'>(</span><span class='word'>normal</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>fault-only-first</span><span class='ignore'>,</span> <span class='word'>whole</span> <span class='word'>register</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>bytemask</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [398]</span><br>
<span class='comment'>% Strided and indexed accesses just use their dedicated archetypes.</span><span class='cumsum'> [398]</span><br>
<span class='word'>Extra</span> <span class='word'>archetype-specific</span> <span class='word'>calculations</span> <span class='word'>are</span> <span class='word'>performed</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>computing</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>EVL</span> <span class='ignore'>=</span> <span class='word'>ceil</span><span class='ignore'>(</span><span class='word'>vl</span><span class='ignore'>/</span><span class='word'>8</span><span class='ignore'>)</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>bytemask</span> <span class='word'>accesses</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>relevant</span> <span class='word'>information</span> <span class='word'>is</span> <span class='word'>returned</span> <span class='word'>as</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>DecodedMemOp</span><span class='ignore'>}</span> <span class='word'>enum</span><span class='ignore'>.</span><span class='cumsum'> [422]</span><br>
<span class='cumsum'> [422]</span><br>
<span class='comment'>% \todomark{diagram of floating point ld/st vs. vector ld/st}</span><span class='cumsum'> [422]</span><br>
<span class='comment'>% \todomark{table of floating point ld/st, vector ld/st instructions}</span><span class='cumsum'> [422]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>appx</span> <span class='ignore'>-</span> <span class='ignore'>Decision</span> <span class='ignore'>tree</span> <span class='ignore'>for</span> <span class='ignore'>operation</span> <span class='ignore'>decoding</span><span class='ignore'>?</span><span class='ignore'>}</span><span class='cumsum'> [422]</span><br>
<span class='cumsum'> [422]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\mcb</span><span class='ignore'>}</span><span class='option'>[2]</span><span class='ignore'>{</span><span class='ignore'>\multicolumn</span><span class='ignore'>{</span><span class='ignore'>#</span><span class='ignore'>1</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>|</span><span class='ignore'>c</span><span class='ignore'>|</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>#</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [422]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;<span class='comment'>% \begin{tabularx}{\textwidth}{@{}*{32}{p{\dimexpr(\textwidth-64\tabcolsep)/32\relax}}@{}}</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\small</span><span class='exclenv'>\begin</span><span class='exclenv'>{tabularx}</span><span class='ignore'>{</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span> <span class='ignore'>XXXX</span><span class='ignore'>}</span><span class='cumsum'> [422]</span><br>
&nbsp; &nbsp; <span class='comment'>% \small\begin{tabularx}{\textwidth}{p{}}</span><span class='cumsum'> [422]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='comment'>% \begin{tabular}{*{32}{p{3cm}}}</span><span class='cumsum'> [422]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='comment'>% 31&amp;&amp;29&amp;28&amp;27&amp;26&amp;25&amp;24&amp;&amp;&amp;&amp;20&amp;19&amp;&amp;&amp;&amp;15&amp;14&amp;&amp;12&amp;11&amp;&amp;&amp;&amp;7&amp;6&amp;&amp;&amp;&amp;&amp;&amp;0 \\</span><span class='cumsum'> [422]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\hline</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>3</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>nf</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>mew</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>2</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>mop</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='ignore'>vm</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>5</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='exclcmd'>\paramt</span><span class='ignore'>{</span><span class='ignore'>umop</span><span class='ignore'>}</span><span class='ignore'>/</span><span class='ignore'>rs2</span><span class='ignore'>/</span><span class='ignore'>vs2</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>5</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>rs1</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>3</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>width</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>5</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>vd</span><span class='ignore'>}</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\mcb</span><span class='ignore'>{</span><span class='ignore'>7</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>Opcode</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\hline</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabularx}</span><span class='cumsum'> [422]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='ignore'>Floating-point</span> <span class='ignore'>and</span> <span class='ignore'>Vector</span> <span class='ignore'>load</span><span class='ignore'>/</span><span class='ignore'>store</span> <span class='ignore'>encoding</span><span class='ignore'>}</span><span class='cumsum'> [422]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>fix</span><span class='ignore'>}</span><span class='cumsum'> [422]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [422]</span><br>
<span class='cumsum'> [422]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Fast-path</span> <span class='hword'>checking</span> <span class='hword'>phase</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>checking</span><span class='ignore'>}</span><span class='cumsum'> [425]</span><br>
<span class='word'>The</span> <span class='word'>initial</span> <span class='word'>motivation</span> <span class='word'>for</span> <span class='word'>this</span> <span class='word'>project</span> <span class='word'>was</span> <span class='word'>investigating</span> <span class='word'>the</span> <span class='word'>impact</span> <span class='word'>of</span> <span class='word'>capability</span> <span class='word'>checks</span> <span class='word'>on</span> <span class='word'>performance</span><span class='ignore'>.</span><span class='cumsum'> [440]</span><br>
<span class='word'>Rather</span> <span class='word'>than</span> <span class='word'>check</span> <span class='word'>each</span> <span class='word'>element's</span> <span class='word'>access</span> <span class='word'>individually</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>determine</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>fast-path</span><span class='ignore'>}</span> <span class='word'>checks</span> <span class='word'>which</span> <span class='word'>count</span> <span class='word'>as</span> <span class='word'>checks</span> <span class='word'>for</span> <span class='word'>multiple</span> <span class='word'>elements</span> <span class='word'>at</span> <span class='word'>once</span><span class='ignore'>.</span><span class='cumsum'> [463]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>emulator</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>is</span> <span class='word'>done</span> <span class='word'>by</span> <span class='word'>computing</span> <span class='word'>the</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>tight</span> <span class='word'>bounds</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>exact</span> <span class='word'>range</span> <span class='word'>of</span> <span class='word'>bytes</span> <span class='word'>that</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>accessed</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>doing</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>capability</span> <span class='word'>check</span> <span class='word'>with</span> <span class='word'>that</span> <span class='word'>bounds</span><span class='ignore'>.</span><span class='cumsum'> [496]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>fastpath</span><span class='ignore'>}</span> <span class='word'>describes</span> <span class='word'>methods</span> <span class='word'>for</span> <span class='word'>calculating</span> <span class='word'>the</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>tight</span> <span class='word'>bounds</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>type</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>ways</span> <span class='word'>that</span> <span class='word'>architectural</span> <span class='word'>complexity</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>traded</span> <span class='word'>off</span> <span class='word'>to</span> <span class='word'>calculate</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>wider</span><span class='ignore'>}</span> <span class='word'>bounds</span><span class='ignore'>.</span><span class='cumsum'> [520]</span><br>
<span class='cumsum'> [520]</span><br>
<span class='comment'>% We investigate an approach using a \enquote{fast-path}, where certain instructions could check their whole access range against a capability immediately rather than check each individual element.</span><span class='cumsum'> [520]</span><br>
<span class='comment'>% Other approaches, such as optimizing a parallel checker for $n$ elements, were too hardware-specific and couldn't be modelled in software as well.</span><span class='cumsum'> [520]</span><br>
<span class='comment'>% \cref{chap:hardware:sec:fastpath} describes methods for calculating the \enquote{tight bounds} for each access type, i.e. the minimum range of bytes that must be accessible, and ways that architectural complexity can be traded off to calculate \emph{wider} bounds.</span><span class='cumsum'> [520]</span><br>
<span class='cumsum'> [520]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>don't</span> <span class='word'>pass</span> <span class='word'>the</span> <span class='word'>capability</span> <span class='word'>check</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>raises</span> <span class='word'>an</span> <span class='word'>imprecise</span> <span class='word'>trap</span> <span class='word'>and</span> <span class='word'>stops</span> <span class='word'>immediately</span><span class='ignore'>.</span><span class='cumsum'> [538]</span><br>
<span class='word'>In</span> <span class='word'>the</span> <span class='word'>case</span> <span class='word'>of</span> <span class='word'>fault-only-first</span> <span class='word'>loads</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>synchronous</span> <span class='word'>exceptions</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>capability</span> <span class='word'>checks</span><span class='ignore'>)</span> <span class='word'>are</span> <span class='word'>explicitly</span> <span class='word'>handled</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>access</span> <span class='word'>continues</span> <span class='word'>regardless</span> <span class='word'>and</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>checked</span> <span class='word'>individually</span><span class='ignore'>.</span><span class='cumsum'> [562]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>the</span> <span class='word'>expected</span> <span class='word'>behaviour</span> <span class='word'>if</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>check</span> <span class='word'>for</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>wider</span><span class='ignore'>}</span> <span class='word'>bounds</span> <span class='word'>fails</span><span class='ignore'>.</span><span class='cumsum'> [576]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>deviates</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>spec</span> <span class='word'>in</span> <span class='word'>that</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>not</span><span class='ignore'>}</span> <span class='word'>set</span> <span class='word'>when</span> <span class='word'>the</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>check</span> <span class='word'>fails</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>it</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>know</span> <span class='word'>exactly</span> <span class='word'>which</span> <span class='word'>element</span> <span class='word'>would</span> <span class='word'>have</span> <span class='word'>triggered</span> <span class='word'>the</span> <span class='word'>exception</span><span class='ignore'>.</span><span class='cumsum'> [607]</span><br>
<span class='word'>As</span> <span class='word'>noted</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>fastpath</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>fully</span> <span class='word'>compliant</span> <span class='word'>machine</span> <span class='word'>must</span> <span class='word'>check</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>to</span> <span class='word'>find</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>in</span> <span class='word'>these</span> <span class='word'>cases</span><span class='ignore'>.</span><span class='cumsum'> [624]</span><br>
<span class='cumsum'> [624]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Execution</span> <span class='hword'>phase</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>execution</span><span class='ignore'>}</span><span class='cumsum'> [626]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>deems</span> <span class='word'>it</span> <span class='word'>appropriate</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>continues</span> <span class='word'>execution</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>instruction</span> <span class='word'>in</span> <span class='word'>two</span> <span class='word'>phases</span><span class='ignore'>.</span><span class='cumsum'> [643]</span><br>
<span class='word'>First</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>mapping</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>elements</span> <span class='word'>to</span> <span class='word'>accessed</span> <span class='word'>memory</span> <span class='word'>addresses</span> <span class='word'>is</span> <span class='word'>found</span><span class='ignore'>.</span><span class='cumsum'> [655]</span><br>
<span class='word'>The</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>this</span> <span class='word'>step</span> <span class='word'>is</span> <span class='word'>independent</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>access</span> <span class='word'>direction</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>an</span> <span class='word'>effective</span> <span class='word'>description</span> <span class='word'>of</span> <span class='word'>how</span> <span class='word'>each</span> <span class='word'>type</span> <span class='word'>of</span> <span class='word'>access</span> <span class='word'>works</span><span class='ignore'>.</span><span class='cumsum'> [677]</span><br>
<span class='word'>It</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>found</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>appx</span><span class='ignore'>:</span><span class='ignore'>code</span><span class='ignore'>:</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>access</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [682]</span><br>
<span class='word'>The</span> <span class='word'>previously</span> <span class='word'>computed</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>are</span> <span class='word'>sanity-checked</span> <span class='word'>against</span> <span class='word'>these</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>actually</span> <span class='word'>performed</span><span class='ignore'>.</span><span class='cumsum'> [698]</span><br>
<span class='cumsum'> [698]</span><br>
<span class='cmd'>\subsubsection</span><span class='ignore'>{</span><span class='hword'>Integer</span> <span class='hword'>vs</span><span class='ignore'>.</span> <span class='hword'>Capability</span> <span class='hword'>encoding</span> <span class='hword'>mode</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>int</span><span class='ignore'>_</span><span class='ignore'>mode</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [703]</span><br>
<span class='word'>As</span> <span class='word'>noted</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cheriencodingmode</span><span class='ignore'>}</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>defines</span> <span class='word'>two</span> <span class='word'>execution</span> <span class='word'>modes</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>can</span> <span class='word'>switch</span> <span class='word'>between</span><span class='ignore'>.</span><span class='cumsum'> [717]</span><br>
<span class='word'>In</span> <span class='word'>Integer</span> <span class='word'>mode</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>address</span> <span class='word'>operands</span> <span class='word'>to</span> <span class='word'>existing</span> <span class='word'>RISC-V</span> <span class='word'>load</span> <span class='word'>and</span> <span class='word'>store</span> <span class='word'>opcodes</span> <span class='word'>contain</span> <span class='word'>integer</span> <span class='word'>addresses</span><span class='ignore'>}</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>implicitly</span> <span class='word'>dereferenced</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>default</span> <span class='word'>data</span> <span class='word'>capability</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>in</span> <span class='word'>Capability</span> <span class='word'>mode</span> <span class='word'>those</span> <span class='word'>opcodes</span> <span class='word'>are</span> <span class='word'>modified</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>capability</span> <span class='word'>operands</span><span class='ignore'>.</span><span class='cumsum'> [754]</span><br>
<span class='word'>Integer</span> <span class='word'>mode</span> <span class='word'>was</span> <span class='word'>included</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>interests</span> <span class='word'>of</span> <span class='word'>maintaining</span> <span class='word'>compatibility</span> <span class='word'>with</span> <span class='word'>legacy</span> <span class='word'>code</span> <span class='word'>that</span> <span class='word'>hasn't</span> <span class='word'>been</span> <span class='word'>adapted</span> <span class='word'>to</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [773]</span><br>
<span class='word'>As</span> <span class='word'>similar</span> <span class='word'>vector</span> <span class='word'>code</span> <span class='word'>may</span> <span class='word'>also</span> <span class='word'>exist</span><span class='ignore'>,</span> <span class='word'>CHERI-RVV</span> <span class='word'>treats</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>as</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>existing</span> <span class='word'>RISC-V</span> <span class='word'>load</span> <span class='word'>and</span> <span class='word'>store</span> <span class='word'>opcodes</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>requires</span> <span class='word'>that</span> <span class='word'>they</span> <span class='word'>respect</span> <span class='word'>integer</span><span class='ignore'>/</span><span class='word'>capability</span> <span class='word'>mode</span><span class='ignore'>.</span><span class='cumsum'> [801]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/sub20_emu_vec.tex</span><span class='cumsum'> [801]</span><br>
<span class='cumsum'> [801]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_25EmulationInvestigation/sub30_fast_path}</span><span class='cumsum'> [801]</span><br>
<span class='cumsum'> [801]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/sub30_fast_path.tex</span><span class='cumsum'> [801]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Fast-path</span> <span class='hword'>calculations</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>fastpath</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>A</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>over</span> <span class='word'>various</span> <span class='word'>sets</span> <span class='word'>of</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [13]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>chooses</span> <span class='word'>to</span> <span class='word'>perform</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>vector</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>calculating</span> <span class='word'>the</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>before</span> <span class='word'>starting</span> <span class='word'>the</span> <span class='word'>actual</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>in</span> <span class='word'>hardware</span> <span class='word'>this</span> <span class='word'>may</span> <span class='word'>introduce</span> <span class='word'>prohibitive</span> <span class='word'>latency</span><span class='ignore'>.</span><span class='cumsum'> [43]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>describes</span> <span class='word'>the</span> <span class='word'>general</span> <span class='word'>principles</span> <span class='word'>surrounding</span> <span class='word'>fast-paths</span> <span class='word'>for</span> <span class='word'>CHERI-RVV</span><span class='ignore'>,</span> <span class='word'>notes</span> <span class='word'>the</span> <span class='word'>areas</span> <span class='word'>where</span> <span class='word'>whole-access</span> <span class='word'>fast-paths</span> <span class='word'>are</span> <span class='word'>difficult</span> <span class='word'>to</span> <span class='word'>calculate</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>describes</span> <span class='word'>possible</span> <span class='word'>approaches</span> <span class='word'>for</span> <span class='word'>hardware</span><span class='ignore'>.</span><span class='cumsum'> [69]</span><br>
<span class='cumsum'> [69]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Possible</span> <span class='hword'>fast-path</span> <span class='hword'>outcomes</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>In</span> <span class='word'>some</span> <span class='word'>cases</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>failed</span> <span class='word'>address</span> <span class='word'>range</span> <span class='word'>check</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>mean</span> <span class='word'>the</span> <span class='word'>access</span> <span class='word'>fails</span><span class='ignore'>.</span><span class='cumsum'> [17]</span><br>
<span class='word'>The</span> <span class='word'>obvious</span> <span class='word'>case</span> <span class='word'>is</span> <span class='word'>fault-only-first</span> <span class='word'>loads</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>capability</span> <span class='word'>exceptions</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>handled</span> <span class='word'>without</span> <span class='word'>triggering</span> <span class='word'>a</span> <span class='word'>trap</span><span class='ignore'>.</span><span class='cumsum'> [33]</span><br>
<span class='word'>Implementations</span> <span class='word'>may</span> <span class='word'>also</span> <span class='word'>choose</span> <span class='word'>to</span> <span class='word'>calculate</span> <span class='word'>wider</span> <span class='word'>bounds</span> <span class='word'>than</span> <span class='word'>accessed</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>sake</span> <span class='word'>of</span> <span class='word'>simplicity</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>even</span> <span class='word'>forego</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>altogether</span><span class='ignore'>.</span><span class='cumsum'> [55]</span><br>
<span class='word'>Thus</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>can</span> <span class='word'>have</span> <span class='word'>four</span> <span class='word'>outcomes</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>circumstances</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='cumsum'> [67]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[t]</span><span class='cumsum'> [67]</span><br>
<span class='exclenv'>\begin</span><span class='exclenv'>{subtable}</span><span class='ignore'>{</span><span class='ignore'>0.5</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [67]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>ll</span><span class='ignore'>}</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Success</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='ignore'>accesses</span> <span class='ignore'>will</span> <span class='ignore'>succeed</span> <span class='exclcmd'>\\</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Failure</span> <span class='ignore'>&amp;</span> <span class='ignore'>At</span> <span class='ignore'>least</span> <span class='ignore'>one</span> <span class='ignore'>access</span> <span class='exclcmd'>\emph</span><span class='ignore'>{</span><span class='ignore'>will</span><span class='ignore'>}</span><span class='exclcmd'>\\</span><span class='ignore'>&amp;</span> <span class='ignore'>raise</span> <span class='ignore'>an</span> <span class='ignore'>exception</span> <span class='exclcmd'>\\</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Likely-Failure</span> <span class='ignore'>&amp;</span> <span class='ignore'>At</span> <span class='ignore'>least</span> <span class='ignore'>one</span> <span class='ignore'>access</span> <span class='exclcmd'>\emph</span><span class='ignore'>{</span><span class='ignore'>may</span><span class='ignore'>}</span> <span class='exclcmd'>\\</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\emph</span><span class='ignore'>{</span><span class='ignore'>or</span><span class='ignore'>}</span> <span class='ignore'>Unchecked</span> <span class='ignore'>&amp;</span> <span class='ignore'>raise</span> <span class='ignore'>an</span> <span class='ignore'>exception</span> <span class='exclcmd'>\\</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [67]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [67]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Possible</span> <span class='oword'>fast-path</span> <span class='oword'>outcomes</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{subtable}</span><span class='comment'>%</span><span class='cumsum'> [70]</span><br>
<span class='exclcmd'>\hfill</span><span class='comment'>%</span><span class='cumsum'> [70]</span><br>
<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='ignore'>{</span><span class='ignore'>0.45</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{algorithmic}</span><span class='cumsum'> [70]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\If</span><span class='ignore'>{</span><span class='ignore'>can</span> <span class='ignore'>calculate</span> <span class='ignore'>range</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\If</span><span class='ignore'>{</span><span class='ignore'>range</span> <span class='ignore'>is</span> <span class='ignore'>within</span> <span class='ignore'>capability</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\State</span> <span class='ignore'>Success</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\ElsIf</span><span class='ignore'>{</span><span class='ignore'>range</span> <span class='ignore'>is</span> <span class='ignore'>wide</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\State</span> <span class='ignore'>Likely-Failure</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\ElsIf</span><span class='ignore'>{</span><span class='ignore'>fault-only-first</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\State</span> <span class='ignore'>Likely-Failure</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\Else</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\State</span> <span class='ignore'>Failure</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\EndIf</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\Else</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\State</span> <span class='ignore'>Unchecked</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\EndIf</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{algorithmic}</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Algorithm</span><span class='ignore'>}</span><span class='cumsum'> [71]</span><br>
<span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [71]</span><br>
<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Fast-path</span> <span class='oword'>outcomes</span><span class='ignore'>}</span><span class='cumsum'> [73]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [73]</span><br>
<span class='cumsum'> [73]</span><br>
<span class='word'>A</span> <span class='word'>Success</span> <span class='word'>means</span> <span class='word'>no</span> <span class='word'>per-access</span> <span class='word'>capability</span> <span class='word'>checks</span> <span class='word'>are</span> <span class='word'>required</span><span class='ignore'>.</span><span class='cumsum'> [82]</span><br>
<span class='word'>Likely-Failure</span> <span class='word'>and</span> <span class='word'>Unchecked</span> <span class='word'>results</span> <span class='word'>mean</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>checked</span><span class='ignore'>,</span> <span class='word'>to</span> <span class='word'>see</span> <span class='word'>if</span> <span class='word'>any</span> <span class='word'>of</span> <span class='word'>them</span> <span class='word'>actually</span> <span class='word'>raise</span> <span class='word'>an</span> <span class='word'>exception</span><span class='ignore'>.</span><span class='cumsum'> [102]</span><br>
<span class='word'>Unfortunately</span><span class='ignore'>,</span> <span class='word'>accesses</span> <span class='word'>still</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>checked</span> <span class='word'>under</span> <span class='word'>Failure</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>both</span> <span class='word'>precise</span> <span class='word'>and</span> <span class='word'>imprecise</span> <span class='word'>traps</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>report</span> <span class='word'>the</span> <span class='word'>offending</span> <span class='word'>element</span> <span class='word'>in</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>In</span> <span class='oword'>very</span> <span class='oword'>particular</span> <span class='oword'>cases</span><span class='ignore'>,</span> <span class='oword'>e.g</span><span class='ignore'>.</span> <span class='oword'>unmasked</span> <span class='oword'>unit-strided</span> <span class='oword'>accesses</span> <span class='oword'>where</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>nf</span> <span class='ignore'>=</span> <span class='oword'>1</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='oword'>the</span> <span class='oword'>capability</span> <span class='oword'>bounds</span> <span class='oword'>could</span> <span class='oword'>be</span> <span class='oword'>used</span> <span class='oword'>to</span> <span class='oword'>calculate</span> <span class='oword'>what</span> <span class='oword'>the</span> <span class='oword'>offending</span> <span class='oword'>element</span> <span class='oword'>must</span> <span class='oword'>have</span> <span class='oword'>been</span><span class='ignore'>.</span> <span class='oword'>We</span> <span class='oword'>believe</span> <span class='oword'>this</span> <span class='oword'>is</span> <span class='oword'>too</span> <span class='oword'>niche</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>use</span> <span class='oword'>case</span> <span class='oword'>to</span> <span class='oword'>investigate</span> <span class='oword'>further</span><span class='ignore'>,</span> <span class='oword'>particularly</span> <span class='oword'>given</span> <span class='oword'>the</span> <span class='oword'>complexity</span> <span class='oword'>of</span> <span class='oword'>the</span> <span class='oword'>resulting</span> <span class='oword'>hardware</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [172]</span><br>
<span class='cumsum'> [172]</span><br>
<span class='word'>Because</span> <span class='word'>all</span> <span class='word'>archetypes</span> <span class='word'>may</span> <span class='word'>have</span> <span class='word'>Failure</span> <span class='word'>or</span> <span class='word'>Likely-Failure</span> <span class='word'>outcomes</span><span class='ignore'>,</span> <span class='word'>hardware</span> <span class='word'>must</span> <span class='word'>provide</span> <span class='word'>a</span> <span class='word'>fallback</span> <span class='word'>slow-path</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>archetype</span> <span class='word'>which</span> <span class='word'>checks</span><span class='ignore'>/</span><span class='word'>performs</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>in</span> <span class='word'>turn</span><span class='ignore'>.</span><span class='cumsum'> [197]</span><br>
<span class='word'>In</span> <span class='word'>theory</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>CHERI-RVV</span> <span class='word'>specification</span> <span class='word'>could</span> <span class='word'>relax</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>requirement</span> <span class='word'>for</span> <span class='word'>imprecise</span> <span class='word'>traps</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>state</span> <span class='word'>that</span> <span class='word'>all</span> <span class='word'>capability</span> <span class='word'>exceptions</span> <span class='word'>trigger</span> <span class='word'>imprecise</span> <span class='word'>traps</span><span class='ignore'>.</span><span class='cumsum'> [219]</span><br>
<span class='word'>In</span> <span class='word'>this</span> <span class='word'>case</span><span class='ignore'>,</span> <span class='word'>only</span> <span class='word'>archetypes</span> <span class='word'>that</span> <span class='word'>produce</span> <span class='word'>Likely-Failure</span> <span class='word'>outcomes</span> <span class='word'>need</span> <span class='word'>the</span> <span class='word'>slow-path</span><span class='ignore'>.</span><span class='cumsum'> [231]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>likely</span> <span class='word'>that</span> <span class='word'>for</span> <span class='word'>complexity</span> <span class='word'>reasons</span> <span class='word'>all</span> <span class='word'>masked</span> <span class='word'>accesses</span> <span class='word'>will</span> <span class='word'>use</span> <span class='word'>wide</span> <span class='word'>ranges</span><span class='ignore'>,</span> <span class='word'>thus</span> <span class='word'>producing</span> <span class='word'>Likely-Failure</span> <span class='word'>outcomes</span> <span class='word'>and</span> <span class='word'>requiring</span> <span class='word'>slow-paths</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>archetypes</span> <span class='word'>anyway</span><span class='ignore'>.</span><span class='cumsum'> [257]</span><br>
<span class='word'>Because</span> <span class='word'>the</span> <span class='word'>Likely-Failure</span> <span class='word'>and</span> <span class='word'>Failure</span> <span class='word'>cases</span> <span class='word'>require</span> <span class='word'>the</span> <span class='word'>slow-path</span> <span class='word'>anyway</span><span class='ignore'>,</span> <span class='word'>computing</span> <span class='word'>the</span> <span class='word'>fast-path</span> <span class='word'>can</span> <span class='word'>only</span> <span class='word'>be</span> <span class='word'>worthwhile</span> <span class='word'>if</span> <span class='word'>Success</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>common</span> <span class='word'>case</span><span class='ignore'>.</span><span class='cumsum'> [280]</span><br>
<span class='cumsum'> [280]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Whole-access</span> <span class='hword'>fast-paths</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>wholeaccessfastpath</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>technically</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>calculate</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>entirety</span> <span class='word'>of</span> <span class='word'>an</span> <span class='word'>access</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>appx</span><span class='ignore'>:</span><span class='ignore'>fastpathfull</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>for</span> <span class='word'>some</span> <span class='word'>situations</span> <span class='word'>it</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>equally</span><span class='ignore'>/</span><span class='word'>more</span> <span class='word'>expensive</span> <span class='word'>than</span> <span class='word'>checking</span> <span class='word'>each</span> <span class='word'>access</span><span class='ignore'>.</span><span class='cumsum'> [31]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>bounds</span> <span class='word'>for</span> <span class='word'>masked</span> <span class='word'>accesses</span> <span class='word'>depend</span> <span class='word'>on</span> <span class='word'>finding</span> <span class='word'>the</span> <span class='word'>minimum</span> <span class='word'>and</span> <span class='word'>maximum</span> <span class='word'>active</span> <span class='word'>indices</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>in</span> <span class='word'>hardware</span> <span class='word'>may</span> <span class='word'>require</span> <span class='word'>a</span> <span class='word'>linear</span> <span class='word'>scan</span><span class='ignore'>.</span><span class='cumsum'> [55]</span><br>
<span class='word'>Indexed</span> <span class='word'>accesses</span> <span class='word'>require</span> <span class='word'>finding</span> <span class='word'>the</span> <span class='word'>minimum</span><span class='ignore'>/</span><span class='word'>maximum</span> <span class='word'>offset</span> <span class='word'>values</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>likely</span> <span class='word'>requires</span> <span class='word'>an</span> <span class='word'>expensive</span> <span class='word'>parallel</span> <span class='word'>reduction</span> <span class='word'>over</span> <span class='word'>all</span><span class='ignore'>/</span><span class='word'>some</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [75]</span><br>
<span class='word'>In</span> <span class='word'>these</span> <span class='word'>cases</span> <span class='word'>hardware</span> <span class='word'>implementations</span> <span class='word'>could</span> <span class='word'>defer</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>slow-path</span> <span class='word'>on</span> <span class='word'>all</span> <span class='word'>masked</span><span class='ignore'>/</span><span class='word'>indexed</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>for</span> <span class='word'>masked</span> <span class='word'>accesses</span> <span class='word'>use</span> <span class='word'>the</span> <span class='word'>wider</span><span class='ignore'>,</span> <span class='word'>unmasked</span> <span class='word'>bounds</span> <span class='word'>and</span> <span class='word'>generate</span> <span class='word'>Likely-Failure</span> <span class='word'>outcomes</span><span class='ignore'>.</span><span class='cumsum'> [103]</span><br>
<span class='word'>Unit</span> <span class='word'>and</span> <span class='word'>strided</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>much</span> <span class='word'>easier</span> <span class='word'>to</span> <span class='word'>handle</span><span class='ignore'>.</span><span class='cumsum'> [112]</span><br>
<span class='cumsum'> [112]</span><br>
<span class='word'>Arbitrarily</span> <span class='word'>strided</span> <span class='word'>accesses</span> <span class='ignore'>(</span><span class='word'>which</span> <span class='word'>may</span> <span class='word'>have</span> <span class='word'>positive</span><span class='ignore'>,</span> <span class='word'>negative</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>zero-valued</span> <span class='word'>strides</span><span class='ignore'>)</span> <span class='word'>are</span> <span class='word'>relatively</span> <span class='word'>simple</span> <span class='word'>to</span> <span class='word'>calculate</span><span class='ignore'>.</span><span class='cumsum'> [128]</span><br>
<span class='word'>After</span> <span class='word'>calculating</span> <span class='word'>the</span> <span class='word'>segment</span> <span class='word'>width</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='mathgroup'>$</span><span class='mathcmd'>\text</span><span class='ignore'>{</span><span class='math'>number</span> <span class='math'>of</span> <span class='math'>fields</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\text</span><span class='ignore'>{</span><span class='math'>element</span> <span class='math'>width</span><span class='ignore'>}</span><span class='mathgroup'>$</span><span class='ignore'>)</span> <span class='word'>the</span> <span class='word'>full</span> <span class='word'>bounds</span> <span class='word'>just</span> <span class='word'>depends</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>sign</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>stride</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>eq</span><span class='ignore'>:</span><span class='ignore'>tightboundsstrided</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [146]</span><br>
<span class='word'>Unit-stride</span> <span class='word'>accesses</span> <span class='word'>simplify</span> <span class='word'>this</span> <span class='word'>further</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>the</span> <span class='word'>stride</span> <span class='word'>is</span> <span class='word'>equal</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>segment</span> <span class='word'>width</span> <span class='word'>and</span> <span class='word'>guaranteed</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>positive</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>eq</span><span class='ignore'>:</span><span class='ignore'>tightboundsunit</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [165]</span><br>
<span class='cumsum'> [165]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\vstart</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>\code</span><span class='ignore'>{</span><span class='ignore'>vstart</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [165]</span><br>
<span class='comment'>% \newcommand{\vstartactive}{\code{vstart}_{\mathit{active}}}</span><span class='cumsum'> [165]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\vstartactive</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>\code</span><span class='ignore'>{</span><span class='ignore'>vstart</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [165]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\evl</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>\code</span><span class='ignore'>{</span><span class='ignore'>evl</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [165]</span><br>
<span class='comment'>% \newcommand{\evlactive}{\code{evl}_{\mathit{active}}}</span><span class='cumsum'> [165]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\evlactive</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>\code</span><span class='ignore'>{</span><span class='ignore'>evl</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [165]</span><br>
<span class='cmd'>\newcommand</span><span class='ignore'>{</span><span class='ignore'>\baseaddr</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>\code</span><span class='ignore'>{</span><span class='ignore'>base</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [165]</span><br>
<span class='cumsum'> [165]</span><br>
<span class='envir'>\begin</span><span class='envir'>{mycapequ}</span><span class='option'>[!ht]</span><span class='cumsum'> [165]</span><br>
<span class='cumsum'> [165]</span><br>
<span class='envir'>\begin</span><span class='envir'>{equation}</span><span class='mathcmd'>\label</span><span class='ignore'>{</span><span class='math'>eq</span><span class='math'>:</span><span class='math'>tightboundsstrided</span><span class='ignore'>}</span><span class='cumsum'> [166]</span><br>
<span class='mathcmd'>\baseaddr</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='mathcmd'>\ </span><span class='math'>+</span><span class='mathcmd'>\ </span><span class='exclenv'>\begin</span><span class='exclenv'>{cases}</span><span class='cumsum'> [166]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>[</span><span class='mathcmd'>\vstartactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span><span class='math'>,</span> <span class='math'>(</span><span class='mathcmd'>\evlactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>-</span> <span class='math'>1</span><span class='math'>)</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span> <span class='math'>+</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>nf</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>eew</span><span class='ignore'>}</span><span class='math'>)</span><span class='ignore'>}</span> <span class='math'>&amp;</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span> <span class='mathcmd'>\ge</span> <span class='math'>0</span> <span class='mathcmd'>\\</span><span class='cumsum'> [166]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='cumsum'> [166]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>[</span><span class='math'>(</span><span class='mathcmd'>\evlactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>-</span> <span class='math'>1</span><span class='math'>)</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span><span class='math'>,</span> <span class='mathcmd'>\vstartactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span> <span class='math'>+</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>nf</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>eew</span><span class='ignore'>}</span><span class='math'>)</span><span class='ignore'>}</span> <span class='math'>&amp;</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>stride</span><span class='ignore'>}</span> <span class='math'>&lt;</span> <span class='math'>0</span><span class='cumsum'> [166]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{cases}</span><span class='cumsum'> [166]</span><br>
<span class='envir'>\end</span><span class='envir'>{equation}</span><span class='cumsum'> [166]</span><br>
<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Tight</span> <span class='oword'>bounds</span> <span class='oword'>for</span> <span class='oword'>strided</span> <span class='oword'>access</span><span class='ignore'>}</span><span class='cumsum'> [171]</span><br>
<span class='envir'>\end</span><span class='envir'>{mycapequ}</span><span class='cumsum'> [171]</span><br>
<span class='cumsum'> [171]</span><br>
<span class='envir'>\begin</span><span class='envir'>{mycapequ}</span><span class='option'>[!ht]</span><span class='cumsum'> [171]</span><br>
<span class='envir'>\begin</span><span class='envir'>{equation}</span><span class='mathcmd'>\label</span><span class='ignore'>{</span><span class='math'>eq</span><span class='math'>:</span><span class='math'>tightboundsunit</span><span class='ignore'>}</span><span class='cumsum'> [172]</span><br>
&nbsp;&nbsp;<span class='mathcmd'>\baseaddr</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='mathcmd'>\ </span><span class='math'>+</span><span class='mathcmd'>\ </span><span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>[</span><span class='mathcmd'>\vstartactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>nf</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>eew</span><span class='ignore'>}</span><span class='math'>,</span> <span class='mathcmd'>\evlactive</span><span class='ignore'>{</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>nf</span><span class='ignore'>}</span> <span class='math'>*</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>eew</span><span class='ignore'>}</span><span class='math'>)</span><span class='ignore'>}</span><span class='cumsum'> [172]</span><br>
<span class='envir'>\end</span><span class='envir'>{equation}</span><span class='cumsum'> [172]</span><br>
<span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Tight</span> <span class='oword'>bounds</span> <span class='oword'>for</span> <span class='oword'>unit-stride</span> <span class='oword'>access</span><span class='ignore'>}</span><span class='cumsum'> [177]</span><br>
<span class='envir'>\end</span><span class='envir'>{mycapequ}</span><span class='cumsum'> [177]</span><br>
<span class='cumsum'> [177]</span><br>
<span class='word'>Ultimately</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>potential</span> <span class='word'>up-front</span> <span class='word'>latency</span> <span class='word'>seemed</span> <span class='word'>like</span> <span class='word'>a</span> <span class='word'>dealbreaker</span> <span class='word'>for</span> <span class='word'>this</span> <span class='word'>approach</span><span class='ignore'>.</span><span class='cumsum'> [189]</span><br>
<span class='word'>We</span> <span class='word'>turned</span> <span class='word'>our</span> <span class='word'>attention</span> <span class='word'>to</span> <span class='word'>fast-pathing</span> <span class='word'>smaller</span> <span class='word'>groups</span> <span class='word'>of</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [199]</span><br>
<span class='cumsum'> [199]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span><span class='ignore'>-</span><span class='hword'>element</span> <span class='hword'>known-range</span> <span class='hword'>fast-paths</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='word'>A</span> <span class='word'>hardware</span> <span class='word'>implementation</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>unit</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>issue</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>requests</span> <span class='word'>within</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>range</span> <span class='word'>in</span> <span class='word'>parallel</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>elements</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>cache</span> <span class='word'>line</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>accessible</span> <span class='word'>all</span> <span class='word'>at</span> <span class='word'>once</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='word'>In</span> <span class='word'>these</span> <span class='word'>cases</span><span class='ignore'>,</span> <span class='word'>checking</span> <span class='word'>elements</span> <span class='word'>individually</span> <span class='word'>would</span> <span class='word'>either</span> <span class='word'>require</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>parallel</span> <span class='word'>bounds</span> <span class='word'>checks</span><span class='ignore'>,</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>checks</span><span class='ignore'>'</span> <span class='word'>worth</span> <span class='word'>of</span> <span class='word'>latency</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>something</span> <span class='word'>inbetween</span><span class='ignore'>.</span><span class='cumsum'> [59]</span><br>
<span class='word'>In</span> <span class='word'>this</span> <span class='word'>subsection</span> <span class='word'>we</span> <span class='word'>consider</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>for</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>elements</span><span class='ignore'>.</span> <span class='cumsum'> [70]</span><br>
<span class='cumsum'> [70]</span><br>
<span class='comment'>% \todomark{pre-check: permissions}</span><span class='cumsum'> [70]</span><br>
<span class='word'>Capability</span> <span class='word'>checks</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>split</span> <span class='word'>into</span> <span class='word'>two</span> <span class='word'>steps</span><span class='ignore'>:</span> <span class='word'>address-agnostic</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>permissions</span> <span class='word'>checks</span><span class='ignore'>,</span> <span class='word'>bounds</span> <span class='word'>decoding</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>address-dependent</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>bounds</span> <span class='word'>checks</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [89]</span><br>
<span class='word'>Address-agnostic</span> <span class='word'>steps</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>before</span> <span class='word'>any</span> <span class='word'>bounds</span> <span class='word'>checking</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>should</span> <span class='word'>add</span> <span class='word'>minimal</span> <span class='word'>start-up</span> <span class='word'>latency</span> <span class='ignore'>(</span><span class='word'>bounds</span> <span class='word'>decoding</span> <span class='word'>must</span> <span class='word'>complete</span> <span class='word'>before</span> <span class='word'>the</span> <span class='word'>checks</span> <span class='word'>anyway</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>permission</span> <span class='word'>checks</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>in</span> <span class='word'>parallel</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [120]</span><br>
<span class='word'>Once</span> <span class='word'>the</span> <span class='word'>bounds</span> <span class='word'>are</span> <span class='word'>decoded</span> <span class='word'>the</span> <span class='word'>actual</span> <span class='word'>checks</span> <span class='word'>consist</span> <span class='word'>of</span> <span class='word'>minimal</span> <span class='word'>logic</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Likely</span> <span class='oword'>requires</span> <span class='oword'>two</span> <span class='oword'>arithmetic</span> <span class='oword'>operations</span> <span class='oword'>per</span> <span class='oword'>element</span><span class='ignore'>,</span> <span class='oword'>for</span> <span class='oword'>checking</span> <span class='oword'>against</span> <span class='oword'>the</span> <span class='oword'>top</span> <span class='oword'>and</span> <span class='oword'>bottom</span> <span class='oword'>bounds</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>must</span> <span class='word'>have</span> <span class='word'>very</span> <span class='word'>minimal</span> <span class='word'>logic</span> <span class='word'>to</span> <span class='word'>compete</span><span class='ignore'>.</span><span class='cumsum'> [157]</span><br>
<span class='cumsum'> [157]</span><br>
<span class='word'>We</span> <span class='word'>first</span> <span class='word'>consider</span> <span class='word'>unit</span> <span class='word'>and</span> <span class='word'>strided</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>note</span> <span class='word'>two</span> <span class='word'>approaches</span><span class='ignore'>.</span><span class='cumsum'> [168]</span><br>
<span class='word'>First</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>could</span> <span class='word'>amortize</span> <span class='word'>the</span> <span class='word'>checking</span> <span class='word'>logic</span> <span class='word'>cost</span> <span class='word'>over</span> <span class='word'>multiple</span> <span class='word'>sets</span> <span class='word'>of</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>elements</span> <span class='word'>by</span> <span class='word'>operating</span> <span class='word'>in</span> <span class='word'>terms</span> <span class='word'>of</span> <span class='word'>cache</span> <span class='word'>lines</span><span class='ignore'>.</span><span class='cumsum'> [189]</span><br>
<span class='word'>Iterating</span> <span class='word'>through</span> <span class='word'>all</span> <span class='word'>accessed</span> <span class='word'>cache</span> <span class='word'>lines</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>then</span> <span class='word'>iterating</span> <span class='word'>over</span> <span class='word'>the</span> <span class='word'>elements</span> <span class='word'>inside</span><span class='ignore'>,</span> <span class='word'>allows</span> <span class='word'>the</span> <span class='word'>fast-path</span> <span class='word'>to</span> <span class='word'>hardcode</span> <span class='word'>the</span> <span class='word'>bounds</span> <span class='word'>width</span> <span class='word'>and</span> <span class='word'>do</span> <span class='word'>one</span> <span class='word'>check</span> <span class='word'>for</span> <span class='word'>multiple</span> <span class='word'>cycles</span> <span class='word'>of</span> <span class='word'>work</span> <span class='ignore'>(</span><span class='word'>if</span> <span class='word'>cache</span> <span class='word'>lines</span> <span class='word'>contain</span> <span class='word'>more</span> <span class='word'>than</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>elements</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [227]</span><br>
<span class='word'>Cache-line-aligned</span> <span class='word'>allocations</span> <span class='word'>benefit</span> <span class='word'>here</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>all</span> <span class='word'>fast-path</span> <span class='word'>checks</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>in-bounds</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>Successful</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>misaligned</span> <span class='word'>data</span> <span class='word'>is</span> <span class='word'>guaranteed</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>at</span> <span class='word'>least</span> <span class='word'>one</span> <span class='word'>Likely-Failure</span> <span class='word'>outcome</span> <span class='word'>per</span> <span class='word'>access</span> <span class='ignore'>(</span><span class='word'>requiring</span> <span class='word'>a</span> <span class='word'>slow-path</span> <span class='word'>check</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [258]</span><br>
<span class='word'>Calculating</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>for</span> <span class='word'>the</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>accessed</span> <span class='word'>elements</span> <span class='word'>per</span> <span class='word'>cycle</span> <span class='word'>could</span> <span class='word'>address</span> <span class='word'>this</span><span class='ignore'>.</span><span class='cumsum'> [271]</span><br>
<span class='cumsum'> [271]</span><br>
<span class='comment'>% \todomark{unit/strided: by $m$ elements?}</span><span class='cumsum'> [271]</span><br>
<span class='word'>For</span> <span class='word'>unit</span> <span class='word'>and</span> <span class='word'>strided</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>bounds</span> <span class='word'>occupied</span> <span class='word'>by</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>elements</span> <span class='word'>is</span> <span class='word'>straightforward</span> <span class='word'>to</span> <span class='word'>calculate</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>addresses</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>generated</span> <span class='word'>in</span> <span class='word'>order</span><span class='ignore'>.</span><span class='cumsum'> [294]</span><br>
<span class='word'>The</span> <span class='word'>minimum</span> <span class='word'>and</span> <span class='word'>maximum</span> <span class='word'>can</span> <span class='word'>then</span> <span class='word'>be</span> <span class='word'>picked</span> <span class='word'>easily</span> <span class='word'>to</span> <span class='word'>generate</span> <span class='word'>tight</span> <span class='word'>bounds</span><span class='ignore'>.</span><span class='cumsum'> [307]</span><br>
<span class='word'>An</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span><span class='ignore'>-</span><span class='word'>way</span> <span class='word'>multiplexer</span> <span class='word'>is</span> <span class='word'>still</span> <span class='word'>required</span> <span class='word'>for</span> <span class='word'>taking</span> <span class='word'>the</span> <span class='word'>minimum</span> <span class='word'>and</span> <span class='word'>maximum</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>evl</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>be</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span><span class='ignore'>-</span><span class='word'>aligned</span><span class='ignore'>.</span><span class='cumsum'> [329]</span><br>
<span class='word'>If</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>is</span> <span class='word'>small</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>also</span> <span class='word'>neatly</span> <span class='word'>extends</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>masked</span><span class='ignore'>/</span><span class='word'>inactive</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [342]</span><br>
<span class='word'>This</span> <span class='word'>may</span> <span class='word'>use</span> <span class='word'>less</span> <span class='word'>logic</span> <span class='word'>overall</span> <span class='word'>than</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>parallel</span> <span class='word'>bounds</span> <span class='word'>checks</span><span class='ignore'>,</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>hardware</span> <span class='word'>platform</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>e.g</span><span class='ignore'>.</span> <span class='oword'>on</span> <span class='oword'>FPGAs</span> <span class='oword'>multiplexers</span> <span class='oword'>can</span> <span class='oword'>be</span> <span class='oword'>relatively</span> <span class='oword'>cheap</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>it</span> <span class='word'>definitely</span> <span class='word'>uses</span> <span class='word'>more</span> <span class='word'>logic</span> <span class='word'>than</span> <span class='word'>the</span> <span class='word'>cache-line</span> <span class='word'>approach</span><span class='ignore'>.</span><span class='cumsum'> [376]</span><br>
<span class='word'>Clearly</span><span class='ignore'>,</span> <span class='word'>there's</span> <span class='word'>a</span> <span class='word'>trade-off</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>made</span><span class='ignore'>.</span><span class='cumsum'> [383]</span><br>
<span class='cumsum'> [383]</span><br>
<span class='word'>Indexed</span> <span class='word'>fast-paths</span> <span class='word'>are</span> <span class='word'>more</span> <span class='word'>complicated</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>the</span> <span class='word'>addresses</span> <span class='word'>are</span> <span class='word'>unsorted</span><span class='ignore'>.</span><span class='cumsum'> [393]</span><br>
<span class='word'>The</span> <span class='word'>two</span> <span class='word'>approaches</span> <span class='word'>above</span> <span class='word'>have</span> <span class='word'>different</span> <span class='word'>advantages</span> <span class='word'>for</span> <span class='word'>indexed</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [403]</span><br>
<span class='word'>If</span> <span class='word'>the</span> <span class='word'>offsets</span><span class='ignore'>/</span><span class='word'>indices</span> <span class='word'>are</span> <span class='word'>spatially</span> <span class='word'>close</span><span class='ignore'>,</span> <span class='word'>just</span> <span class='word'>not</span> <span class='word'>sorted</span><span class='ignore'>,</span> <span class='word'>cache</span> <span class='word'>line</span> <span class='word'>checks</span> <span class='word'>may</span> <span class='word'>efficiently</span> <span class='word'>cover</span> <span class='word'>all</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [421]</span><br>
<span class='word'>An</span> <span class='word'>implementation</span> <span class='word'>could</span> <span class='word'>potentially</span> <span class='word'>cache</span> <span class='word'>the</span> <span class='word'>results</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>refer</span> <span class='word'>back</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>instead</span> <span class='word'>of</span> <span class='word'>trying</span> <span class='word'>to</span> <span class='word'>iterate</span> <span class='word'>through</span> <span class='word'>cache</span> <span class='word'>lines</span> <span class='word'>in</span> <span class='word'>order</span><span class='ignore'>.</span><span class='cumsum'> [444]</span><br>
<span class='word'>Otherwise</span> <span class='word'>a</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span><span class='ignore'>-</span><span class='word'>way</span> <span class='word'>parallel</span> <span class='word'>reduction</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>to</span> <span class='word'>find</span> <span class='word'>the</span> <span class='word'>min</span> <span class='word'>and</span> <span class='word'>max</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>that</span> <span class='word'>would</span> <span class='word'>likely</span> <span class='word'>take</span> <span class='word'>up</span> <span class='word'>more</span> <span class='word'>logic</span> <span class='word'>than</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>comparisons</span><span class='ignore'>.</span><span class='cumsum'> [470]</span><br>
<span class='word'>This</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>a</span> <span class='word'>moot</span> <span class='word'>point</span> <span class='word'>depending</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>cache</span> <span class='word'>implementation</span> <span class='word'>though</span> <span class='ignore'>-</span> <span class='word'>if</span> <span class='word'>the</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>accesses</span> <span class='word'>per</span> <span class='word'>cycle</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>cache</span> <span class='word'>line</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>addresses</span> <span class='word'>are</span> <span class='word'>spread</span> <span class='word'>out</span><span class='ignore'>,</span> <span class='word'>you're</span> <span class='word'>limited</span> <span class='word'>to</span> <span class='word'>one</span> <span class='word'>access</span> <span class='word'>and</span> <span class='word'>therefore</span> <span class='word'>one</span> <span class='word'>check</span> <span class='word'>per</span> <span class='word'>cycle</span> <span class='word'>regardless</span><span class='ignore'>.</span><span class='cumsum'> [513]</span><br>
<span class='cumsum'> [513]</span><br>
<span class='word'>In</span> <span class='word'>summary</span><span class='ignore'>,</span> <span class='word'>there</span> <span class='word'>are</span> <span class='word'>fast-path</span> <span class='word'>checks</span> <span class='word'>that</span> <span class='word'>consume</span> <span class='word'>less</span> <span class='word'>logic</span> <span class='word'>than</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span> <span class='word'>parallel</span> <span class='word'>checks</span> <span class='word'>in</span> <span class='word'>certain</span> <span class='word'>circumstances</span><span class='ignore'>.</span><span class='cumsum'> [530]</span><br>
<span class='word'>Even</span> <span class='word'>though</span> <span class='word'>a</span> <span class='word'>slow-path</span> <span class='word'>is</span> <span class='word'>always</span> <span class='word'>necessary</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>implemented</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>slow</span> <span class='word'>way</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>doing</span> <span class='word'>one</span> <span class='word'>check</span> <span class='word'>per</span> <span class='word'>cycle</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>save</span> <span class='word'>on</span> <span class='word'>logic</span><span class='ignore'>.</span><span class='cumsum'> [555]</span><br>
<span class='word'>Particularly</span> <span class='word'>if</span> <span class='word'>other</span> <span class='word'>parts</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>system</span> <span class='word'>rely</span> <span class='word'>on</span> <span class='word'>constraining</span> <span class='word'>the</span> <span class='word'>addresses</span> <span class='word'>accessed</span> <span class='word'>in</span> <span class='word'>each</span> <span class='word'>cycle</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>fast-path</span> <span class='word'>check</span> <span class='word'>can</span> <span class='word'>take</span> <span class='word'>advantage</span> <span class='word'>of</span> <span class='word'>those</span> <span class='word'>constraints</span><span class='ignore'>.</span> <span class='cumsum'> [580]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/sub30_fast_path.tex</span><span class='cumsum'> [580]</span><br>
<span class='cumsum'> [580]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_25EmulationInvestigation/sub40_beyond_emu}</span><span class='cumsum'> [580]</span><br>
<span class='cumsum'> [580]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/sub40_beyond_emu.tex</span><span class='cumsum'> [580]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Going</span> <span class='hword'>beyond</span> <span class='hword'>the</span> <span class='hword'>emulator</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>is</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>example</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>conformant</span> <span class='word'>CHERI-RVV</span> <span class='word'>implementation</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>exercise</span> <span class='word'>every</span> <span class='word'>part</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>specification</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>Four</span> <span class='word'>properties</span> <span class='word'>stand</span> <span class='word'>out</span><span class='ignore'>:</span><span class='cumsum'> [28]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [28]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>assumes</span> <span class='word'>all</span> <span class='word'>element</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>naturally</span> <span class='word'>aligned</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>spec</span> <span class='word'>allows</span> <span class='word'>misaligned</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [43]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>doesn't</span> <span class='word'>consider</span> <span class='word'>multiple</span> <span class='word'>hardware</span> <span class='word'>threads</span><span class='ignore'>,</span> <span class='word'>essentially</span> <span class='word'>assuming</span> <span class='word'>all</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>atomic</span><span class='ignore'>.</span><span class='cumsum'> [56]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Segments</span><span class='ignore'>/</span><span class='word'>elements</span> <span class='word'>are</span> <span class='word'>always</span> <span class='word'>accessed</span> <span class='word'>in</span> <span class='word'>order</span><span class='ignore'>,</span> <span class='word'>despite</span> <span class='word'>the</span> <span class='word'>spec</span> <span class='word'>not</span> <span class='word'>enforcing</span> <span class='word'>ordering</span><span class='cumsum'> [69]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Imprecise</span> <span class='word'>traps</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>exceptions</span> <span class='ignore'>-</span> <span class='word'>precise</span> <span class='word'>trap</span> <span class='word'>behaviour</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>explored</span><span class='ignore'>.</span><span class='cumsum'> [82]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [82]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>notes</span> <span class='word'>how</span> <span class='word'>relaxed</span> <span class='word'>access</span> <span class='word'>ordering</span> <span class='word'>and</span> <span class='word'>precise</span> <span class='word'>exceptions</span> <span class='word'>may</span> <span class='word'>affect</span> <span class='word'>the</span> <span class='word'>hardware</span> <span class='word'>in</span> <span class='word'>ways</span> <span class='word'>not</span> <span class='word'>previously</span> <span class='word'>explored</span><span class='ignore'>.</span><span class='cumsum'> [101]</span><br>
<span class='cumsum'> [101]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Misaligned</span> <span class='hword'>accesses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>Implementations</span> <span class='word'>are</span> <span class='word'>allowed</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>vector</span> <span class='word'>accesses</span> <span class='word'>that</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>aligned</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>size</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>element</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='word'>This</span> <span class='word'>support</span> <span class='word'>is</span> <span class='word'>independent</span> <span class='word'>of</span> <span class='word'>misaligned</span> <span class='word'>scalar</span> <span class='word'>access</span> <span class='word'>support</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>if</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>misaligned</span> <span class='word'>64-bit</span> <span class='word'>scalar</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>allowed</span><span class='ignore'>,</span> <span class='word'>misaligned</span> <span class='word'>vector</span> <span class='word'>accesses</span> <span class='word'>of</span> <span class='word'>64-bit</span> <span class='word'>elements</span> <span class='word'>do</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>not</span><span class='ignore'>}</span> <span class='word'>have</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>allowed</span><span class='ignore'>.</span><span class='cumsum'> [49]</span><br>
<span class='cumsum'> [49]</span><br>
<span class='word'>Changing</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>to</span> <span class='word'>allow</span> <span class='word'>misaligned</span> <span class='word'>accesses</span> <span class='word'>of</span> <span class='word'>integer</span> <span class='word'>data</span> <span class='word'>would</span> <span class='word'>not</span> <span class='word'>have</span> <span class='word'>any</span> <span class='word'>impact</span> <span class='word'>on</span> <span class='word'>CHERI</span> <span class='word'>correctness</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='word'>Capability</span> <span class='word'>loads</span><span class='ignore'>/</span><span class='word'>stores</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>aligned</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>3.5.2</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>cannot</span> <span class='word'>change</span> <span class='word'>this</span><span class='ignore'>.</span><span class='cumsum'> [83]</span><br>
<span class='word'>Writing</span> <span class='word'>misaligned</span> <span class='word'>integer</span> <span class='word'>values</span> <span class='word'>across</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span> <span class='word'>boundary</span> <span class='word'>would</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>sure</span> <span class='word'>to</span> <span class='word'>zero</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>on</span> <span class='word'>both</span> <span class='word'>regions</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>applies</span> <span class='word'>to</span> <span class='word'>scalar</span> <span class='word'>implementations</span> <span class='word'>as</span> <span class='word'>much</span> <span class='word'>as</span> <span class='word'>vector</span> <span class='word'>ones</span><span class='ignore'>.</span><span class='cumsum'> [115]</span><br>
<span class='word'>Alignment</span> <span class='word'>only</span> <span class='word'>impacts</span> <span class='word'>CHERI-RVV</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>extent</span> <span class='word'>that</span> <span class='word'>it</span> <span class='word'>impacts</span> <span class='word'>capabilities-in-vectors</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>hyp</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [126]</span><br>
<span class='cumsum'> [126]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Atomicity</span> <span class='hword'>of</span> <span class='hword'>accesses</span><span class='ignore'>/</span><span class='hword'>General</span> <span class='hword'>memory</span> <span class='hword'>model</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>Vector</span> <span class='word'>memory</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>specified</span> <span class='word'>to</span> <span class='word'>follow</span> <span class='word'>the</span> <span class='word'>RISC-V</span> <span class='word'>Weak</span> <span class='word'>Memory</span> <span class='word'>Ordering</span> <span class='word'>model</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Behaviour</span> <span class='oword'>under</span> <span class='oword'>the</span> <span class='oword'>Total</span> <span class='oword'>Store</span> <span class='oword'>Ordering</span> <span class='oword'>extension</span> <span class='oword'>hasn't</span> <span class='oword'>been</span> <span class='oword'>defined</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>although</span> <span class='word'>this</span> <span class='word'>model</span> <span class='word'>hasn't</span> <span class='word'>been</span> <span class='word'>fully</span> <span class='word'>explained</span> <span class='word'>in</span> <span class='word'>terms</span> <span class='word'>of</span> <span class='word'>vectors</span> <span class='word'>yet</span><span class='ignore'>.</span><span class='cumsum'> [41]</span><br>
<span class='word'>RVWMO</span> <span class='word'>defines</span> <span class='word'>a</span> <span class='word'>global</span> <span class='word'>order</span> <span class='word'>of</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>memory</span> <span class='word'>operations</span><span class='ignore'>}</span><span class='ignore'>:</span> <span class='word'>atomic</span> <span class='word'>operations</span> <span class='word'>that</span> <span class='word'>are</span> <span class='word'>either</span> <span class='word'>loads</span><span class='ignore'>,</span> <span class='word'>stores</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>both</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Chapter</span> <span class='word'>14</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RISCV-vol1-20191213</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [60]</span><br>
<span class='word'>The</span> <span class='word'>RVWMO</span> <span class='word'>spec</span> <span class='word'>assumes</span> <span class='word'>all</span> <span class='word'>memory</span> <span class='word'>instructions</span> <span class='word'>create</span> <span class='word'>exactly</span> <span class='word'>one</span> <span class='word'>memory</span> <span class='word'>operation</span> <span class='word'>but</span> <span class='word'>calls</span> <span class='word'>out</span> <span class='word'>that</span> <span class='word'>once</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>model</span> <span class='word'>is</span> <span class='word'>formalized</span><span class='ignore'>,</span> <span class='word'>vector</span> <span class='word'>accesses</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>defined</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>multiple</span> <span class='word'>operations</span><span class='ignore'>.</span><span class='cumsum'> [91]</span><br>
<span class='cumsum'> [91]</span><br>
<span class='word'>The</span> <span class='word'>RVV</span> <span class='word'>spec</span> <span class='word'>states</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>vector</span> <span class='word'>misaligned</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>follow</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>rules</span> <span class='word'>for</span> <span class='word'>atomicity</span> <span class='word'>as</span> <span class='word'>scalar</span> <span class='word'>misaligned</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>that</span> <span class='word'>misaligned</span> <span class='word'>accesses</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>decomposed</span> <span class='word'>into</span> <span class='word'>multiple</span> <span class='word'>memory</span> <span class='word'>operations</span> <span class='word'>of</span> <span class='word'>any</span> <span class='word'>granularity</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>e.g</span><span class='ignore'>.</span> <span class='oword'>each</span> <span class='oword'>byte</span> <span class='oword'>could</span> <span class='oword'>be</span> <span class='oword'>written</span> <span class='oword'>in</span> <span class='oword'>a</span> <span class='oword'>separate</span> <span class='oword'>access</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [134]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>the</span> <span class='word'>only</span> <span class='word'>mention</span> <span class='word'>of</span> <span class='word'>atomicity</span> <span class='word'>in</span> <span class='word'>that</span> <span class='word'>document</span><span class='ignore'>.</span><span class='cumsum'> [144]</span><br>
<span class='cumsum'> [144]</span><br>
<span class='word'>Again</span><span class='ignore'>,</span> <span class='word'>atomicity</span> <span class='word'>of</span> <span class='word'>integer</span> <span class='word'>data</span> <span class='word'>doesn't</span> <span class='word'>really</span> <span class='word'>impact</span> <span class='word'>the</span> <span class='word'>fusion</span> <span class='word'>of</span> <span class='word'>CHERI</span> <span class='word'>and</span> <span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>are</span> <span class='word'>correctly</span> <span class='word'>zeroed</span> <span class='word'>on</span> <span class='word'>all</span> <span class='word'>integer</span> <span class='word'>writes</span><span class='ignore'>.</span><span class='cumsum'> [170]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>does</span> <span class='word'>impact</span> <span class='word'>capabilities-in-vectors</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>hyp</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [175]</span><br>
<span class='cumsum'> [175]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Relaxed</span> <span class='hword'>access</span> <span class='hword'>ordering</span> <span class='hword'>and</span> <span class='hword'>precise</span> <span class='hword'>traps</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>Ordering</span> <span class='word'>is</span> <span class='word'>only</span> <span class='word'>enforced</span> <span class='word'>insofar</span> <span class='word'>as</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>observable</span><span class='ignore'>.</span><span class='cumsum'> [15]</span><br>
<span class='word'>The</span> <span class='word'>only</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>are</span> <span class='word'>forced</span> <span class='word'>to</span> <span class='word'>perform</span> <span class='word'>their</span> <span class='word'>accesses</span> <span class='word'>in</span> <span class='word'>order</span> <span class='word'>are</span> <span class='word'>indexed-ordered</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>write</span> <span class='word'>to</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>I</span><span class='ignore'>/</span><span class='word'>O</span> <span class='word'>regions</span> <span class='word'>where</span> <span class='word'>order</span> <span class='word'>matters</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>instructions</span> <span class='word'>that</span> <span class='word'>trigger</span> <span class='word'>precise</span> <span class='word'>traps</span><span class='ignore'>.</span><span class='cumsum'> [50]</span><br>
<span class='word'>Precise</span> <span class='word'>traps</span> <span class='word'>require</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>set</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>value</span> <span class='word'>such</span> <span class='word'>that</span> <span class='word'>all</span> <span class='word'>elements</span> <span class='word'>before</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>have</span> <span class='word'>completed</span> <span class='word'>their</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>all</span> <span class='word'>accesses</span> <span class='word'>on</span><span class='ignore'>/</span><span class='word'>after</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vstart</span><span class='ignore'>}</span> <span class='word'>have</span> <span class='word'>not</span> <span class='word'>completed</span> <span class='word'>or</span> <span class='word'>are</span> <span class='word'>idempotent</span><span class='ignore'>.</span><span class='cumsum'> [82]</span><br>
<span class='cumsum'> [82]</span><br>
<span class='word'>If</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instruction</span> <span class='word'>is</span> <span class='word'>1</span><span class='ignore'>.</span> <span class='word'>not</span> <span class='word'>indexed-ordered</span> <span class='word'>and</span> <span class='word'>2</span><span class='ignore'>.</span> <span class='word'>guaranteed</span> <span class='word'>not</span> <span class='word'>to</span> <span class='word'>trigger</span> <span class='word'>a</span> <span class='word'>precise</span> <span class='word'>trap</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>Even</span> <span class='oword'>instructions</span> <span class='oword'>that</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='oword'>would</span><span class='ignore'>}</span> <span class='oword'>trigger</span> <span class='oword'>precise</span> <span class='oword'>traps</span> <span class='oword'>but</span> <span class='oword'>are</span> <span class='oword'>guaranteed</span> <span class='oword'>not</span> <span class='oword'>to</span> <span class='oword'>throw</span> <span class='oword'>an</span> <span class='oword'>exception</span> <span class='oword'>or</span> <span class='oword'>respond</span> <span class='oword'>to</span> <span class='oword'>asynchronous</span> <span class='oword'>interrupt</span> <span class='oword'>may</span> <span class='oword'>execute</span> <span class='oword'>out</span> <span class='oword'>of</span> <span class='oword'>order</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>then</span> <span class='word'>it</span> <span class='word'>may</span> <span class='word'>execute</span> <span class='word'>out</span> <span class='word'>of</span> <span class='word'>order</span><span class='ignore'>.</span><span class='cumsum'> [133]</span><br>
<span class='word'>This</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>affect</span> <span class='word'>CHERI-RVV</span> <span class='word'>in</span> <span class='word'>any</span> <span class='word'>way</span><span class='ignore'>.</span><span class='cumsum'> [141]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/sub40_beyond_emu.tex</span><span class='cumsum'> [141]</span><br>
<span class='cumsum'> [141]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_25EmulationInvestigation/sub50_hyp}</span><span class='cumsum'> [141]</span><br>
<span class='cumsum'> [141]</span><br>
<span class='comment'>% --- Start of included file ./1_25EmulationInvestigation/sub50_hyp.tex</span><span class='cumsum'> [141]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Evaluating</span> <span class='hword'>hypotheses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>hw</span><span class='ignore'>_</span><span class='word'>cap</span><span class='ignore'>_</span><span class='word'>as</span><span class='ignore'>_</span><span class='word'>vec</span><span class='ignore'>_</span><span class='word'>mem</span><span class='ignore'>_</span><span class='word'>ref</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Feasibility</span><span class='ignore'>}</span><span class='cumsum'> [10]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>true</span><span class='ignore'>.</span><span class='cumsum'> [13]</span><br>
<span class='word'>All</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>index</span> <span class='word'>the</span> <span class='word'>scalar</span> <span class='word'>general-purpose</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>to</span> <span class='word'>read</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>address</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>CHERI-RVV</span> <span class='word'>implementations</span> <span class='word'>can</span> <span class='word'>simply</span> <span class='word'>use</span> <span class='word'>this</span> <span class='word'>index</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>scalar</span> <span class='word'>capability</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>instead</span><span class='ignore'>.</span><span class='cumsum'> [44]</span><br>
<span class='word'>This</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>considered</span> <span class='word'>through</span> <span class='word'>the</span> <span class='word'>lens</span> <span class='word'>of</span> <span class='word'>adding</span> <span class='word'>CHERI</span> <span class='word'>to</span> <span class='word'>any</span> <span class='word'>RISC-V</span> <span class='word'>processor</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>in</span> <span class='word'>particular</span> <span class='word'>adding</span> <span class='word'>Capability</span> <span class='word'>mode</span> <span class='word'>to</span> <span class='word'>adjust</span> <span class='word'>the</span> <span class='word'>behaviour</span> <span class='word'>of</span> <span class='word'>legacy</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [71]</span><br>
<span class='word'>RVV</span> <span class='word'>instructions</span> <span class='word'>can</span> <span class='word'>have</span> <span class='word'>their</span> <span class='word'>behaviour</span> <span class='word'>adjusted</span> <span class='word'>in</span> <span class='word'>exactly</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>way</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>scalar</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [89]</span><br>
<span class='cumsum'> [89]</span><br>
<span class='word'>That</span> <span class='word'>approach</span> <span class='word'>then</span> <span class='word'>scales</span> <span class='word'>to</span> <span class='word'>other</span> <span class='word'>base</span> <span class='word'>architectures</span> <span class='word'>that</span> <span class='word'>have</span> <span class='word'>CHERI</span> <span class='word'>variants</span><span class='ignore'>.</span><span class='cumsum'> [101]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>Morello's</span> <span class='word'>scalar</span> <span class='word'>Arm</span> <span class='word'>instructions</span> <span class='word'>were</span> <span class='word'>modified</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>CHERI</span> <span class='word'>capabilities</span> <span class='word'>as</span> <span class='word'>memory</span> <span class='word'>references</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>1.3</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>armltdMorelloArchitectureReference2021</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>one</span> <span class='word'>may</span> <span class='word'>simply</span> <span class='word'>try</span> <span class='word'>to</span> <span class='word'>apply</span> <span class='word'>those</span> <span class='word'>modifications</span> <span class='word'>to</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [132]</span><br>
<span class='word'>This</span> <span class='word'>only</span> <span class='word'>works</span> <span class='word'>where</span> <span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>accesses</span> <span class='word'>memory</span> <span class='word'>references</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>way</span> <span class='word'>as</span> <span class='word'>scalar</span> <span class='word'>Arm</span> <span class='word'>instructions</span> <span class='word'>did</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>through</span> <span class='word'>a</span> <span class='word'>scalar</span> <span class='word'>register</span> <span class='word'>file</span><span class='ignore'>.</span><span class='cumsum'> [156]</span><br>
<span class='cumsum'> [156]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>has</span> <span class='word'>some</span> <span class='word'>addressing</span> <span class='word'>modes</span> <span class='word'>like</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>u64base</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>as</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>64-bit</span> <span class='word'>integer</span> <span class='word'>addresses</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>armltdArmCompilerScalable2019</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [175]</span><br>
<span class='word'>This</span> <span class='word'>has</span> <span class='word'>more</span> <span class='word'>complications</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>simply</span> <span class='word'>dereferencing</span> <span class='word'>integer</span> <span class='word'>addresses</span> <span class='word'>without</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>is</span> <span class='word'>insecure</span><span class='ignore'>.</span><span class='cumsum'> [189]</span><br>
<span class='word'>Would</span> <span class='word'>a</span> <span class='word'>CHERI</span> <span class='word'>version</span> <span class='word'>convert</span> <span class='word'>this</span> <span class='word'>mode</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>,</span> <span class='word'>breaking</span> <span class='word'>compatibility</span> <span class='word'>with</span> <span class='word'>legacy</span> <span class='word'>code</span> <span class='word'>that</span> <span class='word'>expects</span> <span class='word'>integer</span> <span class='word'>references</span><span class='ignore'>?</span><span class='cumsum'> [208]</span><br>
<span class='word'>Another</span> <span class='word'>option</span> <span class='word'>would</span> <span class='word'>be</span> <span class='word'>to</span> <span class='word'>only</span> <span class='word'>enable</span> <span class='word'>this</span> <span class='word'>instruction</span> <span class='word'>in</span> <span class='word'>Integer</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>dereference</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>.</span><span class='cumsum'> [226]</span><br>
<span class='word'>It's</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>port</span> <span class='word'>this</span> <span class='word'>to</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>requires</span> <span class='word'>further</span> <span class='word'>investigation</span> <span class='word'>and</span> <span class='word'>thought</span><span class='ignore'>.</span><span class='cumsum'> [239]</span><br>
<span class='cumsum'> [239]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>hw</span><span class='ignore'>_</span><span class='word'>cap</span><span class='ignore'>_</span><span class='word'>bounds</span><span class='ignore'>_</span><span class='word'>checks</span><span class='ignore'>_</span><span class='word'>amortized</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Fast-path</span> <span class='word'>checks</span><span class='ignore'>}</span><span class='cumsum'> [247]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>true</span><span class='ignore'>,</span> <span class='word'>at</span> <span class='word'>least</span> <span class='word'>for</span> <span class='word'>Successful</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [256]</span><br>
<span class='word'>Because</span> <span class='word'>the</span> <span class='word'>RVV</span> <span class='word'>spec</span> <span class='word'>requires</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>faulting</span> <span class='word'>element</span> <span class='word'>is</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>always</span><span class='ignore'>}</span> <span class='word'>recorded</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>17</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>Failure</span> <span class='word'>due</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>violation</span> <span class='word'>requires</span> <span class='word'>elements</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>checked</span> <span class='word'>individually</span><span class='ignore'>.</span><span class='cumsum'> [283]</span><br>
<span class='word'>CHERI-RVV</span> <span class='word'>could</span> <span class='word'>change</span> <span class='word'>the</span> <span class='word'>specification</span> <span class='word'>so</span> <span class='word'>the</span> <span class='word'>faulting</span> <span class='word'>element</span> <span class='word'>doesn't</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>calculated</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>would</span> <span class='word'>make</span> <span class='word'>Failures</span> <span class='word'>faster</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>that</span> <span class='word'>still</span> <span class='word'>requires</span> <span class='word'>Likely-Failures</span> <span class='word'>to</span> <span class='word'>take</span> <span class='word'>the</span> <span class='word'>slow-path</span><span class='ignore'>.</span><span class='cumsum'> [311]</span><br>
<span class='cumsum'> [311]</span><br>
<span class='word'>There</span> <span class='word'>are</span> <span class='word'>many</span> <span class='word'>ways</span> <span class='word'>to</span> <span class='word'>combine</span> <span class='word'>the</span> <span class='word'>checks</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>elements</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>take</span> <span class='word'>advantage</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>range</span> <span class='word'>constraints</span><span class='ignore'>.</span><span class='cumsum'> [333]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>unit-stride</span> <span class='word'>access</span> <span class='word'>could</span> <span class='word'>a</span> <span class='word'>hierarchy</span> <span class='word'>of</span> <span class='word'>checks</span><span class='ignore'>:</span> <span class='word'>cache-line</span> <span class='word'>checks</span> <span class='word'>until</span> <span class='word'>a</span> <span class='word'>Likely-Failure</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>tight</span> <span class='mathgroup'>$</span><span class='math'>m</span><span class='mathgroup'>$</span><span class='ignore'>-</span><span class='word'>element</span> <span class='word'>bounds</span> <span class='word'>until</span> <span class='word'>a</span> <span class='word'>Likely-Failure</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>the</span> <span class='word'>slow-path</span><span class='ignore'>.</span><span class='cumsum'> [359]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>choice</span> <span class='word'>of</span> <span class='word'>fast-path</span> <span class='word'>checks</span> <span class='word'>is</span> <span class='word'>inherently</span> <span class='word'>a</span> <span class='word'>trade-off</span> <span class='word'>between</span> <span class='word'>latency</span><span class='ignore'>,</span> <span class='word'>area</span><span class='ignore'>,</span> <span class='word'>energy</span> <span class='word'>usage</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>more</span><span class='ignore'>.</span><span class='cumsum'> [376]</span><br>
<span class='word'>Picking</span> <span class='word'>the</span> <span class='word'>right</span> <span class='word'>one</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>job</span> <span class='word'>is</span> <span class='word'>highly</span> <span class='word'>dependent</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>existing</span> <span class='word'>implementation</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>indeed</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>may</span> <span class='word'>decide</span> <span class='word'>that</span> <span class='word'>parallel</span> <span class='word'>per-element</span> <span class='word'>checks</span> <span class='word'>is</span> <span class='word'>better</span> <span class='word'>than</span> <span class='word'>a</span> <span class='word'>fast-path</span><span class='ignore'>.</span><span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/sub50_hyp.tex</span><span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [405]</span><br>
<span class='comment'>% --- End of included file ./1_25EmulationInvestigation/content.tex</span><span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_30Software/content</span><span class='ignore'>}</span><span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='comment'>% --- Start of included file ./1_30Software/content.tex</span><span class='cumsum'> [405]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [405]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [405]</span><br>
<span class='cumsum'> [405]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>The</span> <span class='hword'>CHERI-RVV</span> <span class='hword'>software</span> <span class='hword'>stack</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='word'>This</span> <span class='word'>chapter</span> <span class='word'>explores</span> <span class='word'>the</span> <span class='word'>current</span> <span class='word'>state</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>CHERI-RVV</span> <span class='word'>software</span> <span class='word'>stack</span><span class='ignore'>:</span> <span class='word'>mainstream</span> <span class='word'>compiler</span> <span class='word'>support</span> <span class='word'>for</span> <span class='word'>vanilla</span> <span class='word'>RVV</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>compilersupport</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>modifications</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>bring</span> <span class='word'>support</span> <span class='word'>to</span> <span class='word'>CHERI-Clang</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>chericlang</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [30]</span><br>
<span class='word'>The</span> <span class='word'>software</span> <span class='word'>hypotheses</span> <span class='word'>are</span> <span class='word'>tested</span> <span class='word'>with</span> <span class='word'>this</span> <span class='word'>knowledge</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>hypotheses</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>we</span> <span class='word'>recommend</span> <span class='word'>a</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>changes</span> <span class='word'>to</span> <span class='word'>bring</span> <span class='word'>CHERI-Clang</span> <span class='word'>support</span> <span class='word'>to</span> <span class='word'>par</span> <span class='word'>with</span> <span class='word'>other</span> <span class='word'>compilers</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>chericlangchanges</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='comment'>% First, the available compiler support for vanilla RVV is explored and briefly compared to Arm SVE .</span><span class='cumsum'> [54]</span><br>
<span class='comment'>% that translates to CHERI-Clang and what changes were necessary to implement capabilities, and </span><span class='cumsum'> [54]</span><br>
<span class='cumsum'> [54]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Compiling</span> <span class='hword'>vector</span> <span class='hword'>code</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>compilersupport</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>Modern</span> <span class='word'>compilers</span> <span class='word'>provide</span> <span class='word'>many</span> <span class='word'>ways</span> <span class='word'>to</span> <span class='word'>generate</span> <span class='word'>vectorized</span> <span class='word'>code</span><span class='ignore'>.</span><span class='cumsum'> [12]</span><br>
<span class='word'>While</span> <span class='word'>this</span> <span class='word'>support</span> <span class='word'>is</span> <span class='word'>very</span> <span class='word'>advanced</span> <span class='word'>for</span> <span class='word'>well</span> <span class='word'>established</span> <span class='word'>vector</span> <span class='word'>models</span><span class='ignore'>,</span> <span class='word'>like</span> <span class='word'>x86-64</span> <span class='word'>AVX</span><span class='ignore'>,</span> <span class='word'>newer</span> <span class='word'>vector</span> <span class='word'>models</span> <span class='word'>like</span> <span class='word'>RVV</span> <span class='word'>don't</span> <span class='word'>have</span> <span class='word'>as</span> <span class='word'>many</span> <span class='word'>options</span><span class='ignore'>.</span><span class='cumsum'> [36]</span><br>
<span class='word'>It</span> <span class='word'>can</span> <span class='word'>even</span> <span class='word'>be</span> <span class='word'>difficult</span> <span class='word'>to</span> <span class='word'>get</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>to</span> <span class='word'>generate</span> <span class='word'>any</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>at</span> <span class='word'>all</span><span class='ignore'>.</span><span class='cumsum'> [52]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>examines</span> <span class='word'>support</span> <span class='word'>across</span> <span class='word'>the</span> <span class='word'>Clang</span> <span class='word'>and</span> <span class='word'>GCC</span> <span class='word'>compilers</span> <span class='word'>for</span> <span class='word'>various</span> <span class='word'>vectorization</span> <span class='word'>methods</span> <span class='word'>on</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [68]</span><br>
<span class='cumsum'> [68]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Available</span> <span class='hword'>compilers</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='comment'>% Before you can compile vector code, the compiler must be told to use a vector ISA.</span><span class='cumsum'> [2]</span><br>
<span class='word'>Compiler</span> <span class='word'>support</span> <span class='word'>for</span> <span class='word'>RVV</span> <span class='word'>varies</span><span class='ignore'>.</span><span class='cumsum'> [7]</span><br>
<span class='word'>On</span> <span class='word'>Clang</span> <span class='word'>13</span> <span class='word'>and</span> <span class='word'>other</span> <span class='word'>LLVM-13-based</span> <span class='word'>compilers</span><span class='ignore'>,</span> <span class='word'>version</span> <span class='word'>0.1</span><span class='ignore'>(</span><span class='ignore'>?</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>It</span> <span class='oword'>is</span> <span class='oword'>difficult</span> <span class='oword'>to</span> <span class='oword'>verify</span> <span class='oword'>the</span> <span class='oword'>actual</span> <span class='oword'>corresponding</span> <span class='oword'>version</span><span class='ignore'>,</span> <span class='oword'>because</span> <span class='oword'>there</span> <span class='oword'>is</span> <span class='oword'>no</span> <span class='oword'>readily</span> <span class='oword'>available</span> <span class='oword'>specification</span> <span class='oword'>for</span> <span class='oword'>v0.1</span><span class='ignore'>,</span> <span class='oword'>and</span> <span class='oword'>the</span> <span class='oword'>extension</span> <span class='oword'>supports</span> <span class='oword'>instructions</span> <span class='oword'>only</span> <span class='oword'>present</span> <span class='oword'>from</span> <span class='oword'>v0.8</span> <span class='oword'>such</span> <span class='oword'>as</span> <span class='oword'>whole</span> <span class='oword'>register</span> <span class='oword'>accesses</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>specification</span> <span class='word'>is</span> <span class='word'>supported</span> <span class='word'>as</span> <span class='word'>an</span> <span class='word'>experimental</span> <span class='word'>extension</span><span class='ignore'>.</span><span class='cumsum'> [58]</span><br>
<span class='word'>Clang</span><span class='ignore'>/</span><span class='word'>LLVM</span><span class='ignore'>~</span><span class='word'>14</span> <span class='word'>and</span> <span class='word'>up</span> <span class='word'>support</span> <span class='word'>RVV</span> <span class='word'>v1.0</span><span class='ignore'>.</span><span class='cumsum'> [66]</span><br>
<span class='word'>GCC</span> <span class='word'>is</span> <span class='word'>an</span> <span class='word'>interesting</span> <span class='word'>case</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>there</span> <span class='word'>is</span> <span class='word'>a</span> <span class='word'>version</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>RISC-V</span> <span class='word'>GCC</span> <span class='word'>10.1</span> <span class='word'>that</span> <span class='word'>partially</span> <span class='word'>supports</span> <span class='word'>RVV</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>compilerdifferences</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>it</span> <span class='word'>was</span> <span class='word'>left</span> <span class='word'>untouched</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>year</span> <span class='word'>and</span> <span class='word'>deleted</span> <span class='word'>as</span> <span class='word'>of</span> <span class='word'>17th</span> <span class='word'>May</span> <span class='word'>2022</span><span class='ignore'>.</span><span class='cumsum'> [100]</span><br>
<span class='word'>See</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>appx</span><span class='ignore'>:</span><span class='ignore'>building</span><span class='ignore'>_</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>gcc</span><span class='ignore'>_</span><span class='ignore'>toolchain</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>more</span> <span class='word'>information</span> <span class='word'>on</span> <span class='word'>finding</span> <span class='word'>and</span> <span class='word'>building</span> <span class='word'>this</span> <span class='word'>version</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>cmdline</span><span class='ignore'>_</span><span class='ignore'>nocheri</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>required</span> <span class='word'>command-line</span> <span class='word'>arguments</span> <span class='word'>to</span> <span class='word'>enable</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [119]</span><br>
<span class='cumsum'> [119]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Automatic</span> <span class='hword'>vectorization</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>Figure</span> <span class='ignore'>page</span> <span class='ignore'>showing</span> <span class='ignore'>generated</span> <span class='ignore'>ASM</span> <span class='ignore'>for</span> <span class='ignore'>increment</span> <span class='ignore'>loop</span> <span class='ignore'>-</span> <span class='ignore'>see</span> <span class='ignore'>godbolt</span> <span class='ignore'>links</span> <span class='ignore'>MD</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>Compilers</span> <span class='word'>with</span> <span class='word'>auto-vectorization</span> <span class='word'>can</span> <span class='word'>automatically</span> <span class='word'>create</span> <span class='word'>vectorized</span> <span class='word'>code</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>scalar</span> <span class='word'>program</span><span class='ignore'>.</span><span class='cumsum'> [14]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>scalar</span> <span class='word'>loop</span> <span class='word'>over</span> <span class='word'>an</span> <span class='word'>array</span> <span class='word'>that</span> <span class='word'>increments</span> <span class='word'>each</span> <span class='word'>element</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>converted</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>vectorized</span> <span class='word'>loop</span> <span class='word'>that</span> <span class='word'>increments</span> <span class='word'>multiple</span> <span class='word'>elements</span> <span class='word'>at</span> <span class='word'>once</span><span class='ignore'>.</span><span class='cumsum'> [39]</span><br>
<span class='comment'>% Although this is simple in some cases, auto-vectorization can take significant effort and time to implement (for example, GCC started implementing it for x86 in 2003 and only turned on basic support in 2007\footnote{\url{https://gcc.gnu.org/projects/tree-ssa/vectorization.html}}).</span><span class='cumsum'> [39]</span><br>
<span class='word'>Clang</span> <span class='word'>and</span> <span class='word'>GCC</span> <span class='word'>support</span> <span class='word'>auto-vectorization</span> <span class='word'>in</span> <span class='word'>Arm</span> <span class='word'>SVE</span><span class='ignore'>,</span> <span class='word'>explored</span> <span class='word'>further</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>soft</span><span class='ignore'>:</span><span class='ignore'>compiling</span><span class='ignore'>:</span><span class='ignore'>armsve</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>don't</span> <span class='word'>yet</span> <span class='word'>support</span> <span class='word'>it</span> <span class='word'>for</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [57]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>and</span> <span class='word'>RVV</span> <span class='word'>are</span> <span class='word'>quite</span> <span class='word'>similar</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>there</span> <span class='word'>shouldn't</span> <span class='word'>be</span> <span class='word'>anything</span> <span class='word'>blocking</span> <span class='word'>auto-vectorization</span> <span class='word'>for</span> <span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>just</span> <span class='word'>requires</span> <span class='word'>engineering</span> <span class='word'>effort</span><span class='ignore'>.</span><span class='cumsum'> [78]</span><br>
<span class='comment'>% There's nothing preventing RVV auto-vectorization, especially as the similar Arm SVE model has auto-vectorization (see \cref{chap:soft:compiling:armsve}), but currently Clang and GCC do not support it.</span><span class='cumsum'> [78]</span><br>
<span class='comment'>% Currently there is no support for RVV auto-vectorization in Clang or GCC.</span><span class='cumsum'> [78]</span><br>
<span class='comment'>% Both compilers have support for Arm SVE auto-vectorization, explored further in \cref{chap:soft:compiling:armsve}.</span><span class='cumsum'> [78]</span><br>
<span class='cumsum'> [78]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Vector</span> <span class='hword'>intrinsics</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>Intrinsics</span><span class='ignore'>}</span> <span class='word'>are</span> <span class='word'>functions</span> <span class='word'>defined</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>that</span> <span class='word'>can</span> <span class='word'>invoke</span> <span class='word'>low-level</span> <span class='word'>functionality</span> <span class='word'>and</span> <span class='word'>instructions</span> <span class='word'>directly</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>specific</span> <span class='word'>architecture</span><span class='ignore'>.</span><span class='cumsum'> [21]</span><br>
<span class='word'>When</span> <span class='word'>automatic</span> <span class='word'>vectorization</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>available</span><span class='ignore'>,</span> <span class='word'>intrinsics</span> <span class='word'>are</span> <span class='word'>the</span> <span class='word'>next</span> <span class='word'>best</span> <span class='word'>thing</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>they</span> <span class='word'>aren't</span> <span class='word'>portable</span> <span class='word'>across</span> <span class='word'>different</span> <span class='word'>ISAs</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>present</span> <span class='word'>a</span> <span class='word'>familiar</span> <span class='word'>high-level</span> <span class='word'>interface</span> <span class='ignore'>(</span><span class='word'>function</span> <span class='word'>calls</span><span class='ignore'>)</span> <span class='word'>that</span> <span class='word'>gives</span> <span class='word'>fine-grained</span> <span class='word'>control</span> <span class='word'>over</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [53]</span><br>
<span class='comment'>% RVV provides an intrinsic for each vector instruction.</span><span class='cumsum'> [53]</span><br>
<span class='word'>The</span> <span class='word'>compiler</span> <span class='word'>then</span> <span class='word'>handles</span> <span class='word'>low-level</span> <span class='word'>decisions</span> <span class='word'>like</span> <span class='word'>register</span> <span class='word'>allocation</span> <span class='word'>under</span> <span class='word'>the</span> <span class='word'>hood</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>sometimes</span> <span class='word'>may</span> <span class='word'>provide</span> <span class='word'>extra</span> <span class='word'>functionality</span> <span class='word'>for</span> <span class='word'>ease</span> <span class='word'>of</span> <span class='word'>use</span><span class='ignore'>.</span><span class='cumsum'> [75]</span><br>
<span class='cumsum'> [75]</span><br>
<span class='word'>RVV</span> <span class='word'>has</span> <span class='word'>a</span> <span class='word'>comprehensive</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>intrinsics</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-intrinsics</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [83]</span><br>
<span class='comment'>%, implemented in the aforementioned special version of GCC and Clang~13+.</span><span class='cumsum'> [83]</span><br>
<span class='word'>With</span> <span class='word'>these</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>general</span> <span class='word'>strip-mining</span> <span class='word'>loop</span> <span class='word'>is</span> <span class='word'>easy</span> <span class='word'>to</span> <span class='word'>construct</span><span class='ignore'>:</span><span class='cumsum'> [93]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>example</span> <span class='ignore'>based</span> <span class='ignore'>on</span> <span class='exclcmd'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>riscv-non-isa</span><span class='ignore'>/</span><span class='ignore'>rvv-intrinsic-doc</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>master</span><span class='ignore'>/</span><span class='ignore'>examples</span><span class='ignore'>/</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>memcpy.c</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [93]</span><br>
<span class='envir'>\begin</span><span class='envir'>{enumerate}</span><span class='cumsum'> [93]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Use</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>intrinsic</span> <span class='word'>to</span> <span class='word'>get</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>length</span> <span class='word'>for</span> <span class='word'>this</span> <span class='word'>iteration</span><span class='ignore'>.</span><span class='cumsum'> [105]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Allocate</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>by</span> <span class='word'>declaring</span> <span class='word'>variables</span> <span class='word'>with</span> <span class='word'>vector</span> <span class='word'>types</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vuint32m8</span><span class='ignore'>_</span><span class='word'>t</span><span class='ignore'>}</span> <span class='word'>represents</span> <span class='word'>8</span> <span class='word'>registers</span> <span class='word'>worth</span> <span class='word'>of</span> <span class='word'>32-bit</span> <span class='word'>unsigned</span> <span class='word'>integers</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [125]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Pass</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>length</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>computation</span><span class='ignore'>/</span><span class='word'>memory</span> <span class='word'>intrinsics</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>operate</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>variables</span><span class='ignore'>.</span><span class='cumsum'> [140]</span><br>
<span class='envir'>\end</span><span class='envir'>{enumerate}</span><span class='cumsum'> [140]</span><br>
<span class='cumsum'> [140]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Inline</span> <span class='hword'>assembly</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>If</span> <span class='word'>a</span> <span class='word'>compiler</span> <span class='word'>doesn't</span> <span class='word'>supply</span> <span class='word'>complete</span> <span class='word'>intrinsics</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>programmer</span> <span class='word'>desires</span> <span class='word'>even</span> <span class='word'>more</span> <span class='word'>control</span><span class='ignore'>,</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>used</span><span class='ignore'>.</span><span class='cumsum'> [22]</span><br>
<span class='word'>The</span> <span class='word'>programmer</span> <span class='word'>gives</span> <span class='word'>a</span> <span class='word'>string</span> <span class='word'>of</span> <span class='word'>handwritten</span> <span class='word'>assembly</span> <span class='word'>code</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>compiler</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>is</span> <span class='word'>parsed</span> <span class='word'>and</span> <span class='word'>directly</span> <span class='word'>inserted</span> <span class='word'>into</span> <span class='word'>the</span> <span class='word'>output</span> <span class='word'>code</span><span class='ignore'>.</span><span class='cumsum'> [44]</span><br>
<span class='word'>The</span> <span class='word'>compiler</span> <span class='word'>still</span> <span class='word'>has</span> <span class='word'>to</span> <span class='word'>parse</span> <span class='word'>the</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>method</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>depend</span> <span class='word'>on</span> <span class='word'>any</span> <span class='word'>intrinsics</span> <span class='word'>being</span> <span class='word'>present</span> <span class='ignore'>(</span><span class='word'>or</span> <span class='word'>functional</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [65]</span><br>
<span class='word'>We</span> <span class='word'>used</span> <span class='word'>this</span> <span class='word'>for</span> <span class='word'>CHERI-Clang</span> <span class='word'>programs</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>it</span> <span class='word'>could</span> <span class='word'>not</span> <span class='word'>use</span> <span class='word'>intrinsics</span> <span class='word'>without</span> <span class='word'>crashing</span><span class='ignore'>.</span><span class='cumsum'> [79]</span><br>
<span class='cumsum'> [79]</span><br>
<span class='word'>Inline</span> <span class='word'>assembly</span> <span class='word'>can</span> <span class='word'>interact</span> <span class='word'>with</span> <span class='word'>C</span> <span class='word'>code</span> <span class='word'>and</span> <span class='word'>variables</span> <span class='word'>through</span> <span class='word'>a</span> <span class='word'>template</span> <span class='word'>syntax</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='word'>The</span> <span class='word'>programmer</span> <span class='word'>inserts</span> <span class='word'>a</span> <span class='word'>placeholder</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>assembly</span> <span class='word'>code</span> <span class='word'>with</span> <span class='word'>a</span> <span class='word'>corresponding</span> <span class='word'>expression</span><span class='ignore'>,</span> <span class='word'>noting</span> <span class='word'>how</span> <span class='word'>the</span> <span class='word'>expression</span> <span class='word'>is</span> <span class='word'>stored</span> <span class='word'>using</span> <span class='word'>a</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>constraint</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [114]</span><br>
<span class='word'>For</span> <span class='word'>our</span> <span class='word'>purposes</span><span class='ignore'>,</span> <span class='word'>constraints</span> <span class='word'>enforce</span> <span class='word'>that</span> <span class='word'>a</span> <span class='word'>value</span> <span class='word'>is</span> <span class='word'>either</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>register</span> <span class='word'>or</span> <span class='word'>in</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [130]</span><br>
<span class='cumsum'> [130]</span><br>
<span class='word'>Using</span> <span class='word'>the</span> <span class='word'>constraint</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>determines</span> <span class='word'>how</span> <span class='word'>the</span> <span class='word'>expression's</span> <span class='word'>value</span> <span class='word'>is</span> <span class='word'>stored</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>inserts</span> <span class='word'>a</span> <span class='word'>reference</span> <span class='word'>to</span> <span class='word'>it</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>assembly</span> <span class='word'>string</span><span class='ignore'>.</span><span class='cumsum'> [152]</span><br>
<span class='word'>Because</span> <span class='word'>this</span> <span class='word'>is</span> <span class='word'>done</span> <span class='word'>before</span> <span class='word'>the</span> <span class='word'>assembly</span> <span class='word'>string</span> <span class='word'>is</span> <span class='word'>parsed</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>isn't</span> <span class='word'>immediately</span> <span class='word'>type-checked</span> <span class='word'>against</span> <span class='word'>the</span> <span class='word'>assembly</span> <span class='word'>instruction</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>can</span> <span class='word'>lead</span> <span class='word'>to</span> <span class='word'>some</span> <span class='word'>difficult</span> <span class='word'>errors</span><span class='ignore'>.</span><span class='cumsum'> [177]</span><br>
<span class='cumsum'> [177]</span><br>
<span class='word'>Clang</span> <span class='word'>and</span> <span class='word'>GCC</span> <span class='word'>support</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>for</span> <span class='word'>RVV</span> <span class='word'>quite</span> <span class='word'>well</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>even</span> <span class='word'>allows</span> <span class='word'>the</span> <span class='word'>intrinsic</span> <span class='word'>vector</span> <span class='word'>types</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>referenced</span> <span class='word'>by</span> <span class='word'>assembly</span> <span class='word'>templates</span> <span class='ignore'>(</span><span class='word'>thus</span> <span class='word'>making</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>do</span> <span class='word'>register</span> <span class='word'>allocation</span> <span class='word'>instead</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>programmer</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [211]</span><br>
<span class='word'>The</span> <span class='word'>only</span> <span class='word'>caveat</span> <span class='word'>is</span> <span class='word'>that</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>memory</span><span class='ignore'>}</span> <span class='word'>constraints</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>supported</span> <span class='word'>by</span> <span class='word'>RVV</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [225]</span><br>
<span class='word'>None</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>support</span> <span class='word'>address</span> <span class='word'>offsets</span><span class='ignore'>,</span> <span class='word'>unlike</span> <span class='word'>their</span> <span class='word'>scalar</span> <span class='word'>counterparts</span><span class='ignore'>.</span><span class='cumsum'> [239]</span><br>
<span class='word'>Clang</span> <span class='word'>always</span> <span class='word'>treats</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>memory</span><span class='ignore'>}</span> <span class='word'>constraint</span> <span class='word'>as</span> <span class='word'>an</span> <span class='word'>offset</span> <span class='word'>access</span><span class='ignore'>,</span> <span class='word'>even</span> <span class='word'>when</span> <span class='word'>that</span> <span class='word'>offset</span> <span class='word'>is</span> <span class='word'>zero</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>it</span> <span class='word'>adds</span> <span class='word'>an</span> <span class='word'>offset</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>assembly</span> <span class='word'>string</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>memory</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>making</span> <span class='word'>it</span> <span class='word'>invalid</span><span class='ignore'>.</span><span class='cumsum'> [267]</span><br>
<span class='word'>To</span> <span class='word'>get</span> <span class='word'>around</span> <span class='word'>this</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>must</span> <span class='word'>use</span> <span class='word'>the</span> <span class='word'>pointer</span> <span class='word'>itself</span> <span class='word'>with</span> <span class='word'>a</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>register</span><span class='ignore'>}</span> <span class='word'>constraint</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>ptr</span><span class='ignore'>_</span><span class='ignore'>reg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [281]</span><br>
<span class='word'>On</span> <span class='word'>CHERI</span> <span class='word'>platforms</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>pointers</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>stored</span> <span class='word'>in</span> <span class='word'>capability</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>capability</span> <span class='word'>register</span><span class='ignore'>}</span> <span class='word'>constraint</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>instead</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>reg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [300]</span><br>
<span class='cumsum'> [300]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='option'>[hb]</span><span class='cumsum'> [300]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [300]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='ignore'>{</span><span class='ignore'>0.6</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [300]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=6,lastline=6]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [300]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Preamble</span><span class='ignore'>}</span><span class='cumsum'> [301]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [301]</span><br>
<span class='cumsum'> [301]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\vspace</span><span class='ignore'>{</span><span class='ignore'>1em</span><span class='ignore'>}</span><span class='cumsum'> [301]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='ignore'>{</span><span class='ignore'>0.49</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [301]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=7,lastline=10]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [301]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Load</span> <span class='oword'>scalar</span> <span class='oword'>from</span> <span class='oword'>memory</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>memory</span><span class='ignore'>}</span><span class='cumsum'> [305]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='exclcmd'>\hfill</span><span class='comment'>%</span><span class='cumsum'> [305]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='ignore'>{</span><span class='ignore'>0.49</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [305]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=20,lastline=23]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [305]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Failed</span> <span class='oword'>attempt</span> <span class='oword'>to</span> <span class='oword'>load</span> <span class='oword'>vector</span> <span class='oword'>from</span> <span class='oword'>memory</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>memory</span><span class='ignore'>}</span><span class='cumsum'> [312]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [312]</span><br>
<span class='cumsum'> [312]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\vspace</span><span class='ignore'>{</span><span class='ignore'>1em</span><span class='ignore'>}</span><span class='cumsum'> [312]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='ignore'>{</span><span class='ignore'>0.49</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [312]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=32,lastline=35]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [312]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Load</span> <span class='oword'>vector</span> <span class='oword'>from</span> <span class='oword'>pointer</span> <span class='oword'>in</span> <span class='oword'>register</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>ptr</span><span class='ignore'>_</span><span class='ignore'>reg</span><span class='ignore'>}</span><span class='cumsum'> [318]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [318]</span><br>
<span class='cumsum'> [318]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Inline</span> <span class='oword'>assembly</span> <span class='oword'>examples</span><span class='cmd'>\\</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>godbolt.org</span><span class='ignore'>/</span><span class='ignore'>z</span><span class='ignore'>/</span><span class='ignore'>rW9orr66a</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>inlineasm</span><span class='ignore'>}</span><span class='cumsum'> [322]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [322]</span><br>
<span class='cumsum'> [322]</span><br>
<span class='word'>Broadly</span> <span class='word'>speaking</span><span class='ignore'>,</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>supports</span> <span class='word'>more</span> <span class='word'>RVV</span> <span class='word'>instructions</span> <span class='word'>than</span> <span class='word'>intrinsics</span> <span class='word'>do</span><span class='ignore'>.</span><span class='cumsum'> [333]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>used</span> <span class='word'>extensively</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>testbench</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>evaluation</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>eval</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>alongside</span> <span class='word'>intrinsics</span> <span class='word'>where</span> <span class='word'>possible</span><span class='ignore'>.</span><span class='cumsum'> [348]</span><br>
<span class='cumsum'> [348]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [348]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>RVV</span> <span class='hword'>vs</span><span class='ignore'>.</span> <span class='hword'>Arm</span> <span class='hword'>SVE</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>soft</span><span class='ignore'>:</span><span class='ignore'>compiling</span><span class='ignore'>:</span><span class='ignore'>armsve</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='word'>similar</span> <span class='word'>model</span> <span class='word'>to</span> <span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>length</span> <span class='word'>may</span> <span class='word'>scale</span> <span class='word'>between</span> <span class='word'>128</span> <span class='word'>and</span> <span class='word'>2048</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>RVV</span> <span class='oword'>slightly</span> <span class='oword'>differs</span> <span class='oword'>here</span><span class='ignore'>,</span> <span class='oword'>as</span> <span class='oword'>it</span> <span class='oword'>allows</span> <span class='oword'>VLEN</span> <span class='oword'>smaller</span> <span class='oword'>than</span> <span class='oword'>128</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>instructions</span> <span class='word'>are</span> <span class='word'>designed</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>totally</span> <span class='word'>agnostic</span> <span class='word'>across</span> <span class='word'>different</span> <span class='word'>platforms</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>stephensARMScalableVector2017</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [45]</span><br>
<span class='word'>Arm</span> <span class='word'>have</span> <span class='word'>released</span> <span class='word'>a</span> <span class='word'>C</span> <span class='word'>language</span> <span class='word'>extension</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>SVE</span> <span class='word'>development</span> <span class='ignore'>(</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>armltdARMLanguageExtensions2020</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>supported</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>Arm</span> <span class='word'>Compiler</span> <span class='word'>for</span> <span class='word'>Embedded</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>developer.arm.com</span><span class='ignore'>/</span><span class='ignore'>Tools</span><span class='ignore'>\%</span><span class='ignore'>20and</span><span class='ignore'>\%</span><span class='ignore'>20Software</span><span class='ignore'>/</span><span class='ignore'>Arm</span><span class='ignore'>\%</span><span class='ignore'>20Compiler</span><span class='ignore'>\%</span><span class='ignore'>20for</span><span class='ignore'>\%</span><span class='ignore'>20Embedded</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>Clang</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>GCC</span><span class='ignore'>.</span><span class='cumsum'> [67]</span><br>
<span class='word'>They</span> <span class='word'>support</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>previously</span> <span class='word'>examined</span> <span class='word'>vectorization</span> <span class='word'>types</span><span class='ignore'>.</span><span class='cumsum'> [76]</span><br>
<span class='cumsum'> [76]</span><br>
<span class='word'>Auto-vectorization</span> <span class='word'>is</span> <span class='word'>supported</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>main</span> <span class='word'>focus</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>user</span> <span class='word'>guide</span> <span class='ignore'>(</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>armltdArmCompilerScalable2019</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>is</span> <span class='word'>helping</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>decide</span> <span class='word'>whether</span> <span class='word'>to</span> <span class='word'>auto-vectorize</span><span class='ignore'>.</span><span class='cumsum'> [95]</span><br>
<span class='word'>Intrinsics</span> <span class='word'>are</span> <span class='word'>also</span> <span class='word'>supported</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>seem</span> <span class='word'>to</span> <span class='word'>cover</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>SVE</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>take</span> <span class='word'>a</span> <span class='word'>slightly</span> <span class='word'>different</span> <span class='word'>approach</span> <span class='word'>to</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [116]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>intrinsics</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>directly</span> <span class='word'>map</span> <span class='word'>to</span> <span class='word'>available</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>aim</span> <span class='word'>to</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>provide</span> <span class='word'>a</span> <span class='word'>regular</span> <span class='word'>interface</span> <span class='word'>and</span> <span class='word'>leave</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>to</span> <span class='word'>pick</span> <span class='word'>the</span> <span class='word'>best</span> <span class='word'>mapping</span> <span class='word'>to</span> <span class='word'>SVE</span> <span class='word'>instructions</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>while</span> <span class='word'>RVV</span> <span class='word'>intrinsics</span> <span class='ignore'>(</span><span class='word'>at</span> <span class='word'>least</span> <span class='word'>for</span> <span class='word'>memory</span><span class='ignore'>)</span> <span class='word'>tend</span> <span class='word'>to</span> <span class='word'>map</span> <span class='word'>1</span><span class='ignore'>:</span><span class='word'>1</span> <span class='word'>to</span> <span class='word'>existing</span> <span class='word'>instructions</span><span class='ignore'>.</span><span class='cumsum'> [160]</span><br>
<span class='word'>Arm's</span> <span class='word'>approach</span> <span class='word'>gives</span> <span class='word'>more</span> <span class='word'>flexibility</span> <span class='word'>for</span> <span class='word'>future</span> <span class='word'>extensions</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>intrinsics</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>compiled</span> <span class='word'>to</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>with</span> <span class='word'>newer</span> <span class='word'>compilers</span><span class='ignore'>.</span><span class='cumsum'> [181]</span><br>
<span class='cumsum'> [181]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>also</span> <span class='word'>supports</span> <span class='word'>inline</span> <span class='word'>assembly</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>experience</span> <span class='word'>is</span> <span class='word'>notably</span> <span class='word'>worse</span> <span class='word'>than</span> <span class='word'>for</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [196]</span><br>
<span class='word'>The</span> <span class='word'>two</span> <span class='word'>standout</span> <span class='word'>issues</span> <span class='word'>are</span> <span class='word'>a</span> <span class='word'>lack</span> <span class='word'>of</span> <span class='word'>register</span> <span class='word'>allocation</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>use</span> <span class='word'>of</span> <span class='word'>condition</span> <span class='word'>code</span> <span class='word'>flags</span> <span class='word'>for</span> <span class='word'>branching</span><span class='ignore'>.</span><span class='cumsum'> [215]</span><br>
<span class='word'>Unlike</span> <span class='word'>RVV</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>intrinsic</span> <span class='word'>types</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>values</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>referenced</span> <span class='word'>in</span> <span class='word'>inline</span> <span class='word'>assembly</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>stephensARMScalableVector2017</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>all</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>allocated</span> <span class='word'>and</span> <span class='word'>tracked</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>programmer</span><span class='ignore'>.</span><span class='cumsum'> [241]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE's</span> <span class='word'>equivalent</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>while</span><span class='ignore'>}</span> <span class='word'>family</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>armltdARMLanguageExtensions2020</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>return</span> <span class='word'>the</span> <span class='word'>number</span> <span class='word'>of</span> <span class='word'>updated</span> <span class='word'>elements</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>instead</span> <span class='word'>set</span> <span class='word'>the</span> <span class='word'>condition</span> <span class='word'>flags</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>how</span> <span class='word'>many</span> <span class='word'>elements</span> <span class='word'>are</span> <span class='word'>updated</span><span class='ignore'>.</span><span class='cumsum'> [270]</span><br>
<span class='word'>Because</span> <span class='word'>there</span> <span class='word'>is</span> <span class='word'>no</span> <span class='word'>way</span> <span class='word'>to</span> <span class='word'>branch</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>condition</span> <span class='word'>flags</span> <span class='word'>in</span> <span class='word'>C</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>programmer</span> <span class='word'>must</span> <span class='word'>manually</span> <span class='word'>insert</span> <span class='word'>a</span> <span class='word'>label</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>top</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>loop</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>branch</span> <span class='word'>to</span> <span class='word'>that</span> <span class='word'>label</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='word'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>godbolt.org</span><span class='ignore'>/</span><span class='ignore'>z</span><span class='ignore'>/</span><span class='ignore'>zoWh9jq3o</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>is</span> <span class='word'>more</span> <span class='word'>error</span> <span class='word'>prone</span> <span class='word'>than</span> <span class='word'>the</span> <span class='word'>RVV</span> <span class='word'>method</span><span class='ignore'>.</span><span class='cumsum'> [314]</span><br>
<span class='word'>Examples</span> <span class='word'>of</span> <span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>code</span> <span class='word'>with</span> <span class='word'>auto-vectorization</span><span class='ignore'>,</span> <span class='word'>intrinsics</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>inline</span> <span class='word'>ASM</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>found</span> <span class='word'>in</span> <span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>appendix</span> <span class='ignore'>based</span> <span class='ignore'>on</span> <span class='exclcmd'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>godbolt.org</span><span class='ignore'>/</span><span class='ignore'>z</span><span class='ignore'>/</span><span class='ignore'>zoWh9jq3o</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [329]</span><br>
<span class='cumsum'> [329]</span><br>
<span class='envir'>\begin</span><span class='envir'>{figure}</span><span class='cumsum'> [329]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [329]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.45</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [329]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=43,lastline=46]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [329]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Load</span> <span class='oword'>vector</span> <span class='oword'>from</span> <span class='oword'>capability</span> <span class='oword'>in</span> <span class='oword'>register</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>reg</span><span class='ignore'>}</span><span class='cumsum'> [335]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='exclcmd'>\hfill</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [335]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{subfigure}</span><span class='option'>[t]</span><span class='ignore'>{</span><span class='ignore'>0.54</span><span class='exclcmd'>\textwidth</span><span class='ignore'>}</span><span class='cumsum'> [335]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='exclcmd'>\centering</span><span class='cumsum'> [335]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='exclcmd'>\inputframedminted</span><span class='option'>[gobble=4,firstline=57,lastline=67]</span><span class='ignore'>{</span><span class='ignore'>c</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>.</span><span class='ignore'>/</span><span class='ignore'>code</span><span class='ignore'>/</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm.c</span><span class='ignore'>}</span><span class='cumsum'> [335]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Portable</span> <span class='oword'>code</span> <span class='oword'>for</span> <span class='oword'>CHERI</span> <span class='oword'>and</span> <span class='oword'>non-CHERI</span><span class='cmd'>\parnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>relies</span> <span class='oword'>on</span> <span class='oword'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>pure</span><span class='cmd'>\_</span><span class='oword'>capabilities</span><span class='ignore'>}</span> <span class='oword'>feature</span> <span class='oword'>flag</span><span class='ignore'>,</span> <span class='oword'>which</span> <span class='oword'>was</span> <span class='oword'>added</span> <span class='oword'>to</span> <span class='oword'>CHERI-Clang</span> <span class='oword'>for</span> <span class='oword'>this</span> <span class='oword'>project</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>portable</span><span class='ignore'>}</span><span class='cumsum'> [357]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\end</span><span class='exclenv'>{subfigure}</span><span class='cumsum'> [357]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\parnotes</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [357]</span><br>
&nbsp; &nbsp; <span class='cmd'>\caption</span><span class='ignore'>{</span><span class='oword'>Inline</span> <span class='oword'>assembly</span> <span class='oword'>examples</span> <span class='ignore'>(</span><span class='oword'>CHERI</span><span class='ignore'>)</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>inlineasmcheri</span><span class='ignore'>}</span><span class='cumsum'> [361]</span><br>
<span class='envir'>\end</span><span class='envir'>{figure}</span><span class='cumsum'> [361]</span><br>
<span class='cumsum'> [361]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [361]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Compiling</span> <span class='hword'>vector</span> <span class='hword'>code</span> <span class='hword'>with</span> <span class='hword'>CHERI-Clang</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>chericlang</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='word'>Current</span> <span class='word'>CHERI</span> <span class='word'>compiler</span> <span class='word'>work</span> <span class='word'>is</span> <span class='word'>done</span> <span class='word'>on</span> <span class='word'>CHERI-Clang</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>fork</span> <span class='word'>of</span> <span class='word'>Clang</span> <span class='word'>and</span> <span class='word'>other</span> <span class='word'>LLVM</span> <span class='word'>tools</span> <span class='word'>that</span> <span class='word'>supports</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>It's</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>LLVM</span><span class='ignore'>~</span><span class='word'>13</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>supports</span> <span class='word'>vanilla</span> <span class='word'>RVV</span> <span class='word'>v0.1</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>vector-related</span> <span class='word'>code</span> <span class='word'>had</span> <span class='word'>not</span> <span class='word'>been</span> <span class='word'>updated</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [45]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>outlines</span> <span class='word'>the</span> <span class='word'>changes</span> <span class='word'>made</span> <span class='word'>to</span> <span class='word'>CHERI-Clang</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>changes</span> <span class='word'>required</span> <span class='word'>for</span> <span class='word'>vector</span> <span class='word'>code</span><span class='ignore'>,</span> <span class='word'>to</span> <span class='word'>compile</span> <span class='word'>programs</span> <span class='word'>for</span> <span class='word'>CHERI-RVV</span><span class='ignore'>.</span><span class='cumsum'> [65]</span><br>
<span class='word'>The</span> <span class='word'>required</span> <span class='word'>command-line</span> <span class='word'>options</span> <span class='word'>for</span> <span class='word'>CHERI-Clang</span> <span class='word'>are</span> <span class='word'>shown</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>cmdline</span><span class='ignore'>_</span><span class='ignore'>cheri</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [74]</span><br>
<span class='cumsum'> [74]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Adapting</span> <span class='hword'>vector</span> <span class='hword'>assembly</span> <span class='hword'>instructions</span> <span class='hword'>to</span> <span class='hword'>CHERI</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>addingtochericlang</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>LLVM</span> <span class='word'>uses</span> <span class='word'>a</span> <span class='word'>domain-specific</span> <span class='word'>language</span> <span class='word'>to</span> <span class='word'>describe</span> <span class='word'>the</span> <span class='word'>instructions</span> <span class='word'>it</span> <span class='word'>can</span> <span class='word'>emit</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>given</span> <span class='word'>target</span><span class='ignore'>.</span><span class='cumsum'> [22]</span><br>
<span class='word'>The</span> <span class='word'>RISC-V</span> <span class='word'>target</span> <span class='word'>describes</span> <span class='word'>multiple</span> <span class='word'>register</span> <span class='word'>sets</span> <span class='word'>that</span> <span class='word'>RISC-V</span> <span class='word'>instructions</span> <span class='word'>can</span> <span class='word'>use</span><span class='ignore'>.</span><span class='cumsum'> [34]</span><br>
<span class='word'>Vanilla</span> <span class='word'>RVV</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>use</span> <span class='word'>the</span> <span class='word'>General</span> <span class='word'>Purpose</span> <span class='word'>Registers</span> <span class='ignore'>(</span><span class='word'>GPR</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>store</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>address</span> <span class='word'>of</span> <span class='word'>each</span> <span class='word'>access</span><span class='ignore'>.</span><span class='cumsum'> [53]</span><br>
<span class='word'>CHERI-Clang</span> <span class='word'>added</span> <span class='word'>a</span> <span class='word'>GPCR</span> <span class='word'>set</span><span class='ignore'>,</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>the</span> <span class='word'>General</span> <span class='word'>Purpose</span> <span class='word'>Capability</span> <span class='word'>Registers</span><span class='ignore'>.</span><span class='cumsum'> [64]</span><br>
<span class='word'>As</span> <span class='word'>noted</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>emu</span><span class='ignore'>:</span><span class='ignore'>rvv</span><span class='ignore'>_</span><span class='ignore'>int</span><span class='ignore'>_</span><span class='ignore'>mode</span><span class='ignore'>}</span> <span class='word'>CHERI-RVV</span> <span class='word'>requires</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>integer</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>and</span><span class='ignore'>}</span> <span class='word'>capability</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>therefore</span> <span class='word'>two</span> <span class='word'>versions</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>accesses</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>created</span><span class='ignore'>:</span> <span class='word'>versions</span> <span class='word'>which</span> <span class='word'>take</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>base</span> <span class='word'>address</span><span class='ignore'>,</span> <span class='word'>only</span> <span class='word'>available</span> <span class='word'>in</span> <span class='word'>CHERI</span><span class='ignore'>/</span><span class='word'>Capability</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>versions</span> <span class='word'>which</span> <span class='word'>take</span> <span class='word'>integer</span> <span class='word'>base</span> <span class='word'>addresses</span> <span class='word'>for</span> <span class='word'>Integer</span> <span class='word'>mode</span><span class='ignore'>.</span><span class='cumsum'> [112]</span><br>
<span class='cumsum'> [112]</span><br>
<span class='word'>With</span> <span class='word'>the</span> <span class='word'>above</span> <span class='word'>changes</span><span class='ignore'>,</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>insert</span> <span class='word'>capability-enabled</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>reg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [126]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>this</span> <span class='word'>requires</span> <span class='word'>using</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>register</span> <span class='word'>constraint</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>address</span><span class='ignore'>,</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>code</span> <span class='word'>written</span> <span class='word'>for</span> <span class='word'>CHERI-RVV</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>inherently</span> <span class='word'>compatible</span> <span class='word'>with</span> <span class='word'>vanilla</span> <span class='word'>RVV</span><span class='ignore'>.</span><span class='cumsum'> [152]</span><br>
<span class='word'>For</span> <span class='word'>un-annotated</span> <span class='word'>pointers</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>int</span><span class='ignore'>*</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>only</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>code</span> <span class='word'>and</span> <span class='word'>integers</span> <span class='word'>in</span> <span class='word'>legacy</span> <span class='word'>or</span> <span class='word'>hybrid</span> <span class='word'>code</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>conditional</span> <span class='word'>macro</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>used</span> <span class='word'>to</span> <span class='word'>insert</span> <span class='word'>the</span> <span class='word'>correct</span> <span class='word'>constraint</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>portable</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [182]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>falls</span> <span class='word'>apart</span> <span class='word'>in</span> <span class='word'>hybrid</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>manually</span> <span class='word'>annotated</span> <span class='word'>pointers</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>int</span><span class='ignore'>*</span> <span class='cmd'>\_</span><span class='cmd'>\_</span><span class='word'>capability</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>because</span> <span class='word'>the</span> <span class='word'>macro</span> <span class='word'>cannot</span> <span class='word'>detect</span> <span class='word'>the</span> <span class='word'>annotation</span><span class='ignore'>.</span><span class='cumsum'> [203]</span><br>
<span class='cumsum'> [203]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Adapting</span> <span class='hword'>vector</span> <span class='hword'>intrinsics</span> <span class='hword'>to</span> <span class='hword'>CHERI</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='word'>Vector</span> <span class='word'>intrinsics</span> <span class='word'>are</span> <span class='word'>another</span> <span class='word'>story</span> <span class='word'>entirely</span><span class='ignore'>.</span><span class='cumsum'> [11]</span><br>
<span class='word'>When</span> <span class='word'>compiling</span> <span class='word'>for</span> <span class='word'>pure-capability</span> <span class='word'>libraries</span><span class='ignore'>,</span> <span class='word'>all</span> <span class='word'>attempts</span> <span class='word'>to</span> <span class='word'>use</span> <span class='word'>vector</span> <span class='word'>intrinsics</span> <span class='word'>crash</span> <span class='word'>CHERI-Clang</span><span class='ignore'>.</span><span class='cumsum'> [24]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>due</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>similar</span> <span class='word'>issue</span> <span class='word'>to</span> <span class='word'>inline</span> <span class='word'>assembly</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>intrinsics</span> <span class='ignore'>(</span><span class='word'>both</span> <span class='word'>the</span> <span class='word'>Clang</span> <span class='word'>intrinsic</span> <span class='word'>functions</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>underlying</span> <span class='word'>LLVM</span> <span class='word'>IR</span> <span class='word'>intrinsics</span><span class='ignore'>)</span> <span class='word'>were</span> <span class='word'>designed</span> <span class='word'>to</span> <span class='word'>take</span> <span class='word'>regular</span> <span class='word'>pointers</span> <span class='word'>and</span> <span class='word'>cannot</span> <span class='word'>handle</span> <span class='word'>it</span> <span class='word'>when</span> <span class='word'>capabilities</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>instead</span><span class='ignore'>.</span><span class='cumsum'> [62]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>Appendix</span> <span class='ignore'>which</span> <span class='ignore'>covers</span> <span class='ignore'>what</span> <span class='ignore'>I</span> <span class='ignore'>know</span> <span class='ignore'>so</span> <span class='ignore'>far</span> <span class='ignore'>about</span> <span class='ignore'>this</span> <span class='ignore'>problem</span><span class='ignore'>?</span><span class='ignore'>}</span><span class='cumsum'> [62]</span><br>
<span class='word'>Unfortunately</span> <span class='word'>the</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>generating</span> <span class='word'>the</span> <span class='word'>intrinsics</span> <span class='word'>is</span> <span class='word'>spread</span> <span class='word'>across</span> <span class='word'>many</span> <span class='word'>files</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>there's</span> <span class='word'>no</span> <span class='word'>simple</span> <span class='word'>way</span> <span class='word'>to</span> <span class='word'>change</span> <span class='word'>the</span> <span class='word'>pointers</span> <span class='word'>to</span> <span class='word'>capabilities</span> <span class='ignore'>(</span><span class='word'>much</span> <span class='word'>less</span> <span class='word'>changing</span> <span class='word'>it</span> <span class='word'>on-the-fly</span> <span class='word'>for</span> <span class='word'>pure</span> <span class='word'>capability</span> <span class='word'>vs</span><span class='ignore'>.</span> <span class='word'>hybrid</span> <span class='word'>mode</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [96]</span><br>
<span class='cumsum'> [96]</span><br>
<span class='word'>It</span> <span class='word'>seems</span> <span class='word'>that</span> <span class='word'>significant</span> <span class='word'>engineering</span> <span class='word'>work</span> <span class='word'>is</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>bring</span> <span class='word'>vector</span> <span class='word'>intrinsics</span> <span class='word'>up</span> <span class='word'>to</span> <span class='word'>scratch</span> <span class='word'>on</span> <span class='word'>CHERI-Clang</span><span class='ignore'>.</span><span class='cumsum'> [113]</span><br>
<span class='word'>We</span> <span class='word'>did</span> <span class='word'>experiment</span> <span class='word'>with</span> <span class='word'>creating</span> <span class='word'>replacement</span> <span class='word'>wrapper</span> <span class='word'>functions</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>each</span> <span class='word'>function</span> <span class='word'>tried</span> <span class='word'>to</span> <span class='word'>mimic</span> <span class='word'>an</span> <span class='word'>intrinsic</span> <span class='word'>using</span> <span class='word'>inline</span> <span class='word'>asssembly</span><span class='ignore'>.</span><span class='cumsum'> [132]</span><br>
<span class='word'>These</span> <span class='word'>were</span> <span class='word'>rejected</span> <span class='word'>for</span> <span class='word'>two</span> <span class='word'>reasons</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>increased</span> <span class='word'>overhead</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>function</span> <span class='word'>call</span> <span class='word'>on</span> <span class='word'>every</span> <span class='word'>vector</span> <span class='word'>instruction</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>We</span> <span class='oword'>tried</span> <span class='oword'>using</span> <span class='oword'>preprocessor</span> <span class='oword'>macros</span> <span class='oword'>instead</span> <span class='oword'>of</span> <span class='oword'>real</span> <span class='oword'>functions</span><span class='ignore'>,</span> <span class='oword'>but</span> <span class='oword'>they</span> <span class='oword'>are</span> <span class='oword'>difficult</span> <span class='oword'>to</span> <span class='oword'>program</span> <span class='oword'>and</span> <span class='oword'>do</span> <span class='oword'>not</span> <span class='oword'>support</span> <span class='oword'>returning</span> <span class='oword'>values</span> <span class='oword'>like</span> <span class='oword'>intrinsics</span> <span class='oword'>do</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>lack</span> <span class='word'>of</span> <span class='word'>support</span> <span class='word'>for</span> <span class='word'>passing</span> <span class='word'>vector</span> <span class='word'>types</span> <span class='word'>as</span> <span class='word'>arguments</span> <span class='word'>or</span> <span class='word'>return</span> <span class='word'>values</span><span class='ignore'>.</span><span class='cumsum'> [187]</span><br>
<span class='word'>The</span> <span class='word'>RISC-V</span> <span class='word'>ABI</span> <span class='word'>treats</span> <span class='word'>all</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>as</span> <span class='word'>temporary</span> <span class='word'>and</span> <span class='word'>explicitly</span> <span class='word'>states</span> <span class='word'>that</span> <span class='cmd'>\enquote</span><span class='ignore'>{</span><span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>used</span> <span class='word'>for</span> <span class='word'>passing</span> <span class='word'>arguments</span> <span class='word'>or</span> <span class='word'>return</span> <span class='word'>values</span><span class='ignore'>}</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RISCV-ABI-v1.0rc2</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [211]</span><br>
<span class='word'>CHERI-Clang</span> <span class='word'>would</span> <span class='word'>try</span> <span class='word'>to</span> <span class='word'>return</span> <span class='word'>them</span> <span class='word'>by</span> <span class='word'>saving</span> <span class='word'>them</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>had</span> <span class='word'>its</span> <span class='word'>own</span> <span class='word'>issues</span><span class='ignore'>.</span><span class='cumsum'> [229]</span><br>
<span class='comment'>% Even if we wanted to change that, because the registers and CHERI has its own issues with saving vector registers on the stack.</span><span class='cumsum'> [229]</span><br>
<span class='cumsum'> [229]</span><br>
<span class='comment'>% \todomark{segue into saving registers on stack doesn't make sense - doesn't explain why someone would want to}</span><span class='cumsum'> [229]</span><br>
<span class='cumsum'> [229]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Storing</span> <span class='hword'>scalable</span> <span class='hword'>vectors</span> <span class='hword'>on</span> <span class='hword'>the</span> <span class='hword'>stack</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>If</span> <span class='word'>a</span> <span class='word'>program</span> <span class='word'>uses</span> <span class='word'>more</span> <span class='word'>data</span> <span class='word'>than</span> <span class='word'>can</span> <span class='word'>fit</span> <span class='word'>in</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>calls</span> <span class='word'>a</span> <span class='word'>function</span> <span class='word'>which</span> <span class='word'>may</span> <span class='word'>overwrite</span> <span class='word'>important</span> <span class='word'>register</span> <span class='word'>values</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>will</span> <span class='word'>save</span> <span class='word'>those</span> <span class='word'>register</span> <span class='word'>values</span> <span class='word'>to</span> <span class='word'>memory</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>.</span><span class='cumsum'> [39]</span><br>
<span class='word'>Because</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>are</span> <span class='word'>temporary</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>thus</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>overwritten</span> <span class='word'>by</span> <span class='word'>called</span> <span class='word'>functions</span><span class='ignore'>,</span> <span class='word'>they</span> <span class='word'>must</span> <span class='word'>also</span> <span class='word'>be</span> <span class='word'>saved</span><span class='ignore'>/</span><span class='word'>restored</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>stack</span><span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>Example</span> <span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>godbolt.org</span><span class='ignore'>/</span><span class='ignore'>z</span><span class='ignore'>/</span><span class='ignore'>KPTW7rcvY</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [61]</span><br>
<span class='word'>This</span> <span class='word'>also</span> <span class='word'>applies</span> <span class='word'>to</span> <span class='word'>multiprocessing</span> <span class='word'>systems</span> <span class='word'>where</span> <span class='word'>a</span> <span class='word'>process</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>paused</span><span class='ignore'>,</span> <span class='word'>have</span> <span class='word'>the</span> <span class='word'>state</span> <span class='word'>saved</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>resume</span> <span class='word'>later</span><span class='ignore'>.</span><span class='cumsum'> [80]</span><br>
<span class='word'>RVV</span> <span class='word'>provides</span> <span class='word'>the</span> <span class='word'>whole-register</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>explicitly</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>this</span> <span class='word'>process</span> <span class='word'>easy</span><span class='ignore'>.</span><span class='cumsum'> [93]</span><br>
<span class='cumsum'> [93]</span><br>
<span class='word'>CHERI-Clang</span> <span class='word'>contains</span> <span class='word'>an</span> <span class='word'>LLVM</span> <span class='word'>IR</span> <span class='word'>pass</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='cmd'>\gitfile</span><span class='ignore'>{</span><span class='oword'>llvm</span><span class='ignore'>/</span><span class='oword'>lib</span><span class='ignore'>/</span><span class='oword'>CodeGen</span><span class='ignore'>/</span><span class='oword'>CheriBoundAllocas.cpp</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='oword'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='oword'>llvm-project</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>github.com</span><span class='ignore'>/</span><span class='ignore'>CTSRD-CHERI</span><span class='ignore'>/</span><span class='ignore'>llvm-project</span><span class='ignore'>/</span><span class='ignore'>blob</span><span class='ignore'>/</span><span class='ignore'>master</span><span class='ignore'>/</span><span class='ignore'>llvm</span><span class='ignore'>/</span><span class='ignore'>lib</span><span class='ignore'>/</span><span class='ignore'>CodeGen</span><span class='ignore'>/</span><span class='ignore'>CheriBoundAllocas.cpp</span><span class='ignore'>}</span><span class='ignore'>}</span> <span class='word'>which</span> <span class='word'>enforces</span> <span class='word'>strict</span> <span class='word'>bounds</span> <span class='word'>on</span> <span class='word'>so-called</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>stack</span> <span class='word'>capabilities</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='ignore'>(</span><span class='word'>capabilities</span> <span class='word'>pointing</span> <span class='word'>to</span> <span class='word'>stack-allocated</span> <span class='word'>data</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>by</span> <span class='word'>definition</span> <span class='word'>requires</span> <span class='word'>knowing</span> <span class='word'>the</span> <span class='word'>size</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>data</span> <span class='word'>ahead</span> <span class='word'>of</span> <span class='word'>time</span><span class='ignore'>.</span><span class='cumsum'> [131]</span><br>
<span class='word'>This</span> <span class='word'>pass</span> <span class='word'>assumes</span> <span class='word'>all</span> <span class='word'>stack-allocated</span> <span class='word'>data</span> <span class='word'>has</span> <span class='word'>a</span> <span class='word'>static</span> <span class='word'>size</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>crashes</span> <span class='word'>when</span> <span class='word'>dynamically-sized</span> <span class='word'>types</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>scalable</span> <span class='word'>vectors</span> <span class='word'>are</span> <span class='word'>allocated</span><span class='ignore'>.</span><span class='cumsum'> [151]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>therefore</span> <span class='word'>impossible</span> <span class='ignore'>(</span><span class='word'>for</span> <span class='word'>now</span><span class='ignore'>)</span> <span class='word'>to</span> <span class='word'>save</span> <span class='word'>vectors</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span> <span class='word'>in</span> <span class='word'>CHERI-Clang</span><span class='ignore'>,</span> <span class='word'>although</span> <span class='word'>it's</span> <span class='word'>clear</span> <span class='word'>that</span> <span class='word'>it's</span> <span class='word'>theoretically</span> <span class='word'>possible</span><span class='ignore'>.</span><span class='cumsum'> [172]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>required</span> <span class='word'>vector</span> <span class='word'>allocations</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>calculated</span> <span class='word'>based</span> <span class='word'>on</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>before</span> <span class='word'>each</span> <span class='word'>stack</span> <span class='word'>allocation</span> <span class='word'>is</span> <span class='word'>performed</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>if</span> <span class='word'>performance</span> <span class='word'>is</span> <span class='word'>a</span> <span class='word'>concern</span> <span class='word'>stack</span> <span class='word'>bounds</span> <span class='word'>for</span> <span class='word'>those</span> <span class='word'>allocations</span> <span class='word'>could</span> <span class='word'>potentially</span> <span class='word'>be</span> <span class='word'>ignored</span> <span class='word'>altogether</span><span class='ignore'>.</span><span class='cumsum'> [209]</span><br>
<span class='word'>These</span> <span class='word'>possibilities</span> <span class='word'>are</span> <span class='word'>investigated</span> <span class='word'>further</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>next</span> <span class='word'>section</span><span class='ignore'>.</span><span class='cumsum'> [218]</span><br>
<span class='cumsum'> [218]</span><br>
<span class='cmd'>\pagebreak</span><span class='cumsum'> [218]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_30Software/sub50_hyp}</span><span class='cumsum'> [218]</span><br>
<span class='cumsum'> [218]</span><br>
<span class='comment'>% --- Start of included file ./1_30Software/sub50_hyp.tex</span><span class='cumsum'> [218]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Evaluating</span> <span class='hword'>hypotheses</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>hypotheses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>sw</span><span class='ignore'>_</span><span class='word'>vec</span><span class='ignore'>_</span><span class='word'>legacy</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Compiling</span><span class='ignore'>/</span><span class='word'>running</span> <span class='word'>legacy</span> <span class='word'>code</span> <span class='word'>in</span> <span class='word'>integer</span> <span class='word'>mode</span><span class='ignore'>}</span><span class='cumsum'> [13]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>true</span> <span class='word'>for</span> <span class='word'>CHERI-RVV</span><span class='ignore'>,</span> <span class='word'>when</span> <span class='word'>running</span> <span class='word'>the</span> <span class='word'>compiled</span> <span class='word'>programs</span> <span class='word'>in</span> <span class='word'>integer</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>programs</span> <span class='word'>only</span> <span class='word'>access</span> <span class='word'>memory</span> <span class='word'>within</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>.</span><span class='cumsum'> [37]</span><br>
<span class='cumsum'> [37]</span><br>
<span class='word'>All</span> <span class='word'>vanilla</span> <span class='word'>RVV</span> <span class='word'>instructions</span> <span class='word'>have</span> <span class='word'>counterparts</span> <span class='word'>with</span> <span class='word'>identical</span> <span class='word'>encodings</span> <span class='word'>and</span> <span class='word'>behaviour</span> <span class='word'>in</span> <span class='word'>CHERI-RVV</span> <span class='word'>integer</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>assuming</span> <span class='word'>the</span> <span class='word'>accessed</span> <span class='word'>addresses</span> <span class='word'>are</span> <span class='word'>all</span> <span class='word'>accessible</span> <span class='word'>through</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>.</span><span class='cumsum'> [62]</span><br>
<span class='word'>There</span> <span class='word'>are</span> <span class='word'>no</span> <span class='word'>changes</span> <span class='word'>to</span> <span class='word'>instruction</span> <span class='word'>behaviour</span> <span class='word'>that</span> <span class='word'>require</span> <span class='word'>the</span> <span class='word'>compiler's</span> <span class='word'>handling</span> <span class='word'>of</span> <span class='word'>them</span> <span class='word'>to</span> <span class='word'>change</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>a</span> <span class='word'>non-CHERI</span> <span class='word'>compiler</span> <span class='word'>and</span> <span class='word'>an</span> <span class='word'>integer-mode-CHERI</span> <span class='word'>compiler</span> <span class='word'>can</span> <span class='word'>always</span> <span class='word'>produce</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>from</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>code</span><span class='ignore'>.</span><span class='cumsum'> [97]</span><br>
<span class='word'>This</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='word'>capability-mode-CHERI</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>integer</span> <span class='word'>addressing</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>supported</span> <span class='word'>in</span> <span class='word'>capability-mode-CHERI-RVV</span><span class='ignore'>.</span><span class='cumsum'> [111]</span><br>
<span class='cumsum'> [111]</span><br>
<span class='word'>All</span> <span class='word'>legacy</span> <span class='word'>vector</span> <span class='word'>programs</span> <span class='word'>should</span> <span class='word'>produce</span> <span class='word'>equivalent</span> <span class='word'>binaries</span> <span class='word'>when</span> <span class='word'>compiled</span> <span class='word'>for</span> <span class='word'>integer-mode-CHERI</span><span class='ignore'>.</span><span class='cumsum'> [123]</span><br>
<span class='word'>On</span> <span class='word'>top</span> <span class='word'>of</span> <span class='word'>that</span><span class='ignore'>,</span> <span class='word'>all</span> <span class='word'>binaries</span> <span class='word'>compiled</span> <span class='word'>for</span> <span class='word'>non-CHERI</span> <span class='word'>RVV</span> <span class='word'>platforms</span> <span class='word'>should</span> <span class='word'>produce</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>results</span> <span class='word'>when</span> <span class='word'>run</span> <span class='word'>on</span> <span class='word'>an</span> <span class='word'>equivalent</span> <span class='word'>integer-mode-CHERI</span> <span class='word'>RVV</span> <span class='word'>platform</span><span class='ignore'>.</span><span class='cumsum'> [147]</span><br>
<span class='word'>Both</span> <span class='word'>claims</span> <span class='word'>assume</span> <span class='word'>the</span> <span class='word'>program</span> <span class='word'>doesn't</span> <span class='word'>perform</span> <span class='word'>accesses</span> <span class='word'>that</span> <span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>violate</span><span class='ignore'>?</span> <span class='ignore'>exceed</span><span class='ignore'>?</span><span class='ignore'>}</span> <span class='word'>the</span> <span class='word'>DDC</span><span class='ignore'>.</span><span class='cumsum'> [158]</span><br>
<span class='cumsum'> [158]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>sw</span><span class='ignore'>_</span><span class='word'>pure</span><span class='ignore'>_</span><span class='word'>compat</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Converting</span> <span class='word'>legacy</span> <span class='word'>code</span> <span class='word'>to</span> <span class='word'>pure-capability</span> <span class='word'>code</span><span class='ignore'>}</span><span class='cumsum'> [168]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>true</span> <span class='word'>for</span> <span class='word'>CHERI-RVV</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>done</span> <span class='word'>in</span> <span class='word'>practice</span> <span class='word'>yet</span><span class='ignore'>.</span><span class='cumsum'> [180]</span><br>
<span class='word'>Some</span> <span class='word'>engineering</span> <span class='word'>effort</span> <span class='word'>is</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>this</span> <span class='word'>in</span> <span class='word'>CHERI-Clang</span><span class='ignore'>.</span><span class='cumsum'> [190]</span><br>
<span class='word'>Because</span> <span class='word'>this</span> <span class='word'>argument</span> <span class='word'>concerns</span> <span class='word'>source</span> <span class='word'>code</span><span class='ignore'>,</span> <span class='word'>all</span> <span class='word'>three</span> <span class='word'>ways</span> <span class='word'>to</span> <span class='word'>generate</span> <span class='word'>CHERI-RVV</span> <span class='word'>instructions</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>examined</span><span class='ignore'>.</span><span class='cumsum'> [206]</span><br>
<span class='cumsum'> [206]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Inline</span> <span class='hword'>Assembly</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='hword'>Unlikely</span><span class='ignore'>}</span><span class='cumsum'> [209]</span><br>
<span class='word'>For</span> <span class='word'>GCC-style</span> <span class='word'>inline</span> <span class='word'>assembly</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>currently</span> <span class='word'>impossible</span> <span class='word'>for</span> <span class='word'>integer-addressed</span> <span class='word'>RVV</span> <span class='word'>source</span> <span class='word'>code</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>recompiled</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>mode</span> <span class='word'>without</span> <span class='word'>modification</span><span class='ignore'>.</span><span class='cumsum'> [230]</span><br>
<span class='word'>Integer-addressed</span> <span class='word'>RVV</span> <span class='word'>assembly</span> <span class='word'>uses</span> <span class='word'>general-purpose</span> <span class='word'>registers</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>address</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>pure-capability</span> <span class='word'>instructions</span> <span class='word'>require</span> <span class='word'>capability</span> <span class='word'>registers</span> <span class='word'>instead</span><span class='ignore'>.</span><span class='cumsum'> [248]</span><br>
<span class='word'>The</span> <span class='word'>base</span> <span class='word'>address</span> <span class='word'>register</span> <span class='word'>can</span> <span class='word'>either</span> <span class='word'>be</span> <span class='word'>specified</span> <span class='word'>directly</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>changed</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>register</span><span class='ignore'>;</span> <span class='word'>or</span> <span class='word'>specified</span> <span class='word'>using</span> <span class='word'>template</span> <span class='word'>syntax</span> <span class='word'>and</span> <span class='word'>an</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>r</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>constraint</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>changed</span> <span class='word'>to</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>C</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>constraint</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>inlineasm</span><span class='ignore'>,</span><span class='ignore'>fig</span><span class='ignore'>:</span><span class='ignore'>inlineasmcheri</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [283]</span><br>
<span class='word'>Using</span> <span class='word'>a</span> <span class='word'>preprocessor</span> <span class='word'>macro</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>template</span> <span class='word'>syntax</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>portable</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>could</span> <span class='word'>make</span> <span class='word'>code</span> <span class='word'>portable</span> <span class='word'>between</span> <span class='word'>non-CHERI</span> <span class='word'>and</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>adding</span> <span class='word'>it</span> <span class='word'>still</span> <span class='word'>requires</span> <span class='word'>source</span> <span class='word'>code</span> <span class='word'>changes</span><span class='ignore'>.</span><span class='cumsum'> [308]</span><br>
<span class='cumsum'> [308]</span><br>
<span class='word'>In</span> <span class='word'>theory</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>could</span> <span class='word'>change</span> <span class='word'>the</span> <span class='word'>behaviour</span> <span class='word'>of</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>to</span> <span class='word'>automatically</span> <span class='word'>convert</span> <span class='word'>general</span> <span class='word'>purpose</span> <span class='word'>registers</span><span class='ignore'>/</span><span class='word'>constraints</span> <span class='word'>to</span> <span class='word'>capability</span> <span class='word'>versions</span> <span class='word'>in</span> <span class='word'>specific</span> <span class='word'>circumstances</span><span class='ignore'>.</span><span class='cumsum'> [331]</span><br>
<span class='word'>However</span><span class='ignore'>,</span> <span class='word'>this</span> <span class='word'>can</span> <span class='word'>have</span> <span class='word'>wide-reaching</span> <span class='word'>ramifications</span><span class='ignore'>,</span> <span class='word'>potentially</span> <span class='word'>making</span> <span class='word'>code</span> <span class='word'>more</span> <span class='word'>difficult</span> <span class='word'>to</span> <span class='word'>understand</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>even</span> <span class='word'>breaking</span> <span class='word'>existing</span> <span class='word'>code</span><span class='ignore'>.</span><span class='cumsum'> [349]</span><br>
<span class='cumsum'> [349]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Intrinsics</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='hword'>Yes</span><span class='ignore'>}</span><span class='cumsum'> [351]</span><br>
<span class='word'>The</span> <span class='word'>current</span> <span class='word'>specification</span> <span class='word'>for</span> <span class='word'>RVV</span> <span class='word'>intrinsics</span> <span class='word'>uses</span> <span class='word'>pointer</span> <span class='word'>types</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>base</span> <span class='word'>addresses</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-intrinsics</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [364]</span><br>
<span class='word'>In</span> <span class='word'>pure-capability</span> <span class='word'>compilers</span> <span class='word'>all</span> <span class='word'>pointers</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>treated</span> <span class='word'>as</span> <span class='word'>capabilities</span> <span class='word'>instead</span> <span class='word'>of</span> <span class='word'>integers</span><span class='ignore'>,</span> <span class='word'>including</span> <span class='word'>those</span> <span class='word'>in</span> <span class='word'>intrinsics</span><span class='ignore'>.</span><span class='cumsum'> [381]</span><br>
<span class='word'>All</span> <span class='word'>RVV</span> <span class='word'>memory</span> <span class='word'>intrinsics</span> <span class='word'>have</span> <span class='word'>equivalent</span> <span class='word'>RVV</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>all</span> <span class='word'>use</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>changing</span> <span class='word'>the</span> <span class='word'>intrinsics</span> <span class='word'>to</span> <span class='word'>match</span> <span class='word'>is</span> <span class='word'>valid</span><span class='ignore'>.</span><span class='cumsum'> [404]</span><br>
<span class='cumsum'> [404]</span><br>
<span class='word'>Assuming</span> <span class='word'>all</span> <span class='word'>base</span> <span class='word'>address</span> <span class='word'>pointers</span> <span class='word'>are</span> <span class='word'>created</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>manner</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>through</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>malloc</span><span class='ignore'>}</span> <span class='word'>or</span> <span class='word'>monotonic</span> <span class='word'>decrease</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>not</span> <span class='word'>through</span> <span class='word'>integer</span> <span class='word'>literals</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>conversion</span> <span class='word'>to</span> <span class='word'>pure-capability</span> <span class='word'>should</span> <span class='word'>make</span> <span class='word'>them</span> <span class='word'>all</span> <span class='word'>valid</span> <span class='word'>capabilities</span> <span class='word'>which</span> <span class='word'>are</span> <span class='word'>compatible</span> <span class='word'>with</span> <span class='word'>the</span> <span class='word'>intrinsics</span><span class='ignore'>.</span><span class='cumsum'> [442]</span><br>
<span class='word'>Therefore</span> <span class='word'>well-behaved</span> <span class='word'>code</span> <span class='word'>using</span> <span class='word'>RVV</span> <span class='word'>intrinsics</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>compilable</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>mode</span> <span class='word'>without</span> <span class='word'>changes</span><span class='ignore'>.</span><span class='cumsum'> [456]</span><br>
<span class='cumsum'> [456]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>currently</span> <span class='word'>the</span> <span class='word'>case</span> <span class='word'>for</span> <span class='word'>CHERI-Clang</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>RVV</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>intrinsics</span> <span class='word'>are</span> <span class='word'>broken</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>fixed</span> <span class='word'>with</span> <span class='word'>engineering</span> <span class='word'>effort</span><span class='ignore'>.</span><span class='cumsum'> [479]</span><br>
<span class='cumsum'> [479]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Auto-vectorization</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='hword'>Yes</span><span class='ignore'>}</span><span class='cumsum'> [481]</span><br>
<span class='word'>All</span> <span class='word'>vanilla</span> <span class='word'>RVV</span> <span class='word'>instructions</span> <span class='word'>have</span> <span class='word'>counterparts</span> <span class='word'>with</span> <span class='word'>identical</span> <span class='word'>encodings</span> <span class='word'>and</span> <span class='word'>behaviour</span> <span class='word'>in</span> <span class='word'>CHERI-RVV</span> <span class='word'>pure-capability</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>assuming</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>addresses</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>converted</span> <span class='word'>to</span> <span class='word'>valid</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [506]</span><br>
<span class='word'>Any</span> <span class='word'>scalar</span> <span class='word'>code</span> <span class='word'>that</span> <span class='word'>can</span> <span class='word'>be</span> <span class='cumsum'> [512]</span><br>
<span class='envir'>\begin</span><span class='envir'>{enumerate*}</span><span class='option'>[label=\alph*)]</span><span class='cumsum'> [512]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>compiled</span> <span class='word'>in</span> <span class='word'>scalar</span> <span class='word'>pure-capability</span> <span class='word'>mode</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>ensures</span> <span class='oword'>all</span> <span class='oword'>memory</span> <span class='oword'>accesses</span> <span class='oword'>use</span> <span class='oword'>valid</span> <span class='oword'>capabilities</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span><span class='cumsum'> [526]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>auto-vectorized</span> <span class='word'>by</span> <span class='word'>a</span> <span class='word'>legacy</span> <span class='word'>RVV</span> <span class='word'>compiler</span><span class='ignore'>,</span><span class='cumsum'> [532]</span><br>
<span class='envir'>\end</span><span class='envir'>{enumerate*}</span><span class='cumsum'> [532]</span><br>
<span class='word'>must</span> <span class='word'>have</span> <span class='word'>an</span> <span class='word'>equivalent</span> <span class='word'>pure-capability</span> <span class='word'>vectorized</span> <span class='word'>form</span><span class='ignore'>.</span><span class='cumsum'> [539]</span><br>
<span class='word'>This</span> <span class='word'>form</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>acquired</span> <span class='word'>by</span> <span class='word'>performing</span> <span class='word'>the</span> <span class='word'>auto-vectorization</span> <span class='word'>in</span> <span class='word'>legacy</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>ensuring</span> <span class='word'>all</span> <span class='word'>base</span> <span class='word'>addresses</span> <span class='word'>are</span> <span class='word'>available</span> <span class='word'>as</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>making</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>use</span> <span class='word'>those</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [567]</span><br>
<span class='word'>Therefore</span> <span class='word'>a</span> <span class='word'>pure-capability</span> <span class='word'>compiler</span> <span class='word'>can</span> <span class='word'>always</span> <span class='word'>auto-vectorize</span> <span class='word'>CHERI-compliant</span> <span class='word'>scalar</span> <span class='word'>code</span> <span class='word'>if</span> <span class='word'>some</span> <span class='word'>legacy</span> <span class='word'>compiler</span> <span class='word'>can</span> <span class='word'>also</span> <span class='word'>auto-vectorize</span> <span class='word'>it</span><span class='ignore'>.</span><span class='cumsum'> [585]</span><br>
<span class='cumsum'> [585]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>currently</span> <span class='word'>possible</span> <span class='word'>for</span> <span class='word'>CHERI-Clang</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>RVV</span> <span class='word'>auto-vectorization</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>implemented</span> <span class='word'>yet</span><span class='ignore'>.</span><span class='cumsum'> [599]</span><br>
<span class='word'>Similar</span> <span class='word'>models</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>Arm</span> <span class='word'>SVE</span><span class='ignore'>)</span> <span class='word'>already</span> <span class='word'>have</span> <span class='word'>auto-vectorization</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>RVV</span> <span class='word'>auto-vectorization</span> <span class='ignore'>(</span><span class='word'>and</span> <span class='word'>thus</span> <span class='word'>CHERI-RVV</span> <span class='word'>auto-vectorization</span><span class='ignore'>)</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>possible</span><span class='ignore'>.</span><span class='cumsum'> [617]</span><br>
<span class='cumsum'> [617]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>sw</span><span class='ignore'>_</span><span class='word'>stack</span><span class='ignore'>_</span><span class='word'>vectors</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Saving</span> <span class='word'>vectors</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>}</span><span class='cumsum'> [626]</span><br>
<span class='comment'>% \todomark{Yes vectors can be stored on the stack}</span><span class='cumsum'> [626]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>true</span> <span class='word'>in</span> <span class='word'>theory</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>not</span> <span class='word'>yet</span> <span class='word'>supported</span> <span class='word'>by</span> <span class='word'>CHERI-Clang</span> <span class='word'>in</span> <span class='word'>practice</span><span class='ignore'>.</span><span class='cumsum'> [639]</span><br>
<span class='word'>Placing</span> <span class='word'>variable-length</span> <span class='word'>structures</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>known</span> <span class='word'>at</span> <span class='word'>runtime</span> <span class='ignore'>(</span><span class='word'>and</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>stack</span> <span class='word'>has</span> <span class='word'>space</span><span class='ignore'>,</span> <span class='word'>of</span> <span class='word'>course</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [667]</span><br>
<span class='word'>This</span> <span class='word'>isn't</span> <span class='word'>exclusive</span> <span class='word'>to</span> <span class='word'>CHERI</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='word'>to</span> <span class='word'>push</span> <span class='word'>and</span> <span class='word'>pop</span> <span class='word'>values</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>stack</span> <span class='word'>pointer</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>incremented</span> <span class='word'>or</span> <span class='word'>decremented</span> <span class='word'>by</span> <span class='word'>the</span> <span class='word'>size</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>value</span><span class='ignore'>.</span><span class='cumsum'> [694]</span><br>
<span class='word'>Because</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>already</span> <span class='word'>has</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>measured</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>supports</span> <span class='word'>setting</span> <span class='word'>capability</span> <span class='word'>bounds</span> <span class='word'>from</span> <span class='word'>runtime-computed</span> <span class='word'>values</span><span class='ignore'>,</span> <span class='word'>it's</span> <span class='word'>entirely</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>correctly</span> <span class='word'>set</span> <span class='word'>tight</span> <span class='word'>bounds</span> <span class='word'>for</span> <span class='word'>capabilities</span> <span class='word'>pointing</span> <span class='word'>to</span> <span class='word'>variable-length</span> <span class='word'>vectors</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>.</span><span class='cumsum'> [728]</span><br>
<span class='cumsum'> [728]</span><br>
<span class='comment'>% Arm SVE explicitly defines a ``sizeless type'' in the C language extensions \cite{} that may be stored on the stack, so this will need to be implemented for </span><span class='cumsum'> [728]</span><br>
<span class='comment'>% \todomark{Note: Arm Language C extensions https://developer.arm.com/documentation/100987/0000/ defines the concept of a sizeless type, which may be stored on the stack. Would be a good base for RVV?}</span><span class='cumsum'> [728]</span><br>
<span class='cumsum'> [728]</span><br>
<span class='word'>A</span> <span class='word'>minor</span> <span class='word'>complication</span> <span class='word'>is</span> <span class='word'>presented</span> <span class='word'>by</span> <span class='word'>a</span> <span class='word'>note</span> <span class='word'>in</span> <span class='word'>TR-949</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>3.8.2</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-949</span><span class='ignore'>}</span> <span class='word'>concerning</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>re-materializing</span> <span class='word'>bounded</span> <span class='word'>stack</span> <span class='word'>variables</span><span class='ignore'>'</span><span class='ignore'>'</span><span class='ignore'>.</span><span class='cumsum'> [745]</span><br>
<span class='word'>This</span> <span class='word'>section</span> <span class='word'>implies</span> <span class='word'>LLVM</span> <span class='word'>can</span> <span class='word'>try</span> <span class='word'>to</span> <span class='word'>re-create</span> <span class='word'>a</span> <span class='word'>pointer-to-stack</span> <span class='word'>at</span> <span class='word'>any</span> <span class='word'>time</span> <span class='word'>with</span> <span class='word'>minimal</span> <span class='word'>cost</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>may</span> <span class='word'>not</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='word'>vectors</span><span class='ignore'>.</span><span class='cumsum'> [771]</span><br>
<span class='word'>Measuring</span> <span class='word'>the</span> <span class='word'>bounds</span> <span class='word'>requires</span> <span class='word'>measuring</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLMAX</span><span class='ignore'>}</span> <span class='word'>by</span> <span class='word'>changing</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>could</span> <span class='word'>then</span> <span class='word'>require</span> <span class='word'>saving</span><span class='ignore'>/</span><span class='word'>restoring</span> <span class='word'>the</span> <span class='word'>old</span> <span class='word'>value</span><span class='ignore'>.</span><span class='cumsum'> [789]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>only</span> <span class='word'>a</span> <span class='word'>performance</span> <span class='word'>issue</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>worst</span> <span class='word'>case</span> <span class='word'>we</span> <span class='word'>can</span> <span class='word'>just</span> <span class='word'>say</span> <span class='word'>pointers-to-stack-vectors</span> <span class='word'>are</span> <span class='word'>not</span> <span class='word'>re-materializable</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>it</span> <span class='word'>isn't</span> <span class='word'>a</span> <span class='word'>dealbreaker</span><span class='ignore'>.</span><span class='cumsum'> [813]</span><br>
<span class='word'>Further</span> <span class='word'>investigation</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>issue</span> <span class='word'>is</span> <span class='word'>left</span> <span class='word'>as</span> <span class='word'>future</span> <span class='word'>work</span><span class='ignore'>.</span><span class='cumsum'> [823]</span><br>
<span class='comment'>% LLVM allows pointers to be non-re-materializable, so this isn't a dealbreaker, but it should be investigated in the future.</span><span class='cumsum'> [823]</span><br>
<span class='comment'>% Further investigation of this issue is left as future work.</span><span class='cumsum'> [823]</span><br>
<span class='cumsum'> [823]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>sw</span><span class='ignore'>_</span><span class='word'>multiproc</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Running</span> <span class='word'>CHERI-RVV</span> <span class='word'>code</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>multiprocessing</span> <span class='word'>system</span><span class='ignore'>}</span><span class='cumsum'> [833]</span><br>
<span class='comment'>% \todomark{H-D: Yes IFF vectors can be stored on the stack. May require a dynamic stack bounds calculation based on VLEN.}</span><span class='cumsum'> [833]</span><br>
<span class='word'>This</span> <span class='word'>requires</span> <span class='word'>two</span> <span class='word'>conditions</span><span class='ignore'>:</span> <span class='word'>an</span> <span class='word'>OS</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>save</span> <span class='word'>and</span> <span class='word'>restore</span> <span class='word'>vector</span> <span class='word'>state</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>hardware</span> <span class='word'>must</span> <span class='word'>support</span> <span class='word'>resuming</span> <span class='word'>from</span> <span class='word'>an</span> <span class='word'>interrupted</span> <span class='word'>state</span><span class='ignore'>.</span><span class='cumsum'> [859]</span><br>
<span class='word'>The</span> <span class='word'>first</span> <span class='word'>condition</span> <span class='word'>is</span> <span class='word'>easy</span> <span class='word'>to</span> <span class='word'>fulfil</span> <span class='word'>by</span> <span class='word'>extending</span> <span class='word'>the</span> <span class='word'>previous</span> <span class='word'>hypothesis</span><span class='ignore'>.</span> <span class='cumsum'> [871]</span><br>
<span class='word'>If</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>save</span> <span class='word'>variable-length</span> <span class='word'>vectors</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>stack</span><span class='ignore'>,</span> <span class='word'>given</span> <span class='word'>their</span> <span class='word'>length</span> <span class='word'>is</span> <span class='word'>known</span> <span class='word'>at</span> <span class='word'>runtime</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>must</span> <span class='word'>also</span> <span class='word'>be</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>save</span> <span class='word'>their</span> <span class='word'>data</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>heap</span><span class='ignore'>.</span><span class='cumsum'> [901]</span><br>
<span class='word'>Some</span> <span class='word'>OSs</span> <span class='word'>might</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>changes</span> <span class='word'>to</span> <span class='word'>their</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>current</span> <span class='word'>process</span> <span class='word'>state</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>structure</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>variable-length</span> <span class='word'>data</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>they</span> <span class='word'>would</span> <span class='word'>also</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>allocate</span> <span class='word'>space</span> <span class='word'>for</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vtype</span><span class='ignore'>}</span> <span class='word'>value</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>certainly</span> <span class='word'>possible</span><span class='ignore'>.</span><span class='cumsum'> [935]</span><br>
<span class='cumsum'> [935]</span><br>
<span class='word'>The</span> <span class='word'>second</span> <span class='word'>condition</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>upheld</span> <span class='word'>in</span> <span class='word'>two</span> <span class='word'>ways</span><span class='ignore'>.</span><span class='cumsum'> [944]</span><br>
<span class='word'>First</span><span class='ignore'>,</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>OS</span> <span class='word'>only</span> <span class='word'>context</span> <span class='word'>switches</span> <span class='word'>and</span> <span class='word'>services</span> <span class='word'>interrupts</span> <span class='word'>while</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>hardware</span> <span class='word'>is</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>complete</span> <span class='word'>state</span> <span class='ignore'>(</span><span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>not</span> <span class='word'>partially</span> <span class='word'>executing</span> <span class='word'>an</span> <span class='word'>instruction</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>context</span> <span class='word'>switches</span> <span class='word'>and</span> <span class='word'>interrupts</span> <span class='word'>are</span> <span class='word'>completely</span> <span class='word'>transparent</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>hardware</span> <span class='word'>and</span> <span class='word'>no</span> <span class='word'>changes</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>made</span><span class='ignore'>.</span><span class='cumsum'> [988]</span><br>
<span class='word'>Secondly</span><span class='ignore'>,</span> <span class='word'>if</span> <span class='word'>context</span> <span class='word'>switches</span> <span class='word'>and</span> <span class='word'>interrupts</span> <span class='word'>can</span> <span class='word'>actually</span> <span class='word'>interrupt</span> <span class='word'>vector</span> <span class='word'>instructions</span> <span class='word'>partway</span> <span class='word'>through</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>they</span> <span class='word'>can</span> <span class='word'>only</span> <span class='word'>be</span> <span class='word'>cleanly</span> <span class='word'>resumed</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>hardware</span> <span class='word'>supports</span> <span class='word'>precise</span> <span class='word'>traps</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>exact</span> <span class='word'>instruction</span> <span class='word'>being</span> <span class='word'>executed</span><span class='ignore'>.</span><span class='cumsum'> [1021]</span><br>
<span class='cumsum'> [1021]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Testing</span> <span class='hword'>and</span> <span class='hword'>evaluation</span><span class='ignore'>:</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>vector</span><span class='cmd'>\_</span><span class='hword'>memcpy</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>eval</span><span class='ignore'>}</span><span class='cumsum'> [5]</span><br>
<span class='word'>To</span> <span class='word'>expose</span> <span class='word'>bugs</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>CHERI-RVV</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>developed</span> <span class='word'>a</span> <span class='word'>self-checking</span> <span class='word'>test</span> <span class='word'>program</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>to</span> <span class='word'>execute</span><span class='ignore'>.</span><span class='cumsum'> [23]</span><br>
<span class='word'>At</span> <span class='word'>first</span> <span class='word'>it</span> <span class='word'>was</span> <span class='word'>hand-written</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>in</span> <span class='word'>order</span> <span class='word'>to</span> <span class='word'>test</span> <span class='word'>a</span> <span class='word'>wide</span> <span class='word'>range</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='word'>{vtype}s</span> <span class='word'>we</span> <span class='word'>now</span> <span class='word'>generate</span> <span class='word'>it</span> <span class='word'>with</span> <span class='word'>a</span> <span class='word'>Python</span> <span class='word'>script</span><span class='ignore'>.</span><span class='cumsum'> [46]</span><br>
<span class='word'>It</span> <span class='word'>consists</span> <span class='word'>of</span> <span class='word'>fifty-seven</span> <span class='word'>tests</span> <span class='word'>of</span> <span class='word'>different</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>archetypes</span> <span class='word'>under</span> <span class='word'>various</span> <span class='word'>configurations</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>vectormemcpyschemes</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [60]</span><br>
<span class='cumsum'> [60]</span><br>
<span class='comment'>% The test code is compatible with integer-mode and capability-mode CHERI (and non-CHERI) through preprocessor macros, as shown in .</span><span class='cumsum'> [60]</span><br>
<span class='cmd'>\todomark</span><span class='ignore'>{</span><span class='ignore'>Put</span> <span class='ignore'>the</span> <span class='ignore'>compatibility</span> <span class='ignore'>preprocessor</span> <span class='ignore'>stuff</span> <span class='ignore'>in</span> <span class='ignore'>the</span> <span class='ignore'>compiler</span> <span class='ignore'>appendix</span><span class='ignore'>}</span><span class='cumsum'> [60]</span><br>
<span class='word'>The</span> <span class='word'>test</span> <span class='word'>code</span> <span class='word'>will</span> <span class='word'>use</span> <span class='word'>intrinsics</span> <span class='word'>wherever</span> <span class='word'>the</span> <span class='word'>compiler</span> <span class='word'>supports</span> <span class='word'>them</span> <span class='ignore'>(</span><span class='word'>see</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>compilerdifferences</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>falls</span> <span class='word'>back</span> <span class='word'>to</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>otherwise</span><span class='ignore'>.</span><span class='cumsum'> [79]</span><br>
<span class='word'>Inline</span> <span class='word'>assembly</span> <span class='word'>uses</span> <span class='word'>the</span> <span class='word'>preprocessor</span> <span class='word'>macro</span> <span class='word'>from</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>subfig</span><span class='ignore'>:</span><span class='ignore'>inline</span><span class='ignore'>_</span><span class='ignore'>asm</span><span class='ignore'>_</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>portable</span><span class='ignore'>}</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>CHERI</span> <span class='word'>and</span> <span class='word'>non-CHERI</span> <span class='word'>platforms</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='comment'>% On CHERI platforms, which don't support intrinsics, the preprocessor macro from \todoref{preprocessor macro} is used to support inline ASM.</span><span class='cumsum'> [92]</span><br>
<span class='comment'>% Where the compiler supports intrinsics, the test code will use them, and otherwiuse</span><span class='cumsum'> [92]</span><br>
<span class='comment'>% Based on the compiler version, the test code runs operations with intrinsics where</span><span class='cumsum'> [92]</span><br>
<span class='comment'>% To make up for inconsistent RVV support, the test code checks the compiler version and implements operations with inline assembly or intrinsics as supported.</span><span class='cumsum'> [92]</span><br>
<span class='comment'>% Because the compilers don't have consistent RVV support (see \cref{compilerdifferences})</span><span class='cumsum'> [92]</span><br>
<span class='cumsum'> [92]</span><br>
<span class='word'>These</span> <span class='word'>tests</span> <span class='word'>are</span> <span class='word'>run</span> <span class='word'>under</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>harnesses</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>provide</span> <span class='word'>setup</span> <span class='word'>and</span> <span class='word'>self-checking</span> <span class='word'>code</span> <span class='word'>for</span> <span class='word'>common</span> <span class='word'>cases</span><span class='ignore'>:</span><span class='cumsum'> [107]</span><br>
<span class='word'>The</span> <span class='word'>Vanilla</span> <span class='word'>harness</span> <span class='word'>tests</span> <span class='word'>a</span> <span class='word'>simple</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>between</span> <span class='word'>two</span> <span class='word'>arrays</span><span class='ignore'>;</span><span class='cumsum'> [117]</span><br>
<span class='word'>Masked</span> <span class='word'>tests</span> <span class='word'>that</span> <span class='word'>every</span> <span class='word'>other</span> <span class='word'>element</span> <span class='word'>is</span> <span class='word'>copied</span><span class='ignore'>,</span> <span class='word'>not</span> <span class='word'>all</span> <span class='word'>of</span> <span class='word'>them</span><span class='ignore'>;</span><span class='cumsum'> [129]</span><br>
<span class='word'>Segmented</span> <span class='word'>tests</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>into</span> <span class='word'>four</span> <span class='word'>separate</span> <span class='word'>output</span> <span class='word'>arrays</span><span class='ignore'>,</span> <span class='word'>each</span> <span class='word'>a</span> <span class='word'>different</span> <span class='word'>field</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>four-field</span> <span class='word'>structure</span><span class='ignore'>.</span><span class='cumsum'> [146]</span><br>
<span class='word'>There</span> <span class='word'>is</span> <span class='word'>also</span> <span class='word'>a</span> <span class='word'>special</span> <span class='word'>test</span> <span class='word'>for</span> <span class='word'>fault-only-first</span><span class='ignore'>:</span> <span class='word'>FoF</span> <span class='word'>loads</span> <span class='word'>are</span> <span class='word'>performed</span> <span class='word'>at</span> <span class='word'>the</span> <span class='word'>edge</span> <span class='word'>of</span> <span class='word'>mapped</span> <span class='word'>memory</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>test</span> <span class='word'>shows</span> <span class='word'>that</span> <span class='word'>out-of-bounds</span> <span class='word'>exceptions</span> <span class='word'>are</span> <span class='word'>swallowed</span> <span class='word'>and</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vl</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>reduced</span> <span class='word'>accordingly</span><span class='ignore'>.</span><span class='cumsum'> [178]</span><br>
<span class='word'>All</span> <span class='word'>tests</span> <span class='word'>were</span> <span class='word'>successful</span> <span class='word'>when</span> <span class='word'>they</span> <span class='word'>ran</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>some</span> <span class='word'>testbenches</span> <span class='word'>could</span> <span class='word'>not</span> <span class='word'>be</span> <span class='word'>built</span> <span class='word'>with</span> <span class='word'>some</span> <span class='word'>compilers</span><span class='ignore'>.</span><span class='cumsum'> [195]</span><br>
<span class='word'>The</span> <span class='word'>full</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>test</span> <span class='word'>results</span> <span class='word'>is</span> <span class='word'>available</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>fullresults</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [204]</span><br>
<span class='cumsum'> [204]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[h]</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [204]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>lcc</span><span class='ignore'>}</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\toprule</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Test</span> <span class='ignore'>Scheme</span> <span class='ignore'>&amp;</span> <span class='ignore'>Harness</span> <span class='ignore'>&amp;</span> <span class='ignore'>Compilers</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\midrule</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Unit</span> <span class='ignore'>Stride</span> <span class='ignore'>&amp;</span> <span class='ignore'>Vanilla</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Strided</span> <span class='ignore'>&amp;</span> <span class='ignore'>Vanilla</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Indexed</span> <span class='ignore'>&amp;</span> <span class='ignore'>Vanilla</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Whole</span> <span class='ignore'>Register</span> <span class='ignore'>&amp;</span> <span class='ignore'>Vanilla</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Fault-only-First</span> <span class='ignore'>&amp;</span> <span class='ignore'>Vanilla</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cumsum'> [204]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='ignore'>Unit</span> <span class='ignore'>Stride</span> <span class='ignore'>(</span><span class='ignore'>Masked</span><span class='ignore'>)</span> <span class='ignore'>&amp;</span> <span class='ignore'>Masked</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='ignore'>Bytemask</span> <span class='ignore'>Load</span> <span class='ignore'>&amp;</span> <span class='ignore'>Masked</span> <span class='ignore'>&amp;</span> <span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>llvm-15</span><span class='ignore'>}</span> <span class='ignore'>only</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cumsum'> [204]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='ignore'>Unit</span> <span class='ignore'>Stride</span> <span class='ignore'>(</span><span class='ignore'>Segmented</span><span class='ignore'>)</span> <span class='ignore'>&amp;</span> <span class='ignore'>Segmented</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
<span class='cumsum'> [204]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class='ignore'>Fault-only-First</span> <span class='ignore'>Boundary</span> <span class='ignore'>&amp;</span> <span class='ignore'>-</span><span class='ignore'>-</span><span class='ignore'>-</span> <span class='ignore'>&amp;</span> <span class='ignore'>All</span> <span class='exclcmd'>\\</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\bottomrule</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [204]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vector</span><span class='exclcmd'>\_</span><span class='ignore'>memcpy</span><span class='ignore'>}</span> <span class='ignore'>test</span> <span class='ignore'>schemes</span> <span class='ignore'>and</span> <span class='ignore'>harnesses</span><span class='ignore'>}</span><span class='cumsum'> [204]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>vectormemcpyschemes</span><span class='ignore'>}</span><span class='cumsum'> [204]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [204]</span><br>
<span class='cumsum'> [204]</span><br>
<span class='comment'>% --- End of included file ./1_30Software/sub50_hyp.tex</span><span class='cumsum'> [204]</span><br>
<span class='cumsum'> [204]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_30Software/sub60_chericlangchanges}</span><span class='cumsum'> [204]</span><br>
<span class='cumsum'> [204]</span><br>
<span class='comment'>% --- Start of included file ./1_30Software/sub60_chericlangchanges.tex</span><span class='cumsum'> [204]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Recommended</span> <span class='hword'>changes</span> <span class='hword'>for</span> <span class='hword'>CHERI-Clang</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>chericlangchanges</span><span class='ignore'>}</span><span class='cumsum'> [4]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [4]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Build</span> <span class='word'>on</span> <span class='word'>current</span> <span class='word'>work</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>all</span> <span class='word'>RVV</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>and</span> <span class='word'>pseudoinstructions</span> <span class='word'>CHERI-compatible</span><span class='ignore'>.</span><span class='cumsum'> [18]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Make</span> <span class='word'>RVV</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>intrinsics</span> <span class='word'>take</span> <span class='word'>capabilities</span> <span class='word'>as</span> <span class='word'>arguments</span> <span class='word'>when</span> <span class='word'>compiled</span> <span class='word'>in</span> <span class='word'>pure-capability</span> <span class='word'>mode</span><span class='ignore'>.</span><span class='cumsum'> [32]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Make</span> <span class='word'>the</span> <span class='word'>CheriBoundAllocas</span> <span class='word'>IR</span> <span class='word'>pass</span> <span class='word'>handle</span> <span class='word'>scalable</span> <span class='word'>vectors</span> <span class='word'>by</span> <span class='word'>finding</span> <span class='word'>the</span> <span class='word'>length</span> <span class='word'>at</span> <span class='word'>runtime</span><span class='ignore'>.</span><span class='cumsum'> [46]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='word'>Bring</span> <span class='word'>up</span> <span class='word'>CHERI-enabled</span> <span class='word'>auto-vectorization</span> <span class='word'>in</span> <span class='word'>parallel</span> <span class='word'>with</span> <span class='word'>vanilla</span> <span class='word'>auto-vectorization</span><span class='ignore'>.</span><span class='cumsum'> [55]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [55]</span><br>
<span class='comment'>% \todomark{where to put something on how CHERI-Clang should change?}</span><span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='comment'>% --- End of included file ./1_30Software/sub60_chericlangchanges.tex</span><span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [55]</span><br>
<span class='comment'>% --- End of included file ./1_30Software/content.tex</span><span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_40CapInVec/content</span><span class='ignore'>}</span><span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='comment'>% --- Start of included file ./1_40CapInVec/content.tex</span><span class='cumsum'> [55]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [55]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [55]</span><br>
<span class='cumsum'> [55]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>Capabilities-in-vectors</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='word'>Implementing</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>correctly</span> <span class='word'>for</span> <span class='word'>CHERI</span> <span class='word'>systems</span> <span class='word'>requires</span> <span class='word'>copying</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>as</span> <span class='word'>well</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>data</span><span class='ignore'>.</span><span class='cumsum'> [17]</span><br>
<span class='word'>As</span> <span class='word'>it</span> <span class='word'>stands</span><span class='ignore'>,</span> <span class='word'>any</span> <span class='word'>vectorized</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>compiled</span> <span class='word'>and</span> <span class='word'>executed</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>systems</span> <span class='word'>described</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>,</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>}</span> <span class='word'>will</span> <span class='word'>not</span> <span class='word'>copy</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>cannot</span> <span class='word'>store</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>and</span> <span class='word'>indeed</span> <span class='word'>cannot</span> <span class='word'>store</span> <span class='word'>valid</span> <span class='word'>capabilities</span><span class='ignore'>.</span><span class='cumsum'> [52]</span><br>
<span class='word'>Manipulating</span> <span class='word'>capabilities-in-vectors</span> <span class='word'>could</span> <span class='word'>also</span> <span class='word'>accelerate</span> <span class='word'>CHERI-specific</span> <span class='word'>processes</span><span class='ignore'>,</span> <span class='word'>such</span> <span class='word'>as</span> <span class='word'>revoking</span> <span class='word'>capabilities</span> <span class='word'>for</span> <span class='word'>freed</span> <span class='word'>memory</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>xiaCHERIvokeCharacterisingPointer2019</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [66]</span><br>
<span class='word'>This</span> <span class='word'>chapter</span> <span class='word'>examines</span> <span class='word'>the</span> <span class='word'>changes</span> <span class='word'>made</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>storing</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>determines</span> <span class='word'>the</span> <span class='word'>conditions</span> <span class='word'>required</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>related</span> <span class='word'>hypotheses</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>true</span><span class='ignore'>.</span><span class='cumsum'> [91]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>appx</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span> <span class='word'>lists</span> <span class='word'>the</span> <span class='word'>changes</span> <span class='word'>made</span> <span class='word'>and</span> <span class='word'>all</span> <span class='word'>the</span> <span class='word'>relevant</span> <span class='word'>properties</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>that</span> <span class='word'>allow</span> <span class='word'>storing</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>vectors</span><span class='ignore'>.</span><span class='cumsum'> [109]</span><br>
<span class='cumsum'> [109]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Changing</span> <span class='hword'>the</span> <span class='hword'>emulator</span><span class='ignore'>}</span><span class='cumsum'> [3]</span><br>
<span class='word'>This</span> <span class='word'>part</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>project</span> <span class='word'>aimed</span> <span class='word'>to</span> <span class='word'>investigate</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>storage</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>manip</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>led</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>following</span> <span class='word'>goals</span><span class='ignore'>:</span><span class='cumsum'> [17]</span><br>
<span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [17]</span><br>
&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>storage</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>Vector</span> <span class='word'>registers</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>hold</span> <span class='word'>capabilities</span> <span class='cumsum'> [25]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>At</span> <span class='word'>least</span> <span class='word'>one</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>operation</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>capabilities</span> <span class='word'>from</span> <span class='word'>vectors</span><span class='cumsum'> [40]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [40]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Because</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>should</span> <span class='word'>copy</span> <span class='word'>both</span> <span class='word'>integer</span> <span class='word'>and</span> <span class='word'>capability</span> <span class='word'>data</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>memory</span> <span class='word'>operations</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>handle</span> <span class='word'>both</span><span class='cumsum'> [59]</span><br>
&nbsp; &nbsp; <span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [59]</span><br>
&nbsp; &nbsp; <span class='cmd'>\item</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>manip</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>Vector</span> <span class='word'>instructions</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>affect</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>some</span> <span class='word'>way</span><span class='cumsum'> [70]</span><br>
&nbsp; &nbsp; <span class='envir'>\begin</span><span class='envir'>{itemize}</span><span class='cumsum'> [70]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class='cmd'>\item</span> <span class='word'>Clearing</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>on</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>counts</span> <span class='word'>as</span> <span class='word'>manipulation</span><span class='cumsum'> [81]</span><br>
&nbsp; &nbsp; <span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [81]</span><br>
<span class='envir'>\end</span><span class='envir'>{itemize}</span><span class='cumsum'> [81]</span><br>
<span class='cumsum'> [81]</span><br>
<span class='comment'>% First, we had to consider the impact of vectors on the theoretical vector model.</span><span class='cumsum'> [81]</span><br>
<span class='word'>First</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>considered</span> <span class='word'>the</span> <span class='word'>impact</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>theoretical</span> <span class='word'>vector</span> <span class='word'>model</span><span class='ignore'>.</span><span class='cumsum'> [91]</span><br>
<span class='word'>We</span> <span class='word'>decided</span> <span class='word'>that</span> <span class='word'>any</span> <span class='word'>operation</span> <span class='word'>with</span> <span class='word'>elements</span> <span class='word'>smaller</span> <span class='word'>than</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span> <span class='word'>cannot</span> <span class='word'>output</span> <span class='word'>valid</span> <span class='word'>capabilities</span> <span class='word'>under</span> <span class='word'>any</span> <span class='word'>circumstances</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>avoids</span> <span class='oword'>edge</span> <span class='oword'>cases</span> <span class='oword'>with</span> <span class='oword'>masking</span><span class='ignore'>,</span> <span class='oword'>where</span> <span class='oword'>one</span> <span class='oword'>part</span> <span class='oword'>of</span> <span class='oword'>a</span> <span class='oword'>capability</span> <span class='oword'>could</span> <span class='oword'>be</span> <span class='oword'>modified</span> <span class='oword'>while</span> <span class='oword'>the</span> <span class='oword'>other</span> <span class='oword'>parts</span> <span class='oword'>are</span> <span class='oword'>left</span> <span class='oword'>alone</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>meaning</span> <span class='word'>a</span> <span class='word'>new</span> <span class='word'>element</span> <span class='word'>width</span> <span class='word'>equal</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>introduced</span><span class='ignore'>.</span><span class='cumsum'> [141]</span><br>
<span class='word'>We</span> <span class='word'>set</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>ELEN</span> <span class='ignore'>=</span> <span class='word'>VLEN</span> <span class='ignore'>=</span> <span class='word'>CLEN</span> <span class='ignore'>=</span> <span class='word'>128</span><span class='ignore'>}</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>The</span> <span class='oword'>tag</span> <span class='oword'>bits</span> <span class='oword'>are</span> <span class='oword'>implicitly</span> <span class='oword'>instead</span> <span class='oword'>of</span> <span class='oword'>explicitly</span> <span class='oword'>included</span> <span class='oword'>here</span> <span class='oword'>because</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='oword'>VLEN</span><span class='ignore'>,</span><span class='oword'>ELEN</span><span class='ignore'>}</span> <span class='oword'>must</span> <span class='oword'>be</span> <span class='oword'>powers</span> <span class='oword'>of</span> <span class='oword'>two</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>for</span> <span class='word'>our</span> <span class='word'>vector</span> <span class='word'>unit</span><span class='ignore'>.</span><span class='cumsum'> [169]</span><br>
<span class='cumsum'> [169]</span><br>
<span class='word'>Two</span> <span class='word'>new</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>instructions</span> <span class='word'>were</span> <span class='word'>created</span> <span class='word'>to</span> <span class='word'>take</span> <span class='word'>advantage</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>new</span> <span class='word'>element</span> <span class='word'>width</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>family</span> <span class='word'>were</span> <span class='word'>adjusted</span> <span class='word'>to</span> <span class='word'>support</span> <span class='word'>128-bit</span> <span class='word'>values</span><span class='ignore'>.</span><span class='cumsum'> [194]</span><br>
<span class='word'>Similar</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>CHERI-RISC-V</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>LC</span><span class='ignore'>/</span><span class='word'>SC</span><span class='ignore'>}</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>implemented</span> <span class='word'>128-bit</span> <span class='word'>unit-stride</span> <span class='word'>vector</span> <span class='word'>loads</span> <span class='word'>and</span> <span class='word'>stores</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>took</span> <span class='word'>over</span> <span class='word'>officially-reserved</span> <span class='word'>encodings</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>The</span> <span class='oword'>RVV</span> <span class='oword'>spec</span> <span class='oword'>mentions</span><span class='ignore'>,</span> <span class='oword'>but</span> <span class='oword'>does</span> <span class='oword'>not</span> <span class='oword'>specify</span><span class='ignore'>,</span> <span class='oword'>potential</span> <span class='oword'>encodings</span> <span class='oword'>for</span> <span class='oword'>128-bit</span> <span class='oword'>element</span> <span class='oword'>widths</span> <span class='oword'>and</span> <span class='oword'>instructions</span> <span class='ignore'>(</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='oword'>p10</span><span class='ignore'>,</span> <span class='oword'>p32</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>accesswidth</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>we</span> <span class='word'>expected</span> <span class='word'>official</span> <span class='word'>versions</span> <span class='word'>to</span> <span class='word'>use</span><span class='ignore'>.</span><span class='cumsum'> [238]</span><br>
<span class='word'>The</span> <span class='word'>memory</span> <span class='word'>instructions</span> <span class='word'>had</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>added</span> <span class='word'>to</span> <span class='word'>CHERI-Clang</span> <span class='word'>manually</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>Clang</span> <span class='word'>already</span> <span class='word'>has</span> <span class='word'>support</span> <span class='word'>for</span> <span class='word'>setting</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SEW</span><span class='ignore'>=</span><span class='word'>128</span><span class='ignore'>}</span> <span class='word'>in</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vsetvl</span><span class='ignore'>}</span> <span class='word'>family</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>vtypewidth</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [261]</span><br>
<span class='word'>These</span> <span class='word'>instruction</span> <span class='word'>changes</span> <span class='word'>affected</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>only</span><span class='ignore'>,</span> <span class='word'>rather</span> <span class='word'>than</span> <span class='word'>adding</span> <span class='word'>vector</span> <span class='word'>intrinsics</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>CHERI-Clang</span> <span class='word'>only</span> <span class='word'>supports</span> <span class='word'>inline</span> <span class='word'>assembly</span> <span class='word'>anyway</span><span class='ignore'>.</span><span class='cumsum'> [280]</span><br>
<span class='cumsum'> [280]</span><br>
<span class='comment'>% \input{1_40CapInVec/encoding_tables}</span><span class='cumsum'> [280]</span><br>
<span class='cumsum'> [280]</span><br>
<span class='word'>The</span> <span class='word'>next</span> <span class='word'>step</span> <span class='word'>was</span> <span class='word'>to</span> <span class='word'>add</span> <span class='word'>capability</span> <span class='word'>support</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>file</span><span class='ignore'>.</span><span class='cumsum'> [293]</span><br>
<span class='word'>Our</span> <span class='word'>approach</span> <span class='word'>to</span> <span class='word'>capabilities-in-vectors</span> <span class='word'>is</span> <span class='word'>similar</span> <span class='word'>in</span> <span class='word'>concept</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>Merged</span> <span class='word'>scalar</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>for</span> <span class='word'>CHERI-RISC-V</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cherimergedreg</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>in</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>same</span> <span class='word'>bits</span> <span class='word'>of</span> <span class='word'>a</span> <span class='word'>register</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>accessed</span> <span class='word'>in</span> <span class='word'>two</span> <span class='word'>contexts</span><span class='ignore'>:</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>context</span><span class='ignore'>,</span> <span class='word'>zeroing</span> <span class='word'>the</span> <span class='word'>tag</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>context</span> <span class='word'>which</span> <span class='word'>maintains</span> <span class='word'>the</span> <span class='word'>current</span> <span class='word'>tag</span><span class='ignore'>.</span><span class='cumsum'> [338]</span><br>
<span class='word'>The</span> <span class='word'>only</span> <span class='word'>instructions</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>access</span> <span class='word'>data</span> <span class='word'>in</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>context</span> <span class='word'>are</span> <span class='word'>the</span> <span class='word'>aforementioned</span> <span class='word'>128-bit</span> <span class='word'>memory</span> <span class='word'>accesses</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>The</span> <span class='oword'>encoding</span> <span class='oword'>mode</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>bg</span><span class='ignore'>:</span><span class='ignore'>subsec</span><span class='ignore'>:</span><span class='ignore'>cheriencodingmode</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='oword'>does</span> <span class='oword'>not</span> <span class='oword'>affect</span> <span class='oword'>register</span> <span class='oword'>usage</span><span class='ignore'>:</span> <span class='oword'>when</span> <span class='oword'>using</span> <span class='oword'>the</span> <span class='oword'>Integer</span> <span class='oword'>encoding</span> <span class='oword'>mode</span><span class='ignore'>,</span> <span class='oword'>instructions</span> <span class='oword'>can</span> <span class='oword'>still</span> <span class='oword'>access</span> <span class='oword'>the</span> <span class='oword'>vector</span> <span class='oword'>register</span> <span class='oword'>in</span> <span class='oword'>a</span> <span class='oword'>capability</span> <span class='oword'>context</span><span class='ignore'>.</span> <span class='oword'>This</span> <span class='oword'>is</span> <span class='oword'>just</span> <span class='oword'>like</span> <span class='oword'>how</span> <span class='oword'>scalar</span> <span class='oword'>capability</span> <span class='oword'>registers</span> <span class='oword'>are</span> <span class='oword'>still</span> <span class='oword'>accessible</span> <span class='oword'>in</span> <span class='oword'>Integer</span> <span class='oword'>encoding</span> <span class='oword'>mode</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [395]</span><br>
<span class='word'>All</span> <span class='word'>other</span> <span class='word'>instructions</span> <span class='word'>will</span> <span class='word'>read</span> <span class='word'>out</span> <span class='word'>untagged</span> <span class='word'>integer</span> <span class='word'>data</span> <span class='word'>and</span> <span class='word'>clear</span> <span class='word'>tags</span> <span class='word'>when</span> <span class='word'>writing</span> <span class='word'>data</span><span class='ignore'>.</span><span class='cumsum'> [410]</span><br>
<span class='cumsum'> [410]</span><br>
<span class='word'>A</span> <span class='word'>new</span> <span class='word'>CHERI-specific</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>file</span> <span class='word'>was</span> <span class='word'>created</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>each</span> <span class='word'>register</span> <span class='word'>is</span> <span class='word'>a</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SafeTaggedCap</span><span class='ignore'>}</span> <span class='ignore'>(</span><span class='word'>p</span><span class='cmd'>\pageref</span><span class='ignore'>{</span><span class='ignore'>safetaggedcap</span><span class='ignore'>}</span><span class='ignore'>)</span> <span class='word'>i.e</span><span class='ignore'>.</span> <span class='word'>either</span> <span class='word'>zero-tagged</span> <span class='word'>integer</span> <span class='word'>data</span> <span class='word'>or</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>tagged</span> <span class='word'>capability</span><span class='ignore'>.</span><span class='cumsum'> [435]</span><br>
<span class='word'>This</span> <span class='word'>makes</span> <span class='word'>it</span> <span class='word'>much</span> <span class='word'>harder</span> <span class='word'>to</span> <span class='word'>accidentally</span> <span class='word'>violate</span> <span class='word'>Provenance</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>reuses</span> <span class='word'>the</span> <span class='word'>code</span> <span class='word'>path</span> <span class='ignore'>(</span><span class='word'>and</span> <span class='word'>related</span> <span class='word'>security</span> <span class='word'>properties</span><span class='ignore'>)</span> <span class='word'>for</span> <span class='word'>accessing</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>memory</span><span class='ignore'>.</span><span class='cumsum'> [458]</span><br>
<span class='word'>Just</span> <span class='word'>like</span> <span class='word'>scalar</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>vectorized</span> <span class='word'>capability</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>atomic</span> <span class='word'>and</span> <span class='word'>128-bit</span> <span class='word'>aligned</span><span class='ignore'>.</span><span class='cumsum'> [470]</span><br>
<span class='cumsum'> [470]</span><br>
<span class='comment'>% \todomark{This paragraph is bad. Plan: split the above paragraph into two, incorporate impact on Provenance and required memory accesses into second half.}</span><span class='cumsum'> [470]</span><br>
<span class='comment'>% Using \code{SafeTaggedCap} had a few major consequences.</span><span class='cumsum'> [470]</span><br>
<span class='comment'>% Firstly, \code{SafeTaggedCap} enforces the Provenance security property within the vector unit.</span><span class='cumsum'> [470]</span><br>
<span class='comment'>% Secondly, it reuses the code path for accessing scalar capabilities in memory, so all related security properties are maintained (e.g. accesses must be 128-bit aligned, and are atomic).</span><span class='cumsum'> [470]</span><br>
<span class='cumsum'> [470]</span><br>
<span class='comment'>% \subsection{Testing}</span><span class='cumsum'> [470]</span><br>
<span class='comment'>% The above emulator changes allowed a minimal \code{memcpy} example to be constructed, which could copy both capabilities and integer data mixed together.</span><span class='cumsum'> [470]</span><br>
<span class='comment'>% This, along with another test to ensure arithmetic accesses the register file in an integer context, is described in the evaluation (\cref{chap:capinvec:eval}).</span><span class='cumsum'> [470]</span><br>
<span class='cumsum'> [470]</span><br>
<span class='cmd'>\input</span><span class='fileinc'>{1_40CapInVec/sub50_hyp}</span><span class='cumsum'> [470]</span><br>
<span class='cumsum'> [470]</span><br>
<span class='comment'>% --- Start of included file ./1_40CapInVec/sub50_hyp.tex</span><span class='cumsum'> [470]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Evaluating</span> <span class='hword'>hypotheses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>cap</span><span class='ignore'>_</span><span class='word'>in</span><span class='ignore'>_</span><span class='word'>vec</span><span class='ignore'>_</span><span class='word'>storage</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Holding</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>vectors</span><span class='ignore'>}</span><span class='cumsum'> [11]</span><br>
<span class='word'>It</span> <span class='word'>is</span> <span class='word'>possible</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>single</span> <span class='word'>vector</span> <span class='word'>register</span> <span class='word'>to</span> <span class='word'>hold</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='ignore'>(</span><span class='word'>and</span> <span class='word'>differentiate</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>from</span> <span class='word'>integer</span> <span class='word'>data</span><span class='ignore'>)</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span> <span class='ignore'>=</span> <span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [35]</span><br>
<span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>could</span> <span class='word'>also</span> <span class='word'>be</span> <span class='word'>larger</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>compliant</span> <span class='word'>implementation</span> <span class='word'>must</span> <span class='word'>then</span> <span class='word'>have</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>be</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>multiple</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [54]</span><br>
<span class='word'>In</span> <span class='word'>theory</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>could</span> <span class='word'>also</span> <span class='word'>describe</span> <span class='word'>a</span> <span class='word'>scheme</span> <span class='word'>where</span> <span class='word'>capabilities</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>held</span> <span class='word'>by</span> <span class='word'>multiple</span> <span class='word'>registers</span> <span class='word'>together</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span> <span class='ignore'>=</span> <span class='word'>CLEN</span><span class='ignore'>/</span><span class='word'>2</span><span class='ignore'>}</span> <span class='word'>with</span> <span class='word'>one</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>for</span> <span class='word'>every</span> <span class='word'>two</span> <span class='word'>registers</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>would</span> <span class='word'>complicate</span> <span class='word'>matters</span><span class='ignore'>.</span><span class='cumsum'> [88]</span><br>
<span class='cumsum'> [88]</span><br>
<span class='word'>If</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>decides</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>we</span> <span class='word'>did</span><span class='ignore'>,</span> <span class='word'>that</span> <span class='word'>elements</span> <span class='word'>of</span> <span class='word'>width</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span> <span class='word'>are</span> <span class='word'>required</span> <span class='word'>to</span> <span class='word'>produce</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='mathgroup'>$</span><span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>VLEN</span><span class='ignore'>}</span> <span class='mathcmd'>\ge</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>ELEN</span><span class='ignore'>}</span><span class='mathgroup'>$</span> <span class='word'>therefore</span> <span class='mathgroup'>$</span><span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>VLEN</span><span class='ignore'>}</span> <span class='mathcmd'>\ge</span> <span class='mathcmd'>\code</span><span class='ignore'>{</span><span class='math'>CLEN</span><span class='ignore'>}</span><span class='mathgroup'>$</span><span class='ignore'>.</span><span class='cumsum'> [109]</span><br>
<span class='word'>If</span> <span class='word'>a</span> <span class='word'>short</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>VLEN</span><span class='ignore'>}</span> <span class='word'>is</span> <span class='word'>absolutely</span> <span class='word'>essential</span><span class='ignore'>,</span> <span class='word'>one</span> <span class='word'>could</span> <span class='word'>place</span> <span class='word'>precise</span> <span class='word'>guarantees</span> <span class='word'>on</span> <span class='word'>a</span> <span class='word'>specific</span> <span class='word'>set</span> <span class='word'>of</span> <span class='word'>instructions</span> <span class='word'>to</span> <span class='word'>enable</span> <span class='word'>it</span> <span class='ignore'>(</span><span class='word'>e.g</span><span class='ignore'>.</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>SEW</span><span class='ignore'>=</span><span class='word'>64</span><span class='ignore'>,</span> <span class='word'>LMUL</span><span class='ignore'>=</span><span class='word'>2</span><span class='ignore'>}</span> <span class='word'>unit-stride</span> <span class='word'>unmasked</span> <span class='word'>loads</span> <span class='word'>could</span> <span class='word'>guarantee</span> <span class='word'>atomic</span> <span class='word'>capability</span> <span class='word'>transfers</span><span class='ignore'>)</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='word'>does</span> <span class='word'>not</span> <span class='word'>consider</span> <span class='word'>this</span><span class='ignore'>.</span><span class='cumsum'> [150]</span><br>
<span class='word'>The</span> <span class='word'>CHERI</span> <span class='word'>security</span> <span class='word'>properties</span> <span class='word'>also</span> <span class='word'>impose</span> <span class='word'>some</span> <span class='word'>conditions</span><span class='ignore'>.</span><span class='cumsum'> [158]</span><br>
<span class='cumsum'> [158]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Provenance</span> <span class='cmd'>\&amp;</span> <span class='hword'>Monotonicity</span><span class='ignore'>}</span><span class='cumsum'> [160]</span><br>
<span class='word'>The</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>protected</span> <span class='word'>such</span> <span class='word'>that</span> <span class='word'>capabilities</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>forged</span> <span class='word'>from</span> <span class='word'>integer</span> <span class='word'>data</span><span class='ignore'>.</span><span class='cumsum'> [175]</span><br>
<span class='word'>The</span> <span class='word'>emulator's</span> <span class='word'>integer</span><span class='ignore'>/</span><span class='word'>capability</span> <span class='word'>context</span> <span class='word'>approach</span><span class='ignore'>,</span> <span class='word'>where</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>may</span> <span class='word'>only</span> <span class='word'>be</span> <span class='word'>set</span> <span class='word'>on</span> <span class='word'>copying</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>capability</span> <span class='word'>from</span> <span class='word'>memory</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>the</span> <span class='word'>output</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>is</span> <span class='word'>zeroed</span> <span class='word'>on</span> <span class='word'>all</span> <span class='word'>other</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>enforces</span> <span class='word'>this</span> <span class='word'>correctly</span><span class='ignore'>.</span><span class='cumsum'> [210]</span><br>
<span class='cumsum'> [210]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Integrity</span><span class='ignore'>}</span><span class='cumsum'> [211]</span><br>
<span class='word'>Integrity</span> <span class='word'>is</span> <span class='word'>not</span> <span class='word'>affected</span> <span class='word'>by</span> <span class='word'>how</span> <span class='word'>a</span> <span class='word'>capability</span> <span class='word'>is</span> <span class='word'>stored</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>long</span> <span class='word'>as</span> <span class='word'>the</span> <span class='word'>other</span> <span class='word'>properties</span> <span class='word'>are</span> <span class='word'>maintained</span><span class='ignore'>.</span><span class='cumsum'> [229]</span><br>
<span class='cumsum'> [229]</span><br>
<span class='comment'>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class='cumsum'> [229]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>cap</span><span class='ignore'>_</span><span class='word'>in</span><span class='ignore'>_</span><span class='word'>vec</span><span class='ignore'>_</span><span class='word'>load</span><span class='ignore'>_</span><span class='word'>store</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Sending</span> <span class='word'>capabilities</span> <span class='word'>between</span> <span class='word'>vectors</span> <span class='word'>and</span> <span class='word'>memory</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>hyp</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>}</span><span class='cumsum'> [241]</span><br>
<span class='word'>For</span> <span class='word'>this</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>the</span> <span class='word'>case</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>instructions</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>load</span><span class='ignore'>/</span><span class='word'>store</span> <span class='word'>capabilities</span> <span class='word'>must</span> <span class='word'>fulfil</span> <span class='word'>certain</span> <span class='word'>alignment</span> <span class='word'>and</span> <span class='word'>atomicity</span> <span class='word'>requirements</span><span class='ignore'>.</span><span class='cumsum'> [261]</span><br>
<span class='word'>They</span> <span class='word'>must</span> <span class='word'>require</span> <span class='word'>all</span> <span class='word'>accesses</span> <span class='word'>be</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>-</span><span class='word'>aligned</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>at</span> <span class='word'>least</span> <span class='word'>only</span> <span class='word'>load</span> <span class='word'>valid</span> <span class='word'>caps</span> <span class='word'>from</span> <span class='word'>aligned</span> <span class='word'>addresses</span><span class='ignore'>,</span> <span class='word'>because</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>only</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLEN</span><span class='ignore'>}</span><span class='ignore'>-</span><span class='word'>aligned</span> <span class='word'>regions</span><span class='ignore'>.</span><span class='cumsum'> [288]</span><br>
<span class='word'>TR-951</span> <span class='word'>states</span> <span class='word'>that</span> <span class='word'>capability</span> <span class='word'>memory</span> <span class='word'>accesses</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>atomic</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Section</span> <span class='word'>11.3</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [299]</span><br>
<span class='word'>This</span> <span class='word'>applies</span> <span class='word'>to</span> <span class='word'>vectors</span><span class='ignore'>,</span> <span class='word'>even</span> <span class='word'>in</span> <span class='word'>ways</span> <span class='word'>that</span> <span class='word'>don't</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='word'>scalar</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [312]</span><br>
<span class='cumsum'> [312]</span><br>
<span class='word'>Individual</span> <span class='word'>element</span> <span class='word'>accesses</span> <span class='word'>for</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>access</span> <span class='word'>must</span> <span class='word'>be</span> <span class='word'>atomic</span> <span class='word'>relative</span> <span class='word'>to</span> <span class='word'>each</span> <span class='word'>other</span><span class='ignore'>.</span><span class='cumsum'> [326]</span><br>
<span class='word'>This</span> <span class='word'>is</span> <span class='word'>relevant</span> <span class='word'>for</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>a</span> <span class='word'>strided</span> <span class='word'>store</span> <span class='word'>using</span> <span class='word'>an</span> <span class='word'>unaligned</span> <span class='word'>stride</span><span class='ignore'>,</span> <span class='word'>such</span> <span class='word'>that</span> <span class='word'>one</span> <span class='word'>element</span> <span class='word'>writes</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>capability</span> <span class='word'>and</span> <span class='word'>another</span> <span class='word'>element</span> <span class='word'>overwrites</span> <span class='word'>part</span> <span class='word'>of</span> <span class='word'>that</span> <span class='word'>address</span> <span class='word'>range</span><span class='ignore'>.</span><span class='cumsum'> [355]</span><br>
<span class='word'>If</span> <span class='word'>unaligned</span> <span class='word'>128-bit</span> <span class='word'>accesses</span> <span class='word'>are</span> <span class='word'>allowed</span><span class='ignore'>,</span> <span class='word'>then</span> <span class='word'>either</span> <span class='word'>the</span> <span class='word'>unaligned</span> <span class='word'>second</span> <span class='word'>element</span> <span class='word'>should</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>win</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>and</span> <span class='word'>clear</span> <span class='word'>relevant</span> <span class='word'>tag</span> <span class='word'>bits</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>the</span> <span class='word'>first</span> <span class='word'>element</span> <span class='word'>should</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>win</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>and</span> <span class='word'>write</span> <span class='word'>the</span> <span class='word'>full</span> <span class='word'>capability</span> <span class='word'>atomically</span><span class='ignore'>.</span><span class='cumsum'> [386]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>requires</span> <span class='word'>all</span> <span class='word'>128-bit</span> <span class='word'>accesses</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>aligned</span> <span class='word'>so</span> <span class='word'>meets</span> <span class='word'>this</span> <span class='word'>requirement</span> <span class='word'>easily</span><span class='ignore'>.</span><span class='cumsum'> [400]</span><br>
<span class='cumsum'> [400]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Provenance</span><span class='ignore'>}</span><span class='cumsum'> [401]</span><br>
<span class='word'>Provenance</span> <span class='word'>requires</span> <span class='word'>the</span> <span class='word'>accesses</span> <span class='word'>be</span> <span class='word'>atomic</span> <span class='word'>as</span> <span class='word'>described</span> <span class='word'>above</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>require</span> <span class='word'>that</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>are</span> <span class='word'>copied</span> <span class='word'>correctly</span><span class='ignore'>:</span> <span class='word'>the</span> <span class='word'>output</span> <span class='word'>tag</span> <span class='word'>bit</span> <span class='word'>must</span> <span class='word'>only</span> <span class='word'>be</span> <span class='word'>set</span> <span class='word'>if</span> <span class='word'>the</span> <span class='word'>input</span> <span class='word'>had</span> <span class='word'>a</span> <span class='word'>valid</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>.</span><span class='cumsum'> [434]</span><br>
<span class='word'>These</span> <span class='word'>conditions</span> <span class='word'>also</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='word'>scalar</span> <span class='word'>accesses</span><span class='ignore'>.</span><span class='cumsum'> [441]</span><br>
<span class='cumsum'> [441]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Monotonicity</span><span class='ignore'>}</span><span class='cumsum'> [442]</span><br>
<span class='word'>These</span> <span class='word'>loads</span><span class='ignore'>/</span><span class='word'>stores</span> <span class='word'>do</span> <span class='word'>not</span> <span class='word'>attempt</span> <span class='word'>to</span> <span class='word'>manipulate</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>have</span> <span class='word'>no</span> <span class='word'>relevance</span> <span class='word'>to</span> <span class='word'>monotonicity</span><span class='ignore'>.</span><span class='cumsum'> [457]</span><br>
<span class='cumsum'> [457]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Integrity</span><span class='ignore'>}</span><span class='cumsum'> [458]</span><br>
<span class='word'>The</span> <span class='word'>same</span> <span class='word'>conditions</span> <span class='word'>for</span> <span class='word'>scalar</span> <span class='word'>and</span> <span class='word'>other</span> <span class='word'>vector</span> <span class='word'>accesses</span> <span class='word'>apply</span> <span class='word'>to</span> <span class='word'>maintain</span> <span class='word'>Integrity</span><span class='ignore'>:</span> <span class='word'>namely</span> <span class='word'>that</span> <span class='word'>the</span> <span class='word'>base</span> <span class='word'>capability</span> <span class='word'>for</span> <span class='word'>each</span> <span class='word'>access</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>checked</span> <span class='word'>to</span> <span class='word'>ensure</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>valid</span><span class='ignore'>.</span><span class='cumsum'> [487]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>doesn't</span> <span class='word'>allow</span> <span class='word'>capabilities-in-vectors</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>dereferenced</span> <span class='word'>directly</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>if</span> <span class='word'>an</span> <span class='word'>implementation</span> <span class='word'>allows</span> <span class='word'>it</span> <span class='word'>those</span> <span class='word'>capabilities</span> <span class='word'>would</span> <span class='word'>also</span> <span class='word'>need</span> <span class='word'>to</span> <span class='word'>be</span> <span class='word'>checked</span><span class='ignore'>.</span><span class='cumsum'> [510]</span><br>
<span class='cumsum'> [510]</span><br>
<span class='comment'>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class='cumsum'> [510]</span><br>
<span class='cmd'>\hypsubsection</span><span class='ignore'>{</span><span class='word'>hyp</span><span class='ignore'>:</span><span class='word'>cap</span><span class='ignore'>_</span><span class='word'>in</span><span class='ignore'>_</span><span class='word'>vec</span><span class='ignore'>_</span><span class='word'>manip</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='word'>Manipulating</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>vectors</span><span class='ignore'>}</span><span class='cumsum'> [519]</span><br>
<span class='word'>The</span> <span class='word'>emulator</span> <span class='word'>limits</span> <span class='word'>all</span> <span class='word'>manipulation</span> <span class='word'>to</span> <span class='word'>clearing</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>,</span> <span class='word'>achieved</span> <span class='word'>by</span> <span class='word'>writing</span> <span class='word'>data</span> <span class='word'>to</span> <span class='word'>the</span> <span class='word'>register</span> <span class='word'>in</span> <span class='word'>an</span> <span class='word'>integer</span> <span class='word'>context</span><span class='ignore'>.</span><span class='cumsum'> [540]</span><br>
<span class='word'>In</span> <span class='word'>theory</span><span class='ignore'>,</span> <span class='word'>it's</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>do</span> <span class='word'>more</span> <span class='word'>complex</span> <span class='word'>transformations</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>proven</span> <span class='word'>by</span> <span class='word'>implementing</span> <span class='word'>each</span> <span class='word'>vector</span> <span class='word'>manipulation</span> <span class='word'>on</span> <span class='word'>vector</span> <span class='word'>elements</span> <span class='word'>as</span> <span class='word'>sequential</span> <span class='word'>scalar</span> <span class='word'>manipulations</span> <span class='word'>on</span> <span class='word'>scalar</span> <span class='word'>elements</span><span class='ignore'>.</span><span class='cumsum'> [568]</span><br>
<span class='cumsum'> [568]</span><br>
<span class='word'>With</span> <span class='word'>this</span> <span class='word'>method</span><span class='ignore'>,</span> <span class='word'>all</span> <span class='word'>pre-existing</span> <span class='word'>scalar</span> <span class='word'>capability</span> <span class='word'>manipulations</span> <span class='word'>can</span> <span class='word'>become</span> <span class='word'>vector</span> <span class='word'>manipulations</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>the</span> <span class='word'>utility</span> <span class='word'>seems</span> <span class='word'>limited</span><span class='ignore'>.</span><span class='cumsum'> [585]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>instructions</span> <span class='word'>for</span> <span class='word'>creating</span> <span class='word'>capabilities</span> <span class='word'>or</span> <span class='word'>manipulating</span> <span class='word'>bounds</span> <span class='word'>en</span> <span class='word'>masse</span> <span class='word'>don't</span> <span class='word'>have</span> <span class='word'>an</span> <span class='word'>obvious</span> <span class='word'>use</span> <span class='word'>case</span><span class='ignore'>.</span><span class='cumsum'> [602]</span><br>
<span class='word'>If</span> <span class='word'>more</span> <span class='word'>transformations</span> <span class='word'>are</span> <span class='word'>added</span> <span class='word'>they</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>considered</span> <span class='word'>carefully</span><span class='ignore'>,</span> <span class='word'>rather</span> <span class='word'>than</span> <span class='word'>creating</span> <span class='word'>vector</span> <span class='word'>equivalents</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>scalar</span> <span class='word'>manipulations</span><span class='ignore'>.</span><span class='cumsum'> [621]</span><br>
<span class='word'>For</span> <span class='word'>example</span><span class='ignore'>,</span> <span class='word'>revocation</span> <span class='word'>as</span> <span class='word'>described</span> <span class='word'>in</span> <span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>xiaCHERIvokeCharacterisingPointer2019</span><span class='ignore'>}</span> <span class='word'>may</span> <span class='word'>benefit</span> <span class='word'>from</span> <span class='word'>a</span> <span class='word'>vector</span> <span class='word'>equivalent</span> <span class='word'>to</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>CLoadTags</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [635]</span><br>
<span class='cumsum'> [635]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Provenance</span> <span class='cmd'>\&amp;</span> <span class='hword'>Monotonicity</span><span class='ignore'>}</span><span class='cumsum'> [637]</span><br>
<span class='word'>Because</span> <span class='word'>the</span> <span class='word'>only</span> <span class='word'>possible</span> <span class='word'>manipulations</span> <span class='word'>clear</span> <span class='word'>the</span> <span class='word'>tag</span> <span class='word'>bit</span><span class='ignore'>,</span> <span class='word'>it's</span> <span class='word'>impossible</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>or</span> <span class='word'>change</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>Provenance</span> <span class='word'>and</span> <span class='word'>Monotonicity</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>violated</span><span class='ignore'>.</span><span class='cumsum'> [660]</span><br>
<span class='word'>Any</span> <span class='word'>manipulations</span> <span class='word'>that</span> <span class='word'>create</span> <span class='word'>capabilities</span><span class='ignore'>,</span> <span class='word'>or</span> <span class='word'>potentially</span> <span class='word'>any</span> <span class='word'>manipulations</span> <span class='word'>that</span> <span class='word'>transfer</span> <span class='word'>capabilities</span> <span class='word'>from</span> <span class='word'>vector</span> <span class='word'>registers</span> <span class='word'>directly</span> <span class='word'>to</span> <span class='word'>scalar</span> <span class='word'>registers</span><span class='ignore'>,</span> <span class='word'>would</span> <span class='word'>require</span> <span class='word'>more</span> <span class='word'>scrutiny</span><span class='ignore'>.</span><span class='cumsum'> [683]</span><br>
<span class='cumsum'> [683]</span><br>
<span class='cmd'>\subsubsection</span><span class='option'>*</span><span class='ignore'>{</span><span class='hword'>Integrity</span><span class='ignore'>}</span><span class='cumsum'> [684]</span><br>
<span class='word'>As</span> <span class='word'>stated</span> <span class='word'>before</span><span class='ignore'>,</span> <span class='word'>capabilities-in-vectors</span> <span class='word'>cannot</span> <span class='word'>be</span> <span class='word'>dereferenced</span> <span class='word'>directly</span><span class='ignore'>,</span> <span class='word'>so</span> <span class='word'>there</span> <span class='word'>is</span> <span class='word'>no</span> <span class='word'>impact</span> <span class='word'>on</span> <span class='word'>Integrity</span><span class='ignore'>.</span><span class='cumsum'> [699]</span><br>
<span class='cumsum'> [699]</span><br>
<span class='cmd'>\subsection</span><span class='ignore'>{</span><span class='hword'>Testing</span> <span class='hword'>and</span> <span class='hword'>evaluation</span><span class='ignore'>:</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='hword'>vector</span><span class='cmd'>\_</span><span class='hword'>memcpy</span><span class='cmd'>\_</span><span class='hword'>pointers</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>:</span><span class='ignore'>eval</span><span class='ignore'>}</span><span class='cumsum'> [6]</span><br>
<span class='word'>We</span> <span class='word'>constructed</span> <span class='word'>a</span> <span class='word'>second</span> <span class='word'>test</span> <span class='word'>program</span> <span class='word'>to</span> <span class='word'>ensure</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vector</span><span class='cmd'>\_</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>performed</span> <span class='word'>correctly</span> <span class='word'>with</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>.</span><span class='cumsum'> [22]</span><br>
<span class='word'>It</span> <span class='word'>copies</span> <span class='word'>an</span> <span class='word'>array</span> <span class='word'>of</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Element</span><span class='ignore'>}</span> <span class='word'>structures</span> <span class='word'>that</span> <span class='word'>hold</span> <span class='word'>pointers</span> <span class='word'>to</span> <span class='word'>static</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>Base</span><span class='ignore'>}</span> <span class='word'>structures</span><span class='ignore'>.</span><span class='cumsum'> [36]</span><br>
<span class='comment'>% \code{vector\_memcpy\_pointers} tests the behaviour of \code{memcpy} with capabilities-in-vectors, by copying an array of data structures that hold pointers to static data.</span><span class='cumsum'> [36]</span><br>
<span class='word'>On</span> <span class='word'>CHERI</span> <span class='word'>platforms</span><span class='ignore'>,</span> <span class='word'>even</span> <span class='word'>in</span> <span class='word'>Integer</span> <span class='word'>mode</span><span class='ignore'>,</span> <span class='word'>capability</span> <span class='word'>pointers</span> <span class='word'>are</span> <span class='word'>used</span> <span class='word'>and</span> <span class='word'>copied</span><span class='ignore'>.</span><span class='cumsum'> [49]</span><br>
<span class='word'>The</span> <span class='word'>first</span> <span class='word'>test</span> <span class='word'>simply</span> <span class='word'>copies</span> <span class='word'>the</span> <span class='word'>data</span> <span class='word'>and</span> <span class='word'>tests</span> <span class='word'>that</span> <span class='word'>all</span> <span class='word'>the</span> <span class='word'>copied</span> <span class='word'>pointers</span> <span class='word'>still</span> <span class='word'>work</span><span class='ignore'>,</span> <span class='word'>which</span> <span class='word'>succeeds</span> <span class='word'>on</span> <span class='word'>all</span> <span class='word'>compilers</span><span class='ignore'>/</span><span class='word'>architectures</span><span class='ignore'>.</span><span class='cumsum'> [71]</span><br>
<span class='word'>The</span> <span class='word'>second</span> <span class='word'>test</span> <span class='word'>is</span> <span class='word'>CHERI-exclusive</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>invalidates</span> <span class='word'>all</span> <span class='word'>pointers</span> <span class='word'>during</span> <span class='word'>the</span> <span class='word'>copy</span> <span class='word'>process</span> <span class='word'>by</span> <span class='word'>performing</span> <span class='word'>integer</span> <span class='word'>arithmetic</span> <span class='word'>on</span> <span class='word'>the</span> <span class='word'>vector</span> <span class='word'>registers</span><span class='ignore'>.</span><span class='cumsum'> [92]</span><br>
<span class='word'>The</span> <span class='word'>copied</span> <span class='word'>pointers</span> <span class='word'>are</span> <span class='word'>examined</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>sure</span> <span class='word'>their</span> <span class='word'>tag</span> <span class='word'>bits</span> <span class='word'>are</span> <span class='word'>all</span> <span class='word'>zeroed</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>this</span> <span class='word'>test</span> <span class='word'>succeeds</span> <span class='word'>on</span> <span class='word'>both</span> <span class='word'>CHERI</span> <span class='word'>configurations</span><span class='ignore'>.</span><span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='envir'>\begin</span><span class='envir'>{table}</span><span class='option'>[h]</span><span class='cumsum'> [114]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\centering</span><span class='cumsum'> [114]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\CatchFileDef</span><span class='ignore'>{</span><span class='exclcmd'>\tablevecmemcpypointers</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>1</span><span class='ignore'>_</span><span class='ignore'>50Evaluation</span><span class='ignore'>/</span><span class='ignore'>data</span><span class='ignore'>/</span><span class='ignore'>vector</span><span class='ignore'>_</span><span class='ignore'>memcpy</span><span class='ignore'>_</span><span class='ignore'>pointers</span><span class='ignore'>_</span><span class='ignore'>rows</span><span class='ignore'>}</span><span class='ignore'>{</span><span class='ignore'>}</span><span class='cumsum'> [114]</span><br>
&nbsp; &nbsp; <span class='exclenv'>\begin</span><span class='exclenv'>{tabular}</span><span class='ignore'>{</span><span class='ignore'>rcccccc</span><span class='ignore'>}</span><span class='cumsum'> [114]</span><br>
&nbsp;&nbsp;<span class='exclcmd'>\tablevecmemcpypointers</span><span class='cumsum'> [114]</span><br>
&nbsp;&nbsp;<span class='exclenv'>\end</span><span class='exclenv'>{tabular}</span><span class='cumsum'> [114]</span><br>
&nbsp; &nbsp; <span class='exclcmd'>\caption</span><span class='ignore'>{</span><span class='exclcmd'>\code</span><span class='ignore'>{</span><span class='ignore'>vector</span><span class='exclcmd'>\_</span><span class='ignore'>memcpy</span><span class='exclcmd'>\_</span><span class='ignore'>pointers</span><span class='ignore'>}</span> <span class='ignore'>results</span><span class='ignore'>}</span><span class='exclcmd'>\label</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>fullresults</span><span class='ignore'>:</span><span class='ignore'>vectormemcpyptrs</span><span class='ignore'>}</span><span class='cumsum'> [114]</span><br>
<span class='envir'>\end</span><span class='envir'>{table}</span><span class='cumsum'> [114]</span><br>
<span class='comment'>% --- End of included file ./1_40CapInVec/sub50_hyp.tex</span><span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [114]</span><br>
<span class='comment'>% --- End of included file ./1_40CapInVec/content.tex</span><span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='cmd'>\subfile</span><span class='ignore'>{</span><span class='fileinc'>1_60Conclusion/content</span><span class='ignore'>}</span><span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='comment'>% --- Start of included file ./1_60Conclusion/content.tex</span><span class='cumsum'> [114]</span><br>
<span class='document'>\documentclass</span><span class='option'>[../thesis]</span><span class='document'>{subfiles}</span><span class='cumsum'> [114]</span><br>
<span class='envir'>\begin</span><span class='envir'>{document}</span><span class='cumsum'> [114]</span><br>
<span class='cumsum'> [114]</span><br>
<span class='cmd'>\chapter</span><span class='ignore'>{</span><span class='hword'>Conclusion</span><span class='ignore'>}</span><span class='cumsum'> [1]</span><br>
<span class='cumsum'> [1]</span><br>
<span class='word'>This</span> <span class='word'>project</span> <span class='word'>demonstrated</span> <span class='word'>the</span> <span class='word'>viability</span> <span class='word'>of</span> <span class='word'>integrating</span> <span class='word'>CHERI</span> <span class='word'>with</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>models</span> <span class='word'>by</span> <span class='word'>producing</span> <span class='word'>an</span> <span class='word'>example</span> <span class='word'>CHERI-RVV</span> <span class='word'>implementation</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='word'>This</span> <span class='word'>required</span> <span class='word'>both</span> <span class='word'>research</span> <span class='word'>effort</span> <span class='word'>in</span> <span class='word'>studying</span> <span class='word'>the</span> <span class='word'>related</span> <span class='word'>specifications</span> <span class='ignore'>(</span><span class='cmd'>\cite</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>,</span><span class='ignore'>specification-RVV-v1.0</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>demonstrated</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>background</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>a</span> <span class='word'>substantial</span> <span class='word'>implementation</span> <span class='word'>effort</span> <span class='word'>demonstrated</span> <span class='word'>in</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>hardware</span><span class='ignore'>,</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>,</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>capinvec</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [38]</span><br>
<span class='comment'>% During this project, we developed a large Rust and C codebase (9,120 lines of code) for a helper library (860 LoC), a RISC-V emulator (5,320 LoC), and a set of emulator test programs (2,940 LoC\footnote{\code{vector\_memcpy} uses an autogenerated test program, the generator is included but the extra 2,470 lines of generated code are not.}).</span><span class='cumsum'> [38]</span><br>
<span class='word'>We</span> <span class='word'>produced</span> <span class='word'>four</span> <span class='word'>software</span> <span class='word'>artifacts</span><span class='ignore'>:</span> <span class='word'>a</span> <span class='word'>Rust</span> <span class='word'>wrapper</span> <span class='word'>for</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>cheri-compressed-cap</span><span class='ignore'>}</span> <span class='word'>C</span> <span class='word'>library</span> <span class='ignore'>(</span><span class='word'>900</span> <span class='word'>lines</span> <span class='word'>of</span> <span class='word'>code</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>RISC-V</span> <span class='word'>emulator</span> <span class='word'>supporting</span> <span class='word'>multiple</span> <span class='word'>architecture</span> <span class='word'>extensions</span> <span class='ignore'>(</span><span class='word'>5,300</span> <span class='word'>LoC</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>a</span> <span class='word'>fork</span> <span class='word'>of</span> <span class='word'>CHERI-Clang</span> <span class='word'>supporting</span> <span class='word'>RVV</span> <span class='ignore'>(</span><span class='word'>400</span> <span class='word'>changed</span> <span class='word'>LoC</span><span class='ignore'>)</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>test</span> <span class='word'>programs</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>emulator</span> <span class='ignore'>(</span><span class='word'>3,000</span> <span class='word'>LoC</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>This</span> <span class='oword'>doesn't</span> <span class='oword'>include</span> <span class='oword'>automatically</span> <span class='oword'>generated</span> <span class='oword'>code</span><span class='ignore'>.</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [87]</span><br>
<span class='comment'>% This includes the \code{vector\_memcpy} generator codebase but not the generated program.</span><span class='cumsum'> [87]</span><br>
<span class='comment'>% These are hosted online (see \cref{appx:artifacts}) and were submitted alongside this dissertation.</span><span class='cumsum'> [87]</span><br>
<span class='word'>Developing</span> <span class='word'>these</span> <span class='word'>artifacts</span> <span class='word'>provided</span> <span class='word'>enough</span> <span class='word'>information</span> <span class='word'>to</span> <span class='word'>make</span> <span class='word'>conclusions</span> <span class='word'>for</span> <span class='word'>the</span> <span class='word'>initial</span> <span class='word'>hypotheses</span> <span class='ignore'>(</span><span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>tab</span><span class='ignore'>:</span><span class='ignore'>hypotheses</span><span class='ignore'>}</span><span class='ignore'>)</span><span class='ignore'>.</span><span class='cumsum'> [100]</span><br>
<span class='cumsum'> [100]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Evaluating</span> <span class='hword'>hypotheses</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='cumsum'> [2]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>as</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>mem</span><span class='ignore'>_</span><span class='ignore'>ref</span><span class='ignore'>}</span> <span class='word'>showed</span> <span class='word'>that</span> <span class='word'>all</span> <span class='word'>memory</span> <span class='word'>references</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>replaced</span> <span class='word'>with</span> <span class='word'>capabilities</span> <span class='word'>in</span> <span class='word'>all</span> <span class='word'>RVV</span> <span class='word'>instructions</span> <span class='word'>while</span> <span class='word'>maintaining</span> <span class='word'>functionality</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>hw</span><span class='ignore'>_</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>bounds</span><span class='ignore'>_</span><span class='ignore'>checks</span><span class='ignore'>_</span><span class='ignore'>amortized</span><span class='ignore'>}</span> <span class='word'>then</span> <span class='word'>alleviated</span> <span class='word'>performance</span> <span class='word'>concerns</span> <span class='word'>by</span> <span class='word'>showing</span> <span class='word'>it</span> <span class='word'>was</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>combine</span> <span class='word'>the</span> <span class='word'>required</span> <span class='word'>capability</span> <span class='word'>checks</span> <span class='word'>for</span> <span class='word'>all</span> <span class='word'>vector</span> <span class='word'>accesses</span><span class='ignore'>,</span> <span class='word'>amortizing</span> <span class='word'>the</span> <span class='word'>overall</span> <span class='word'>cost</span> <span class='word'>of</span> <span class='word'>checking</span><span class='ignore'>,</span> <span class='word'>although</span> <span class='word'>with</span> <span class='word'>varying</span> <span class='word'>practical</span> <span class='word'>benefit</span><span class='ignore'>.</span><span class='cumsum'> [49]</span><br>
<span class='cumsum'> [49]</span><br>
<span class='word'>On</span> <span class='word'>the</span> <span class='word'>software</span> <span class='word'>side</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>legacy</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>pure</span><span class='ignore'>_</span><span class='ignore'>compat</span><span class='ignore'>}</span> <span class='word'>showed</span> <span class='word'>that</span> <span class='word'>non-CHERI</span> <span class='word'>vectorized</span> <span class='word'>code</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>run</span> <span class='word'>on</span> <span class='word'>CHERI</span> <span class='word'>systems</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>even</span> <span class='word'>recompiled</span> <span class='word'>for</span> <span class='word'>pure-capability</span> <span class='word'>platforms</span> <span class='word'>with</span> <span class='word'>no</span> <span class='word'>source</span> <span class='word'>code</span> <span class='word'>changes</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>that</span> <span class='word'>CHERI-Clang's</span> <span class='word'>current</span> <span class='word'>state</span> <span class='word'>adds</span> <span class='word'>some</span> <span class='word'>practical</span> <span class='word'>limitations</span><span class='ignore'>.</span><span class='cumsum'> [84]</span><br>
<span class='word'>We</span> <span class='word'>developed</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vector</span><span class='cmd'>\_</span><span class='word'>memcpy</span><span class='ignore'>}</span> <span class='word'>test</span> <span class='word'>program</span> <span class='word'>to</span> <span class='word'>show</span> <span class='word'>that</span> <span class='word'>despite</span> <span class='word'>those</span> <span class='word'>limitations</span><span class='ignore'>,</span> <span class='word'>it's</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>write</span> <span class='word'>correct</span> <span class='word'>CHERI-RVV</span> <span class='word'>code</span> <span class='word'>on</span> <span class='word'>current</span> <span class='word'>compilers</span><span class='ignore'>.</span><span class='cumsum'> [107]</span><br>
<span class='comment'>% Despite those limitations, the \code{vector\_memcpy} testbench proves it's possible to write correct CHERI-RVV code on current compilers </span><span class='cumsum'> [107]</span><br>
<span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>stack</span><span class='ignore'>_</span><span class='ignore'>vectors</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>sw</span><span class='ignore'>_</span><span class='ignore'>multiproc</span><span class='ignore'>}</span> <span class='word'>address</span> <span class='word'>the</span> <span class='word'>pausing</span> <span class='word'>and</span> <span class='word'>resuming</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>code</span><span class='ignore'>,</span> <span class='word'>specifically</span> <span class='word'>saving</span> <span class='word'>and</span> <span class='word'>restoring</span> <span class='word'>variable-length</span> <span class='word'>architectural</span> <span class='word'>state</span><span class='ignore'>,</span> <span class='word'>concluding</span> <span class='word'>that</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>entirely</span> <span class='word'>possible</span> <span class='word'>but</span> <span class='word'>requires</span> <span class='word'>software</span> <span class='word'>adjustments</span><span class='ignore'>.</span><span class='cumsum'> [132]</span><br>
<span class='cumsum'> [132]</span><br>
<span class='word'>Through</span> <span class='word'>a</span> <span class='word'>limited</span> <span class='word'>investigation</span> <span class='word'>of</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>,</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>storage</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>load</span><span class='ignore'>_</span><span class='ignore'>store</span><span class='ignore'>,</span><span class='ignore'>hyp</span><span class='ignore'>:</span><span class='ignore'>cap</span><span class='ignore'>_</span><span class='ignore'>in</span><span class='ignore'>_</span><span class='ignore'>vec</span><span class='ignore'>_</span><span class='ignore'>manip</span><span class='ignore'>}</span> <span class='word'>showed</span> <span class='word'>that</span> <span class='word'>a</span> <span class='word'>highly</span> <span class='word'>constrained</span> <span class='word'>implementation</span> <span class='word'>could</span> <span class='word'>enable</span> <span class='word'>a</span> <span class='word'>fully-functional</span> <span class='word'>vectorized</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>memcpy</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>demonstrated</span> <span class='word'>in</span> <span class='word'>the</span> <span class='cmd'>\code</span><span class='ignore'>{</span><span class='word'>vector</span><span class='cmd'>\_</span><span class='word'>memcpy</span><span class='cmd'>\_</span><span class='word'>pointers</span><span class='ignore'>}</span> <span class='word'>test</span> <span class='word'>program</span><span class='ignore'>,</span> <span class='word'>without</span> <span class='word'>violating</span> <span class='word'>CHERI</span> <span class='word'>security</span> <span class='word'>principles</span><span class='ignore'>.</span><span class='cumsum'> [164]</span><br>
<span class='word'>It</span> <span class='word'>should</span> <span class='word'>be</span> <span class='word'>possible</span> <span class='word'>to</span> <span class='word'>extend</span> <span class='word'>the</span> <span class='word'>CHERI-RVV</span> <span class='word'>ISA</span> <span class='word'>with</span> <span class='word'>vector</span> <span class='word'>equivalents</span> <span class='word'>of</span> <span class='word'>existing</span> <span class='word'>CHERI</span> <span class='word'>scalar</span> <span class='word'>instructions</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>we</span> <span class='word'>did</span> <span class='word'>not</span> <span class='word'>investigate</span> <span class='word'>this</span> <span class='word'>further</span><span class='ignore'>.</span><span class='cumsum'> [188]</span><br>
<span class='cumsum'> [188]</span><br>
<span class='word'>Overall</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>is</span> <span class='word'>clear</span> <span class='word'>that</span> <span class='word'>scalable</span> <span class='word'>vector</span> <span class='word'>models</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>adapted</span> <span class='word'>to</span> <span class='word'>CHERI</span> <span class='word'>without</span> <span class='word'>significant</span> <span class='word'>loss</span> <span class='word'>of</span> <span class='word'>functionality</span><span class='ignore'>.</span><span class='cumsum'> [206]</span><br>
<span class='word'>Most</span> <span class='word'>of</span> <span class='word'>the</span> <span class='word'>hypotheses</span> <span class='word'>are</span> <span class='word'>general</span> <span class='word'>enough</span> <span class='word'>to</span> <span class='word'>cover</span> <span class='word'>other</span> <span class='word'>scalable</span> <span class='word'>models</span><span class='ignore'>,</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>Arm</span> <span class='word'>SVE</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>any</span> <span class='word'>differences</span> <span class='word'>from</span> <span class='word'>RVV's</span> <span class='word'>model</span> <span class='word'>will</span> <span class='word'>require</span> <span class='word'>careful</span> <span class='word'>examination</span><span class='ignore'>.</span><span class='cumsum'> [231]</span><br>
<span class='word'>Given</span> <span class='word'>the</span> <span class='word'>importance</span> <span class='word'>of</span> <span class='word'>vector</span> <span class='word'>processing</span> <span class='word'>to</span> <span class='word'>modern</span> <span class='word'>computing</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>thus</span> <span class='word'>its</span> <span class='word'>importance</span> <span class='word'>to</span> <span class='word'>CHERI</span><span class='ignore'>,</span> <span class='word'>we</span> <span class='word'>hope</span> <span class='word'>that</span> <span class='word'>this</span> <span class='word'>research</span> <span class='word'>paves</span> <span class='word'>the</span> <span class='word'>way</span> <span class='word'>for</span> <span class='word'>future</span> <span class='word'>vector-enabled</span> <span class='word'>CHERI</span> <span class='word'>processors</span><span class='ignore'>.</span><span class='cumsum'> [259]</span><br>
<span class='cumsum'> [259]</span><br>
<span class='cmd'>\section</span><span class='ignore'>{</span><span class='hword'>Future</span> <span class='hword'>work</span><span class='ignore'>}</span><span class='cumsum'> [2]</span><br>
<span class='word'>The</span> <span class='word'>stated</span> <span class='word'>purpose</span> <span class='word'>of</span> <span class='word'>this</span> <span class='word'>project</span> <span class='word'>was</span> <span class='word'>to</span> <span class='word'>enable</span> <span class='word'>future</span> <span class='word'>implementations</span> <span class='word'>of</span> <span class='word'>CHERI-RVV</span> <span class='word'>and</span> <span class='word'>CHERI</span> <span class='word'>Arm</span> <span class='word'>SVE</span><span class='ignore'>.</span><span class='cumsum'> [19]</span><br>
<span class='word'>We've</span> <span class='word'>shown</span> <span class='word'>this</span> <span class='word'>is</span> <span class='word'>feasible</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>we</span> <span class='word'>believe</span> <span class='word'>our</span> <span class='word'>research</span> <span class='word'>is</span> <span class='word'>enough</span> <span class='word'>to</span> <span class='word'>create</span> <span class='word'>an</span> <span class='word'>initial</span> <span class='word'>CHERI-RVV</span> <span class='word'>specification</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>both</span> <span class='word'>could</span> <span class='word'>benefit</span> <span class='word'>from</span> <span class='word'>more</span> <span class='word'>research</span> <span class='word'>on</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>.</span><span class='cumsum'> [46]</span><br>
<span class='cumsum'> [46]</span><br>
<span class='word'>All</span> <span class='word'>architectures</span> <span class='word'>may</span> <span class='word'>benefit</span> <span class='word'>from</span> <span class='word'>more</span> <span class='word'>advanced</span> <span class='word'>vectorized</span> <span class='word'>capability</span> <span class='word'>manipulation</span><span class='ignore'>.</span><span class='cumsum'> [56]</span><br>
<span class='word'>Because</span> <span class='word'>these</span> <span class='word'>processes</span> <span class='word'>are</span> <span class='word'>still</span> <span class='word'>evolving</span><span class='ignore'>,</span> <span class='word'>it</span> <span class='word'>may</span> <span class='word'>be</span> <span class='word'>wise</span> <span class='word'>to</span> <span class='word'>standardize</span> <span class='word'>the</span> <span class='word'>first</span> <span class='word'>version</span> <span class='word'>of</span> <span class='word'>CHERI-RVV</span> <span class='word'>based</span> <span class='word'>on</span> <span class='word'>this</span> <span class='word'>dissertation</span> <span class='word'>and</span> <span class='word'>only</span> <span class='word'>add</span> <span class='word'>new</span> <span class='word'>instructions</span> <span class='word'>as</span> <span class='word'>required</span><span class='ignore'>.</span><span class='cumsum'> [84]</span><br>
<span class='word'>Once</span> <span class='word'>created</span><span class='ignore'>,</span> <span class='word'>the</span> <span class='word'>standard</span> <span class='word'>can</span> <span class='word'>be</span> <span class='word'>implemented</span> <span class='word'>in</span> <span class='word'>CHERI-Clang</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>See</span> <span class='cmd'>\cref</span><span class='ignore'>{</span><span class='ignore'>chap</span><span class='ignore'>:</span><span class='ignore'>software</span><span class='ignore'>:</span><span class='ignore'>sec</span><span class='ignore'>:</span><span class='ignore'>chericlangchanges</span><span class='ignore'>}</span> <span class='oword'>for</span> <span class='oword'>the</span> <span class='oword'>other</span> <span class='oword'>required</span> <span class='oword'>changes</span> <span class='oword'>to</span> <span class='oword'>CHERI-Clang</span><span class='ignore'>.</span><span class='ignore'>}</span> <span class='word'>and</span> <span class='word'>added</span> <span class='word'>to</span> <span class='word'>existing</span> <span class='word'>CHERI-RISC-V</span> <span class='word'>processors</span><span class='cmd'>\footnote</span><span class='ignore'>{</span><span class='oword'>\url</span><span class='ignore'>{</span><span class='ignore'>https</span><span class='ignore'>:</span><span class='ignore'>/</span><span class='ignore'>/</span><span class='ignore'>www.cl.cam.ac.uk</span><span class='ignore'>/</span><span class='ignore'>research</span><span class='ignore'>/</span><span class='ignore'>security</span><span class='ignore'>/</span><span class='ignore'>ctsrd</span><span class='ignore'>/</span><span class='ignore'>cheri</span><span class='ignore'>/</span><span class='ignore'>cheri-risc-v.html</span><span class='ignore'>}</span><span class='ignore'>}</span><span class='ignore'>.</span><span class='cumsum'> [108]</span><br>
<span class='cumsum'> [108]</span><br>
<span class='word'>More</span> <span class='word'>theoretically</span><span class='ignore'>,</span> <span class='word'>other</span> <span class='word'>vector</span> <span class='word'>models</span> <span class='word'>could</span> <span class='word'>benefit</span> <span class='word'>from</span> <span class='cmd'>\emph</span><span class='ignore'>{</span><span class='word'>dereferencing</span><span class='ignore'>}</span> <span class='word'>capabilities-in-vectors</span><span class='ignore'>.</span><span class='cumsum'> [118]</span><br>
<span class='word'>Arm</span> <span class='word'>SVE</span> <span class='word'>has</span> <span class='word'>addressing</span> <span class='word'>modes</span> <span class='word'>that</span> <span class='word'>directly</span> <span class='word'>use</span> <span class='word'>vector</span> <span class='word'>elements</span> <span class='word'>as</span> <span class='word'>memory</span> <span class='word'>references</span><span class='ignore'>,</span> <span class='word'>as</span> <span class='word'>do</span> <span class='word'>its</span> <span class='word'>predecessors</span> <span class='word'>and</span> <span class='word'>contemporaries</span><span class='ignore'>.</span><span class='cumsum'> [137]</span><br>
<span class='word'>A</span> <span class='word'>draft</span> <span class='word'>specification</span> <span class='word'>of</span> <span class='word'>CHERI-x86</span> <span class='word'>is</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>works</span><span class='cmd'>\cite</span><span class='optparm'>[</span><span class='word'>Chapter</span> <span class='word'>6</span><span class='optparm'>]</span><span class='ignore'>{</span><span class='ignore'>TR-951</span><span class='ignore'>}</span><span class='ignore'>,</span> <span class='word'>and</span> <span class='word'>existing</span> <span class='word'>x86</span> <span class='word'>vector</span> <span class='word'>models</span> <span class='word'>like</span> <span class='word'>AVX</span> <span class='word'>have</span> <span class='word'>similar</span> <span class='word'>features</span><span class='ignore'>.</span><span class='cumsum'> [158]</span><br>
<span class='word'>This</span> <span class='word'>may</span> <span class='word'>prove</span> <span class='word'>impractical</span><span class='ignore'>,</span> <span class='word'>but</span> <span class='word'>this</span> <span class='word'>could</span> <span class='word'>be</span> <span class='word'>mitigated</span> <span class='word'>by</span> <span class='word'>e.g</span><span class='ignore'>.</span> <span class='word'>replacing</span> <span class='word'>these</span> <span class='word'>addressing</span> <span class='word'>modes</span> <span class='word'>with</span> <span class='word'>variants</span> <span class='word'>of</span> <span class='word'>RVV's</span> <span class='ignore'>`</span><span class='ignore'>`</span><span class='word'>indexed</span><span class='ignore'>'</span><span class='ignore'>'</span> <span class='word'>mode</span><span class='ignore'>.</span><span class='cumsum'> [179]</span><br>
<span class='word'>Once</span> <span class='word'>this</span> <span class='word'>problem</span> <span class='word'>is</span> <span class='word'>solved</span><span class='ignore'>,</span> <span class='word'>CHERI</span> <span class='word'>will</span> <span class='word'>be</span> <span class='word'>able</span> <span class='word'>to</span> <span class='word'>match</span> <span class='word'>the</span> <span class='word'>memory</span> <span class='word'>access</span> <span class='word'>abilities</span> <span class='word'>of</span> <span class='word'>any</span> <span class='word'>vector</span> <span class='word'>ISA</span> <span class='word'>it</span> <span class='word'>needs</span> <span class='word'>to</span><span class='ignore'>,</span> <span class='word'>making</span> <span class='word'>it</span> <span class='word'>that</span> <span class='word'>much</span> <span class='word'>easier</span> <span class='word'>for</span> <span class='word'>industry</span> <span class='word'>to</span> <span class='word'>adopt</span> <span class='word'>CHERI</span> <span class='word'>in</span> <span class='word'>the</span> <span class='word'>long</span> <span class='word'>term</span><span class='ignore'>.</span><span class='cumsum'> [215]</span><br>
<span class='comment'>% Once this problem is solved, CHERI support may be extended to any vector models where it would help,</span><span class='cumsum'> [215]</span><br>
<span class='comment'>% Solving this problem may be the key to extending CHERI support to </span><span class='cumsum'> [215]</span><br>
<span class='comment'>% Regardless of the exact solution, we believe it is feasible to extend CHERI-support</span><span class='cumsum'> [215]</span><br>
<span class='cumsum'> [215]</span><br>
<span class='envir'>\end</span><span class='envir'>{document}</span><span class='cumsum'> [215]</span><br>
<span class='comment'>% --- End of included file ./1_60Conclusion/content.tex</span><span class='cumsum'> [215]</span><br>
<span class='cumsum'> [215]</span><br>
<span class='cmd'>\label</span><span class='ignore'>{</span><span class='ignore'>wc</span><span class='ignore'>:</span><span class='ignore'>end</span><span class='ignore'>}</span></p></div>
<br>
<div class='count'>
<ul class='count'>
<li class='header'>File: chapters.tex</li>
<li>Encoding: ascii</li>
<li>Sum count: 15017</li>
<li>Words in text: 13921</li>
<li>Words in headers: 227</li>
<li>Words outside text (captions, etc.): 836</li>
<li>Number of headers: 83</li>
<li>Number of floats/tables/figures: 9</li>
<li>Number of math inlines: 31</li>
<li>Number of math displayed: 2</li>
<li>Subcounts:</li>
<span class='subcount'>
<li class='fielddesc'>&nbsp; text+headers+captions (#headers/#floats/#inlines/#displayed)</li>
  <li>298+1+14 (1/0/0/0) Chapter: Introduction\label{wc:start}\label{chap:intro}</li>
  <li>389+1+19 (1/0/0/0) Section: Motivation</li>
  <li>350+3+2 (1/0/0/0) Section: Hypotheses and Aims</li>
  <li>84+1+0 (1/0/0/0) Chapter: Background\label{chap:background}</li>
  <li>182+1+0 (1/0/0/0) Section: RISC-V}\label{chap:bg:sec:riscv</li>
  <li>164+6+0 (1/0/0/0) Section: A brief history of vector processing}\label{chap:bg:rvvstart</li>
  <li>134+4+17 (1/0/0/0) Section: The RVV vector model}\label{chap:bg:sec:rvv:vector_model</li>
  <li>418+1+10 (1/0/0/0) Subsection: \code{vtype}}\label{chap:bg:subsec:vtype</li>
  <li>227+6+14 (1/0/0/0) Subsection: \code{vl} and \code{vstart} --- Prestart, body, tail}\label{chap:bg:subsec:vlvstart</li>
  <li>93+4+56 (1/0/0/0) Subsection: Masking --- Active/inactive elements}\label{chap:bg:subsec:rvvmasking</li>
  <li>728+10+41 (4/0/0/0) Subsection: Exception handling}\label{chap:bg:subsec:vexceptions</li>
  <li>75+1+5 (1/0/0/0) Subsection: Summary}\label{chap:bg:subsec:rvvsummary</li>
  <li>178+3+2 (1/0/1/0) Section: Previous RVV implementations\label{chap:bg:rvvend}</li>
  <li>98+3+0 (1/0/0/0) Section: RVV memory instructions\label{chap:bg:sec:rvvmemory}</li>
  <li>116+2+33 (1/0/3/0) Subsection: Segmented accesses</li>
  <li>159+7+21 (3/1/2/0) Subsection: Unit and Strided accesses}\label{chap:bg:sec:rvv:unitstrideaccess</li>
  <li>159+3+17 (1/1/1/0) Subsection: Unit fault-only-first loads}\label{chap:bg:sec:rvv:fof</li>
  <li>157+5+27 (3/1/2/0) Subsection: Indexed accesses}\label{rvv:indexedmem</li>
  <li>62+3+6 (1/1/0/0) Subsection: Unit whole-register accesses</li>
  <li>86+3+5 (1/1/0/0) Subsection: Unit bytemask accesses</li>
  <li>294+1+47 (1/1/0/0) Section: CHERI}\label{chap:bg:sec:cheri</li>
  <li>298+2+0 (1/0/0/0) Subsection: CHERI-RISC-V ISA</li>
  <li>132+2+0 (1/0/0/0) Subsection: Instruction changes}\label{cheri_instructions</li>
  <li>155+5+22 (1/0/0/0) Subsection: Capability and Integer encoding mode\label{chap:bg:subsec:cheriencodingmode}</li>
  <li>123+5+14 (1/0/0/0) Subsection: Pure-capability and Hybrid compilation modes}\label{cheri_purecap_hybrid</li>
  <li>134+2+0 (1/0/0/0) Subsection: Capability relocations\label{chap:bg:subsec:cherirelocs}</li>
  <li>67+3+10 (1/0/0/0) Chapter: Hardware emulation investigation\label{chap:hardware}</li>
  <li>168+3+12 (1/0/0/0) Section: Developing the emulator}\label{chap:software:sec:emu</li>
  <li>937+7+35 (3/0/1/0) Subsection: Emulating CHERI</li>
  <li>760+14+27 (5/0/0/0) Subsection: Emulating vectors</li>
  <li>67+2+0 (1/0/0/0) Section: Fast-path calculations\label{chap:hardware:sec:fastpath}</li>
  <li>224+3+53 (1/1/0/0) Subsection: Possible fast-path outcomes</li>
  <li>184+2+10 (1/0/1/2) Subsection: Whole-access fast-paths}\label{chap:hardware:subsec:wholeaccessfastpath</li>
  <li>537+3+23 (1/0/17/0) Subsection: $m$-element known-range fast-paths</li>
  <li>97+4+0 (1/0/0/0) Section: Going beyond the emulator</li>
  <li>124+2+0 (1/0/0/0) Subsection: Misaligned accesses</li>
  <li>149+6+20 (1/0/0/0) Subsection: Atomicity of accesses/General memory model</li>
  <li>110+6+25 (1/0/0/0) Subsection: Relaxed access ordering and precise traps</li>
  <li>402+2+0 (1/0/1/0) Section: Evaluating hypotheses</li>
  <li>50+4+0 (1/0/0/0) Chapter: The CHERI-RVV software stack\label{chap:software}</li>
  <li>65+3+0 (1/0/0/0) Section: Compiling vector code}\label{chap:software:sec:compilersupport</li>
  <li>85+2+32 (1/0/0/0) Subsection: Available compilers</li>
  <li>76+2+0 (1/0/0/0) Subsection: Automatic vectorization</li>
  <li>138+2+0 (1/0/0/0) Subsection: Vector intrinsics</li>
  <li>324+2+22 (1/1/0/0) Subsection: Inline assembly</li>
  <li>313+4+44 (1/1/0/0) Subsection: RVV vs. Arm SVE}\label{chap:soft:compiling:armsve</li>
  <li>69+5+0 (1/0/0/0) Section: Compiling vector code with CHERI-Clang}\label{chap:software:sec:chericlang</li>
  <li>197+6+0 (1/0/0/0) Subsection: Adapting vector assembly instructions to CHERI}\label{addingtochericlang</li>
  <li>200+5+24 (1/0/0/0) Subsection: Adapting vector intrinsics to CHERI</li>
  <li>206+6+6 (1/0/0/0) Subsection: Storing scalable vectors on the stack</li>
  <li>1004+9+8 (4/0/0/0) Section: Evaluating hypotheses}\label{chap:software:sec:hypotheses</li>
  <li>199+5+0 (1/0/0/0) Subsection: Testing and evaluation: \code{vector\_memcpy}}\label{chap:software:eval</li>
  <li>51+4+0 (1/0/0/0) Section: Recommended changes for CHERI-Clang}\label{chap:software:sec:chericlangchanges</li>
  <li>108+1+0 (1/0/0/0) Chapter: Capabilities-in-vectors\label{chap:capinvec}</li>
  <li>369+3+98 (1/0/0/0) Section: Changing the emulator</li>
  <li>686+11+0 (8/0/2/0) Section: Evaluating hypotheses</li>
  <li>108+6+0 (1/0/0/0) Subsection: Testing and evaluation: \code{vector\_memcpy\_pointers}}\label{chap:capinvec:eval</li>
  <li>93+1+6 (1/0/0/0) Chapter: Conclusion</li>
  <li>257+2+0 (1/0/0/0) Section: Evaluating hypotheses</li>
  <li>204+2+9 (1/0/0/0) Section: Future work</li>
</span>
</ul>
</div>
</div>

<div class="stylehelp"><p><h2>Format/colour codes of verbose output:</h2>

<span class='error'>ERROR</span>&nbsp;&nbsp;....&nbsp;&nbsp;TeXcount error message<br>
<span class='word'>Text which is counted</span>&nbsp;&nbsp;....&nbsp;&nbsp;counted as text words<br>
<span class='hword'>Header and title text</span>&nbsp;&nbsp;....&nbsp;&nbsp;counted as header words<br>
<span class='oword'>Caption text and footnotes</span>&nbsp;&nbsp;....&nbsp;&nbsp;counted as caption words<br>
<span class='altwd'>Words in user specified counters</span>&nbsp;&nbsp;....&nbsp;&nbsp;counted in separate counters<br>
<span class='ignore'>Ignored text or code</span>&nbsp;&nbsp;....&nbsp;&nbsp;excluded or ignored<br>
<span class='document'>\documentclass</span>&nbsp;&nbsp;....&nbsp;&nbsp;document start, beginning of preamble<br>
<span class='special'>Special macros, eg require special handling or have side-effects</span>&nbsp;&nbsp;....&nbsp;&nbsp;<br>
<span class='cmd'>\macro</span>&nbsp;&nbsp;....&nbsp;&nbsp;macro not counted, but parameters may be<br>
<span class='exclcmd'>\macro</span>&nbsp;&nbsp;....&nbsp;&nbsp;macro in excluded region<br>
<span class='option'>[Macro options]</span>&nbsp;&nbsp;....&nbsp;&nbsp;not counted<br>
<span class='optparm'>[Optional parameter]</span>&nbsp;&nbsp;....&nbsp;&nbsp;content parsed and styled as counted<br>
<span class='envir'>\begin{name}&nbsp; \end{name}</span>&nbsp;&nbsp;....&nbsp;&nbsp;environment<br>
<span class='exclenv'>\begin{name}&nbsp; \end{name}</span>&nbsp;&nbsp;....&nbsp;&nbsp;environment in excluded region<br>
<span class='specarg'>Special argument, eg with side-effects</span>&nbsp;&nbsp;....&nbsp;&nbsp;<br>
<span class='mathgroup'>$&nbsp; $</span>&nbsp;&nbsp;....&nbsp;&nbsp;counted as one equation<br>
<span class='exclmath'>$&nbsp; $</span>&nbsp;&nbsp;....&nbsp;&nbsp;equation in excluded region<br>
<span class='math'>2+2=4</span>&nbsp;&nbsp;....&nbsp;&nbsp;maths (inside $...$ etc.)<br>
<span class='mathcmd'>$\macro$</span>&nbsp;&nbsp;....&nbsp;&nbsp;macros inside maths<br>
<span class='comment'>% Comments</span>&nbsp;&nbsp;....&nbsp;&nbsp;not counted<br>
<span class='tc'>%TC:TeXcount instructions</span>&nbsp;&nbsp;....&nbsp;&nbsp;not counted<br>
<span class='fileinc'>File to include</span>&nbsp;&nbsp;....&nbsp;&nbsp;not counted but file may be counted later<br>
<span class='cumsum'>[cumsum]</span>&nbsp;&nbsp;....&nbsp;&nbsp;cumulative sum count<br>
</p></div>

</body>

</html>
